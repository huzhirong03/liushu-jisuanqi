<!DOCTYPE html>
<!--
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘                      å…­å”ç«ç®­è®¡ç®—å™¨ - ä»£ç ç´¢å¼•                              â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                           â•‘
â•‘  ã€æŸ¥æ‰¾æ–¹æ³•ã€‘æŒ‰ Ctrl+F æœç´¢å…³é”®è¯                                          â•‘
â•‘                                                                           â•‘
â•‘  1. é»˜è®¤å¼€å¥–å·ç ï¼ˆæµ‹è¯•ç”¨ï¼‰                                                  â•‘
â•‘     æœç´¢: ã€æµ‹è¯•ç”¨ã€‘é»˜è®¤å¼€å¥–å·ç                                             â•‘
â•‘                                                                           â•‘
â•‘  2. æ ¼å¼è§£ææ¨¡å—ï¼ˆè§£æä¸‹æ³¨æ–‡æœ¬ï¼‰                                            â•‘
â•‘     æœç´¢: ã€æ¨¡å—1ã€‘æ ¼å¼è§£ææ¨¡å—                                             â•‘
â•‘                                                                           â•‘
â•‘  3. è®¡ç®—é€»è¾‘æ¨¡å—ï¼ˆè®¡ç®—ä¸­å¥–ç»“æœï¼‰                                            â•‘
â•‘     æœç´¢: ã€æ¨¡å—2ã€‘è®¡ç®—é€»è¾‘æ¨¡å—                                             â•‘
â•‘                                                                           â•‘
â•‘  4. èµ”ç‡è®¾ç½®æ¨¡å—ï¼ˆèµ”ç‡è¯»å†™å¯¼å…¥å¯¼å‡ºï¼‰                                        â•‘
â•‘     æœç´¢: ã€æ¨¡å—3ã€‘èµ”ç‡è®¾ç½®æ¨¡å—                                             â•‘
â•‘                                                                           â•‘
â•‘  5. å¯¼å‡º/å¯¼å…¥èµ”ç‡æŒ‰é’®                                                      â•‘
â•‘     ä½ç½®: æ¿€æ´»ä¼šå‘˜é¡µé¢ â†’ èµ”ç‡é…ç½®å¤‡ä»½                                       â•‘
â•‘                                                                           â•‘
â•‘  â˜…â˜…â˜… 6. ã€AIæç¤ºè¯ã€‘å¤§æ¨¡å‹è¾“å…¥æç¤ºè¯ â˜…â˜…â˜…                                  â•‘
â•‘     æœç´¢: ã€AIæç¤ºè¯å¼€å§‹ã€‘                                                  â•‘
â•‘     è¯´æ˜: å‘é€ç»™DeepSeekå¤§æ¨¡å‹çš„æç¤ºè¯ï¼Œæ§åˆ¶AIå¦‚ä½•è§£æç”¨æˆ·è¾“å…¥              â•‘
â•‘                                                                           â•‘
â•‘  â˜…â˜…â˜… 7. ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘æµ‹è¯•å®Œæˆååˆ é™¤ â˜…â˜…â˜…                                  â•‘
â•‘     æœç´¢: ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘                                                    â•‘
â•‘     è¯´æ˜: å‘Šè¯‰AI"åˆ é™¤AIè°ƒè¯•æ˜¾ç¤ºä»£ç "å³å¯ç§»é™¤                               â•‘
â•‘                                                                           â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ã€æ”¯æŒçš„ç©æ³•ç±»å‹ã€‘å…±23ç§                                                   â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘  ç‰¹ç ç±»:     ç‰¹ç ã€ç”Ÿè‚–ç‰¹ç ï¼ˆä¹°Xå„Yï¼‰ã€å¤§å°å•åŒ                             â•‘
â•‘  å¹³ç‰¹ç±»:     å¹³ç‰¹ä¸€è‚–(ä¸€å‹)ã€å¹³ç‰¹äºŒè¿è‚–(äºŒå‹)ã€å¹³ç‰¹ä¸‰è¿è‚–(ä¸‰å‹)ã€           â•‘
â•‘             å¹³ç‰¹å››è¿è‚–ã€å¹³ç‰¹äº”è¿è‚–ã€å¹³ç‰¹å°¾æ•°                               â•‘
â•‘  ç”Ÿè‚–ç±»:     ç”Ÿè‚–ã€å…­è‚–ã€åˆè‚–ã€æ­£è‚–                                         â•‘
â•‘  æ³¢è‰²ç±»:     æ³¢è‰²ã€åŠæ³¢(çº¢å•/çº¢åŒ/è“å•/è“åŒ/ç»¿å¤§/ç»¿å°ç­‰)                    â•‘
â•‘  å¹³ç ç±»:     å•å¹³/å¹³ç                                                      â•‘
â•‘  è¿ç ç±»:     äºŒä¸­äºŒã€ä¸‰ä¸­ä¸‰ã€äºŒå…¨ä¸­ã€ä¸‰å…¨ä¸­ã€äºŒä¸­ç‰¹ã€ä¸‰ä¸­ç‰¹ã€ç‰¹ä¸²           â•‘
â•‘  ä¸ä¸­ç±»:     äº”ä¸ä¸­~åäºŒä¸ä¸­                                               â•‘
â•‘  å…¶ä»–:       æ€»å’Œå¤§å°å•åŒã€äº”è¡Œã€å®¶ç¦½é‡å…½ã€å¤´å°¾æ•°                           â•‘
â•‘                                                                           â•‘
â•‘  ã€é‡è¦åŒºåˆ†ã€‘"ä¹°çŒªå„10" vs "çŒªx10"                                          â•‘
â•‘  ä¹°çŒªå„10 â†’ ç”Ÿè‚–ç‰¹ç ï¼šä¹°çŒªçš„å·ç (7,19,31,43)å„10å…ƒ=40å…ƒï¼Œèµ”ç‡43            â•‘
â•‘  çŒªx10   â†’ ç”Ÿè‚–ï¼šä¹°çŒªç”Ÿè‚–10å…ƒï¼Œèµ”ç‡12                                      â•‘
â•‘                                                                           â•‘
â•‘  ã€åˆ«åæ˜ å°„ã€‘                                                              â•‘
â•‘  ä¸€å‹=å¹³ç‰¹ä¸€è‚–  äºŒå‹=å¹³ç‰¹äºŒè¿è‚–  ä¸‰å‹=å¹³ç‰¹ä¸‰è¿è‚–  å¹³ç =å•å¹³  +=å(å·ç )     â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
-->
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="å…­å”ç«ç®­è®¡ç®—å™¨">
    <meta name="theme-color" content="#1a1a2e">
    
    <title>å…­å”ç«ç®­è®¡ç®—å™¨</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            min-height: 100vh;
            color: #fff;
            padding: 15px;
            padding-top: max(15px, env(safe-area-inset-top));
            padding-bottom: max(15px, env(safe-area-inset-bottom));
        }
        
        .container {
            max-width: 500px;
            margin: 0 auto;
        }
        
        /* é¡¶éƒ¨æ ‡é¢˜ */
        .header {
            text-align: center;
            padding: 15px 0;
        }
        
        .header h1 {
            font-size: 24px;
            color: #e94560;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .header h1::before {
            content: '';
            width: 20px;
            height: 20px;
            background: #e94560;
            border-radius: 4px;
        }
        
        /* ä¿¡æ¯å¡ç‰‡ */
        .info-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .info-card {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .info-card.large {
            flex: 2;
        }
        
        .info-card-label {
            font-size: 11px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .info-card-value {
            font-size: 13px;
            color: #fff;
            font-family: 'Courier New', monospace;
            word-break: break-all;
        }
        
        .info-card-value.highlight {
            color: #fbbf24;
            font-weight: bold;
        }
        
        /* åŠŸèƒ½æŒ‰é’®åŒº */
        .btn-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .btn {
            flex: 1;
            padding: 10px 8px;
            border: none;
            border-radius: 8px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3px;
            max-width: 100px;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-success {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .btn-warning {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .btn:active {
            transform: scale(0.95);
        }
        
        .btn-icon {
            font-size: 16px;
        }
        
        .btn-row {
            justify-content: center;
        }
        
        /* å¼€å¥–æ˜¾ç¤ºåŒº */
        .lottery-display {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .lottery-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 12px;
            text-align: center;
        }
        
        .lottery-balls {
            display: flex;
            justify-content: center;
            align-items: center;
            flex-wrap: nowrap;
            gap: 6px;
            overflow-x: auto;
        }
        
        .ball-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1px;
            flex-shrink: 0;
        }
        
        .ball {
            width: 34px;
            height: 34px;
            min-width: 34px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            font-weight: bold;
            color: white;
            text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
            box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 -3px 6px rgba(0,0,0,0.2), inset 0 3px 6px rgba(255,255,255,0.3);
            /* åŠ¨ç”»æ•ˆæœ */
            opacity: 0;
            transform: scale(0.5);
            animation: ballAppear 0.4s ease-out forwards;
            animation-delay: var(--delay, 0s);
        }
        
        @keyframes ballAppear {
            to {
                opacity: 1;
                transform: scale(1);
            }
        }
        
        /* ç¦ç”¨åŠ¨ç”»æ—¶ç«‹å³æ˜¾ç¤º */
        .ball.no-anim {
            opacity: 1;
            transform: scale(1);
            animation: none;
        }
        
        .ball.red { background: linear-gradient(145deg, #ff6b6b, #c0392b); }
        .ball.blue { background: linear-gradient(145deg, #4dabf7, #2980b9); }
        .ball.green { background: linear-gradient(145deg, #51cf66, #27ae60); }
        
        .ball-info {
            font-size: 10px;
            color: #aaa;
            white-space: nowrap;
            font-weight: 500;
        }
        
        .ball-plus {
            font-size: 14px;
            color: #666;
            margin: 0 1px;
            flex-shrink: 0;
        }
        
        .lottery-empty {
            text-align: center;
            color: #666;
            padding: 20px;
            font-size: 14px;
        }
        
        /* è¾“å…¥æ¡†åŒº */
        .input-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .input-section-title {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }
        
        .input-textarea {
            width: 100%;
            height: 200px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 12px;
            color: #fff;
            font-size: 14px;
            font-family: 'Courier New', monospace;
            resize: none;
            outline: none;
        }
        
        .input-textarea::placeholder {
            color: #666;
        }
        
        .input-textarea:focus {
            border-color: #e94560;
        }
        
        /* æ“ä½œæŒ‰é’® */
        .action-row {
            display: flex;
            gap: 10px;
        }
        
        .btn-calculate {
            flex: 2;
            background: linear-gradient(90deg, #e94560, #ff6b6b);
            color: white;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-clear {
            flex: 1;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            padding: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }
        
        .btn-check {
            flex: 1;
            padding: 16px;
            border: none;
            border-radius: 10px;
            background: linear-gradient(90deg, #9b59b6, #8e44ad);
            color: white;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* æ ¸å¯¹è¯¦æƒ…é¡µæ ·å¼ */
        .check-summary {
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .check-summary-item {
            text-align: center;
        }
        
        .check-summary-label {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .check-summary-value {
            font-size: 18px;
            font-weight: bold;
        }
        
        .check-summary-value.win {
            color: #e74c3c;
        }
        
        .check-summary-value.lose {
            color: #2ecc71;
        }
        
        .check-detail-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .check-detail-item {
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            padding: 12px;
            border-left: 3px solid #666;
        }
        
        .check-detail-item.win {
            border-left-color: #e74c3c;
            background: rgba(231, 76, 60, 0.1);
        }
        
        .check-detail-item.lose {
            border-left-color: #2ecc71;
            background: rgba(46, 204, 113, 0.1);
        }
        
        .check-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        .check-detail-type {
            font-size: 13px;
            color: #fff;
            font-weight: bold;
        }
        
        .check-detail-badge {
            font-size: 11px;
            padding: 2px 8px;
            border-radius: 10px;
            background: #e74c3c;
            color: white;
        }
        
        .check-detail-badge.miss {
            background: #666;
        }
        
        .check-detail-info {
            font-size: 12px;
            color: #888;
            margin-bottom: 5px;
        }
        
        .check-detail-calc {
            font-size: 12px;
            color: #aaa;
            font-family: 'Courier New', monospace;
        }
        
        .check-detail-result {
            font-size: 16px;
            font-weight: bold;
            text-align: right;
            margin-top: 8px;
        }
        
        .check-detail-result.win {
            color: #e74c3c;
        }
        
        .check-detail-result.lose {
            color: #2ecc71;
        }
        
        /* é¡µé¢åˆ‡æ¢ */
        .page {
            display: none;
        }
        
        .page.active {
            display: block;
        }
        
        /* å­é¡µé¢å¤´éƒ¨ */
        .page-header {
            display: flex;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 15px;
        }
        
        .btn-back {
            background: none;
            border: none;
            color: #fff;
            font-size: 24px;
            cursor: pointer;
            padding: 5px 15px 5px 0;
        }
        
        .page-title {
            font-size: 18px;
            font-weight: bold;
        }
        
        /* è®¾ç½®é¡¹ */
        .setting-group {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
        }
        
        .setting-group-title {
            font-size: 14px;
            color: #e94560;
            margin-bottom: 15px;
            font-weight: bold;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-size: 14px;
        }
        
        .setting-input {
            width: 100px;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            padding: 8px 12px;
            color: #fbbf24;
            font-size: 14px;
            text-align: right;
            outline: none;
        }
        
        .setting-input:focus {
            border-color: #e94560;
        }
        
        /* å‚ç…§è¡¨ */
        .ref-table-wrap {
            overflow-x: auto;
            margin-top: 5px;
        }
        
        .ref-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 13px;
        }
        
        .ref-table th {
            background: rgba(233, 69, 96, 0.3);
            padding: 10px 8px;
            text-align: left;
            color: #fff;
            font-weight: bold;
            white-space: nowrap;
        }
        
        .ref-table td {
            padding: 10px 8px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: #ddd;
        }
        
        .ref-table tr:nth-child(even) {
            background: rgba(255, 255, 255, 0.03);
        }
        
        .ref-table .num-red { color: #e74c3c; font-weight: bold; }
        .ref-table .num-blue { color: #3498db; font-weight: bold; }
        .ref-table .num-green { color: #2ecc71; font-weight: bold; }
        
        /* æ¿€æ´»é¡µé¢ */
        .machine-code-display {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            margin-bottom: 15px;
        }
        
        .machine-code-value {
            font-family: 'Courier New', monospace;
            font-size: 20px;
            color: #fbbf24;
            letter-spacing: 2px;
        }
        
        .license-input {
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 15px;
            color: #fff;
            font-size: 16px;
            font-family: 'Courier New', monospace;
            text-align: center;
            outline: none;
            margin-bottom: 15px;
        }
        
        .btn-activate {
            width: 100%;
            background: linear-gradient(90deg, #27ae60, #2ecc71);
            color: white;
            padding: 16px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
        }
        
        /* AIæ¨¡å‹åˆ‡æ¢æŒ‰é’® */
        .ai-model-btn {
            flex: 1;
            min-width: 60px;
            padding: 10px 12px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #ccc;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }
        .ai-model-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.3);
        }
        .ai-model-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-color: #667eea;
            color: white;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }
        .ai-model-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* å¤šæ¨¡å‹å¯¹æ¯”æ ‡ç­¾ */
        .model-tab {
            flex: 1;
            padding: 10px 8px;
            background: transparent;
            border: none;
            border-bottom: 2px solid transparent;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }
        .model-tab:hover {
            background: rgba(255,255,255,0.05);
        }
        .model-tab.active {
            color: #fff;
            border-bottom-color: #667eea;
            background: rgba(102,126,234,0.1);
        }
        .model-tab.success {
            color: #81c784;
        }
        .model-tab.error {
            color: #ef5350;
        }
        .model-tab.warning {
            color: #ffa726;
        }
        .model-tab-name {
            font-size: 12px;
            font-weight: 600;
        }
        .model-tab-time {
            font-size: 10px;
            margin-top: 2px;
            opacity: 0.8;
        }
        
        .status-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            text-align: center;
        }
        
        .status-label {
            font-size: 12px;
            color: #888;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: bold;
            margin-top: 5px;
        }
        
        .status-value.active { color: #2ecc71; }
        .status-value.trial { color: #f39c12; }
        .status-value.expired { color: #e74c3c; }
        
        /* ç»“æœæ˜¾ç¤º */
        .result-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 15px;
            display: none;
        }
        
        .result-section.show {
            display: block;
        }
        
        .result-title {
            font-size: 14px;
            color: #e94560;
            margin-bottom: 10px;
            font-weight: bold;
        }
        
        .result-content {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 12px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .btn-copy-result {
            width: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            color: white;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 10px;
        }

        /* å¼€å¥–è¾“å…¥ */
        .lottery-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .lottery-num-input {
            width: 45px;
            height: 45px;
            background: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            font-size: 16px;
            font-weight: bold;
            text-align: center;
            outline: none;
        }
        
        .lottery-num-input:focus {
            border-color: #e94560;
        }
        
        .lottery-num-input.special {
            border-color: #fbbf24;
            color: #fbbf24;
        }
        
        .plus-sign {
            display: flex;
            align-items: center;
            font-size: 20px;
            color: #666;
        }
        
        .num-input-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
        }
        
        .num-label {
            font-size: 10px;
            color: #888;
        }
        
        .lottery-num-input {
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            color: #fff;
            font-size: 14px;
            font-weight: bold;
            text-align: center;
            outline: none;
        }
        
        .lottery-num-input:focus {
            border-color: #e94560;
        }
        
        .lottery-num-input.special {
            border-color: #fbbf24;
            color: #fbbf24;
        }
        
        .lottery-num-input.special:focus {
            border-color: #fbbf24;
            box-shadow: 0 0 8px rgba(251, 191, 36, 0.5);
        }
        
        .lottery-input-row {
            display: flex;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
        }
        
        /* å¯¼å…¥å¯¼å‡ºæŒ‰é’® */
        .config-btn-row {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
            justify-content: center;
        }
        
        .btn-config {
            padding: 8px 16px;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
            background: rgba(255,255,255,0.1);
            color: #fff;
        }
        
        .btn-config:active {
            transform: scale(0.95);
        }
        
        .btn-export {
            border-color: #3498db;
            color: #3498db;
        }
        
        .btn-import {
            border-color: #2ecc71;
            color: #2ecc71;
        }
        
        /* å¯¼å…¥å¼¹çª— */
        .import-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        .import-modal.show {
            display: flex;
        }
        
        .import-modal-content {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            width: 100%;
            max-width: 400px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .import-modal-title {
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #2ecc71;
        }
        
        .import-textarea {
            width: 100%;
            height: 150px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            color: #fff;
            padding: 10px;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            resize: none;
            margin-bottom: 15px;
        }
        
        .import-modal-btns {
            display: flex;
            gap: 10px;
        }
        
        .import-modal-btns button {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .btn-import-confirm {
            background: linear-gradient(90deg, #2ecc71, #27ae60);
            color: white;
        }
        
        .btn-import-cancel {
            background: rgba(255,255,255,0.1);
            color: #888;
        }
        
        /* èµ”ç‡è®¾ç½®æ–°å¸ƒå±€ */
        .odds-layout {
            display: flex;
            height: calc(100vh - 120px);
            gap: 0;
        }
        
        .odds-menu {
            width: 90px;
            background: rgba(0,0,0,0.3);
            border-radius: 10px 0 0 10px;
            overflow-y: auto;
            flex-shrink: 0;
        }
        
        .odds-menu-item {
            padding: 15px 10px;
            text-align: center;
            font-size: 13px;
            color: #888;
            cursor: pointer;
            border-bottom: 1px solid rgba(255,255,255,0.05);
            transition: all 0.3s;
        }
        
        .odds-menu-item:hover {
            background: rgba(255,255,255,0.05);
        }
        
        .odds-menu-item.active {
            background: rgba(233, 69, 96, 0.2);
            color: #e94560;
            border-left: 3px solid #e94560;
        }
        
        .odds-content {
            flex: 1;
            background: rgba(0,0,0,0.2);
            border-radius: 0 10px 10px 0;
            padding: 15px;
            overflow-y: auto;
        }
        
        .odds-panel {
            display: none;
        }
        
        .odds-panel.active {
            display: block;
        }
        
        .odds-panel-title {
            font-size: 14px;
            color: #e94560;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .odds-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        
        .odds-item-label {
            font-size: 13px;
            color: #ccc;
        }
        
        .odds-item-input {
            width: 80px;
            background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: #fff;
            padding: 8px;
            font-size: 14px;
            text-align: center;
        }
        
        .odds-note {
            font-size: 12px;
            color: #888;
            padding: 8px 10px;
            background: rgba(0,0,0,0.2);
            border-radius: 6px;
            margin-bottom: 10px;
            border-left: 3px solid #e94560;
        }
        
        .odds-save-btn {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: linear-gradient(90deg, #e94560, #c23a51);
            color: white;
            padding: 12px 40px;
            border: none;
            border-radius: 25px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ä¸»é¡µé¢ -->
        <div class="page active" id="page-main">
            <div class="header">
                <h1 style="color:#e94560;">ğŸš€å…­å”ç«ç®­è®¡ç®—å™¨</h1>
            </div>
            
            <!-- åŠŸèƒ½æŒ‰é’® - 4ä¸ª -->
            <div class="btn-row">
                <button class="btn btn-primary" onclick="showPage('page-lottery')">
                    <span class="btn-icon">ğŸ¯</span>
                    <span>å¼€å¥–è®¾ç½®</span>
                </button>
                <button class="btn btn-success" onclick="showPage('page-odds')">
                    <span class="btn-icon">âš™ï¸</span>
                    <span>èµ”ç‡è®¾ç½®</span>
                </button>
                <button class="btn" onclick="showPage('page-format')" style="background:linear-gradient(135deg,#e91e63,#9c27b0);">
                    <span class="btn-icon">âœï¸</span>
                    <span>è‡ªå®šä¹‰æ ¼å¼</span>
                </button>
                <button class="btn btn-warning" onclick="showPage('page-params')">
                    <span class="btn-icon">ğŸ”§</span>
                    <span>å‚æ•°è®¾ç½®</span>
                </button>
            </div>
            
            <!-- å¼€å¥–æ˜¾ç¤º - ä¸Šä¸‹å¸ƒå±€ -->
            <div class="lottery-display" style="padding:10px;">
                <!-- é¡¶éƒ¨ï¼šæ ‡é¢˜ + åˆ‡æ¢æŒ‰é’® -->
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                    <div style="display:flex;align-items:center;gap:6px;">
                        <span id="lottery-type-name" style="color:#e94560;font-weight:bold;font-size:15px;">æ–°æ¾³</span>
                        <span id="lottery-issue" style="color:#888;font-size:12px;">ç¬¬xxxæœŸ</span>
                        <span style="color:#888;font-size:12px;">å¼€å¥–ç»“æœ</span>
                    </div>
                    <div style="display:flex;gap:6px;align-items:center;">
                        <button id="btn-hk" onclick="switchLotteryType('hk')" class="lottery-switch-btn" style="padding:5px 12px;border-radius:5px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #4CAF50;background:transparent;color:#4CAF50;">é¦™æ¸¯</button>
                        <button id="btn-xam" onclick="switchLotteryType('xam')" class="lottery-switch-btn active" style="padding:5px 12px;border-radius:5px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #e94560;background:transparent;color:#e94560;">æ–°æ¾³</button>
                    </div>
                </div>
                <!-- ä¸‹æ–¹ï¼šå¼€å¥–å·ç ï¼ˆç´§å‡‘å¸ƒå±€ï¼‰+ å¤åˆ¶æŒ‰é’® -->
                <div style="display:flex;align-items:center;gap:8px;">
                    <div class="lottery-balls" id="lottery-balls" style="gap:4px;justify-content:flex-start;flex:1;">
                        <div class="lottery-empty">è¯·å…ˆè®¾ç½®å¼€å¥–å·ç </div>
                    </div>
                    <button onclick="copyLotteryResult()" style="padding:6px 12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:12px;cursor:pointer;white-space:nowrap;flex-shrink:0;">å¤åˆ¶</button>
                </div>
            </div>
            
            <!-- è¾“å…¥æ¡† - æ ‡é¢˜è¡Œå¸¦æŒ‰é’® -->
            <div class="input-section" style="flex:1;display:flex;flex-direction:column;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div class="input-section-title" style="margin-bottom:0;">ç²˜è´´ä¸‹æ³¨ä¿¡æ¯</div>
                    <div style="display:flex;gap:6px;align-items:center;">
                        <!-- è°ƒè¯•æŒ‰é’® -->
                        <button onclick="showAIDebug()" style="padding:4px 8px;background:linear-gradient(90deg,#9b59b6,#8e44ad);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="æŸ¥çœ‹AIè¯†åˆ«è¯¦æƒ…">ğŸ¤–AI</button>
                        <button onclick="showLocalDebug()" style="padding:4px 8px;background:linear-gradient(90deg,#27ae60,#229954);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="æŸ¥çœ‹ç¨‹åºè¯†åˆ«è¯¦æƒ…">ğŸ“‹ç¨‹åº</button>
                        <!-- å¤šæ¨¡å‹å¯¹æ¯”æŒ‰é’® -->
                        <button onclick="runMultiModelTest()" style="padding:4px 8px;background:linear-gradient(90deg,#f39c12,#e67e22);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•">ğŸ”¬å¯¹æ¯”</button>
                        <!-- åŸæœ‰æŒ‰é’® -->
                        <button onclick="showCheckDetail()" style="padding:6px 12px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:6px;font-size:12px;cursor:pointer;">ğŸ” æ ¸å¯¹</button>
                        <button onclick="clearInput()" style="padding:6px 12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:12px;cursor:pointer;">æ¸…ç©º</button>
                        <button onclick="calculateBets()" style="padding:6px 12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;">ğŸ“Š å¼€å§‹è®¡ç®—</button>
                    </div>
                </div>
                <textarea class="input-textarea" id="bet-input" style="flex:1;min-height:200px;" placeholder="åœ¨æ­¤ç²˜è´´ç”¨æˆ·å‘é€çš„ä¸‹æ³¨ä¿¡æ¯...

ç¤ºä¾‹ï¼š
31.34å„äºŒå
å°æ•°å„20
ä¹°çŒªå„10
ç‰¹43 20å…ƒ
10 12 20 22 23 25 33 40 43 44 30å„20
é¾™x10
ç‹—x80ï¼ŒçŒ´é¸¡x50"></textarea>
            </div>
            
            <!-- ç»“æœæ˜¾ç¤º -->
            <div class="result-section" id="result-section">
                <div class="result-title">è®¡ç®—ç»“æœ</div>
                <div class="result-content" id="result-content"></div>
                <button class="btn-copy-result" onclick="copyResult()">ğŸ“‹ å¤åˆ¶ç»“æœ</button>
            </div>
        </div>
        
        <!-- å¼€å¥–è®¾ç½®é¡µé¢ -->
        <div class="page" id="page-lottery">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">å¼€å¥–è®¾ç½®</div>
            </div>
            
            <!-- å¿«é€Ÿç²˜è´´è§£æ -->
            <div class="setting-group" style="padding:12px;">
                <!-- æ ‡é¢˜è¡Œï¼šæ ‡é¢˜ + æŒ‰é’® -->
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <div class="setting-group-title" style="margin-bottom:0;">å¿«é€Ÿç²˜è´´å¼€å¥–å·ç </div>
                    <button onclick="parseLotteryInput()" style="padding:6px 15px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;">
                        ğŸ” è§£æå¹¶å¡«å…¥
                    </button>
                </div>
                <!-- å¤§è¾“å…¥æ¡† -->
                <textarea id="paste-lottery-input" placeholder="ç¤ºèŒƒè¾“å…¥æ ¼å¼ï¼š&#10;01 08 09 15 24 26 ç‰¹27&#10;01.08.09.15.24.26.27&#10;01,08,09,15,24,26 ç‰¹27" style="width:100%;height:100px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;padding:12px;font-size:15px;resize:none;line-height:1.6;"></textarea>
                <!-- è§£æé¢„è§ˆ -->
                <div id="parse-preview" style="display:none;margin-top:8px;padding:8px;background:rgba(0,0,0,0.3);border-radius:8px;text-align:center;">
                    <div id="parse-preview-balls" style="display:flex;justify-content:center;align-items:center;gap:5px;flex-wrap:nowrap;"></div>
                </div>
            </div>
            
            <div class="setting-group" style="padding:12px;">
                <!-- æ ‡é¢˜è¡Œï¼šæ ‡é¢˜ + æŒ‰é’® -->
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                    <div class="setting-group-title" style="margin-bottom:0;">å¼€å¥–å·ç </div>
                    <button onclick="saveLotteryNumbers()" style="padding:6px 15px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:13px;cursor:pointer;">ä¿å­˜å¼€å¥–å·ç </button>
                </div>
                <!-- å•è¡Œæ˜¾ç¤º7ä¸ªè¾“å…¥æ¡† -->
                <div style="display:flex;align-items:center;justify-content:center;gap:4px;flex-wrap:nowrap;">
                    <input type="text" class="lottery-num-input" id="num1" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <input type="text" class="lottery-num-input" id="num2" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <input type="text" class="lottery-num-input" id="num3" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <input type="text" class="lottery-num-input" id="num4" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <input type="text" class="lottery-num-input" id="num5" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <input type="text" class="lottery-num-input" id="num6" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                    <span style="color:#e94560;font-weight:bold;font-size:16px;margin:0 2px;">+</span>
                    <input type="text" class="lottery-num-input special" id="num-special" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #f5a623;color:#f5a623;">
                </div>
                <div style="display:flex;justify-content:center;gap:4px;margin-top:4px;font-size:10px;color:#666;">
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:36px;text-align:center;">å¹³ç </span>
                    <span style="width:20px;"></span>
                    <span style="width:36px;text-align:center;color:#f5a623;">ç‰¹</span>
                </div>
            </div>
            
            <!-- å†å²è®°å½•é€‰æ‹© -->
            <div class="setting-group" style="padding:12px;">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                    <div class="setting-group-title" style="margin-bottom:0;">ğŸ“œ å†å²å¼€å¥–è®°å½•ï¼ˆæœ€è¿‘10æœŸï¼‰</div>
                    <button onclick="fetchHistoryData()" style="padding:5px 10px;background:linear-gradient(90deg,#9b59b6,#8e44ad);color:white;border:none;border-radius:5px;font-size:11px;cursor:pointer;">ğŸ”„ æ‰‹åŠ¨è·å–</button>
                </div>
                
                <!-- å½©ç§é€‰æ‹©æ ‡ç­¾ -->
                <div style="display:flex;gap:6px;margin-bottom:10px;">
                    <button id="history-btn-xam" onclick="switchHistoryType('xam')" class="history-type-btn active" style="flex:1;padding:8px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #e94560;background:rgba(233,69,96,0.2);color:#e94560;">æ–°æ¾³é—¨</button>
                    <button id="history-btn-hk" onclick="switchHistoryType('hk')" class="history-type-btn" style="flex:1;padding:8px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #4CAF50;background:transparent;color:#4CAF50;">é¦™æ¸¯</button>
                </div>
                
                <!-- å†å²è®°å½•åˆ—è¡¨ï¼ˆå¯æ»‘åŠ¨ï¼‰ -->
                <div id="history-list" style="max-height:220px;overflow-y:auto;background:rgba(0,0,0,0.2);border-radius:8px;padding:6px;-webkit-overflow-scrolling:touch;">
                    <div style="text-align:center;color:#666;font-size:12px;padding:20px;">ğŸ”„ æ­£åœ¨è‡ªåŠ¨åŠ è½½å†å²è®°å½•...</div>
                </div>
                
                <!-- å¼€å¥–æ—¶é—´æç¤º -->
                <div style="font-size:10px;color:#666;text-align:center;margin-top:8px;">
                    â° å¼€å¥–æ—¶é—´ï¼šæ–°æ¾³é—¨ 21:30 | é¦™æ¸¯ 21:30ï¼ˆå‘¨äºŒå››å…­ï¼‰| æ¾³é—¨ 22:30
                </div>
            </div>
            
            <!-- è‡ªåŠ¨è·å–å¼€å¥– -->
            <div class="setting-group" style="padding:12px;">
                <div class="setting-group-title" style="margin-bottom:10px;">ğŸ“¡ è‡ªåŠ¨è·å–å¼€å¥–æ•°æ®</div>
                
                <!-- å½©ç§é€‰æ‹© -->
                <div style="display:flex;gap:8px;margin-bottom:10px;">
                    <select id="lottery-type-select" style="flex:1;padding:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;font-size:14px;">
                        <option value="xam" selected>ğŸ‡²ğŸ‡´ æ–°æ¾³é—¨å…­åˆå½©</option>
                        <option value="hk">ğŸ‡­ğŸ‡° é¦™æ¸¯å…­åˆå½©</option>
                        <option value="am">ğŸ‡²ğŸ‡´ ãŠ£æ¾³é—¨å…­åˆå½©</option>
                    </select>
                    <button onclick="fetchLotteryData()" style="padding:10px 20px;background:linear-gradient(90deg,#4CAF50,#45a049);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;white-space:nowrap;">
                        ğŸ“¡ è·å–æœ€æ–°
                    </button>
                </div>
                
                <!-- è·å–çŠ¶æ€æ˜¾ç¤º -->
                <div id="fetch-status" style="display:none;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:13px;text-align:center;"></div>
                
                <!-- APIæ¥æºæç¤º -->
                <div style="font-size:11px;color:#666;text-align:center;margin-top:8px;">
                    æ•°æ®æ¥æºï¼šMarksix6ï¼ˆè‡ªåŠ¨è·å–ï¼‰
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">å±æ€§å‚ç…§è¡¨</div>
                <button class="btn btn-primary" onclick="showPage('page-reference')" style="width:100%;max-width:none;">
                    <span>ğŸ“– æŸ¥çœ‹ç”Ÿè‚–/æ³¢è‰²/äº”è¡Œå¯¹ç…§è¡¨</span>
                </button>
            </div>
        </div>
        
        <!-- èµ”ç‡è®¾ç½®é¡µé¢ -->
        <div class="page" id="page-odds">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">èµ”ç‡è®¾ç½®</div>
            </div>
            
            <div class="odds-layout">
                <!-- å·¦ä¾§èœå•ï¼ˆæŒ‰ç”¨æˆ·æä¾›çš„ç©æ³•ç±»å‹ï¼‰ -->
                <div class="odds-menu">
                    <div class="odds-menu-item active" onclick="showOddsPanel('tema')">ç‰¹ç </div>
                    <div class="odds-menu-item" onclick="showOddsPanel('daxiao')">å¤§å°å•åŒ</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('pingte')">å¹³ç‰¹ä¸€è‚–</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('pingte2')">å¹³ç‰¹è¿è‚–</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('pingtew')">å¹³ç‰¹å°¾æ•°</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('liuxiao')">å…­è‚–</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('danping')">å•å¹³(å¹³ç )</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('bose')">æ³¢è‰²</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('banbo')">åŠæ³¢</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('lianma')">è¿ç </div>
                    <div class="odds-menu-item" onclick="showOddsPanel('buzhong')">ä¸ä¸­</div>
                    <div class="odds-menu-item" onclick="showOddsPanel('qita')">å…¶ä»–</div>
                </div>
                
                <!-- å³ä¾§å†…å®¹ï¼ˆæŒ‰æ–°ç©æ³•ç±»å‹ï¼‰ -->
                <div class="odds-content">
                    <!-- ç‰¹ç  -->
                    <div class="odds-panel active" id="panel-tema">
                        <div class="odds-panel-title">ç‰¹ç èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç‰¹ç </span>
                            <input type="number" class="odds-item-input" id="odds-tema" value="43">
                        </div>
                    </div>
                    
                    <!-- å¤§å°å•åŒ -->
                    <div class="odds-panel" id="panel-daxiao">
                        <div class="odds-panel-title">å¤§å°å•åŒèµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¤§</span>
                            <input type="number" class="odds-item-input" id="odds-da" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å°</span>
                            <input type="number" class="odds-item-input" id="odds-xiao" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å•</span>
                            <input type="number" class="odds-item-input" id="odds-dan" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åŒ</span>
                            <input type="number" class="odds-item-input" id="odds-shuang" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆå¤§</span>
                            <input type="number" class="odds-item-input" id="odds-heda" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆå°</span>
                            <input type="number" class="odds-item-input" id="odds-hexiao" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆå•</span>
                            <input type="number" class="odds-item-input" id="odds-hedan" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆåŒ</span>
                            <input type="number" class="odds-item-input" id="odds-heshuang" value="1.98" step="0.01">
                        </div>
                    </div>
                    
                    <!-- å¹³ç‰¹ä¸€è‚– -->
                    <div class="odds-panel" id="panel-pingte">
                        <div class="odds-panel-title">å¹³ç‰¹ä¸€è‚–èµ”ç‡ï¼ˆåˆ«åï¼šä¸€å‹ï¼‰</div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹ä¸€è‚–</span>
                            <input type="number" class="odds-item-input" id="odds-pingte1" value="11" step="0.1">
                        </div>
                    </div>
                    
                    <!-- å¹³ç‰¹è¿è‚– -->
                    <div class="odds-panel" id="panel-pingte2">
                        <div class="odds-panel-title">å¹³ç‰¹è¿è‚–èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹äºŒè¿è‚–ï¼ˆäºŒå‹ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-pingte2x" value="26" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹ä¸‰è¿è‚–ï¼ˆä¸‰å‹ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-pingte3x" value="66" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹å››è¿è‚–</span>
                            <input type="number" class="odds-item-input" id="odds-pingte4x" value="180" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹äº”è¿è‚–</span>
                            <input type="number" class="odds-item-input" id="odds-pingte5x" value="500" step="0.1">
                        </div>
                    </div>
                    
                    <!-- å¹³ç‰¹å°¾æ•° -->
                    <div class="odds-panel" id="panel-pingtew">
                        <div class="odds-panel-title">å¹³ç‰¹å°¾æ•°èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¹³ç‰¹å°¾æ•°</span>
                            <input type="number" class="odds-item-input" id="odds-pingtew" value="2.8" step="0.1">
                        </div>
                    </div>
                    
                    <!-- å…­è‚– -->
                    <div class="odds-panel" id="panel-liuxiao">
                        <div class="odds-panel-title">å…­è‚–èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">å…­è‚–</span>
                            <input type="number" class="odds-item-input" id="odds-liuxiao" value="4.2" step="0.1">
                        </div>
                    </div>
                    
                    <!-- å•å¹³ï¼ˆå¹³ç ï¼‰ -->
                    <div class="odds-panel" id="panel-danping">
                        <div class="odds-panel-title">å•å¹³ï¼ˆå¹³ç ï¼‰èµ”ç‡</div>
                        <div class="odds-note">è¯´æ˜ï¼šæŒ‡é™¤ç‰¹ç å¤–çš„6ä¸ªæ­£ç </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å•å¹³/å¹³ç </span>
                            <input type="number" class="odds-item-input" id="odds-danping" value="8" step="0.1">
                        </div>
                    </div>
                    
                    <!-- æ³¢è‰² -->
                    <div class="odds-panel" id="panel-bose">
                        <div class="odds-panel-title">æ³¢è‰²èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">çº¢æ³¢</span>
                            <input type="number" class="odds-item-input" id="odds-red" value="2.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">è“æ³¢</span>
                            <input type="number" class="odds-item-input" id="odds-blue" value="2.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç»¿æ³¢</span>
                            <input type="number" class="odds-item-input" id="odds-green" value="2.8" step="0.1">
                        </div>
                    </div>
                    
                    <!-- åŠæ³¢ -->
                    <div class="odds-panel" id="panel-banbo">
                        <div class="odds-panel-title">åŠæ³¢èµ”ç‡</div>
                        <div class="odds-note">æ ¼å¼ï¼šæ³¢è‰²+å¤§å°/å•åŒï¼Œå¦‚ï¼šçº¢å•ã€è“åŒã€ç»¿å¤§</div>
                        <div class="odds-item">
                            <span class="odds-item-label">çº¢å¤§</span>
                            <input type="number" class="odds-item-input" id="odds-red-da" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">çº¢å°</span>
                            <input type="number" class="odds-item-input" id="odds-red-xiao" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">çº¢å•</span>
                            <input type="number" class="odds-item-input" id="odds-red-dan" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">çº¢åŒ</span>
                            <input type="number" class="odds-item-input" id="odds-red-shuang" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">è“å¤§</span>
                            <input type="number" class="odds-item-input" id="odds-blue-da" value="5" step="0.1">
                    </div>
                        <div class="odds-item">
                            <span class="odds-item-label">è“å°</span>
                            <input type="number" class="odds-item-input" id="odds-blue-xiao" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">è“å•</span>
                            <input type="number" class="odds-item-input" id="odds-blue-dan" value="5" step="0.1">
                    </div>
                        <div class="odds-item">
                            <span class="odds-item-label">è“åŒ</span>
                            <input type="number" class="odds-item-input" id="odds-blue-shuang" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç»¿å¤§</span>
                            <input type="number" class="odds-item-input" id="odds-green-da" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç»¿å°</span>
                            <input type="number" class="odds-item-input" id="odds-green-xiao" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç»¿å•</span>
                            <input type="number" class="odds-item-input" id="odds-green-dan" value="5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç»¿åŒ</span>
                            <input type="number" class="odds-item-input" id="odds-green-shuang" value="5" step="0.1">
                        </div>
                    </div>
                    
                    <!-- è¿ç  -->
                    <div class="odds-panel" id="panel-lianma">
                        <div class="odds-panel-title">è¿ç èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">äºŒä¸­äºŒ</span>
                            <input type="number" class="odds-item-input" id="odds-2z2" value="42" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ä¸‰ä¸­ä¸‰</span>
                            <input type="number" class="odds-item-input" id="odds-3z3" value="200" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äºŒå…¨ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-2qz" value="21" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ä¸‰å…¨ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-3qz" value="75" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äºŒä¸­ç‰¹</span>
                            <input type="number" class="odds-item-input" id="odds-2zt" value="8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ä¸‰ä¸­ç‰¹</span>
                            <input type="number" class="odds-item-input" id="odds-3zt" value="25" step="0.1">
                    </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ç‰¹ä¸²</span>
                            <input type="number" class="odds-item-input" id="odds-techuan" value="4.5" step="0.1">
                        </div>
                    </div>
                    
                    <!-- ä¸ä¸­ -->
                    <div class="odds-panel" id="panel-buzhong">
                        <div class="odds-panel-title">ä¸ä¸­èµ”ç‡ï¼ˆè‡ªé€‰ä¸ä¸­ï¼‰</div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”ä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-5bz" value="2.2" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å…­ä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-6bz" value="2.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ä¸ƒä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-7bz" value="3.6" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å…«ä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-8bz" value="4.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">ä¹ä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-9bz" value="6.5" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-10bz" value="9" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åä¸€ä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-11bz" value="12" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åäºŒä¸ä¸­</span>
                            <input type="number" class="odds-item-input" id="odds-12bz" value="16" step="0.1">
                        </div>
                    </div>
                    
                    <!-- å…¶ä»–ç©æ³• -->
                    <div class="odds-panel" id="panel-qita">
                        <div class="odds-panel-title">å…¶ä»–ç©æ³•èµ”ç‡</div>
                        <div class="odds-item">
                            <span class="odds-item-label">æ­£è‚–</span>
                            <input type="number" class="odds-item-input" id="odds-zhengxiao" value="2" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆè‚–ï¼ˆ2è‚–ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-hexiao2" value="6" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆè‚–ï¼ˆ3è‚–ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-hexiao3" value="4" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">åˆè‚–ï¼ˆ4è‚–ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-hexiao4" value="3" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">æ€»å’Œå¤§</span>
                            <input type="number" class="odds-item-input" id="odds-zongda" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">æ€»å’Œå°</span>
                            <input type="number" class="odds-item-input" id="odds-zongxiao" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">æ€»å’Œå•</span>
                            <input type="number" class="odds-item-input" id="odds-zongdan" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">æ€»å’ŒåŒ</span>
                            <input type="number" class="odds-item-input" id="odds-zongshuang" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å®¶ç¦½</span>
                            <input type="number" class="odds-item-input" id="odds-jiaqin" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">é‡å…½</span>
                            <input type="number" class="odds-item-input" id="odds-yeshou" value="1.98" step="0.01">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å¤´æ•°ï¼ˆ0-4å¤´ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-toushu" value="4" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">å°¾æ•°ï¼ˆ0-9å°¾ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-weishu" value="9" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”è¡Œï¼ˆé‡‘ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-wuxing-jin" value="4.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”è¡Œï¼ˆæœ¨ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-wuxing-mu" value="4.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”è¡Œï¼ˆæ°´ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-wuxing-shui" value="5.8" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”è¡Œï¼ˆç«ï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-wuxing-huo" value="4" step="0.1">
                        </div>
                        <div class="odds-item">
                            <span class="odds-item-label">äº”è¡Œï¼ˆåœŸï¼‰</span>
                            <input type="number" class="odds-item-input" id="odds-wuxing-tu" value="5.4" step="0.1">
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="odds-save-btn" onclick="saveOdds()">ğŸ’¾ ä¿å­˜èµ”ç‡</button>
        </div>
        
        <!-- è‡ªå®šä¹‰æ ¼å¼é¡µé¢ -->
        <div class="page" id="page-format">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">è‡ªå®šä¹‰æ ¼å¼</div>
            </div>
            
            <!-- AIæ™ºèƒ½è§£æè®¾ç½®ï¼ˆç®€åŒ–ç‰ˆ - å¯¹ç”¨æˆ·éšè—æŠ€æœ¯ç»†èŠ‚ï¼‰ -->
            <div class="setting-group" style="background:linear-gradient(135deg,rgba(102,126,234,0.2),rgba(118,75,162,0.2));border:1px solid rgba(102,126,234,0.3);">
                <div class="setting-group-title" style="color:#a78bfa;">ğŸ¤– AIæ™ºèƒ½è§£æ</div>
                <div style="font-size:12px;color:#888;margin-bottom:12px;">
                    å¼€å¯åå¯è‡ªåŠ¨è¯†åˆ«å„ç§å¤æ‚æ ¼å¼ï¼Œæ— éœ€æ‰‹åŠ¨é…ç½®
                </div>
                
                <div class="setting-item">
                    <span class="setting-item-label">å¯ç”¨AIæ™ºèƒ½è§£æ</span>
                    <input type="checkbox" id="ai-parse-enabled" checked style="width:20px;height:20px;">
                </div>
                
                <!-- AIæ¨¡å‹åˆ‡æ¢æŒ‰é’® -->
                <div style="margin-top:12px;">
                    <div style="font-size:12px;color:#888;margin-bottom:8px;">é€‰æ‹©AIæ¨¡å‹ï¼š</div>
                    <div id="ai-model-buttons" style="display:flex;gap:8px;flex-wrap:wrap;">
                        <button type="button" class="ai-model-btn active" data-provider="deepseek" onclick="switchAIModel('deepseek')">
                            ğŸš€ DS
                        </button>
                        <button type="button" class="ai-model-btn" data-provider="tuzi" onclick="switchAIModel('tuzi')">
                            ğŸŒ è°·æ­Œ
                        </button>
                        <button type="button" class="ai-model-btn" data-provider="qwen" onclick="switchAIModel('qwen')">
                            â˜ï¸ åƒé—®
                        </button>
                        <button type="button" class="ai-model-btn" data-provider="claude" onclick="switchAIModel('claude')">
                            ğŸ¤– Claude
                        </button>
                        <button type="button" class="ai-model-btn" data-provider="gpt" onclick="switchAIModel('gpt')">
                            ğŸ’¡ GPT5
                        </button>
                    </div>
                    <div id="ai-model-status" style="margin-top:8px;padding:8px;background:rgba(76,175,80,0.1);border-radius:6px;font-size:11px;color:#81c784;">
                        âœ… å½“å‰ï¼šDeepSeekï¼ˆå›½å†…ç›´è¿ï¼‰
                    </div>
                </div>
                
                <!-- éšè—çš„é…ç½® -->
                <div style="display:none;">
                    <select id="ai-provider">
                        <option value="deepseek" selected>DeepSeek</option>
                        <option value="qwen">é€šä¹‰åƒé—®</option>
                        <option value="claude">Claude Opus</option>
                        <option value="gpt">GPT 5.1</option>
                        <option value="tuzi">Gemini 3 Pro</option>
                    </select>
                    <input type="hidden" id="ai-api-key" value="">
                </div>
            </div>
            
            <!-- é¢„è®¾æ ¼å¼æ¨¡æ¿ -->
            <div class="setting-group">
                <div class="setting-group-title">ğŸ“‹ é¢„è®¾æ ¼å¼æ¨¡æ¿</div>
                <div style="font-size:12px;color:#888;margin-bottom:12px;">
                    å¸¸ç”¨ä¸‹æ³¨æ ¼å¼ï¼Œå‹¾é€‰å¯ç”¨å¯¹åº”è§£æè§„åˆ™
                </div>
                
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">31.34å„20 â†’ å¤šå·å„ä¸‹æ³¨</span>
                    <input type="checkbox" id="tpl-multi-num" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">ç‰¹43 20å…ƒ â†’ ç‰¹ç ä¸‹æ³¨</span>
                    <input type="checkbox" id="tpl-tema" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">ä¹°çŒªå„10 â†’ ç”Ÿè‚–ä¸‹æ³¨</span>
                    <input type="checkbox" id="tpl-shengxiao" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">46,45,X50 â†’ Xè¡¨ç¤ºé‡‘é¢</span>
                    <input type="checkbox" id="tpl-x-amount" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">5å°¾100 â†’ å°¾æ•°ä¸‹æ³¨</span>
                    <input type="checkbox" id="tpl-wei" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">å…­è‚–é¼ ç‰›è™200 â†’ å¤šè‚–ä¸‹æ³¨</span>
                    <input type="checkbox" id="tpl-duoxiao" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">å¹³ç‰¹çŒ´é¸¡å„200 â†’ å¹³ç‰¹ç”Ÿè‚–</span>
                    <input type="checkbox" id="tpl-pingte" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">çº¢æ³¢/è“æ³¢/ç»¿æ³¢ 50 â†’ æ³¢è‰²</span>
                    <input type="checkbox" id="tpl-bose" checked style="width:18px;height:18px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label" style="font-size:12px;">å¤§/å°/å•/åŒ 100 â†’ ä¸¤é¢</span>
                    <input type="checkbox" id="tpl-dxds" checked style="width:18px;height:18px;">
                </div>
            </div>
            
            <!-- åŸºç¡€è§£æè§„åˆ™ -->
            <div class="setting-group">
                <div class="setting-group-title">âš™ï¸ åŸºç¡€è§£æè§„åˆ™</div>
                
                <div class="setting-item">
                    <span class="setting-item-label">ä¸­æ–‡æ•°å­—è½¬é˜¿æ‹‰ä¼¯</span>
                    <input type="checkbox" id="format-cn-number" checked style="width:20px;height:20px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label">å¿½ç•¥å¤šä½™ç©ºæ ¼/æ ‡ç‚¹</span>
                    <input type="checkbox" id="format-ignore-space" checked style="width:20px;height:20px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label">è‡ªåŠ¨çº æ­£åŒéŸ³å­—</span>
                    <input type="checkbox" id="format-auto-correct" checked style="width:20px;height:20px;">
                </div>
            </div>
            
            <!-- è‡ªå®šä¹‰å…³é”®è¯æ˜ å°„ -->
            <div class="setting-group">
                <div class="setting-group-title">ğŸ·ï¸ è‡ªå®šä¹‰å…³é”®è¯</div>
                <div style="font-size:12px;color:#888;margin-bottom:10px;">
                    æ·»åŠ ç‰¹æ®Šå…³é”®è¯è¯†åˆ«ï¼ˆæ¯è¡Œä¸€ä¸ªï¼Œæ ¼å¼ï¼šå…³é”®è¯=ç©æ³•ï¼‰
                </div>
                <textarea id="custom-keywords" style="width:100%;height:100px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;padding:10px;font-size:13px;resize:none;" placeholder="ç¤ºä¾‹ï¼š
ä¸€å‹=ç‰¹ç 
äºŒå‹=æ­£ç 
ä¸‰å‹=æ­£ç ç‰¹
æ–°å¥¥=ç‰¹ç 
å¹³ç‰¹=å¹³ç‰¹ç”Ÿè‚–"></textarea>
            </div>
            
            <!-- è‡ªå®šä¹‰æ­£åˆ™æ¨¡æ¿ -->
            <div class="setting-group">
                <div class="setting-group-title">ğŸ“ è‡ªå®šä¹‰è§£ææ¨¡æ¿ï¼ˆé«˜çº§ï¼‰</div>
                <div style="font-size:12px;color:#888;margin-bottom:10px;">
                    æ·»åŠ è‡ªå®šä¹‰æ­£åˆ™è§£æè§„åˆ™ï¼ˆæ ¼å¼ï¼šæ¨¡æ¿å|æ­£åˆ™|ç©æ³•ç±»å‹ï¼‰
                </div>
                <textarea id="custom-templates" style="width:100%;height:80px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;padding:10px;font-size:12px;resize:none;font-family:monospace;" placeholder="ç¤ºä¾‹ï¼š
é¾™è™|([é¾™è™])(\d+)|é¾™è™
è¿ç |è¿ç ?(\d+(?:[,ï¼Œ]\d+)+)\s*(\d+)|è¿ç "></textarea>
            </div>
            
            <button onclick="saveFormatSettings()" style="width:100%;padding:12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;margin-top:15px;">
                ğŸ’¾ ä¿å­˜è®¾ç½®
            </button>
            
            <button onclick="resetFormatSettings()" style="width:100%;padding:10px;background:transparent;color:#888;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:13px;cursor:pointer;margin-top:10px;">
                ğŸ”„ æ¢å¤é»˜è®¤è®¾ç½®
            </button>
        </div>
        
        <!-- å‚æ•°è®¾ç½®é¡µé¢ -->
        <div class="page" id="page-params">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">å‚æ•°è®¾ç½®</div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">è®¡ç®—å®¹é”™è®¾ç½®</div>
                <div style="font-size:12px;color:#888;margin-bottom:15px;">
                    è°ƒæ•´è®¡ç®—çš„å®½å®¹åº¦ï¼Œé¿å…å› å°é”™è¯¯å¯¼è‡´è®¡ç®—å¤±è´¥
                </div>
                
                <div class="setting-item">
                    <span class="setting-item-label">å…è®¸çœç•¥"å…ƒ"å­—</span>
                    <input type="checkbox" id="param-omit-yuan" checked style="width:20px;height:20px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label">å…è®¸çœç•¥"ç "å­—</span>
                    <input type="checkbox" id="param-omit-ma" checked style="width:20px;height:20px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label">è‡ªåŠ¨çº æ­£åŒéŸ³å­—</span>
                    <input type="checkbox" id="param-auto-correct" checked style="width:20px;height:20px;">
                </div>
                <div class="setting-item">
                    <span class="setting-item-label">æ¨¡ç³ŠåŒ¹é…ç”Ÿè‚–</span>
                    <input type="checkbox" id="param-fuzzy-shengxiao" checked style="width:20px;height:20px;">
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">é‡‘é¢å•ä½è®¾ç½®</div>
                <div class="setting-item">
                    <span class="setting-item-label">é»˜è®¤å•ä½</span>
                    <select id="param-default-unit" style="background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;padding:8px 12px;font-size:13px;">
                        <option value="1">å…ƒ</option>
                        <option value="10">åå…ƒ</option>
                        <option value="100">ç™¾å…ƒ</option>
                    </select>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">ç‰¹æ®Šè®¡ç®—è§„åˆ™</div>
                <textarea id="custom-calc-rules" style="width:100%;height:80px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;padding:10px;font-size:13px;resize:none;" placeholder="æ·»åŠ ç‰¹æ®Šè®¡ç®—è§„åˆ™..."></textarea>
            </div>
            
            <button onclick="saveParamSettings()" style="width:100%;padding:12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;margin-top:15px;">
                ä¿å­˜è®¾ç½®
            </button>
            
            <!-- å¯¼å…¥å¯¼å‡ºé…ç½® -->
            <div class="setting-group" style="margin-top:20px;">
                <div class="setting-group-title">é…ç½®å¤‡ä»½ä¸æ¢å¤</div>
                <div style="font-size:12px;color:#888;margin-bottom:12px;">
                    å¯¼å‡ºèµ”ç‡é…ç½®å¯åœ¨å…¶ä»–è®¾å¤‡å¯¼å…¥ä½¿ç”¨
                </div>
                <div style="display:flex;gap:10px;">
                    <button onclick="showExportOptions()" style="flex:1;padding:12px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;">
                        ğŸ“¤ å¯¼å‡ºé…ç½®
                    </button>
                    <button onclick="showImportModal()" style="flex:1;padding:12px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;">
                        ğŸ“¥ å¯¼å…¥é…ç½®
                    </button>
                </div>
            </div>
        </div>
        
        <!-- æ¿€æ´»é¡µé¢ -->
        <div class="page" id="page-activate">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">æ¿€æ´»ä¼šå‘˜</div>
            </div>
            
            <div class="status-card">
                <div class="status-label">æˆæƒçŠ¶æ€</div>
                <div class="status-value trial" id="license-status">è¯•ç”¨æœŸå‰©ä½™ 7 å¤©</div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">è®¾å¤‡æœºå™¨ç </div>
                <div class="machine-code-display">
                    <div class="machine-code-value" id="machine-code">ç”Ÿæˆä¸­...</div>
                </div>
                <button class="btn btn-primary" onclick="copyMachineCode()" style="width:100%;">
                    <span>ğŸ“‹ å¤åˆ¶æœºå™¨ç </span>
                </button>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">è¾“å…¥æ¿€æ´»ç </div>
                <input type="text" class="license-input" id="license-input" placeholder="XXXX-XXXX-XXXX-XXXX">
                <button class="btn-activate" onclick="activateLicense()">ğŸ”“ æ¿€æ´»</button>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">èµ”ç‡é…ç½®å¤‡ä»½</div>
                <div class="config-btn-row">
                <button class="btn-config btn-export" onclick="showExportOptions()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
                <button class="btn-config btn-import" onclick="showImportModal()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                </div>
            </div>
            
        </div>
        
        <!-- æ ¸å¯¹è¯¦æƒ…é¡µé¢ -->
        <div class="page" id="page-check">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-main')">â†</button>
                <div class="page-title">æ ¸å¯¹è¯¦æƒ…</div>
            </div>
            
            <!-- æ±‡æ€»ä¿¡æ¯ -->
            <div class="check-summary">
                <div class="check-summary-item">
                    <div class="check-summary-label">æ€»ä¸‹æ³¨</div>
                    <div class="check-summary-value" id="check-total-bet">0</div>
                </div>
                <div class="check-summary-item">
                    <div class="check-summary-label">ä¸­å¥–æ³¨æ•°</div>
                    <div class="check-summary-value" id="check-win-count">0</div>
                </div>
                <div class="check-summary-item">
                    <div class="check-summary-label">ç»“ç®—ç»“æœ</div>
                    <div class="check-summary-value" id="check-result">0</div>
                </div>
            </div>
            
            <!-- è¯¦ç»†åˆ—è¡¨ -->
            <div class="setting-group">
                <div class="setting-group-title">ä¸‹æ³¨æ˜ç»†</div>
                <div class="check-detail-list" id="check-detail-list">
                    <!-- åŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>
        </div>
        
        <!-- å‚ç…§è¡¨é¡µé¢ -->
        <div class="page" id="page-reference">
            <div class="page-header">
                <button class="btn-back" onclick="showPage('page-lottery')">â†</button>
                <div class="page-title">å±æ€§å‚ç…§</div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">ç”Ÿè‚–å‚ç…§è¡¨</div>
                <div class="ref-table-wrap">
                    <table class="ref-table" id="ref-shengxiao"></table>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">äº”è¡Œå‚ç…§è¡¨</div>
                <div class="ref-table-wrap">
                    <table class="ref-table" id="ref-wuxing"></table>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">æ³¢è‰²å‚ç…§è¡¨</div>
                <div class="ref-table-wrap">
                    <table class="ref-table" id="ref-bose"></table>
                </div>
            </div>
            
            <div class="setting-group">
                <div class="setting-group-title">å®¶ç¦½é‡å…½å‚ç…§è¡¨</div>
                <div class="ref-table-wrap">
                    <table class="ref-table" id="ref-jiaqin"></table>
                </div>
            </div>
        </div>
    </div>
    
    <!-- å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•å¼¹çª— -->
    <div class="import-modal" id="multi-model-modal" style="display:none;">
        <div class="import-modal-content" style="max-width:95%;width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;">
            <div class="import-modal-title" style="display:flex;justify-content:space-between;align-items:center;">
                <span>ğŸ”¬ å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•</span>
                <span id="tuzi-site-info" style="font-size:11px;color:#4ade80;background:rgba(74,222,128,0.1);padding:2px 8px;border-radius:4px;margin-left:8px;">å½“å‰ç«™ç‚¹: å¹¿å·</span>
                <button onclick="closeMultiModelModal()" style="background:none;border:none;color:#888;font-size:20px;cursor:pointer;">Ã—</button>
            </div>
            
            <!-- æ¨¡å‹æ ‡ç­¾åˆ‡æ¢ -->
            <div id="model-tabs" style="display:flex;gap:0;margin-bottom:0;border-bottom:1px solid rgba(255,255,255,0.1);">
                <button class="model-tab active" data-model="deepseek" onclick="switchModelTab('deepseek')">
                    <div class="model-tab-name">DeepSeek</div>
                    <div class="model-tab-time" id="tab-time-deepseek">ç­‰å¾…ä¸­...</div>
                </button>
                <button class="model-tab" data-model="qwen" onclick="switchModelTab('qwen')">
                    <div class="model-tab-name">é€šä¹‰åƒé—®</div>
                    <div class="model-tab-time" id="tab-time-qwen">ç­‰å¾…ä¸­...</div>
                </button>
                <button class="model-tab" data-model="tuzi" onclick="switchModelTab('tuzi')">
                    <div class="model-tab-name">Gemini</div>
                    <div class="model-tab-time" id="tab-time-tuzi">ç­‰å¾…ä¸­...</div>
                </button>
                <button class="model-tab" data-model="claude" onclick="switchModelTab('claude')">
                    <div class="model-tab-name">Claude</div>
                    <div class="model-tab-time" id="tab-time-claude">ç­‰å¾…ä¸­...</div>
                </button>
                <button class="model-tab" data-model="gpt" onclick="switchModelTab('gpt')">
                    <div class="model-tab-name">GPT4o</div>
                    <div class="model-tab-time" id="tab-time-gpt">ç­‰å¾…ä¸­...</div>
                </button>
            </div>
            
            <!-- å¯¹æ¯”å†…å®¹åŒºåŸŸ -->
            <div style="flex:1;overflow-y:auto;padding:12px 0;">
                <!-- åŸå§‹è¾“å‡º -->
                <div style="margin-bottom:12px;">
                    <div style="font-size:11px;color:#888;margin-bottom:4px;">[åŸå§‹è¾“å‡ºå†…å®¹]</div>
                    <div id="model-raw-output" style="background:rgba(0,0,0,0.3);border-radius:6px;padding:10px;font-size:12px;color:#ccc;max-height:150px;overflow-y:auto;font-family:monospace;white-space:pre-wrap;word-break:break-all;">
                        ç­‰å¾…è¿è¡Œ...
                    </div>
                </div>
                
                <!-- è§£æç»“æœ -->
                <div style="margin-bottom:12px;">
                    <div style="font-size:11px;color:#888;margin-bottom:4px;">[è§£æç»“æœ]</div>
                    <div id="model-parsed-result" style="background:rgba(0,0,0,0.3);border-radius:6px;padding:10px;font-size:12px;color:#81c784;max-height:120px;overflow-y:auto;">
                        ç­‰å¾…è¿è¡Œ...
                    </div>
                </div>
                
                <!-- çŠ¶æ€å’Œæ“ä½œ -->
                <div id="model-status-area" style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(255,255,255,0.05);border-radius:6px;">
                    <div id="model-status" style="font-size:12px;color:#888;">
                        â³ ç­‰å¾…è¿è¡Œ
                    </div>
                    <button id="model-use-btn" onclick="useModelResult()" style="display:none;padding:8px 16px;background:linear-gradient(90deg,#27ae60,#2ecc71);color:white;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;">
                        âœ… é€‰ç”¨æ­¤ç»“æœ
                    </button>
                </div>
            </div>
            
            <!-- åº•éƒ¨æ“ä½œ -->
            <div style="padding-top:12px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:10px;">
                <button onclick="runMultiModelTest()" style="flex:1;padding:12px;background:linear-gradient(90deg,#667eea,#764ba2);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;">
                    ğŸ”„ é‡æ–°æµ‹è¯•
                </button>
                <button onclick="closeMultiModelModal()" style="flex:1;padding:12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:14px;cursor:pointer;">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>
    
    <!-- å¯¼å‡ºé€‰é¡¹å¼¹çª— -->
    <div class="import-modal" id="export-modal">
        <div class="import-modal-content">
            <div class="import-modal-title">ğŸ“¤ å¯¼å‡ºé…ç½®</div>
            <div style="display:flex;flex-direction:column;gap:12px;">
                <button onclick="exportCopy()" style="width:100%;padding:15px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;border:none;border-radius:10px;font-size:14px;font-weight:bold;cursor:pointer;">
                    ğŸ“‹ å¤åˆ¶é…ç½®æ–‡æœ¬ï¼ˆæ¨èï¼‰
                </button>
                <div style="color:#888;font-size:12px;text-align:center;">
                    å¤åˆ¶åå¯ç›´æ¥ç²˜è´´åˆ°å¾®ä¿¡å‘é€
                </div>
                <button onclick="exportDownload()" style="width:100%;padding:15px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:10px;font-size:14px;cursor:pointer;">
                    ğŸ’¾ ä¸‹è½½ä¸ºæ–‡ä»¶
                </button>
            </div>
            <button onclick="hideExportModal()" style="width:100%;padding:12px;background:transparent;color:#666;border:none;font-size:14px;cursor:pointer;margin-top:15px;">
                å–æ¶ˆ
            </button>
        </div>
    </div>
    
    <!-- å¯¼å…¥é…ç½®å¼¹çª— -->
    <div class="import-modal" id="import-modal">
        <div class="import-modal-content">
            <div class="import-modal-title">ğŸ“¥ å¯¼å…¥é…ç½®</div>
            
            <div style="background:rgba(46,204,113,0.1);border:1px solid rgba(46,204,113,0.3);border-radius:8px;padding:12px;margin-bottom:15px;">
                <div style="color:#2ecc71;font-size:13px;font-weight:bold;margin-bottom:8px;">ğŸ’¡ æ¨èæ–¹å¼ï¼šç²˜è´´å¯¼å…¥</div>
                <div style="color:#888;font-size:12px;">
                    1. åœ¨å¾®ä¿¡æ‰“å¼€æ”¶åˆ°çš„é…ç½®æ–‡ä»¶<br>
                    2. é•¿æŒ‰å†…å®¹ â†’ å…¨é€‰ â†’ å¤åˆ¶<br>
                    3. å›åˆ°è¿™é‡Œç²˜è´´åˆ°ä¸‹æ–¹è¾“å…¥æ¡†
                </div>
            </div>
            
            <textarea class="import-textarea" id="import-textarea" placeholder="é•¿æŒ‰æ­¤å¤„ç²˜è´´é…ç½®å†…å®¹...&#10;&#10;ï¼ˆä»å¾®ä¿¡å¤åˆ¶çš„é…ç½®æ–‡æœ¬ï¼‰" style="height:120px;"></textarea>
            
            <button onclick="importConfig()" style="width:100%;padding:14px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;border:none;border-radius:8px;font-size:15px;font-weight:bold;cursor:pointer;margin:10px 0;">
                âœ… ç¡®è®¤å¯¼å…¥
            </button>
            
            <div style="text-align:center;color:#666;font-size:12px;margin:15px 0;">â€” æˆ–è€…é€‰æ‹©æ–‡ä»¶ â€”</div>
            
            <!-- æ–‡ä»¶é€‰æ‹© - åªæ¥å—æ–‡æœ¬æ–‡ä»¶ï¼Œé¿å…æ˜¾ç¤ºæ‹ç…§é€‰é¡¹ -->
            <input type="file" id="import-file" accept=".txt,.json,text/plain,application/json" style="display:none;" onchange="handleFileSelect(event)">
            <button onclick="document.getElementById('import-file').click()" style="width:100%;padding:12px;background:rgba(255,255,255,0.1);color:#aaa;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:13px;cursor:pointer;">
                ğŸ“ ä»æ–‡ä»¶Appé€‰æ‹©
            </button>
            
            <button onclick="hideImportModal()" style="width:100%;padding:12px;background:transparent;color:#666;border:none;font-size:13px;cursor:pointer;margin-top:10px;">
                å–æ¶ˆ
            </button>
        </div>
    </div>
    
    <script>
    // ==================== å…­åˆå½©æ•°æ® ====================
    const LHC_DATA = {
        // ç”Ÿè‚–å¯¹åº”å·ç ï¼ˆ2024å¹´ä¸ºåŸºå‡†ï¼‰
        shengxiao: {
            'é¼ ': [6, 18, 30, 42],
            'ç‰›': [5, 17, 29, 41],
            'è™': [4, 16, 28, 40],
            'å…”': [3, 15, 27, 39],
            'é¾™': [2, 14, 26, 38],
            'è›‡': [1, 13, 25, 37, 49],
            'é©¬': [12, 24, 36, 48],
            'ç¾Š': [11, 23, 35, 47],
            'çŒ´': [10, 22, 34, 46],
            'é¸¡': [9, 21, 33, 45],
            'ç‹—': [8, 20, 32, 44],
            'çŒª': [7, 19, 31, 43]
        },
        
        // äº”è¡Œå¯¹åº”å·ç 
        wuxing: {
            'é‡‘': [3, 4, 11, 12, 25, 26, 33, 34, 41, 42],
            'æœ¨': [7, 8, 15, 16, 23, 24, 37, 38, 45, 46],
            'æ°´': [13, 14, 21, 22, 29, 30, 43, 44],
            'ç«': [1, 2, 9, 10, 17, 18, 31, 32, 39, 40, 47, 48],
            'åœŸ': [5, 6, 19, 20, 27, 28, 35, 36, 49]
        },
        
        // æ³¢è‰²å¯¹åº”å·ç 
        bose: {
            'çº¢æ³¢': [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46],
            'è“æ³¢': [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48],
            'ç»¿æ³¢': [5, 6, 11, 16, 17, 21, 22, 27, 28, 32, 33, 38, 39, 43, 44, 49]
        },
        
        // å®¶ç¦½é‡å…½
        jiaqin: {
            'å®¶ç¦½': ['ç‰›', 'é©¬', 'ç¾Š', 'é¸¡', 'ç‹—', 'çŒª'],
            'é‡å…½': ['é¼ ', 'è™', 'å…”', 'é¾™', 'è›‡', 'çŒ´']
        }
    };
    
    // ==================== çŠ¶æ€ç®¡ç† ====================
    let appState = {
        lotteryNumbers: [],  // å½“å‰æ˜¾ç¤ºçš„å¼€å¥–å·ç  [1,2,3,4,5,6,ç‰¹ç ]
        currentLotteryType: 'xam',  // å½“å‰é€‰ä¸­çš„å½©ç§ï¼šxam=æ–°æ¾³é—¨, hk=é¦™æ¸¯
        lotteryData: {
            xam: { numbers: [], issue: '', time: '', source: '' },  // æ–°æ¾³é—¨æ•°æ®
            hk: { numbers: [], issue: '', time: '', source: '' }    // é¦™æ¸¯æ•°æ®
        },
        lotteryHistory: {
            xam: [],  // æ–°æ¾³é—¨å†å²è®°å½•ï¼Œæœ€å¤š10æœŸ [{numbers, issue, time, source}, ...]
            hk: []    // é¦™æ¸¯å†å²è®°å½•ï¼Œæœ€å¤š10æœŸ
        },
        odds: {
            tema: 43,
            shengxiao: 12,
            red: 2.8,
            blue: 2.8,
            green: 2.8,
            daxiao: 2,
            danshuang: 2
        },
        machineCode: '',
        isActivated: false,
        trialDaysLeft: 7
    };
    
    // ==================== è°ƒè¯•ä¿¡æ¯å­˜å‚¨ ====================
    let debugInfo = {
        aiInput: '',           // AIè¾“å…¥
        aiOutput: '',          // AIåŸå§‹è¾“å‡º
        aiParsed: null,        // AIè§£æåçš„JSON
        aiBets: [],            // AIè¯†åˆ«çš„ä¸‹æ³¨åˆ—è¡¨
        localBets: [],         // ç¨‹åºè¯†åˆ«çš„ä¸‹æ³¨åˆ—è¡¨
        lastError: ''          // æœ€åä¸€æ¬¡é”™è¯¯
    };
    
    // æ˜¾ç¤ºAIè¯†åˆ«è¯¦æƒ…
    function showAIDebug() {
        let content = `<div style="max-height:70vh;overflow:auto;font-size:13px;line-height:1.6;">`;
        content += `<h3 style="color:#9b59b6;margin:0 0 10px;">ğŸ¤– AIè¯†åˆ«è¯¦æƒ…</h3>`;
        
        if (debugInfo.lastError) {
            content += `<div style="background:#c0392b;padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>âŒ é”™è¯¯ï¼š</strong>${debugInfo.lastError}
            </div>`;
        }
        
        // æ˜¾ç¤ºç½‘ç»œè¯Šæ–­ä¿¡æ¯
        if (debugInfo.requestMode || debugInfo.networkError) {
            content += `<div style="background:rgba(52,152,219,0.3);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>ğŸŒ ç½‘ç»œè¯Šæ–­ï¼š</strong><br>
                <small>è¯·æ±‚æ¨¡å¼: ${debugInfo.requestMode || 'æœªçŸ¥'}</small><br>
                <small>ç›®æ ‡åœ°å€: ${(debugInfo.targetUrl || '').substring(0, 50)}...</small>`;
            if (debugInfo.networkError) {
                content += `<br><span style="color:#e74c3c;"><strong>âš ï¸ ${debugInfo.networkError}</strong></span>`;
            }
            if (debugInfo.rawResponse && !debugInfo.aiOutput) {
                content += `<br><small style="color:#95a5a6;">åŸå§‹å“åº”: ${(debugInfo.rawResponse || '').substring(0, 100)}...</small>`;
            }
            content += `</div>`;
        }
        
        // æ˜¾ç¤ºå­—ç¬¦è§„èŒƒåŒ–ä¿¡æ¯ï¼ˆè¯Šæ–­æ‰‹æœºè¾“å…¥é—®é¢˜ï¼‰
        if (debugInfo.normalizeInfo) {
            content += `<div style="background:rgba(241,196,15,0.3);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>ğŸ“± å­—ç¬¦è§„èŒƒåŒ–ï¼š</strong>${debugInfo.normalizeInfo}
                <br><small style="color:#f1c40f;">ï¼ˆæ£€æµ‹åˆ°ç‰¹æ®Šå­—ç¬¦ï¼Œå·²è‡ªåŠ¨è½¬æ¢ï¼‰</small>
            </div>`;
        }
        
        content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
            <strong>ğŸ“¤ AIè¾“å…¥ï¼ˆç”¨æˆ·åŸæ–‡ï¼‰ï¼š</strong><br>
            <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;">${debugInfo.aiInput || 'æ— '}</pre>
        </div>`;
        
        content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
            <strong>ğŸ“¥ AIåŸå§‹è¾“å‡ºï¼š</strong><br>
            <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${debugInfo.aiOutput || 'æ— '}</pre>
        </div>`;
        
        content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
            <strong>ğŸ” AIè¯†åˆ«ç»“æœï¼š</strong><br>`;
        if (debugInfo.aiParsed && debugInfo.aiParsed.items) {
            content += `<table style="width:100%;border-collapse:collapse;margin-top:8px;">
                <tr style="background:rgba(0,0,0,0.3);"><th style="padding:6px;border:1px solid #555;">åŸæ–‡</th><th style="padding:6px;border:1px solid #555;">AIè¯†åˆ«ç±»å‹</th></tr>`;
            for (const item of debugInfo.aiParsed.items) {
                content += `<tr><td style="padding:6px;border:1px solid #555;">${item.raw || ''}</td><td style="padding:6px;border:1px solid #555;color:#9b59b6;font-weight:bold;">${item.type || ''}</td></tr>`;
            }
            content += `</table>`;
        } else {
            content += `<span style="color:#888;">æ— è¯†åˆ«ç»“æœ</span>`;
        }
        content += `</div>`;
        
        content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;">
            <strong>ğŸ“Š æœ€ç»ˆæå–çš„ä¸‹æ³¨ï¼ˆ${debugInfo.aiBets.length}æ¡ï¼‰ï¼š</strong><br>`;
        if (debugInfo.aiBets.length > 0) {
            content += `<pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${JSON.stringify(debugInfo.aiBets, null, 2)}</pre>`;
        } else {
            content += `<span style="color:#888;">æ— </span>`;
        }
        content += `</div></div>`;
        
        showDebugModal('ğŸ¤– AIè¯†åˆ«è¯¦æƒ…', content);
    }
    
    // æ˜¾ç¤ºç¨‹åºè¯†åˆ«è¯¦æƒ…
    function showLocalDebug() {
        const input = document.getElementById('bet-input').value.trim();
        
        // é‡æ–°æ‰§è¡Œæœ¬åœ°è§£æ
        const localBets = parseBetInput(input);
        debugInfo.localBets = localBets;
        
        let content = `<div style="max-height:70vh;overflow:auto;font-size:13px;line-height:1.6;">`;
        content += `<h3 style="color:#27ae60;margin:0 0 10px;">ğŸ“‹ ç¨‹åºæœ¬åœ°è¯†åˆ«è¯¦æƒ…</h3>`;
        
        content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
            <strong>ğŸ“¤ è¾“å…¥ï¼ˆç”¨æˆ·åŸæ–‡ï¼‰ï¼š</strong><br>
            <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;">${input || 'æ— '}</pre>
        </div>`;
        
        content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
            <strong>ğŸ” é€è¡Œè¯†åˆ«ç»“æœï¼š</strong><br>`;
        const lines = input.split('\n').filter(l => l.trim());
        if (lines.length > 0) {
            content += `<table style="width:100%;border-collapse:collapse;margin-top:8px;">
                <tr style="background:rgba(0,0,0,0.3);"><th style="padding:6px;border:1px solid #555;">åŸæ–‡</th><th style="padding:6px;border:1px solid #555;">ç¨‹åºè¯†åˆ«ç±»å‹</th></tr>`;
            for (const line of lines) {
                const lineBets = parseBetLine(line.trim());
                const types = lineBets.map(b => b.type).join(', ') || 'æœªè¯†åˆ«';
                content += `<tr><td style="padding:6px;border:1px solid #555;">${line}</td><td style="padding:6px;border:1px solid #555;color:#27ae60;font-weight:bold;">${types}</td></tr>`;
            }
            content += `</table>`;
        } else {
            content += `<span style="color:#888;">æ— è¾“å…¥</span>`;
        }
        content += `</div>`;
        
        content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;">
            <strong>ğŸ“Š æœ€ç»ˆæå–çš„ä¸‹æ³¨ï¼ˆ${localBets.length}æ¡ï¼‰ï¼š</strong><br>`;
        if (localBets.length > 0) {
            content += `<pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${JSON.stringify(localBets, null, 2)}</pre>`;
        } else {
            content += `<span style="color:#888;">æ— </span>`;
        }
        content += `</div></div>`;
        
        showDebugModal('ğŸ“‹ ç¨‹åºè¯†åˆ«è¯¦æƒ…', content);
    }
    
    // æ˜¾ç¤ºè°ƒè¯•å¼¹çª—
    function showDebugModal(title, content) {
        // ç§»é™¤å·²æœ‰å¼¹çª—
        const existing = document.getElementById('debug-modal');
        if (existing) existing.remove();
        
        const modal = document.createElement('div');
        modal.id = 'debug-modal';
        modal.innerHTML = `
            <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:99999;display:flex;justify-content:center;align-items:center;padding:20px;">
                <div style="background:#1a1a2e;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.5);">
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:rgba(0,0,0,0.3);border-bottom:1px solid rgba(255,255,255,0.1);">
                        <span style="font-weight:bold;font-size:16px;">${title}</span>
                        <button onclick="document.getElementById('debug-modal').remove()" style="background:none;border:none;color:white;font-size:24px;cursor:pointer;padding:0 5px;">Ã—</button>
                    </div>
                    <div style="padding:20px;overflow:auto;max-height:calc(90vh - 60px);">
                        ${content}
                    </div>
                </div>
            </div>
        `;
        document.body.appendChild(modal);
    }
    
    // ==================== åˆå§‹åŒ– ====================
    async function init() {
        console.log('ğŸš€ [init] åº”ç”¨åˆå§‹åŒ–å¼€å§‹...');
        console.log('ğŸ“ [init] å½“å‰URL:', window.location.href);
        console.log('â° [init] åˆå§‹åŒ–æ—¶é—´:', new Date().toLocaleString('zh-CN'));
        
        try {
            // ç”Ÿæˆæœºå™¨ç 
            console.log('ğŸ”‘ [init] ç”Ÿæˆæœºå™¨ç ...');
            appState.machineCode = await generateMachineCode();
            document.getElementById('machine-code').textContent = appState.machineCode;
            console.log('âœ… [init] æœºå™¨ç ç”Ÿæˆå®Œæˆ:', appState.machineCode);
            
            // åŠ è½½ä¿å­˜çš„é…ç½®
            console.log('ğŸ“‚ [init] åŠ è½½æœ¬åœ°é…ç½®...');
            loadConfig();
            console.log('âœ… [init] é…ç½®åŠ è½½å®Œæˆ');
            
            // æ¢å¤AIæ¨¡å‹é€‰æ‹©
            const savedAIProvider = localStorage.getItem('ai_provider') || 'deepseek';
            switchAIModel(savedAIProvider);
            console.log('ğŸ¤– [init] AIæ¨¡å‹:', savedAIProvider);
            
            // ç¡®ä¿é»˜è®¤å½©ç§ä¸ºæ–°æ¾³é—¨
            if (!appState.currentLotteryType) {
                appState.currentLotteryType = 'xam';
            }
            console.log('ğŸ¯ [init] å½“å‰å½©ç§:', appState.currentLotteryType);
            
            // åŠ è½½èµ”ç‡è®¾ç½®
            console.log('ğŸ’° [init] åŠ è½½èµ”ç‡è®¾ç½®...');
            loadOddsFromStorage();
            
            // æ£€æŸ¥æ¿€æ´»çŠ¶æ€
            console.log('ğŸ” [init] æ£€æŸ¥æ¿€æ´»çŠ¶æ€...');
            checkLicense();
            console.log('âœ… [init] æ¿€æ´»çŠ¶æ€:', appState.isActivated ? 'å·²æ¿€æ´»' : 'æœªæ¿€æ´»');
            
            // æ¸²æŸ“å‚ç…§è¡¨
            renderReferenceTables();
            
            // æ›´æ–°æ˜¾ç¤º
            updateDisplay();
            
            // æ›´æ–°åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            updateSwitchButtons();
            
            // å¦‚æœæ²¡æœ‰æ•°æ®ï¼Œå°è¯•è‡ªåŠ¨è·å–ï¼ˆä¸é˜»å¡ï¼‰
            console.log('ğŸ”„ [init] å¼€å§‹è‡ªåŠ¨è·å–æ•°æ®...');
            tryAutoFetchOnce();
            
            // è‡ªåŠ¨è·å–å†å²è®°å½•ï¼ˆæ–°æ¾³é—¨å’Œé¦™æ¸¯åŒæ­¥æ›´æ–°10æ¡ï¼‰
            console.log('ğŸ“œ [init] è‡ªåŠ¨è·å–å†å²å¼€å¥–è®°å½•...');
            fetchHistoryData().then(() => {
                console.log('âœ… [init] å†å²è®°å½•è·å–å®Œæˆ');
            }).catch(err => {
                console.warn('âš ï¸ [init] å†å²è®°å½•è·å–å¤±è´¥:', err);
            });
            
            // å¯åŠ¨å¼€å¥–æ—¶æ®µè‡ªåŠ¨åˆ·æ–°
            startLiveRefresh();
            
            console.log('âœ… [init] åº”ç”¨åˆå§‹åŒ–å®Œæˆï¼');
        } catch (error) {
            console.error('âŒ [init] åˆå§‹åŒ–å‡ºé”™:', error);
        }
    }
    
    // ==================== å¼€å¥–æ—¶æ®µè‡ªåŠ¨åˆ·æ–°ï¼ˆç›´æ’­æ•ˆæœï¼‰ ====================
    let liveRefreshInterval = null;
    let checkLiveInterval = null;
    
    // æ£€æŸ¥æ˜¯å¦åœ¨å¼€å¥–æ—¶æ®µï¼ˆ21:29 - 21:40ï¼‰
    function isLiveTime() {
        const now = new Date();
        const hours = now.getHours();
        const minutes = now.getMinutes();
        // 21:29 åˆ° 21:40
        if (hours === 21 && minutes >= 29 && minutes <= 40) {
            return true;
        }
        return false;
    }
    
    // å¯åŠ¨å¼€å¥–æ—¶æ®µè‡ªåŠ¨åˆ·æ–°ï¼ˆå‚è€ƒ index2.htmlï¼šå¼€å¥–æ—¶æ®µæ¯5ç§’åˆ·æ–°ï¼‰
    function startLiveRefresh() {
        // æ¯åˆ†é’Ÿæ£€æŸ¥æ˜¯å¦è¿›å…¥å¼€å¥–æ—¶æ®µ
        checkLiveInterval = setInterval(() => {
            if (isLiveTime()) {
                // è¿›å…¥å¼€å¥–æ—¶æ®µï¼Œå¼€å§‹é«˜é¢‘åˆ·æ–°
                if (!liveRefreshInterval) {
                    console.log('ğŸ“¡ è¿›å…¥å¼€å¥–æ—¶æ®µï¼Œå¼€å§‹æ¯5ç§’è‡ªåŠ¨åˆ·æ–°...');
                    showLiveToast('ğŸ“¡ å¼€å¥–ç›´æ’­æ¨¡å¼å·²å¼€å¯');
                    liveRefreshInterval = setInterval(async () => {
                        try {
                            // å¯ç”¨ç›´æ’­åŠ¨ç”»
                            window.isLiveAnimationEnabled = true;
                            await fetchAllLotteryData();
                        } catch (e) {
                            console.log('ç›´æ’­åˆ·æ–°å¤±è´¥', e);
                        }
                    }, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡ï¼ˆä¸index2.htmlä¸€è‡´ï¼‰
                }
            } else {
                // é€€å‡ºå¼€å¥–æ—¶æ®µï¼Œåœæ­¢é«˜é¢‘åˆ·æ–°
                if (liveRefreshInterval) {
                    console.log('â¹ï¸ å¼€å¥–æ—¶æ®µç»“æŸï¼Œåœæ­¢è‡ªåŠ¨åˆ·æ–°');
                    clearInterval(liveRefreshInterval);
                    liveRefreshInterval = null;
                }
            }
        }, 60000); // æ¯åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
        
        // ç«‹å³æ£€æŸ¥ä¸€æ¬¡
        if (isLiveTime() && !liveRefreshInterval) {
            console.log('ğŸ“¡ å½“å‰åœ¨å¼€å¥–æ—¶æ®µï¼Œå¼€å§‹è‡ªåŠ¨åˆ·æ–°...');
            showLiveToast('ğŸ“¡ å¼€å¥–ç›´æ’­æ¨¡å¼å·²å¼€å¯');
            liveRefreshInterval = setInterval(async () => {
                try {
                    // å¯ç”¨ç›´æ’­åŠ¨ç”»
                    window.isLiveAnimationEnabled = true;
                    await fetchAllLotteryData();
                } catch (e) {
                    console.log('ç›´æ’­åˆ·æ–°å¤±è´¥', e);
                }
            }, 5000); // æ¯5ç§’åˆ·æ–°ä¸€æ¬¡
        }
    }
    
    // æ˜¾ç¤ºç›´æ’­æç¤º
    function showLiveToast(msg) {
        const toast = document.createElement('div');
        toast.innerHTML = msg;
        toast.style.cssText = 'position:fixed;top:20%;left:50%;transform:translateX(-50%);background:linear-gradient(90deg,#e94560,#c23a51);color:white;padding:12px 20px;border-radius:8px;font-size:13px;z-index:9999;box-shadow:0 4px 15px rgba(233,69,96,0.4);';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 3000);
    }
    
    
    // ä» data.json åŠ è½½é¢„è·å–çš„æ•°æ®ï¼ˆGitHub Actions æ–¹æ¡ˆï¼‰
    async function loadDataFromJSON() {
        console.log('ğŸ”„ [loadDataFromJSON] å¼€å§‹ä» data.json åŠ è½½æ•°æ®...');
        try {
            const url = './data.json?t=' + Date.now();
            console.log('ğŸ“¡ [loadDataFromJSON] è¯·æ±‚URL:', url);
            
            const response = await fetch(url);
            console.log('ğŸ“¥ [loadDataFromJSON] å“åº”çŠ¶æ€:', response.status, response.statusText);
            
            if (!response.ok) {
                console.warn('âš ï¸ [loadDataFromJSON] å“åº”ä¸OKï¼Œè¿”å›false');
                return false;
            }
            
            const data = await response.json();
            console.log('ğŸ“Š [loadDataFromJSON] è·å–åˆ°çš„æ•°æ®:', JSON.stringify(data, null, 2));
            
            if (!data) {
                console.warn('âš ï¸ [loadDataFromJSON] æ•°æ®ä¸ºç©ºï¼Œè¿”å›false');
                return false;
            }
            
            let loaded = false;
            
            // åŠ è½½æ–°æ¾³é—¨æ•°æ®
            if (data.xam && data.xam.numbers && data.xam.numbers.length === 7) {
                console.log('ğŸ° [loadDataFromJSON] æ–°æ¾³é—¨æ•°æ®æœ‰æ•ˆ:', data.xam.numbers.join(','));
                appState.lotteryData['xam'] = {
                    numbers: data.xam.numbers,
                    issue: data.xam.issue,
                    time: data.xam.time,
                    source: 'data.json'
                };
                addToHistory('xam', data.xam);
                loaded = true;
            } else {
                console.warn('âš ï¸ [loadDataFromJSON] æ–°æ¾³é—¨æ•°æ®æ— æ•ˆæˆ–ä¸å®Œæ•´');
            }
            
            // åŠ è½½é¦™æ¸¯æ•°æ®
            if (data.hk && data.hk.numbers && data.hk.numbers.length === 7) {
                console.log('ğŸ° [loadDataFromJSON] é¦™æ¸¯æ•°æ®æœ‰æ•ˆ:', data.hk.numbers.join(','));
                appState.lotteryData['hk'] = {
                    numbers: data.hk.numbers,
                    issue: data.hk.issue,
                    time: data.hk.time,
                    source: 'data.json'
                };
                addToHistory('hk', data.hk);
                loaded = true;
            } else {
                console.warn('âš ï¸ [loadDataFromJSON] é¦™æ¸¯æ•°æ®æ— æ•ˆæˆ–ä¸å®Œæ•´');
            }
            
            if (loaded) {
                // åŠ è½½å½“å‰å½©ç§æ•°æ®
                const currentData = appState.lotteryData[appState.currentLotteryType];
                console.log('ğŸ“Œ [loadDataFromJSON] å½“å‰å½©ç§:', appState.currentLotteryType);
                
                if (currentData && currentData.numbers && currentData.numbers.length === 7) {
                    appState.lotteryNumbers = currentData.numbers;
                    console.log('âœ… [loadDataFromJSON] è®¾ç½®å½“å‰å·ç :', appState.lotteryNumbers.join(','));
                }
                
                saveConfig();
                renderLotteryBalls();
                renderHistoryList();
                
                console.log('âœ… [loadDataFromJSON] æ•°æ®åŠ è½½æˆåŠŸï¼Œæ›´æ–°æ—¶é—´:', data.updateTime);
            } else {
                console.warn('âš ï¸ [loadDataFromJSON] æ²¡æœ‰æœ‰æ•ˆæ•°æ®è¢«åŠ è½½');
            }
            
            return loaded;
        } catch (e) {
            console.error('âŒ [loadDataFromJSON] åŠ è½½å¤±è´¥:', e.message, e);
            return false;
        }
    }
    
    // é¦–æ¬¡è‡ªåŠ¨è·å–æ•°æ®ï¼ˆä¼˜å…ˆä» data.json è¯»å–ï¼‰
    async function tryAutoFetchOnce() {
        // æ£€æŸ¥æ–°æ¾³é—¨æ˜¯å¦æœ‰æ•°æ®
        const xamData = appState.lotteryData['xam'];
        const hkData = appState.lotteryData['hk'];
        
        // å¦‚æœéƒ½æ²¡æœ‰æ•°æ®ï¼Œå°è¯•è·å–
        if ((!xamData || !xamData.numbers || xamData.numbers.length < 7) &&
            (!hkData || !hkData.numbers || hkData.numbers.length < 7)) {
            
            console.log('é¦–æ¬¡åŠ è½½ï¼Œå°è¯•è·å–å¼€å¥–æ•°æ®...');
            showAutoFetchStatus('ğŸ”„ æ­£åœ¨åŠ è½½å¼€å¥–æ•°æ®...');
            
            // æ–¹æ¡ˆ1ï¼šä¼˜å…ˆä» data.json è¯»å–ï¼ˆGitHub Actions é¢„è·å–çš„æ•°æ®ï¼‰
            const jsonLoaded = await loadDataFromJSON();
            if (jsonLoaded) {
                showAutoFetchStatus('âœ… å¼€å¥–æ•°æ®å·²åŠ è½½', 'success');
                setTimeout(hideAutoFetchStatus, 2000);
                return;
            }
            
            // æ–¹æ¡ˆ2ï¼šdata.json å¤±è´¥ï¼Œå°è¯•ç›´æ¥è°ƒç”¨ APIï¼ˆå¤‡é€‰æ–¹æ¡ˆï¼‰
            console.log('data.json åŠ è½½å¤±è´¥ï¼Œå°è¯•è°ƒç”¨ API...');
            showAutoFetchStatus('ğŸ”„ æ­£åœ¨è·å–æœ€æ–°æ•°æ®...');
            
            let success = false;
            for (let retry = 0; retry < 2 && !success; retry++) {
                try {
                    if (retry > 0) {
                        showAutoFetchStatus(`ğŸ”„ é‡è¯•è·å–ä¸­...(${retry}/2)`);
                        await new Promise(r => setTimeout(r, 1000));
                    }
                    await fetchAllLotteryData();
                    
                    const newXamData = appState.lotteryData['xam'];
                    const newHkData = appState.lotteryData['hk'];
                    if ((newXamData && newXamData.numbers && newXamData.numbers.length === 7) ||
                        (newHkData && newHkData.numbers && newHkData.numbers.length === 7)) {
                        success = true;
                        showAutoFetchStatus('âœ… å¼€å¥–æ•°æ®å·²æ›´æ–°', 'success');
                    }
                } catch (e) {
                    console.log(`APIè·å–å¤±è´¥(å°è¯•${retry + 1}):`, e.message);
                }
            }
            
            if (!success) {
                showAutoFetchStatus('âš ï¸ è·å–å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨è·å–', 'warning');
            }
            
            setTimeout(hideAutoFetchStatus, 3000);
        }
    }
    
    // æ˜¾ç¤ºè‡ªåŠ¨è·å–çŠ¶æ€
    function showAutoFetchStatus(msg, type = 'loading') {
        let statusDiv = document.getElementById('auto-fetch-status');
        if (!statusDiv) {
            statusDiv = document.createElement('div');
            statusDiv.id = 'auto-fetch-status';
            statusDiv.style.cssText = 'position:fixed;top:60px;left:50%;transform:translateX(-50%);padding:10px 20px;border-radius:8px;font-size:13px;z-index:9999;transition:opacity 0.3s;';
            document.body.appendChild(statusDiv);
        }
        
        statusDiv.innerHTML = msg;
        statusDiv.style.opacity = '1';
        
        if (type === 'success') {
            statusDiv.style.background = 'linear-gradient(90deg,#2ecc71,#27ae60)';
            statusDiv.style.color = 'white';
        } else if (type === 'warning') {
            statusDiv.style.background = 'linear-gradient(90deg,#f39c12,#e67e22)';
            statusDiv.style.color = 'white';
        } else {
            statusDiv.style.background = 'linear-gradient(90deg,#667eea,#764ba2)';
            statusDiv.style.color = 'white';
        }
    }
    
    // éšè—è‡ªåŠ¨è·å–çŠ¶æ€
    function hideAutoFetchStatus() {
        const statusDiv = document.getElementById('auto-fetch-status');
        if (statusDiv) {
            statusDiv.style.opacity = '0';
            setTimeout(() => statusDiv.remove(), 300);
        }
    }
    
    // è·å–æ‰€æœ‰å½©ç§æ•°æ®
    async function fetchAllLotteryData() {
        const api = LOTTERY_APIS.marksix6;
        
        // è·å–æ•°æ®ï¼ˆå¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼‰
        const data = await fetchWithProxy(api.url);
        
        let hasValidData = false;
        
        // è§£ææ–°æ¾³é—¨æ•°æ®
        const xamResult = api.parse(data, 'xam');
        if (xamResult && xamResult.numbers && xamResult.numbers.length === 7) {
            appState.lotteryData['xam'] = {
                numbers: xamResult.numbers,
                issue: xamResult.issue,
                time: xamResult.time,
                source: xamResult.source
            };
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory('xam', xamResult);
            hasValidData = true;
        }
        
        // è§£æé¦™æ¸¯æ•°æ®
        const hkResult = api.parse(data, 'hk');
        if (hkResult && hkResult.numbers && hkResult.numbers.length === 7) {
            appState.lotteryData['hk'] = {
                numbers: hkResult.numbers,
                issue: hkResult.issue,
                time: hkResult.time,
                source: hkResult.source
            };
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory('hk', hkResult);
            hasValidData = true;
        }
        
        // å¦‚æœæ²¡æœ‰è·å–åˆ°ä»»ä½•æœ‰æ•ˆæ•°æ®ï¼ŒæŠ›å‡ºé”™è¯¯
        if (!hasValidData) {
            throw new Error('æ•°æ®è§£æå¤±è´¥ï¼Œæœªè·å–åˆ°æœ‰æ•ˆå¼€å¥–å·ç ');
        }
        
        // åŠ è½½å½“å‰å½©ç§çš„æ•°æ®
        const currentData = appState.lotteryData[appState.currentLotteryType];
        if (currentData && currentData.numbers && currentData.numbers.length === 7) {
            appState.lotteryNumbers = currentData.numbers;
        }
        
        // ä¿å­˜å¹¶åˆ·æ–°æ˜¾ç¤º
        saveConfig();
        renderLotteryBalls();
        renderHistoryList();  // åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
        
        return true; // è¿”å›æˆåŠŸæ ‡å¿—
    }
    
    // ==================== æœºå™¨ç ç”Ÿæˆ ====================
    async function generateMachineCode() {
        const components = [];
        
        // CanvasæŒ‡çº¹
        try {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.textBaseline = 'top';
            ctx.font = '14px Arial';
            ctx.fillText('LHC', 2, 2);
            components.push(canvas.toDataURL().slice(-50));
        } catch (e) {
            components.push('no-canvas');
        }
        
        // å±å¹•ä¿¡æ¯
        components.push(`${screen.width}x${screen.height}x${screen.colorDepth}`);
        components.push(Intl.DateTimeFormat().resolvedOptions().timeZone);
        components.push(navigator.language);
        components.push(navigator.platform);
        components.push(navigator.hardwareConcurrency || 'unknown');
        
        const raw = components.join('|');
        const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(raw));
        const hashArray = Array.from(new Uint8Array(hashBuffer));
        const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('').toUpperCase();
        
        return `${hashHex.slice(0, 4)}-${hashHex.slice(4, 8)}-${hashHex.slice(8, 12)}-${hashHex.slice(12, 16)}`;
    }
    
    // ==================== é¡µé¢åˆ‡æ¢ ====================
    function showPage(pageId) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        
        // æ‰“å¼€å¼€å¥–è®¾ç½®é¡µé¢æ—¶ï¼Œæ›´æ–°è¾“å…¥æ¡†æ˜¾ç¤ºå’Œå†å²è®°å½•
        if (pageId === 'page-lottery') {
            updateLotteryInputsDisplay();
            renderHistoryList();
        }
        
        // æ‰“å¼€å‚ç…§è¡¨é¡µé¢æ—¶ï¼Œé‡æ–°æ¸²æŸ“è¡¨æ ¼
        if (pageId === 'page-reference') {
            renderReferenceTables();
        }
        
        // æ‰“å¼€è‡ªå®šä¹‰æ ¼å¼é¡µé¢æ—¶ï¼ŒåŠ è½½è®¾ç½®
        if (pageId === 'page-format') {
            loadFormatSettings();
        }
        
        // æ‰“å¼€å‚æ•°è®¾ç½®é¡µé¢æ—¶ï¼ŒåŠ è½½è®¾ç½®
        if (pageId === 'page-params') {
            loadParamSettings();
        }
    }
    
    // æ›´æ–°å¼€å¥–è®¾ç½®é¡µé¢çš„è¾“å…¥æ¡†æ˜¾ç¤º
    function updateLotteryInputsDisplay() {
        if (appState.lotteryNumbers && appState.lotteryNumbers.length >= 7) {
            for (let i = 0; i < 6; i++) {
                const num = appState.lotteryNumbers[i];
                const input = document.getElementById('num' + (i + 1));
                if (num > 0) {
                    input.value = String(num).padStart(2, '0');
                    updateInputColor(input, num, false);
                }
            }
            const specialNum = appState.lotteryNumbers[6];
            const specialInput = document.getElementById('num-special');
            if (specialNum > 0) {
                specialInput.value = String(specialNum).padStart(2, '0');
                updateInputColor(specialInput, specialNum, true);
            }
        }
        // éšè—é¢„è§ˆ
        hideParsePreview();
    }
    
    // ==================== é…ç½®ä¿å­˜/åŠ è½½ ====================
    function saveConfig() {
        localStorage.setItem('lhc_config', JSON.stringify(appState));
    }
    
    function loadConfig() {
        const saved = localStorage.getItem('lhc_config');
        if (saved) {
            const config = JSON.parse(saved);
            appState = { ...appState, ...config };
            
            // æ¢å¤èµ”ç‡è¾“å…¥æ¡†ï¼ˆå®‰å…¨æ£€æŸ¥å…ƒç´ æ˜¯å¦å­˜åœ¨ï¼‰
            const setInputValue = (id, value) => {
                const el = document.getElementById(id);
                if (el && value !== undefined) el.value = value;
            };
            if (appState.odds) {
                setInputValue('odds-tema', appState.odds.tema);
                setInputValue('odds-shengxiao', appState.odds.shengxiao);
                setInputValue('odds-red', appState.odds.red);
                setInputValue('odds-blue', appState.odds.blue);
                setInputValue('odds-green', appState.odds.green);
                setInputValue('odds-daxiao', appState.odds.daxiao);
                setInputValue('odds-danshuang', appState.odds.danshuang);
            }
        }
        
        // ç¡®ä¿lotteryDataç»“æ„å­˜åœ¨
        if (!appState.lotteryData) {
            appState.lotteryData = {
                xam: { numbers: [], issue: '', time: '', source: '' },
                hk: { numbers: [], issue: '', time: '', source: '' }
            };
        }
        
        // ç¡®ä¿å†å²è®°å½•ç»“æ„å­˜åœ¨
        if (!appState.lotteryHistory) {
            appState.lotteryHistory = {
                xam: [],
                hk: []
            };
        }
        
        // é»˜è®¤å½©ç§ä¸ºæ–°æ¾³é—¨
        if (!appState.currentLotteryType) {
            appState.currentLotteryType = 'xam';
        }
        
        // å¦‚æœå½“å‰å½©ç§æœ‰æ•°æ®ï¼ŒåŠ è½½åˆ°lotteryNumbers
        const currentData = appState.lotteryData[appState.currentLotteryType];
        if (currentData && currentData.numbers && currentData.numbers.length === 7) {
            appState.lotteryNumbers = currentData.numbers;
        }
    }
    
    // ==================== å¼€å¥–å·ç  ====================
    
    // è§£æç²˜è´´çš„å¼€å¥–å·ç 
    function parseLotteryInput() {
        let input = document.getElementById('paste-lottery-input').value.trim();
        
        if (!input) {
            alert('è¯·å…ˆç²˜è´´å¼€å¥–å·ç ï¼');
            return;
        }
        
        // å®¹é”™å¤„ç†ï¼šåˆå¹¶å¤šä¸ªè¿ç»­ç©ºæ ¼ä¸ºå•ä¸ªç©ºæ ¼
        input = input.replace(/\s+/g, ' ');
        
        // æå–ç‰¹ç ï¼ˆå¦‚æœæœ‰"ç‰¹"å­—æ ‡è¯†ï¼‰
        let specialNum = null;
        let cleanInput = input;
        
        // æ£€æŸ¥æ˜¯å¦æœ‰"ç‰¹"å­—æ ‡è¯†ç‰¹ç 
        const teMatch = input.match(/ç‰¹\s*(\d+)/);
        if (teMatch) {
            specialNum = parseInt(teMatch[1]);
            cleanInput = input.replace(/ç‰¹\s*\d+/, '').trim();
        }
        
        // ç”¨å„ç§åˆ†éš”ç¬¦åˆ†å‰²ï¼šç©ºæ ¼ã€ç‚¹ã€é€—å·ã€ä¸­æ–‡é€—å·ã€é¡¿å·
        const parts = cleanInput.split(/[\s.,ï¼Œã€ã€‚]+/).filter(p => p);
        
        // è§£ææ•°å­—
        const nums = [];
        const invalidParts = [];
        for (const part of parts) {
            const num = parseInt(part);
            if (!isNaN(num) && num >= 1 && num <= 49) {
                nums.push(num);
            } else if (part && !/^\s*$/.test(part)) {
                invalidParts.push(part);
            }
        }
        
        // å¦‚æœæ²¡æœ‰"ç‰¹"æ ‡è¯†ï¼Œæœ€åä¸€ä¸ªå°±æ˜¯ç‰¹ç 
        if (specialNum === null && nums.length >= 7) {
            specialNum = nums.pop();
        }
        
        // éªŒè¯æ•°é‡
        if (nums.length !== 6 || !specialNum) {
            showFormatErrorModal(nums, specialNum, invalidParts, input);
            hideParsePreview();
            return;
        }
        
        if (specialNum < 1 || specialNum > 49) {
            showFormatErrorModal(nums, specialNum, ['ç‰¹ç è¶…å‡ºèŒƒå›´'], input);
            hideParsePreview();
            return;
        }
        
        // åˆå¹¶æ‰€æœ‰å·ç æ£€æŸ¥é‡å¤
        const allNums = [...nums, specialNum];
        const uniqueNums = new Set(allNums);
        if (uniqueNums.size !== allNums.length) {
            const seen = {};
            const duplicates = [];
            for (const n of allNums) {
                if (seen[n]) duplicates.push(n);
                seen[n] = true;
            }
            showDuplicateErrorModal([...new Set(duplicates)]);
            hideParsePreview();
            return;
        }
        
        // å¡«å…¥è¾“å…¥æ¡†å¹¶æ›´æ–°è¾“å…¥æ¡†èƒŒæ™¯è‰²
        for (let i = 0; i < 6; i++) {
            const numInput = document.getElementById('num' + (i + 1));
            numInput.value = String(nums[i]).padStart(2, '0');
            updateInputColor(numInput, nums[i]);
        }
        const specialInput = document.getElementById('num-special');
        specialInput.value = String(specialNum).padStart(2, '0');
        updateInputColor(specialInput, specialNum, true);
        
        // æ˜¾ç¤ºå¸¦æ³¢è‰²çš„é¢„è§ˆ
        showParsePreview(nums, specialNum);
        
        // æ¸…ç©ºç²˜è´´æ¡†
        document.getElementById('paste-lottery-input').value = '';
        
        // æç¤ºç”¨æˆ·ç‚¹å‡»ä¿å­˜æŒ‰é’®
        const toast = document.createElement('div');
        toast.innerHTML = 'âœ… è§£ææˆåŠŸï¼è¯·ç‚¹å‡»<b>ã€Œä¿å­˜å¼€å¥–å·ç ã€</b>æŒ‰é’®åº”ç”¨';
        toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#4CAF50;padding:15px 20px;border-radius:10px;font-size:13px;z-index:9999;text-align:center;max-width:280px;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2500);
    }
    
    // æ˜¾ç¤ºæ ¼å¼é”™è¯¯å¼¹çª—
    function showFormatErrorModal(nums, specialNum, invalidParts, originalInput) {
        const correctFormat = '01 08 09 15 24 26 ç‰¹27';
        
        // åˆ›å»ºå¼¹çª—HTML
        let html = `
        <div id="format-error-modal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;">
            <div style="background:#fff;border-radius:12px;padding:20px;max-width:320px;width:100%;color:#333;">
                <div style="font-size:18px;font-weight:bold;margin-bottom:15px;">âŒ æ ¼å¼é”™è¯¯ï¼</div>
                
                <div style="margin-bottom:12px;">
                    <div style="color:#666;font-size:13px;">æ‚¨è¾“å…¥çš„ï¼š</div>
                    <div style="font-size:14px;word-break:break-all;">${originalInput}</div>
                </div>
                
                <div style="margin-bottom:12px;">
                    <div style="color:#666;font-size:13px;">è¯†åˆ«åˆ°ï¼š</div>
                    <div style="font-size:14px;">${nums.length}ä¸ªå¹³ç ${specialNum ? ' + 1ä¸ªç‰¹ç ' : ''}</div>
                </div>
                
                ${invalidParts.length > 0 ? `
                <div style="margin-bottom:12px;">
                    <div style="color:#666;font-size:13px;">æ— æ³•è¯†åˆ«çš„å†…å®¹ï¼š</div>
                    <div style="font-size:14px;color:#e74c3c;">${invalidParts.join(', ')}</div>
                </div>
                ` : ''}
                
                <div style="border-top:1px solid #eee;margin:15px 0;"></div>
                
                <div style="color:#e94560;font-size:13px;margin-bottom:8px;">ç‚¹å‡»å³ä¸‹è§’å¤åˆ¶æŒ‰é’®å¤åˆ¶æ­£ç¡®æ ¼å¼</div>
                <div style="display:flex;align-items:center;gap:8px;background:#f5f5f5;padding:10px;border-radius:8px;">
                    <span style="color:#2ecc71;font-size:16px;">âœ…</span>
                    <div>
                        <div style="font-size:12px;color:#888;">æ­£ç¡®æ ¼å¼ç¤ºä¾‹ï¼š</div>
                        <div style="font-size:15px;font-weight:bold;">${correctFormat}</div>
                    </div>
                </div>
                
                <div style="display:flex;gap:10px;margin-top:20px;">
                    <button onclick="closeFormatErrorModal()" style="flex:1;padding:12px;background:#f0f0f0;border:none;border-radius:8px;font-size:14px;cursor:pointer;color:#666;">å–æ¶ˆ</button>
                    <button onclick="copyFormatAndClose('${correctFormat}')" style="flex:1;padding:12px;background:#e94560;border:none;border-radius:8px;font-size:14px;cursor:pointer;color:#fff;font-weight:bold;">å¤åˆ¶</button>
                </div>
            </div>
        </div>`;
        
        // æ·»åŠ åˆ°é¡µé¢
        document.body.insertAdjacentHTML('beforeend', html);
    }
    
    function closeFormatErrorModal() {
        const modal = document.getElementById('format-error-modal');
        if (modal) modal.remove();
    }
    
    function copyFormatAndClose(text) {
        copyToClipboard(text);
        closeFormatErrorModal();
        alert('âœ… å·²å¤åˆ¶æ­£ç¡®æ ¼å¼ï¼');
    }
    
    // æ˜¾ç¤ºé‡å¤å·ç é”™è¯¯å¼¹çª—
    function showDuplicateErrorModal(duplicates) {
        const dupStr = duplicates.map(n => String(n).padStart(2,'0')).join(', ');
        alert('âŒ å·ç é‡å¤ï¼\n\né‡å¤çš„å·ç ï¼š' + dupStr + '\n\nå¼€å¥–å·ç ä¸èƒ½æœ‰é‡å¤ï¼Œè¯·æ£€æŸ¥åé‡æ–°è¾“å…¥ã€‚');
    }
    
    // å¤åˆ¶åˆ°å‰ªè´´æ¿
    function copyToClipboard(text) {
        if (navigator.clipboard) {
            navigator.clipboard.writeText(text);
        } else {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            document.body.appendChild(textarea);
            textarea.select();
            document.execCommand('copy');
            document.body.removeChild(textarea);
        }
    }
    
    // æ ¹æ®å·ç æ›´æ–°è¾“å…¥æ¡†èƒŒæ™¯è‰²
    function updateInputColor(input, num, isSpecial = false) {
        const color = getNumberColor(num);
        const colorMap = {
            'red': '#c23a51',
            'blue': '#3a5fc2',
            'green': '#3a8c4a'
        };
        input.style.background = colorMap[color] || '#333';
        input.style.borderColor = isSpecial ? '#f5a623' : colorMap[color] || '#555';
    }
    
    // æ˜¾ç¤ºè§£æé¢„è§ˆ
    function showParsePreview(nums, specialNum) {
        const preview = document.getElementById('parse-preview');
        const balls = document.getElementById('parse-preview-balls');
        
        let html = '';
        // 6ä¸ªå¹³ç 
        for (let i = 0; i < 6; i++) {
            const num = nums[i];
            const color = getNumberColor(num);
            const colorMap = { 'red': '#c23a51', 'blue': '#3a5fc2', 'green': '#3a8c4a' };
            html += `<div style="width:32px;height:32px;border-radius:50%;background:${colorMap[color]};display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:bold;">${String(num).padStart(2,'0')}</div>`;
        }
        // + å·
        html += `<span style="color:#e94560;font-weight:bold;font-size:14px;margin:0 2px;">+</span>`;
        // ç‰¹ç 
        const specialColor = getNumberColor(specialNum);
        const colorMap = { 'red': '#c23a51', 'blue': '#3a5fc2', 'green': '#3a8c4a' };
        html += `<div style="width:32px;height:32px;border-radius:50%;background:${colorMap[specialColor]};border:2px solid #f5a623;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:bold;">${String(specialNum).padStart(2,'0')}</div>`;
        
        balls.innerHTML = html;
        preview.style.display = 'block';
    }
    
    // éšè—è§£æé¢„è§ˆ
    function hideParsePreview() {
        document.getElementById('parse-preview').style.display = 'none';
    }
    
    // æ ¼å¼åŒ–æ•°å­—è¾“å…¥ï¼ˆåªå…è®¸æ•°å­—ï¼‰
    function formatNumInput(input) {
        // åªä¿ç•™æ•°å­—
        let value = input.value.replace(/[^0-9]/g, '');
        
        // å¦‚æœè¾“å…¥äº†éæ•°å­—ï¼Œæç¤ºé”™è¯¯
        if (input.value !== value && input.value !== '') {
            input.style.borderColor = '#e74c3c';
            setTimeout(() => {
                input.style.borderColor = input.classList.contains('special') ? '#fbbf24' : 'rgba(255, 255, 255, 0.2)';
            }, 500);
        }
        
        // é™åˆ¶æœ€å¤§å€¼49
        if (parseInt(value) > 49) {
            value = '49';
        }
        
        input.value = value;
    }
    
    // å¤±ç„¦æ—¶è¡¥0
    function padNumInput(input) {
        let value = input.value.trim();
        if (value === '') {
            // æ¸…ç©ºæ—¶é‡ç½®é¢œè‰²
            input.style.background = '#333';
            input.style.borderColor = input.id === 'num-special' ? '#f5a623' : '#555';
            return;
        }
        
        let num = parseInt(value);
        if (isNaN(num) || num < 1) {
            input.value = '';
            input.style.background = '#333';
            input.style.borderColor = input.id === 'num-special' ? '#f5a623' : '#555';
            return;
        }
        
        if (num > 49) num = 49;
        
        // è¡¥0ï¼š1-9 â†’ 01-09
        input.value = num.toString().padStart(2, '0');
        
        // æ›´æ–°èƒŒæ™¯è‰²ä¸ºæ³¢è‰²
        const isSpecial = input.id === 'num-special';
        updateInputColor(input, num, isSpecial);
    }
    
    function saveLotteryNumbers() {
        const nums = [];
        let hasError = false;
        
        for (let i = 1; i <= 6; i++) {
            const input = document.getElementById('num' + i);
            const val = parseInt(input.value) || 0;
            if (val < 1 || val > 49) {
                hasError = true;
                input.style.borderColor = '#e74c3c';
            } else {
                input.style.borderColor = 'rgba(255, 255, 255, 0.2)';
            }
            nums.push(val);
        }
        
        const specialInput = document.getElementById('num-special');
        const special = parseInt(specialInput.value) || 0;
        if (special < 1 || special > 49) {
            hasError = true;
            specialInput.style.borderColor = '#e74c3c';
        } else {
            specialInput.style.borderColor = '#fbbf24';
        }
        nums.push(special);
        
        if (hasError || nums.some(n => n < 1 || n > 49)) {
            alert('è¯·è¾“å…¥æ­£ç¡®çš„å·ç ï¼ˆ1-49ï¼‰ï¼');
            return;
        }
        
        // æ£€æŸ¥é‡å¤å·ç 
        const uniqueNums = new Set(nums);
        if (uniqueNums.size !== nums.length) {
            // æ‰¾å‡ºé‡å¤çš„å·ç 
            const seen = {};
            const duplicates = [];
            for (const n of nums) {
                if (seen[n]) {
                    duplicates.push(n);
                }
                seen[n] = true;
            }
            alert('âš ï¸ å¼€å¥–å·ç ä¸èƒ½é‡å¤ï¼\n\né‡å¤çš„å·ç ï¼š' + [...new Set(duplicates)].map(n => String(n).padStart(2,'0')).join(', '));
            return;
        }
        
        appState.lotteryNumbers = nums;
        
        // åŒæ­¥ä¿å­˜åˆ°å½“å‰å½©ç§çš„æ•°æ®
        const currentType = appState.currentLotteryType || 'xam';
        if (appState.lotteryData[currentType]) {
            appState.lotteryData[currentType].numbers = nums;
            // å¦‚æœæ²¡æœ‰æœŸå·ï¼Œä¿æŒåŸæœ‰æœŸå·
        }
        
        saveConfig();
        updateDisplay();
        showPage('page-main');
        
        // æ˜¾ç¤ºç®€çŸ­æç¤ºï¼ˆä¸é˜»å¡ï¼‰
        const toast = document.createElement('div');
        toast.innerHTML = 'âœ… å¼€å¥–å·ç å·²ä¿å­˜';
        toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 1500);
    }
    
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘              ã€æ¨¡å—4ã€‘è‡ªåŠ¨è·å–å¼€å¥–æ•°æ® - APIè°ƒç”¨               â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // APIé…ç½®ï¼ˆä¸‰ä¸ªAPIæºï¼Œè‡ªåŠ¨åˆ‡æ¢ï¼‰
    const LOTTERY_APIS = {
        // API 1: Marksix6ï¼ˆæ¨èï¼Œæ•°æ®æœ€å®Œæ•´ï¼‰
        marksix6: {
            name: 'Marksix6',
            url: 'https://marksix6.net/index.php?api=1',
            // å½©ç§æ˜ å°„
            lotteryMap: {
                'hk': 'é¦™æ¸¯å½©',
                'xam': 'æ–°æ¾³é—¨å½©',
                'am': 'æ¾³é—¨å½©'
            },
            parse: function(data, lotteryType) {
                const targetName = this.lotteryMap[lotteryType];
                if (!data.lottery_data) return null;
                
                const lottery = data.lottery_data.find(l => l.name === targetName);
                if (!lottery) return null;
                
                // è§£æå¼€å¥–å·ç 
                const numbers = lottery.openCode.split(',').map(n => parseInt(n.trim()));
                if (numbers.length !== 7) return null;
                
                return {
                    numbers: numbers,
                    issue: lottery.expect,
                    time: lottery.openTime,
                    zodiac: lottery.zodiac,
                    wave: lottery.wave,
                    source: 'Marksix6'
                };
            }
        },
        
        // ï¼ˆå·²åˆ é™¤ä¸å¯ç”¨çš„ 1234å¼€å¥–ç½‘ å’Œ 168å¼€å¥–ç½‘ï¼‰
    };
    
    // æ˜¾ç¤ºè·å–çŠ¶æ€
    function showFetchStatus(message, type) {
        const statusEl = document.getElementById('fetch-status');
        statusEl.style.display = 'block';
        
        let color = '#fff';
        let bgColor = 'rgba(0,0,0,0.3)';
        
        if (type === 'success') {
            color = '#4CAF50';
            bgColor = 'rgba(76, 175, 80, 0.2)';
        } else if (type === 'error') {
            color = '#e74c3c';
            bgColor = 'rgba(231, 76, 60, 0.2)';
        } else if (type === 'loading') {
            color = '#f5a623';
            bgColor = 'rgba(245, 166, 35, 0.2)';
        }
        
        statusEl.style.color = color;
        statusEl.style.background = bgColor;
        statusEl.innerHTML = message;
    }
    
    // éšè—çŠ¶æ€
    function hideFetchStatus() {
        document.getElementById('fetch-status').style.display = 'none';
    }
    
    // é€šè¿‡CORSä»£ç†è·å–æ•°æ®ï¼ˆè§£å†³è·¨åŸŸé—®é¢˜ï¼‰
    async function fetchWithProxy(url, timeout = 8000) {
        // åˆ›å»ºè¶…æ—¶æ§åˆ¶å™¨
        const createTimeoutController = (ms) => {
            const controller = new AbortController();
            setTimeout(() => controller.abort(), ms);
            return controller;
        };
        
        // æ–¹æ³•1: ç›´æ¥å°è¯•è¯·æ±‚ï¼ˆå¦‚æœæœåŠ¡å™¨æ”¯æŒCORSï¼‰
        try {
            const controller = createTimeoutController(timeout);
            const response = await fetch(url, {
                method: 'GET',
                headers: { 'Accept': 'application/json' },
                signal: controller.signal
            });
            if (response.ok) {
                return await response.json();
            }
        } catch (e) {
            console.log('ç›´æ¥è¯·æ±‚å¤±è´¥ï¼Œå°è¯•ä»£ç†...', e.message);
        }
        
        // æ–¹æ³•2: å°è¯•ä½¿ç”¨å¤šä¸ªå…¬å…±CORSä»£ç†ï¼ˆå¢åŠ æ›´å¤šç¨³å®šä»£ç†ï¼‰
        const corsProxies = [
            // ä»£ç†1: corsproxy.ioï¼ˆç¨³å®šæ€§è¾ƒå¥½ï¼‰
            `https://corsproxy.io/?${encodeURIComponent(url)}`,
            // ä»£ç†2: alloriginsï¼ˆå¤‡ç”¨ï¼‰
            `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
            // ä»£ç†3: cors-anywhere é•œåƒ
            `https://proxy.cors.sh/${url}`,
            // ä»£ç†4: thingproxy
            `https://thingproxy.freeboard.io/fetch/${url}`
        ];
        
        for (const proxyUrl of corsProxies) {
            try {
                const controller = createTimeoutController(timeout);
                const response = await fetch(proxyUrl, {
                    signal: controller.signal,
                    headers: {
                        'x-cors-api-key': 'temp_key', // æŸäº›ä»£ç†éœ€è¦
                    }
                });
                if (response.ok) {
                    const text = await response.text();
                    try {
                        return JSON.parse(text);
                    } catch (parseErr) {
                        console.log('JSONè§£æå¤±è´¥:', proxyUrl);
                        continue;
                    }
                }
            } catch (e) {
                console.log('ä»£ç†è¯·æ±‚å¤±è´¥:', proxyUrl.split('?')[0], e.message);
            }
        }
        
        throw new Error('æ‰€æœ‰è¯·æ±‚æ–¹å¼éƒ½å¤±è´¥äº†ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥');
    }
    
    // ä¸»å‡½æ•°ï¼šè·å–å¼€å¥–æ•°æ®
    async function fetchLotteryData() {
        const lotteryType = document.getElementById('lottery-type-select').value;
        const lotteryNames = {
            'hk': 'é¦™æ¸¯å…­åˆå½©',
            'xam': 'æ–°æ¾³é—¨å…­åˆå½©',
            'am': 'ãŠ£æ¾³é—¨å…­åˆå½©'
        };
        
        showFetchStatus('ğŸ”„ æ­£åœ¨è·å– ' + lotteryNames[lotteryType] + ' æœ€æ–°å¼€å¥–æ•°æ®...', 'loading');
        
        // ä½¿ç”¨ Marksix6 APIï¼ˆå”¯ä¸€å¯ç”¨çš„APIï¼‰
        const api = LOTTERY_APIS.marksix6;
        
        showFetchStatus(`ğŸ”„ æ­£åœ¨è·å– ${api.name} æ•°æ®...`, 'loading');
        
        try {
            // è·å–æ•°æ®
            const data = await fetchWithProxy(api.url);
            console.log(`${api.name} è¿”å›:`, data);
            
            // è§£ææ•°æ®
            const result = api.parse(data, lotteryType);
            
            if (result && result.numbers && result.numbers.length === 7) {
                // æˆåŠŸè·å–æ•°æ®
                applyLotteryResult(result, lotteryNames[lotteryType], lotteryType);
                return;
            }
            
            showFetchStatus('âŒ æ•°æ®è§£æå¤±è´¥ï¼Œè¯·ç¨åé‡è¯•', 'error');
        } catch (error) {
            console.error(`${api.name} å¤±è´¥:`, error);
            showFetchStatus('âŒ è·å–æ•°æ®å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œæˆ–ç¨åé‡è¯•', 'error');
        }
    }
    
    // åº”ç”¨è·å–åˆ°çš„å¼€å¥–ç»“æœ
    function applyLotteryResult(result, lotteryName, lotteryType) {
        // ä¿å­˜åˆ°å¯¹åº”å½©ç§çš„æ•°æ®
        if (lotteryType && appState.lotteryData[lotteryType]) {
            appState.lotteryData[lotteryType] = {
                numbers: result.numbers,
                issue: result.issue,
                time: result.time,
                source: result.source
            };
            // æ·»åŠ åˆ°å†å²è®°å½•
            addToHistory(lotteryType, result);
            renderHistoryList();  // åˆ·æ–°å†å²è®°å½•åˆ—è¡¨
        }
        
        // å¡«å…¥è¾“å…¥æ¡†
        for (let i = 0; i < 6; i++) {
            const input = document.getElementById('num' + (i + 1));
            input.value = String(result.numbers[i]).padStart(2, '0');
            updateInputColor(input, result.numbers[i], false);
        }
        
        const specialInput = document.getElementById('num-special');
        specialInput.value = String(result.numbers[6]).padStart(2, '0');
        updateInputColor(specialInput, result.numbers[6], true);
        
        // æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
        let statusMsg = `âœ… è·å–æˆåŠŸï¼<br>`;
        statusMsg += `<b>${lotteryName}</b> ç¬¬ <b>${result.issue}</b> æœŸ<br>`;
        statusMsg += `å¼€å¥–å·ç ï¼š<b>${result.numbers.slice(0, 6).map(n => String(n).padStart(2, '0')).join(' ')} + ${String(result.numbers[6]).padStart(2, '0')}</b><br>`;
        if (result.time) {
            statusMsg += `å¼€å¥–æ—¶é—´ï¼š${result.time}<br>`;
        }
        statusMsg += `<span style="font-size:11px;color:#888;">æ•°æ®æ¥æºï¼š${result.source}</span>`;
        
        showFetchStatus(statusMsg, 'success');
        
        // æ˜¾ç¤ºé¢„è§ˆ
        showParsePreview(result.numbers.slice(0, 6), result.numbers[6]);
        
        // ä¿å­˜é…ç½®
        saveConfig();
    }
    
    // åˆ‡æ¢èµ”ç‡é¢æ¿
    function showOddsPanel(panelId) {
        // åˆ‡æ¢èœå•é€‰ä¸­çŠ¶æ€
        document.querySelectorAll('.odds-menu-item').forEach(item => {
            item.classList.remove('active');
        });
        event.target.classList.add('active');
        
        // åˆ‡æ¢å†…å®¹é¢æ¿
        document.querySelectorAll('.odds-panel').forEach(panel => {
            panel.classList.remove('active');
        });
        document.getElementById('panel-' + panelId).classList.add('active');
    }
    
    function updateDisplay() {
        // æ›´æ–°å¼€å¥–å·ç æ˜¾ç¤º
        renderLotteryBalls();
    }
    
    function renderLotteryBalls() {
        const container = document.getElementById('lottery-balls');
        const typeNameEl = document.getElementById('lottery-type-name');
        const issueEl = document.getElementById('lottery-issue');
        
        // æ›´æ–°å½©ç§åç§°å’ŒæœŸå·
        const typeNames = { xam: 'æ–°æ¾³', hk: 'é¦™æ¸¯' };
        if (typeNameEl) typeNameEl.textContent = typeNames[appState.currentLotteryType] || 'æ–°æ¾³';
        
        const currentData = appState.lotteryData[appState.currentLotteryType];
        if (issueEl) {
            if (currentData && currentData.issue) {
                issueEl.textContent = 'ç¬¬' + currentData.issue + 'æœŸ';
            } else {
                issueEl.textContent = 'ç¬¬xxxæœŸ';
            }
        }
        
        // æ›´æ–°åˆ‡æ¢æŒ‰é’®çŠ¶æ€
        updateSwitchButtons();
        
        if (!appState.lotteryNumbers || appState.lotteryNumbers.length < 7 || appState.lotteryNumbers[0] === 0) {
            container.innerHTML = '<div class="lottery-empty">è¯·å…ˆè®¾ç½®å¼€å¥–å·ç </div>';
            return;
        }
        
        // æ£€æŸ¥æ˜¯å¦æ˜¯ç›´æ’­æ¨¡å¼ï¼ˆåªæœ‰ç›´æ’­åˆ·æ–°æ—¶æ‰æœ‰åŠ¨ç”»ï¼‰
        const isLive = window.isLiveAnimationEnabled || false;
        
        let html = '';
        for (let i = 0; i < 6; i++) {
            const num = appState.lotteryNumbers[i];
            const color = getNumberColor(num);
            const shengxiao = getNumberShengxiao(num);
            const wuxing = getNumberWuxing(num);
            
            if (isLive) {
                const delay = i * 0.15;
                html += `
                    <div class="ball-wrapper">
                        <div class="ball ${color}" style="--delay:${delay}s">${String(num).padStart(2, '0')}</div>
                        <div class="ball-info">${shengxiao}/${wuxing}</div>
                    </div>
                `;
            } else {
                html += `
                    <div class="ball-wrapper">
                        <div class="ball ${color} no-anim">${String(num).padStart(2, '0')}</div>
                        <div class="ball-info">${shengxiao}/${wuxing}</div>
                    </div>
                `;
            }
        }
        
        html += '<span class="ball-plus">+</span>';
        
        // ç‰¹ç 
        const special = appState.lotteryNumbers[6];
        const specialColor = getNumberColor(special);
        const specialShengxiao = getNumberShengxiao(special);
        const specialWuxing = getNumberWuxing(special);
        
        if (isLive) {
            const specialDelay = 6 * 0.15 + 0.2;
            html += `
                <div class="ball-wrapper">
                    <div class="ball ${specialColor}" style="--delay:${specialDelay}s">${String(special).padStart(2, '0')}</div>
                    <div class="ball-info">${specialShengxiao}/${specialWuxing}</div>
                </div>
            `;
        } else {
            html += `
                <div class="ball-wrapper">
                    <div class="ball ${specialColor} no-anim">${String(special).padStart(2, '0')}</div>
                    <div class="ball-info">${specialShengxiao}/${specialWuxing}</div>
                </div>
            `;
        }
        
        container.innerHTML = html;
        
        // é‡ç½®ç›´æ’­åŠ¨ç”»æ ‡å¿—
        window.isLiveAnimationEnabled = false;
    }
    
    // åˆ‡æ¢å½©ç§
    function switchLotteryType(type) {
        appState.currentLotteryType = type;
        
        // åŠ è½½å¯¹åº”å½©ç§çš„æ•°æ®
        const data = appState.lotteryData[type];
        if (data && data.numbers && data.numbers.length === 7) {
            appState.lotteryNumbers = data.numbers;
        } else {
            appState.lotteryNumbers = [];
        }
        
        // ä¿å­˜å¹¶åˆ·æ–°æ˜¾ç¤º
        saveConfig();
        renderLotteryBalls();
    }
    
    // ==================== å†å²è®°å½•åŠŸèƒ½ ====================
    
    let currentHistoryType = 'xam';  // å½“å‰å†å²è®°å½•æ˜¾ç¤ºçš„å½©ç§
    
    // åˆ‡æ¢å†å²è®°å½•å½©ç§
    function switchHistoryType(type) {
        currentHistoryType = type;
        
        // æ›´æ–°æŒ‰é’®æ ·å¼
        const btnXam = document.getElementById('history-btn-xam');
        const btnHk = document.getElementById('history-btn-hk');
        
        if (btnXam && btnHk) {
            if (type === 'xam') {
                btnXam.style.background = 'rgba(233,69,96,0.2)';
                btnHk.style.background = 'transparent';
            } else {
                btnHk.style.background = 'rgba(76,175,80,0.2)';
                btnXam.style.background = 'transparent';
            }
        }
        
        renderHistoryList();
    }
    
    // æ¸²æŸ“å†å²è®°å½•åˆ—è¡¨
    function renderHistoryList() {
        const container = document.getElementById('history-list');
        if (!container) return;
        
        // ç¡®ä¿å†å²è®°å½•ç»“æ„å­˜åœ¨
        if (!appState.lotteryHistory) {
            appState.lotteryHistory = { xam: [], hk: [] };
        }
        
        const history = appState.lotteryHistory[currentHistoryType] || [];
        
        if (history.length === 0) {
            container.innerHTML = '<div style="text-align:center;color:#666;font-size:12px;padding:20px;">æš‚æ— å†å²è®°å½•ï¼Œè¯·ç‚¹å‡»"æ‰‹åŠ¨è·å–"æŒ‰é’®</div>';
            return;
        }
        
        let html = '';
        history.forEach((item, index) => {
            const numbersStr = item.numbers.slice(0, 6).map(n => String(n).padStart(2, '0')).join(' ') + 
                              ' + ' + String(item.numbers[6]).padStart(2, '0');
            const isFirst = index === 0;
            
            // è®¡ç®—æ—¥æœŸï¼šä»æœŸå·æ¨ç®—ï¼ˆå‡è®¾æ¯å¤©ä¸€æœŸï¼Œä»æœ€æ–°ä¸€æœŸçš„æ—¥æœŸå¾€å‰æ¨ï¼‰
            let dateStr = '';
            if (item.time) {
                // å¦‚æœæœ‰æ—¶é—´ä¿¡æ¯ï¼Œç›´æ¥ä½¿ç”¨
                const match = item.time.match(/(\d{4}-\d{2}-\d{2})/);
                if (match) {
                    dateStr = match[1].substring(5); // å– MM-DD
                }
            } else if (isFirst && appState.lotteryData[currentHistoryType]?.time) {
                // æœ€æ–°ä¸€æœŸä½¿ç”¨å½“å‰æ•°æ®çš„æ—¶é—´
                const match = appState.lotteryData[currentHistoryType].time.match(/(\d{4}-\d{2}-\d{2})/);
                if (match) {
                    dateStr = match[1].substring(5);
                }
            }
            
            html += `
                <div onclick="selectHistoryItem('${currentHistoryType}', ${index})" 
                     style="display:flex;justify-content:space-between;align-items:center;padding:8px;margin-bottom:4px;background:${isFirst ? 'rgba(233,69,96,0.15)' : 'rgba(255,255,255,0.05)'};border-radius:6px;cursor:pointer;border:1px solid ${isFirst ? 'rgba(233,69,96,0.3)' : 'transparent'};">
                    <div style="flex:1;">
                        <div style="font-size:11px;color:#888;margin-bottom:2px;">
                            ç¬¬${item.issue}æœŸ
                            ${dateStr ? '<span style="color:#4CAF50;margin-left:6px;">' + dateStr + '</span>' : ''}
                            ${isFirst ? '<span style="color:#e94560;font-weight:bold;margin-left:6px;">æœ€æ–°</span>' : ''}
                        </div>
                        <div style="font-size:13px;color:#fff;font-family:monospace;">${numbersStr}</div>
                    </div>
                    <button onclick="event.stopPropagation();selectHistoryItem('${currentHistoryType}', ${index})" 
                            style="padding:4px 10px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:4px;font-size:11px;cursor:pointer;">é€‰ç”¨</button>
                </div>
            `;
        });
        
        container.innerHTML = html;
    }
    
    // é€‰æ‹©å†å²è®°å½•
    function selectHistoryItem(type, index) {
        if (!appState.lotteryHistory || !appState.lotteryHistory[type]) return;
        
        const item = appState.lotteryHistory[type][index];
        if (!item || !item.numbers) return;
        
        // è®¾ç½®ä¸ºå½“å‰æ•°æ®
        appState.lotteryNumbers = item.numbers.slice();
        appState.currentLotteryType = type;
        appState.lotteryData[type] = {
            numbers: item.numbers.slice(),
            issue: item.issue,
            time: item.time,
            source: item.source
        };
        
        // å¡«å…¥è¾“å…¥æ¡†
        for (let i = 0; i < 6; i++) {
            const input = document.getElementById('num' + (i + 1));
            if (input) {
                input.value = String(item.numbers[i]).padStart(2, '0');
                updateInputColor(input, item.numbers[i], false);
            }
        }
        const specialInput = document.getElementById('num-special');
        if (specialInput) {
            specialInput.value = String(item.numbers[6]).padStart(2, '0');
            updateInputColor(specialInput, item.numbers[6], true);
        }
        
        // æ˜¾ç¤ºé¢„è§ˆ
        showParsePreview(item.numbers.slice(0, 6), item.numbers[6]);
        
        saveConfig();
        renderLotteryBalls();
        
        // è‡ªåŠ¨è¿”å›ä¸»é¡µï¼Œæ˜¾ç¤ºç®€çŸ­æç¤º
        showPage('page-main');
        
        // æ˜¾ç¤ºæˆåŠŸæç¤ºï¼ˆä¸é˜»å¡ï¼‰
        const toast = document.createElement('div');
        toast.innerHTML = `âœ… å·²åº”ç”¨ç¬¬${item.issue}æœŸ`;
        toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 1500);
    }
    
    // æ·»åŠ å†å²è®°å½•ï¼ˆè·å–æ–°æ•°æ®æ—¶è°ƒç”¨ï¼‰
    function addToHistory(type, data) {
        if (!data || !data.numbers || data.numbers.length < 7) return;
        
        // ç¡®ä¿å†å²è®°å½•ç»“æ„å­˜åœ¨
        if (!appState.lotteryHistory) {
            appState.lotteryHistory = { xam: [], hk: [] };
        }
        if (!appState.lotteryHistory[type]) {
            appState.lotteryHistory[type] = [];
        }
        
        const history = appState.lotteryHistory[type];
        
        // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒæœŸå·
        const existingIndex = history.findIndex(h => h.issue === data.issue);
        if (existingIndex !== -1) {
            // å·²å­˜åœ¨ï¼Œæ›´æ–°æ•°æ®
            history[existingIndex] = {
                numbers: data.numbers.slice(),
                issue: data.issue,
                time: data.time,
                source: data.source
            };
        } else {
            // ä¸å­˜åœ¨ï¼Œæ·»åŠ åˆ°æœ€å‰é¢
            history.unshift({
                numbers: data.numbers.slice(),
                issue: data.issue,
                time: data.time,
                source: data.source
            });
            
            // ä¿æŒæœ€å¤š10æœŸ
            if (history.length > 10) {
                history.pop();
            }
        }
        
        saveConfig();
    }
    
    // æ‰¹é‡æ·»åŠ å†å²è®°å½•ï¼ˆä»APIçš„historyå­—æ®µè§£æï¼‰
    function addHistoryFromAPI(type, historyArray, latestOpenTime) {
        if (!historyArray || !Array.isArray(historyArray)) return;
        
        // ç¡®ä¿å†å²è®°å½•ç»“æ„å­˜åœ¨
        if (!appState.lotteryHistory) {
            appState.lotteryHistory = { xam: [], hk: [] };
        }
        if (!appState.lotteryHistory[type]) {
            appState.lotteryHistory[type] = [];
        }
        
        // è§£ææœ€æ–°çš„å¼€å¥–æ—¥æœŸ
        let latestDate = null;
        if (latestOpenTime) {
            const match = latestOpenTime.match(/(\d{4})-(\d{2})-(\d{2})/);
            if (match) {
                latestDate = new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
            }
        }
        
        // è§£æå†å²è®°å½•æ ¼å¼: "2025129 æœŸï¼š49,19,28,10,17,45,01"
        const parsedHistory = [];
        for (let i = 0; i < Math.min(historyArray.length, 10); i++) {
            const item = historyArray[i];
            // åŒ¹é…æ ¼å¼: "æœŸå· æœŸï¼šå·ç "
            const match = item.match(/(\d+)\s*æœŸ[ï¼š:]\s*([\d,]+)/);
            if (match) {
                const issue = match[1];
                const numbers = match[2].split(',').map(n => parseInt(n.trim()));
                if (numbers.length === 7) {
                    let dateStr = '';
                    
                    if (type === 'xam') {
                        // æ–°æ¾³é—¨ï¼šæ¯å¤©ä¸€æœŸï¼Œå¯ä»¥æ¨ç®—æ—¥æœŸ
                        if (latestDate) {
                            const date = new Date(latestDate);
                            date.setDate(date.getDate() - i);
                            dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                        }
                    } else if (type === 'hk' && i === 0 && latestOpenTime) {
                        // é¦™æ¸¯ï¼šæ¯å‘¨äºŒã€å››ã€å…­å¼€å¥–ï¼Œåªæœ‰æœ€æ–°ä¸€æœŸæ˜¾ç¤ºæ—¥æœŸ
                        dateStr = latestOpenTime;
                    }
                    // é¦™æ¸¯å†å²è®°å½•ä¸æ˜¾ç¤ºæ—¥æœŸï¼ˆå› ä¸ºæ¯å‘¨3æœŸï¼Œæ— æ³•ç®€å•æ¨ç®—ï¼‰
                    
                    parsedHistory.push({
                        numbers: numbers,
                        issue: issue,
                        time: dateStr,
                        source: 'Marksix6å†å²'
                    });
                }
            }
        }
        
        // æ›¿æ¢å†å²è®°å½•
        appState.lotteryHistory[type] = parsedHistory;
        saveConfig();
    }
    
    // è·å–å†å²å¼€å¥–è®°å½•
    async function fetchHistoryData() {
        const api = LOTTERY_APIS.marksix6;
        
        // æ˜¾ç¤ºåŠ è½½æç¤º
        const historyList = document.getElementById('history-list');
        if (historyList) {
            historyList.innerHTML = '<div style="text-align:center;color:#9b59b6;font-size:12px;padding:20px;">ğŸ”„ æ­£åœ¨è·å–å†å²è®°å½•...</div>';
        }
        
        try {
            // ä½¿ç”¨ fetchWithProxy è§£å†³CORSé—®é¢˜
            const data = await fetchWithProxy(api.url);
            
            if (!data.lottery_data) {
                throw new Error('æ•°æ®æ ¼å¼é”™è¯¯');
            }
            
            // è§£ææ–°æ¾³é—¨å†å²
            const xamLottery = data.lottery_data.find(l => l.name === 'æ–°æ¾³é—¨å½©');
            if (xamLottery && xamLottery.history) {
                addHistoryFromAPI('xam', xamLottery.history, xamLottery.openTime);
            }
            
            // è§£æé¦™æ¸¯å†å²
            const hkLottery = data.lottery_data.find(l => l.name === 'é¦™æ¸¯å½©');
            if (hkLottery && hkLottery.history) {
                addHistoryFromAPI('hk', hkLottery.history, hkLottery.openTime);
            }
            
            // åˆ·æ–°æ˜¾ç¤º
            renderHistoryList();
            
            // æ˜¾ç¤ºæˆåŠŸæç¤º
            const toast = document.createElement('div');
            toast.innerHTML = 'âœ… å†å²è®°å½•è·å–æˆåŠŸ';
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
            
        } catch (e) {
            console.error('è·å–å†å²è®°å½•å¤±è´¥:', e);
            if (historyList) {
                historyList.innerHTML = '<div style="text-align:center;color:#e94560;font-size:12px;padding:20px;">âŒ è·å–å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
            }
        }
    }
    
    // å¤åˆ¶å¼€å¥–ç»“æœ
    function copyLotteryResult() {
        const currentData = appState.lotteryData[appState.currentLotteryType];
        if (!currentData || !currentData.numbers || currentData.numbers.length < 7) {
            alert('æš‚æ— å¼€å¥–ç»“æœå¯å¤åˆ¶');
            return;
        }
        
        // ç®€åŒ–åç§°ï¼šæ–°å¥¥ã€é¦™å…­
        const typeNames = { xam: 'æ–°å¥¥', hk: 'é¦™å…­', am: 'æ¾³é—¨' };
        const typeName = typeNames[appState.currentLotteryType] || 'å…­åˆ';
        const numbers = currentData.numbers;
        
        // å·ç æ ¼å¼ï¼šä¸¤ä¸¤åˆ†ç»„ï¼Œç‰¹ç å‰ç”¨"ç‰¹"
        // æ ¼å¼ï¼š31 26  44 21  22 34 ç‰¹ 16
        const n = numbers.map(num => String(num).padStart(2, '0'));
        const numbersStr = `${n[0]} ${n[1]}  ${n[2]} ${n[3]}  ${n[4]} ${n[5]} ç‰¹ ${n[6]}`;
        
        // ç”Ÿè‚–æ ¼å¼ï¼šä¸å·ç å¯¹é½
        // æ ¼å¼ï¼šçŒª  é¾™  ç‹—  é¸¡  çŒ´  çŒ´      è™
        const sx = numbers.map(num => getNumberShengxiao(num));
        const shengxiaoStr = `${sx[0]}  ${sx[1]}  ${sx[2]}  ${sx[3]}  ${sx[4]}  ${sx[5]}      ${sx[6]}`;
        
        // é¢œè‰²æ ¼å¼ï¼šä¸å·ç å¯¹é½
        // æ ¼å¼ï¼šè“  è“  ç»¿  ç»¿  ç»¿  çº¢      ç»¿
        const colorMap = { red: 'çº¢', blue: 'è“', green: 'ç»¿' };
        const colors = numbers.map(num => colorMap[getNumberColor(num)] || '?');
        const colorStr = `${colors[0]}  ${colors[1]}  ${colors[2]}  ${colors[3]}  ${colors[4]}  ${colors[5]}      ${colors[6]}`;
        
        // æ—¶é—´æ ¼å¼ï¼ˆåªä¿ç•™æ—¥æœŸéƒ¨åˆ†ï¼‰
        let dateStr = 'æœªçŸ¥';
        if (currentData.time) {
            const match = currentData.time.match(/(\d{4}-\d{2}-\d{2})/);
            if (match) {
                dateStr = match[1];
            }
        }
        
        const text = `ã€${typeName}ã€‘ç¬¬${currentData.issue}æœŸ\nå·ç ï¼š${numbersStr}\nç”Ÿè‚–ï¼š${shengxiaoStr}\né¢œè‰²ï¼š${colorStr}\næ—¶é—´ï¼š${dateStr}`;
        
        // å¤åˆ¶åˆ°å‰ªè´´æ¿
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
                showCopySuccess();
            }).catch(() => {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }
    
    function fallbackCopy(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.position = 'fixed';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        textarea.select();
        try {
            document.execCommand('copy');
            showCopySuccess();
        } catch (e) {
            alert('å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶');
        }
        document.body.removeChild(textarea);
    }
    
    function showCopySuccess() {
        // æ˜¾ç¤ºå¤åˆ¶æˆåŠŸæç¤ºï¼ˆ2ç§’åè‡ªåŠ¨å…³é—­ï¼‰
        const toast = document.createElement('div');
        toast.innerHTML = 'âœ… å·²å¤åˆ¶å¼€å¥–ç»“æœ';
        toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), 2000);  // 2ç§’åè‡ªåŠ¨å…³é—­
    }
    
    // æ›´æ–°åˆ‡æ¢æŒ‰é’®çŠ¶æ€
    function updateSwitchButtons() {
        const btnXam = document.getElementById('btn-xam');
        const btnHk = document.getElementById('btn-hk');
        
        if (btnXam && btnHk) {
            if (appState.currentLotteryType === 'xam') {
                btnXam.style.background = '#e94560';
                btnXam.style.color = '#fff';
                btnHk.style.background = 'transparent';
                btnHk.style.color = '#4CAF50';
            } else {
                btnHk.style.background = '#4CAF50';
                btnHk.style.color = '#fff';
                btnXam.style.background = 'transparent';
                btnXam.style.color = '#e94560';
            }
        }
    }
    
    function getNumberColor(num) {
        if (LHC_DATA.bose['çº¢æ³¢'].includes(num)) return 'red';
        if (LHC_DATA.bose['è“æ³¢'].includes(num)) return 'blue';
        if (LHC_DATA.bose['ç»¿æ³¢'].includes(num)) return 'green';
        return 'blue';
    }
    
    function getNumberShengxiao(num) {
        for (let [sx, nums] of Object.entries(LHC_DATA.shengxiao)) {
            if (nums.includes(num)) return sx;
        }
        return '';
    }
    
    function getNumberWuxing(num) {
        for (let [wx, nums] of Object.entries(LHC_DATA.wuxing)) {
            if (nums.includes(num)) return wx;
        }
        return '';
    }
    
    // ==================== èµ”ç‡è®¾ç½® ====================
    function saveOdds() {
        // ä¿å­˜æ‰€æœ‰èµ”ç‡è¾“å…¥æ¡†çš„å€¼
        saveOddsToStorage();
        
        showPage('page-main');
        alert('èµ”ç‡è®¾ç½®å·²ä¿å­˜ï¼');
    }
    
    // ==================== æ¿€æ´»åŠŸèƒ½ ====================
    function checkLicense() {
        const statusEl = document.getElementById('license-status');
        
        // æ£€æŸ¥è¯•ç”¨æœŸ
        let installTime = localStorage.getItem('lhc_install_time');
        if (!installTime) {
            installTime = Date.now().toString();
            localStorage.setItem('lhc_install_time', installTime);
        }
        
        const elapsed = Date.now() - parseInt(installTime);
        const daysLeft = Math.max(0, 7 - Math.floor(elapsed / (24 * 60 * 60 * 1000)));
        appState.trialDaysLeft = daysLeft;
        
        // æ£€æŸ¥æ¿€æ´»çŠ¶æ€
        const licenseData = localStorage.getItem('lhc_license');
        if (licenseData) {
            const data = JSON.parse(licenseData);
            if (data.activated) {
                appState.isActivated = true;
                statusEl.textContent = 'å·²æ¿€æ´» âœ“';
                statusEl.className = 'status-value active';
                return;
            }
        }
        
        if (daysLeft > 0) {
            statusEl.textContent = `è¯•ç”¨æœŸå‰©ä½™ ${daysLeft} å¤©`;
            statusEl.className = 'status-value trial';
        } else {
            statusEl.textContent = 'è¯•ç”¨æœŸå·²è¿‡ï¼Œè¯·æ¿€æ´»';
            statusEl.className = 'status-value expired';
        }
    }
    
    function copyMachineCode() {
        navigator.clipboard.writeText(appState.machineCode).then(() => {
            alert('æœºå™¨ç å·²å¤åˆ¶ï¼');
        }).catch(() => {
            const input = document.createElement('input');
            input.value = appState.machineCode;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            alert('æœºå™¨ç å·²å¤åˆ¶ï¼');
        });
    }
    
    function activateLicense() {
        const code = document.getElementById('license-input').value.trim().toUpperCase();
        if (!code) {
            alert('è¯·è¾“å…¥æ¿€æ´»ç ');
            return;
        }
        
        // è¿™é‡Œå®ç°æ¿€æ´»éªŒè¯é€»è¾‘
        // ç®€å•ç¤ºä¾‹ï¼šéªŒè¯æ¿€æ´»ç æ ¼å¼
        if (code.length >= 16) {
            localStorage.setItem('lhc_license', JSON.stringify({
                activated: true,
                code: code,
                time: Date.now()
            }));
            appState.isActivated = true;
            checkLicense();
            alert('æ¿€æ´»æˆåŠŸï¼');
        } else {
            alert('æ¿€æ´»ç æ— æ•ˆï¼Œè¯·æ£€æŸ¥åé‡è¯•');
        }
    }
    
    // ==================== å‚ç…§è¡¨æ¸²æŸ“ ====================
    function renderReferenceTables() {
        // ç”Ÿè‚–è¡¨
        let sxHtml = '<tr><th>ç”Ÿè‚–</th><th>å¯¹åº”å·ç </th></tr>';
        for (let [sx, nums] of Object.entries(LHC_DATA.shengxiao)) {
            const numsStr = nums.map(n => {
                const color = getNumberColor(n);
                return `<span class="num-${color}">${String(n).padStart(2, '0')}</span>`;
            }).join(' ');
            sxHtml += `<tr><td>${sx}</td><td>${numsStr}</td></tr>`;
        }
        document.getElementById('ref-shengxiao').innerHTML = sxHtml;
        
        // äº”è¡Œè¡¨
        let wxHtml = '<tr><th>äº”è¡Œ</th><th>å¯¹åº”å·ç </th></tr>';
        for (let [wx, nums] of Object.entries(LHC_DATA.wuxing)) {
            const numsStr = nums.map(n => {
                const color = getNumberColor(n);
                return `<span class="num-${color}">${String(n).padStart(2, '0')}</span>`;
            }).join(' ');
            wxHtml += `<tr><td>${wx}</td><td>${numsStr}</td></tr>`;
        }
        document.getElementById('ref-wuxing').innerHTML = wxHtml;
        
        // æ³¢è‰²è¡¨
        let bsHtml = '<tr><th>æ³¢è‰²</th><th>å¯¹åº”å·ç </th></tr>';
        for (let [bs, nums] of Object.entries(LHC_DATA.bose)) {
            const colorClass = bs === 'çº¢æ³¢' ? 'red' : bs === 'è“æ³¢' ? 'blue' : 'green';
            const numsStr = nums.map(n => `<span class="num-${colorClass}">${String(n).padStart(2, '0')}</span>`).join(' ');
            bsHtml += `<tr><td>${bs}</td><td>${numsStr}</td></tr>`;
        }
        document.getElementById('ref-bose').innerHTML = bsHtml;
        
        // å®¶ç¦½é‡å…½è¡¨
        let jqHtml = '<tr><th>ç±»å‹</th><th>ç”Ÿè‚–</th></tr>';
        for (let [type, sxList] of Object.entries(LHC_DATA.jiaqin)) {
            jqHtml += `<tr><td>${type}</td><td>${sxList.join(' ')}</td></tr>`;
        }
        document.getElementById('ref-jiaqin').innerHTML = jqHtml;
    }
    
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘                    ã€æ¨¡å—1ã€‘æ ¼å¼è§£ææ¨¡å—                        â•‘
    // â•‘  æ–‡ä»¶åˆ†ç¦»æ—¶æå–åˆ°: js/parser.js                                 â•‘
    // â•‘  åŠŸèƒ½: è§£æç”¨æˆ·è¾“å…¥çš„ä¸‹æ³¨æ–‡æœ¬ï¼Œè¯†åˆ«ç©æ³•å’Œé‡‘é¢                    â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // å­˜å‚¨è§£æåçš„ä¸‹æ³¨æ•°æ®
    let parsedBets = [];
    let calcResults = [];
    
    // è§£æä¸‹æ³¨ä¿¡æ¯ï¼ˆå…¥å£å‡½æ•°ï¼‰
    function parseBetInput(input) {
        const bets = [];
        const lines = input.split('\n').filter(line => line.trim());
        
        for (const line of lines) {
            const parsed = parseBetLine(line.trim());
            if (parsed) {
                bets.push(...parsed);
            }
        }
        return bets;
    }
    
    // è·å–æ ¼å¼è®¾ç½®
    // é»˜è®¤AIé…ç½®ï¼ˆDeepSeekï¼‰- æ”¾åœ¨æœ€å‰é¢ç¡®ä¿å…¨å±€å¯ç”¨
    // é…ç½®æ•°æ®ï¼ˆå·²æ··æ·†ä¿æŠ¤ï¼‰
    const _0x = ['ZGVlcHNlZWs=','c2stMTIzMTQ0ODU1OTUwNDNmY2E2MjNmNjlhZTEyZGJkZDQ='];
    const _d = (s) => {try{return atob(s)}catch(e){return ''}};
    const DEFAULT_AI_CONFIG = {
        provider: _d(_0x[0]),
        apiKey: _d(_0x[1])
    };
    
    function getFormatSettings() {
        try {
            const saved = JSON.parse(localStorage.getItem('lhc_format_settings') || '{}');
            // å§‹ç»ˆä½¿ç”¨å†…ç½®APIé…ç½®ï¼Œé»˜è®¤å¯ç”¨AI
            saved.aiApiKey = DEFAULT_AI_CONFIG.apiKey;
            saved.aiProvider = DEFAULT_AI_CONFIG.provider;
            if (saved.aiEnabled === undefined) {
                saved.aiEnabled = true; // é»˜è®¤å¯ç”¨
            }
            return saved;
        } catch(e) {
            return {
                aiEnabled: true,
                aiApiKey: DEFAULT_AI_CONFIG.apiKey,
                aiProvider: 'deepseek'
            };
        }
    }
    
    // è§£æè‡ªå®šä¹‰å…³é”®è¯
    function parseCustomKeywords(line, settings) {
        const bets = [];
        const keywords = (settings.customKeywords || '').split('\n').filter(k => k.trim());
        
        for (const kw of keywords) {
            const [key, playType] = kw.split('=').map(s => s.trim());
            if (key && playType && line.includes(key)) {
                // æå–å…³é”®è¯åé¢çš„æ•°å­—ä½œä¸ºé‡‘é¢
                const amountMatch = line.match(new RegExp(key + '.*?(\\d+)'));
                if (amountMatch) {
                    // æå–å¯èƒ½çš„å·ç æˆ–ç”Ÿè‚–
                    const numMatch = line.match(/(\d+)/g);
                    if (numMatch && numMatch.length >= 2) {
                        bets.push({ 
                            type: playType, 
                            value: numMatch[0], 
                            number: parseInt(numMatch[0]),
                            amount: parseInt(numMatch[numMatch.length - 1]), 
                            raw: line 
                        });
                        return bets;
                    }
                }
            }
        }
        return null;
    }
    
    // å¢å¼ºç‰ˆè§£æå•è¡Œä¸‹æ³¨
    function parseBetLine(line) {
        const bets = [];
        const settings = getFormatSettings();
        const shengxiaoList = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
        
        // ã€å…³é”®ä¿®å¤ã€‘é¢„å¤„ç†ï¼šå…¨è§’è½¬åŠè§’ï¼ˆè§£å†³æ‰‹æœºè¾“å…¥é—®é¢˜ï¼‰
        if (typeof normalizeFullWidth === 'function') {
            line = normalizeFullWidth(line);
        }
        
        // é¢„å¤„ç†ï¼šè½¬æ¢ä¸­æ–‡æ•°å­—
        if (settings.cnNumber !== false) {
        line = convertChineseNumber(line);
        }
        
        // é¢„å¤„ç†ï¼šæ¸…ç†å¤šä½™ç©ºæ ¼
        if (settings.ignoreSpace !== false) {
            line = line.replace(/\s+/g, ' ').trim();
        }
        
        // é¢„å¤„ç†ï¼šåŒéŸ³å­—çº æ­£
        if (settings.autoCorrect !== false) {
            line = correctHomophones(line);
        }
        
        // ä¼˜å…ˆæ£€æŸ¥è‡ªå®šä¹‰å…³é”®è¯
        const customResult = parseCustomKeywords(line, settings);
        if (customResult && customResult.length > 0) {
            return customResult;
        }
        
        // ========== æ¨¡å¼1: å¤šå·ç å„ä¸‹æ³¨ ==========
        // "31.34å„20" æˆ– "31 34å„20" æˆ– "31,34å„20"
        if (settings.tplMultiNum !== false) {
            const multiMatch = line.match(/^(\d+[\s.,ï¼Œã€]+\d+(?:[\s.,ï¼Œã€]+\d+)*)å„(\d+)å…ƒ?$/);
        if (multiMatch) {
                const nums = multiMatch[1].split(/[\s.,ï¼Œã€]+/).map(n => parseInt(n));
            const amount = parseInt(multiMatch[2]);
            for (const num of nums) {
                    if (num >= 1 && num <= 49) {
                bets.push({ type: 'ç‰¹ç ', number: num, amount: amount, raw: line });
            }
                }
                if (bets.length) return bets;
            }
        }
        
        // ========== æ¨¡å¼2: ç‰¹ç ä¸‹æ³¨ ==========
        // "ç‰¹43 20å…ƒ" "ç‰¹ç  05 100" "ç‰¹43 20"
        if (settings.tplTema !== false) {
            const temaMatch = line.match(/ç‰¹ç ?\s*(\d+)\s*[,ï¼Œ]?\s*(\d+)å…ƒ?/);
        if (temaMatch) {
            bets.push({ type: 'ç‰¹ç ', number: parseInt(temaMatch[1]), amount: parseInt(temaMatch[2]), raw: line });
            return bets;
            }
        }
        
        // ========== æ¨¡å¼3: Xè¡¨ç¤ºé‡‘é¢ ==========
        // "46,45,X50" "22ï¼Œ33ï¼ŒX15" "é¸¡é¼ çŒ´X10"
        if (settings.tplXAmount !== false) {
            // æ•°å­—+Xé‡‘é¢
            const xNumMatch = line.match(/(\d+(?:[,ï¼Œã€\s]+\d+)*)[,ï¼Œã€\s]*[Xx](\d+)/);
            if (xNumMatch) {
                const nums = xNumMatch[1].split(/[,ï¼Œã€\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                const amount = parseInt(xNumMatch[2]);
                for (const num of nums) {
                    bets.push({ type: 'ç‰¹ç ', number: num, amount: amount, raw: line });
                }
                if (bets.length) return bets;
            }
            
            // ç”Ÿè‚–+Xé‡‘é¢
            const xSxMatch = line.match(/([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)[Xx](\d+)/);
            if (xSxMatch) {
                const animals = xSxMatch[1].split('');
                const amount = parseInt(xSxMatch[2]);
                for (const sx of animals) {
                    if (shengxiaoList.includes(sx)) {
                        bets.push({ type: 'ç”Ÿè‚–', value: sx, amount: amount, raw: line });
                    }
                }
                if (bets.length) return bets;
            }
        }
        
        // ========== æ¨¡å¼4: ä¹°ç”Ÿè‚– ==========
        // "ä¹°çŒªå„10" "ä¹°é¾™å„20" "ä¹°çŒª10"
        if (settings.tplShengxiao !== false) {
            const buyMatch = line.match(/ä¹°([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)å„?(\d+)å…ƒ?/);
            if (buyMatch) {
                const animals = buyMatch[1].split('');
                const amount = parseInt(buyMatch[2]);
                for (const sx of animals) {
                    if (shengxiaoList.includes(sx)) {
                        bets.push({ type: 'ç”Ÿè‚–', value: sx, amount: amount, raw: line });
                    }
                }
                if (bets.length) return bets;
            }
            
            // å•ç‹¬ç”Ÿè‚– "é¾™ 200" "çŒª200"
        for (const sx of shengxiaoList) {
                const sxMatch = line.match(new RegExp(`^${sx}\\s*(\\d+)å…ƒ?$`));
            if (sxMatch) {
                bets.push({ type: 'ç”Ÿè‚–', value: sx, amount: parseInt(sxMatch[1]), raw: line });
                return bets;
                }
            }
        }
        
        // ========== æ¨¡å¼5: å°¾æ•°ä¸‹æ³¨ ==========
        // "5å°¾100" "å°¾5 100"
        if (settings.tplWei !== false) {
            const weiMatch = line.match(/(\d)å°¾\s*(\d+)å…ƒ?/) || line.match(/å°¾(\d)\s*(\d+)å…ƒ?/);
            if (weiMatch) {
                bets.push({ type: 'å°¾æ•°', value: weiMatch[1], amount: parseInt(weiMatch[2]), raw: line });
                return bets;
            }
        }
        
        // ========== æ¨¡å¼6: å¤šè‚–ä¸‹æ³¨ ==========
        // "å…­è‚–é¼ ç¾Šé¸¡ç‰›é©¬äºŒ200" "ä¸‰è‚–é¾™è™è›‡100"
        if (settings.tplDuoxiao !== false) {
            const duoxiaoMatch = line.match(/([ä¸€äºŒä¸‰å››äº”å…­ä¸ƒå…«ä¹å]+è‚–|è‚–)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)å…ƒ?/);
            if (duoxiaoMatch) {
                const animals = duoxiaoMatch[2].split('');
                const amount = parseInt(duoxiaoMatch[3]);
                for (const sx of animals) {
                    if (shengxiaoList.includes(sx)) {
                        bets.push({ type: 'å¤šè‚–', value: sx, amount: amount, raw: line });
                    }
                }
                if (bets.length) return bets;
            }
        }
        
        // ========== æ¨¡å¼7: å¹³ç‰¹ç”Ÿè‚– ==========
        // "å¹³ç‰¹çŒ´é¸¡å„200" "å¹³ç‰¹çŒª100"
        if (settings.tplPingte !== false) {
            const pingteMatch = line.match(/å¹³ç‰¹([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)å„?(\d+)å…ƒ?/);
            if (pingteMatch) {
                const animals = pingteMatch[1].split('');
                const amount = parseInt(pingteMatch[2]);
                for (const sx of animals) {
                    if (shengxiaoList.includes(sx)) {
                        bets.push({ type: 'å¹³ç‰¹ç”Ÿè‚–', value: sx, amount: amount, raw: line });
                    }
                }
                if (bets.length) return bets;
            }
        }
        
        // ========== æ¨¡å¼8: æ³¢è‰² ==========
        // "çº¢æ³¢ 50" "çº¢ 50" "è“æ³¢100"
        if (settings.tplBose !== false) {
            const boseMatch = line.match(/(çº¢|è“|ç»¿)æ³¢?\s*(\d+)å…ƒ?/);
        if (boseMatch) {
            bets.push({ type: 'æ³¢è‰²', value: boseMatch[1] + 'æ³¢', amount: parseInt(boseMatch[2]), raw: line });
            return bets;
            }
        }
        
        // ========== æ¨¡å¼9: ä¸¤é¢ï¼ˆå¤§å°å•åŒï¼‰ ==========
        // "å¤§ 100" "å°100" "å•åŒå„50"
        if (settings.tplDxds !== false) {
            const dxdsMatch = line.match(/^(å¤§|å°|å•|åŒ)\s*(\d+)å…ƒ?$/);
        if (dxdsMatch) {
            bets.push({ type: 'ä¸¤é¢', value: dxdsMatch[1], amount: parseInt(dxdsMatch[2]), raw: line });
            return bets;
            }
            
            // "å•åŒå„50"
            const dxdsGeMatch = line.match(/(å¤§å°|å•åŒ)å„(\d+)å…ƒ?/);
            if (dxdsGeMatch) {
                const types = dxdsGeMatch[1].split('');
                const amount = parseInt(dxdsGeMatch[2]);
                for (const t of types) {
                    bets.push({ type: 'ä¸¤é¢', value: t, amount: amount, raw: line });
                }
                if (bets.length) return bets;
            }
        }
        
        // ========== æ¨¡å¼10: çº¯æ•°å­—+é‡‘é¢ ==========
        // "43 20" ç®€å†™å½¢å¼
        const simpleMatch = line.match(/^(\d{1,2})\s+(\d+)å…ƒ?$/);
        if (simpleMatch) {
            const num = parseInt(simpleMatch[1]);
            if (num >= 1 && num <= 49) {
                bets.push({ type: 'ç‰¹ç ', number: num, amount: parseInt(simpleMatch[2]), raw: line });
                return bets;
            }
        }
        
        // ========== æ¨¡å¼11: å¤šç”Ÿè‚–å„ä¸‹æ³¨ ==========
        // "é¼ ç¾Šé¸¡ç‰›é©¬å„200"
        const multiSxMatch = line.match(/^([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]{2,})å„(\d+)å…ƒ?$/);
        if (multiSxMatch) {
            const animals = multiSxMatch[1].split('');
            const amount = parseInt(multiSxMatch[2]);
            for (const sx of animals) {
                if (shengxiaoList.includes(sx)) {
                    bets.push({ type: 'ç”Ÿè‚–', value: sx, amount: amount, raw: line });
                }
            }
            if (bets.length) return bets;
        }
        
        return null;
    }
    
    // åŒéŸ³å­—çº æ­£
    function correctHomophones(str) {
        const corrections = {
            'çŒª': ['ä¸»', 'æœ±', 'ç ', 'è¯¸'],
            'ç‰›': ['å¦', 'çº½', 'é’®'],
            'è™': ['æˆ·', 'æ²ª', 'æŠ¤'],
            'é¾™': ['éš†', 'è‹', 'ç¬¼'],
            'è›‡': ['èˆ', 'æ¶‰', 'è®¾'],
            'é©¬': ['å¦ˆ', 'ç ', 'ç›','å—'],
            'ç¾Š': ['é˜³', 'æ‰¬', 'æ¨', 'æ´‹'],
            'çŒ´': ['ä¾¯', 'å€™', 'å–‰'],
            'é¸¡': ['æœº', 'åŸº', 'æ¿€', 'åŠ'],
            'ç‹—': ['å¤Ÿ', 'è´­', 'æ„', 'æ²Ÿ'],
            'é¼ ': ['æš‘', 'æ•°', 'å±', 'ç½²'],
            'å…”': ['å', 'å›¾', 'åœŸ', 'é€”']
        };
        
        for (const [correct, wrongs] of Object.entries(corrections)) {
            for (const wrong of wrongs) {
                str = str.replace(new RegExp(wrong, 'g'), correct);
            }
        }
        return str;
    }
    
    // è½¬æ¢ä¸­æ–‡æ•°å­—ï¼ˆæ™ºèƒ½ç‰ˆï¼šæ­£ç¡®å¤„ç†å„ç§ä¸­æ–‡æ•°å­—æ ¼å¼ï¼‰
    function convertChineseNumber(str) {
        // å®šä¹‰ä¸­æ–‡æ•°å­—æ˜ å°„
        const digitMap = {'é›¶':0,'ä¸€':1,'äºŒ':2,'ä¸¤':2,'ä¸‰':3,'å››':4,'äº”':5,'å…­':6,'ä¸ƒ':7,'å…«':8,'ä¹':9};
        
        // å¤„ç†å®Œæ•´çš„ä¸­æ–‡æ•°å­—ï¼ˆå¦‚"äºŒåäº”"ã€"ä¸€ç™¾äºŒå"ç­‰ï¼‰
        function parseChineseNum(cnStr) {
            let result = 0;
            let temp = 0;
            
            for (let i = 0; i < cnStr.length; i++) {
                const char = cnStr[i];
                if (digitMap[char] !== undefined) {
                    temp = digitMap[char];
                } else if (char === 'å') {
                    if (temp === 0 && i === 0) temp = 1; // "å"å¼€å¤´è¡¨ç¤º10
                    result += temp * 10;
                    temp = 0;
                } else if (char === 'ç™¾') {
                    result += temp * 100;
                    temp = 0;
                } else if (char === 'åƒ') {
                    result += temp * 1000;
                    temp = 0;
                }
            }
            result += temp; // åŠ ä¸Šæœ€åçš„ä¸ªä½æ•°
            return result;
        }
        
        // åŒ¹é…ä¸­æ–‡æ•°å­—ä¸²å¹¶æ›¿æ¢
        // åŒ¹é…æ¨¡å¼ï¼šè¿ç»­çš„ä¸­æ–‡æ•°å­—å­—ç¬¦
        const cnNumPattern = /[é›¶ä¸€äºŒä¸¤ä¸‰å››äº”å…­ä¸ƒå…«ä¹åç™¾åƒ]+/g;
        
        str = str.replace(cnNumPattern, (match) => {
            const num = parseChineseNum(match);
            return num.toString();
        });
        
        return str;
    }
    
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘                    ã€æ¨¡å—2ã€‘è®¡ç®—é€»è¾‘æ¨¡å—                        â•‘
    // â•‘  æ–‡ä»¶åˆ†ç¦»æ—¶æå–åˆ°: js/calculator.js                             â•‘
    // â•‘  åŠŸèƒ½: æ ¹æ®å¼€å¥–å·ç å’Œä¸‹æ³¨ä¿¡æ¯è®¡ç®—ä¸­å¥–ç»“æœ                        â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // è®¡ç®—å•æ³¨ç»“æœ
    function calculateSingleBet(bet, lotteryNumbers) {
        const tema = lotteryNumbers[6]; // ç‰¹ç 
        const pingma = lotteryNumbers.slice(0, 6); // å¹³ç 
        const allNumbers = lotteryNumbers; // æ‰€æœ‰å·ç 
        
        let isWin = false;
        let odds = 1;
        let winAmount = 0;
        let detail = '';
        
        // è·å–èµ”ç‡
        const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
        
        if (bet.type === 'ç‰¹ç ') {
            odds = parseFloat(savedOdds['odds-tema']) || 43;
            isWin = bet.number === tema;
            detail = `ç‰¹ç  ${String(bet.number).padStart(2,'0')} vs å¼€å¥–ç‰¹ç  ${String(tema).padStart(2,'0')}`;
        } else if (bet.type === 'ç”Ÿè‚–' || bet.type === 'å¤šè‚–') {
            odds = parseFloat(savedOdds['odds-shengxiao']) || 12;
            const sxNums = LHC_DATA.shengxiao[bet.value] || [];
            isWin = sxNums.includes(tema);
            detail = `ç”Ÿè‚– ${bet.value} (${sxNums.join(',')}) vs ç‰¹ç  ${tema}`;
        } else if (bet.type === 'å¹³ç‰¹ç”Ÿè‚–') {
            // å¹³ç‰¹ç”Ÿè‚–ï¼šæ£€æŸ¥å¹³ç ä¸­æ˜¯å¦æœ‰è¯¥ç”Ÿè‚–
            odds = parseFloat(savedOdds['odds-pingte']) || 12;
            const sxNums = LHC_DATA.shengxiao[bet.value] || [];
            isWin = pingma.some(num => sxNums.includes(num));
            const matchNums = pingma.filter(num => sxNums.includes(num));
            detail = `å¹³ç‰¹ ${bet.value} (${sxNums.join(',')}) vs å¹³ç  [${pingma.join(',')}]${matchNums.length > 0 ? ' ä¸­' + matchNums.join(',') : ''}`;
        } else if (bet.type === 'æ³¢è‰²') {
            const colorKey = bet.value === 'çº¢æ³¢' ? 'odds-red' : bet.value === 'è“æ³¢' ? 'odds-blue' : 'odds-green';
            odds = parseFloat(savedOdds[colorKey]) || 2.8;
            const boseNums = LHC_DATA.bose[bet.value] || [];
            isWin = boseNums.includes(tema);
            detail = `${bet.value} vs ç‰¹ç  ${tema}`;
        } else if (bet.type === 'ä¸¤é¢') {
            odds = 2;
            if (bet.value === 'å¤§') isWin = tema >= 25 && tema <= 49;
            else if (bet.value === 'å°') isWin = tema >= 1 && tema <= 24;
            else if (bet.value === 'å•') isWin = tema % 2 === 1;
            else if (bet.value === 'åŒ') isWin = tema % 2 === 0;
            detail = `${bet.value} vs ç‰¹ç  ${tema}`;
        } else if (bet.type === 'å°¾æ•°') {
            // å°¾æ•°ï¼šæ£€æŸ¥ç‰¹ç å°¾æ•°
            odds = parseFloat(savedOdds['odds-weishu']) || 9.8;
            const temaWei = tema % 10;
            isWin = parseInt(bet.value) === temaWei;
            detail = `${bet.value}å°¾ vs ç‰¹ç  ${tema} (å°¾æ•°${temaWei})`;
        } else if (bet.type === 'è¿ç ') {
            // è¿ç ï¼šæ£€æŸ¥æ‰€æœ‰å·ç æ˜¯å¦éƒ½åœ¨å¼€å¥–å·ç ä¸­
            odds = parseFloat(savedOdds['odds-lianma']) || 20;
            const nums = String(bet.value).split(',').map(n => parseInt(n));
            isWin = nums.every(n => allNumbers.includes(n));
            detail = `è¿ç  [${nums.join(',')}] vs å¼€å¥– [${allNumbers.join(',')}]`;
        } else {
            // æœªçŸ¥ç©æ³•ï¼Œé»˜è®¤ä¸ä¸­å¥–
            detail = `æœªçŸ¥ç©æ³•: ${bet.type} ${bet.value || bet.number}`;
        }
        
        if (isWin) {
            winAmount = bet.amount * odds;
        }
        
        return {
            ...bet,
            isWin,
            odds,
            winAmount,
            detail,
            netResult: isWin ? -(winAmount - bet.amount) : bet.amount
        };
    }
    
    async function calculateBets() {
        const input = document.getElementById('bet-input').value.trim();
        if (!input) {
            alert('è¯·å…ˆç²˜è´´ä¸‹æ³¨ä¿¡æ¯');
            return;
        }
        
        if (!appState.lotteryNumbers || appState.lotteryNumbers.length < 7 || appState.lotteryNumbers[0] === 0) {
            alert('è¯·å…ˆè®¾ç½®å¼€å¥–å·ç ï¼');
            return;
        }
        
        const settings = getFormatSettings();
        const lines = input.split('\n').filter(line => line.trim());
        
        // åˆå§‹åŒ–
        parsedBets = [];
        
        // é‡ç½®è°ƒè¯•ä¿¡æ¯
        debugInfo.aiInput = input;
        debugInfo.aiOutput = '';
        debugInfo.aiParsed = null;
        debugInfo.aiBets = [];
        debugInfo.lastError = '';
        
        // ã€æ–°æ¶æ„ã€‘AIä¼˜å…ˆè¯†åˆ«æ‰€æœ‰è¡Œçš„ç±»å‹ï¼Œç¨‹åºè´Ÿè´£æ•°å€¼æå–
        if (settings.aiEnabled && settings.aiApiKey) {
            // ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘å¼€å§‹
            showAutoCloseToast('ğŸ¤– AIæ­£åœ¨è¯†åˆ«ç©æ³•ç±»å‹...', 8000);
            // ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘ç»“æŸ
            
            try {
                // AIè¯†åˆ«æ‰€æœ‰è¡Œçš„ç±»å‹
                const aiResult = await parseWithAI(input);
                console.log('AIè¿”å›ç»“æœ:', aiResult); // è°ƒè¯•
                
                if (aiResult && aiResult.bets && aiResult.bets.length > 0) {
                    // parseWithAI å·²ç»å®Œæˆäº†ç±»å‹è¯†åˆ«å’Œæ•°å€¼æå–ï¼Œç›´æ¥ä½¿ç”¨ç»“æœ
                    parsedBets = aiResult.bets.map(bet => ({
                        ...bet,
                        fromAI: true
                    }));
                    
                    console.log('AIè§£ææˆåŠŸï¼Œä¸‹æ³¨æ•°:', parsedBets.length);
                    showAutoCloseToast(`âœ… AIè¯†åˆ« ${parsedBets.length} æ¡`, 2000);
                } else {
                    // AIè¿”å›ç©ºç»“æœï¼Œå›é€€æœ¬åœ°è§£æ
                    console.log('AIè¿”å›ç©ºç»“æœï¼Œå›é€€æœ¬åœ°è§£æ');
                    debugInfo.lastError = 'AIè¿”å›ç©ºç»“æœæˆ–è§£æå¤±è´¥';
                    showAutoCloseToast('âš ï¸ AIæ— ç»“æœï¼Œä½¿ç”¨æœ¬åœ°è§£æ', 2000);
                    parsedBets = parseBetInput(input);
                }
            } catch (e) {
                console.error('AIè§£æå¤±è´¥:', e);
                debugInfo.lastError = e.message || String(e);
                // ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘å¼€å§‹
                showAutoCloseToast('âŒ AIå¤±è´¥: ' + e.message, 3000);
                // ã€AIè°ƒè¯•æ˜¾ç¤ºã€‘ç»“æŸ
                // å›é€€åˆ°æœ¬åœ°è§£æ
                parsedBets = parseBetInput(input);
            }
        } else {
            // æœªå¯ç”¨AIï¼Œä½¿ç”¨æœ¬åœ°è§£æ
            parsedBets = parseBetInput(input);
        }
        
        console.log('æœ€ç»ˆè§£æç»“æœ:', parsedBets); // è°ƒè¯•
        
        if (parsedBets.length === 0) {
            alert('âŒ æœªè¯†åˆ«åˆ°æœ‰æ•ˆçš„ä¸‹æ³¨ä¿¡æ¯\n\nå»ºè®®ï¼š\n1. æ£€æŸ¥è¾“å…¥æ ¼å¼\n2. åœ¨"è‡ªå®šä¹‰æ ¼å¼"ä¸­æ·»åŠ è§„åˆ™\n3. å¯ç”¨AIæ™ºèƒ½è§£æ');
            return;
        }
        
        // è®¡ç®—æ¯æ³¨ç»“æœ
        calcResults = parsedBets.map(bet => calculateSingleBet(bet, appState.lotteryNumbers));
        
        // æ±‡æ€»
        const totalBet = calcResults.reduce((sum, r) => sum + r.amount, 0);
        const totalWin = calcResults.filter(r => r.isWin).length;
        const netResult = calcResults.reduce((sum, r) => sum + r.netResult, 0);
        
        // ç”Ÿæˆç»“æœæ–‡æœ¬
        let resultText = `ğŸ“Š è®¡ç®—ç»“æœ\n`;
        resultText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n`;
        resultText += `æ€»ä¸‹æ³¨ï¼š${totalBet}å…ƒ | ä¸­å¥–ï¼š${totalWin}æ³¨\n`;
        resultText += `ç»“ç®—ï¼š${netResult >= 0 ? '+' : ''}${netResult}å…ƒ\n`;
        resultText += `â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”\n\n`;
        
        for (const r of calcResults) {
            const status = r.isWin ? 'ğŸ¯ä¸­' : 'âœ—';
            const resultStr = r.netResult >= 0 ? `+${r.netResult}` : `${r.netResult}`;
            // æ˜¾ç¤ºç±»å‹è¯†åˆ«ä¿¡æ¯
            let typeInfo = r.type;
            if (r.fromAI) {
                typeInfo = `[AI]${r.type}`;
                if (r.localType) {
                    typeInfo += `(ç¨‹åºè¯†åˆ«:${r.localType})`;
                }
            }
            resultText += `${status} ${typeInfo}${r.number || r.value || ''} ä¸‹æ³¨${r.amount} â†’ ${resultStr}\n`;
        }
        
        document.getElementById('result-content').textContent = resultText;
        document.getElementById('result-section').classList.add('show');
    }
    
    // æ˜¾ç¤ºæ ¸å¯¹è¯¦æƒ…
    function showCheckDetail() {
        if (calcResults.length === 0) {
            alert('è¯·å…ˆç‚¹å‡»"å¼€å§‹è®¡ç®—"');
            return;
        }
        
        // æ±‡æ€»æ•°æ®
        const totalBet = calcResults.reduce((sum, r) => sum + r.amount, 0);
        const totalWin = calcResults.filter(r => r.isWin).length;
        const netResult = calcResults.reduce((sum, r) => sum + r.netResult, 0);
        
        document.getElementById('check-total-bet').textContent = totalBet + 'å…ƒ';
        document.getElementById('check-win-count').textContent = totalWin + '/' + calcResults.length;
        
        const resultEl = document.getElementById('check-result');
        resultEl.textContent = (netResult >= 0 ? '+' : '') + netResult + 'å…ƒ';
        resultEl.className = 'check-summary-value ' + (netResult >= 0 ? 'lose' : 'win');
        
        // ç”Ÿæˆè¯¦æƒ…åˆ—è¡¨
        const listEl = document.getElementById('check-detail-list');
        listEl.innerHTML = calcResults.map(r => {
            const statusClass = r.isWin ? 'win' : 'lose';
            const badge = r.isWin ? 'ğŸ¯ ä¸­å¥–' : 'æœªä¸­';
            const badgeClass = r.isWin ? '' : 'miss';
            const resultClass = r.netResult >= 0 ? 'lose' : 'win';
            const resultText = (r.netResult >= 0 ? '+' : '') + r.netResult;
            
            // æ˜¾ç¤ºAIä¸ç¨‹åºè¯†åˆ«å·®å¼‚
            let typeConflictHtml = '';
            if (r.fromAI && r.localType) {
                typeConflictHtml = `<div class="check-detail-info" style="color:#ffa500;font-size:11px;">âš ï¸ AIè¯†åˆ«: ${r.aiType || r.type} | ç¨‹åºè¯†åˆ«: ${r.localType}</div>`;
            } else if (r.fromAI) {
                typeConflictHtml = `<div class="check-detail-info" style="color:#4CAF50;font-size:11px;">ğŸ¤– AIè¯†åˆ«</div>`;
            }
            
            return `
                <div class="check-detail-item ${statusClass}">
                    <div class="check-detail-header">
                        <span class="check-detail-type">${r.type} ${r.number ? String(r.number).padStart(2,'0') : (r.value || '')}</span>
                        <span class="check-detail-badge ${badgeClass}">${badge}</span>
                    </div>
                    ${typeConflictHtml}
                    <div class="check-detail-info">ä¸‹æ³¨é‡‘é¢ï¼š${r.amount}å…ƒ</div>
                    <div class="check-detail-calc">${r.detail}</div>
                    ${r.isWin ? `<div class="check-detail-calc">ä¸­å¥–ï¼š${r.amount} Ã— ${r.odds} = ${r.winAmount}</div>` : ''}
                    <div class="check-detail-result ${resultClass}">${resultText}å…ƒ</div>
                </div>
            `;
        }).join('');
        
        showPage('page-check');
    }
    
    function clearInput() {
        document.getElementById('bet-input').value = '';
        document.getElementById('result-section').classList.remove('show');
        parsedBets = [];
        calcResults = [];
    }
    
    // ==================== è‡ªå®šä¹‰æ ¼å¼è®¾ç½® ====================
    
    
    function saveFormatSettings() {
        const settings = {
            // AIè®¾ç½®ï¼ˆé»˜è®¤å¯ç”¨ï¼ŒAPI Keyä½¿ç”¨å†…ç½®ï¼‰
            aiEnabled: document.getElementById('ai-parse-enabled')?.checked !== false,
            aiProvider: 'deepseek',
            aiApiKey: DEFAULT_AI_CONFIG.apiKey,
            
            // é¢„è®¾æ¨¡æ¿
            tplMultiNum: document.getElementById('tpl-multi-num')?.checked !== false,
            tplTema: document.getElementById('tpl-tema')?.checked !== false,
            tplShengxiao: document.getElementById('tpl-shengxiao')?.checked !== false,
            tplXAmount: document.getElementById('tpl-x-amount')?.checked !== false,
            tplWei: document.getElementById('tpl-wei')?.checked !== false,
            tplDuoxiao: document.getElementById('tpl-duoxiao')?.checked !== false,
            tplPingte: document.getElementById('tpl-pingte')?.checked !== false,
            tplBose: document.getElementById('tpl-bose')?.checked !== false,
            tplDxds: document.getElementById('tpl-dxds')?.checked !== false,
            
            // åŸºç¡€è§„åˆ™
            cnNumber: document.getElementById('format-cn-number')?.checked !== false,
            ignoreSpace: document.getElementById('format-ignore-space')?.checked !== false,
            autoCorrect: document.getElementById('format-auto-correct')?.checked !== false,
            
            // è‡ªå®šä¹‰å†…å®¹
            customKeywords: document.getElementById('custom-keywords')?.value || '',
            customTemplates: document.getElementById('custom-templates')?.value || ''
        };
        localStorage.setItem('lhc_format_settings', JSON.stringify(settings));
        showAutoCloseToast('âœ… æ ¼å¼è®¾ç½®å·²ä¿å­˜ï¼');
    }
    
    function loadFormatSettings() {
        const saved = localStorage.getItem('lhc_format_settings');
        if (saved) {
            try {
                const s = JSON.parse(saved);
                
                // AIè®¾ç½®ï¼ˆé»˜è®¤å¯ç”¨ï¼‰
                const aiCheckbox = document.getElementById('ai-parse-enabled');
                if (aiCheckbox) {
                    aiCheckbox.checked = s.aiEnabled !== false; // é»˜è®¤true
                }
                
                // é¢„è®¾æ¨¡æ¿
                if (document.getElementById('tpl-multi-num')) document.getElementById('tpl-multi-num').checked = s.tplMultiNum !== false;
                if (document.getElementById('tpl-tema')) document.getElementById('tpl-tema').checked = s.tplTema !== false;
                if (document.getElementById('tpl-shengxiao')) document.getElementById('tpl-shengxiao').checked = s.tplShengxiao !== false;
                if (document.getElementById('tpl-x-amount')) document.getElementById('tpl-x-amount').checked = s.tplXAmount !== false;
                if (document.getElementById('tpl-wei')) document.getElementById('tpl-wei').checked = s.tplWei !== false;
                if (document.getElementById('tpl-duoxiao')) document.getElementById('tpl-duoxiao').checked = s.tplDuoxiao !== false;
                if (document.getElementById('tpl-pingte')) document.getElementById('tpl-pingte').checked = s.tplPingte !== false;
                if (document.getElementById('tpl-bose')) document.getElementById('tpl-bose').checked = s.tplBose !== false;
                if (document.getElementById('tpl-dxds')) document.getElementById('tpl-dxds').checked = s.tplDxds !== false;
                
                // åŸºç¡€è§„åˆ™
                if (document.getElementById('format-cn-number')) document.getElementById('format-cn-number').checked = s.cnNumber !== false;
                if (document.getElementById('format-ignore-space')) document.getElementById('format-ignore-space').checked = s.ignoreSpace !== false;
                if (document.getElementById('format-auto-correct')) document.getElementById('format-auto-correct').checked = s.autoCorrect !== false;
                
                // è‡ªå®šä¹‰å†…å®¹
                if (document.getElementById('custom-keywords')) document.getElementById('custom-keywords').value = s.customKeywords || '';
                if (document.getElementById('custom-templates')) document.getElementById('custom-templates').value = s.customTemplates || '';
            } catch(e) {
                console.error('åŠ è½½æ ¼å¼è®¾ç½®å¤±è´¥:', e);
                // å‡ºé”™æ—¶åŠ è½½é»˜è®¤å€¼
                loadDefaultAIConfig();
            }
        } else {
            // é¦–æ¬¡åŠ è½½ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
            loadDefaultAIConfig();
        }
    }
    
    // åŠ è½½é»˜è®¤AIé…ç½®ï¼ˆé»˜è®¤å¯ç”¨AIè§£æï¼‰
    function loadDefaultAIConfig() {
        const aiCheckbox = document.getElementById('ai-parse-enabled');
        if (aiCheckbox) {
            aiCheckbox.checked = true; // é»˜è®¤å¯ç”¨
        }
    }
    
    function resetFormatSettings() {
        if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤è®¾ç½®å—ï¼Ÿ')) {
            localStorage.removeItem('lhc_format_settings');
            location.reload();
        }
    }
    
    // ==================== AIæ™ºèƒ½è§£ææ¨¡å— ====================
    
    // AIæœåŠ¡å•†é…ç½®
    // region: 'cn' = å›½å†…æ¨¡å‹ï¼ˆèµ°é˜¿é‡Œäº‘ä»£ç†ï¼‰ï¼Œ'overseas' = æµ·å¤–æ¨¡å‹ï¼ˆèµ°Cloudflareä»£ç†ï¼‰ï¼Œ'direct' = ç›´è¿ï¼ˆç¬¬ä¸‰æ–¹ä¸­è½¬APIï¼‰
    const AI_PROVIDERS = {
        deepseek: {
            name: 'DeepSeek',
            shortName: 'DS',
            url: 'https://api.deepseek.com/v1/chat/completions',
            model: 'deepseek-chat',  // DeepSeek å®˜æ–¹å¯¹è¯æ¨¡å‹ï¼ˆç¨³å®šï¼‰
            region: 'cn',
            apiKey: 'sk-12314485595043fca623f69ae12dbdd4'
        },
        tuzi: {
            name: 'Gemini-Flash',
            shortName: 'Gemini',
            url: 'https://api.tu-zi.com/v1/chat/completions',  // ä¼šè¢«å¤šç«™ç‚¹åˆ‡æ¢è¦†ç›–
            model: 'gemini-2.0-flash',  // å…”å­API - Gemini 2.0 Flashï¼ˆå¿«é€Ÿç‰ˆï¼‰
            region: 'cn',  // èµ°é˜¿é‡Œäº‘ä»£ç†ï¼Œæ‰‹æœºæ— éœ€VPN
            apiKey: 'sk-9oGH0BIdnzPrB5y4sg1Xg6YW7XF4YFj2GUqtoxcA3WFzKVgc',
            useTuziMultiSite: true  // æ ‡è®°ä½¿ç”¨å…”å­APIå¤šç«™ç‚¹
        },
        qwen: {
            name: 'é€šä¹‰åƒé—®',
            shortName: 'åƒé—®',
            url: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions',
            model: 'qwen-turbo',
            region: 'cn',
            apiKey: 'sk-19f295e0c1294471a112b48ec2814c2c'
        },
        claude: {
            name: 'Claude-Sonnet',
            shortName: 'Claude',
            url: 'https://api.tu-zi.com/v1/chat/completions',  // ä¼šè¢«å¤šç«™ç‚¹åˆ‡æ¢è¦†ç›–
            model: 'claude-sonnet-4-0',  // å…”å­API - Claude Sonnet 4.0
            region: 'cn',  // èµ°é˜¿é‡Œäº‘ä»£ç†
            apiKey: 'sk-3wuWW1YSxTUgMEbmTk2511VqJyPNewrdD3q1kU5q1He2ywF9',
            useTuziMultiSite: true  // æ ‡è®°ä½¿ç”¨å…”å­APIå¤šç«™ç‚¹
        },
        gpt: {
            name: 'GPT-4o-Mini',
            shortName: 'GPT4o',
            url: 'https://api.tu-zi.com/v1/chat/completions',  // ä¼šè¢«å¤šç«™ç‚¹åˆ‡æ¢è¦†ç›–
            model: 'gpt-4o-mini',  // å…”å­API - GPT-4o Miniï¼ˆæ€§ä»·æ¯”æœ€é«˜ï¼‰
            region: 'cn',  // èµ°é˜¿é‡Œäº‘ä»£ç†
            apiKey: 'sk-9ShdAzwU4jHDCqsYccO0cmMfgbTkNkqcBEZmUeCxKO3ypYwZ',
            useTuziMultiSite: true  // æ ‡è®°ä½¿ç”¨å…”å­APIå¤šç«™ç‚¹
        }
    };
    
    // ==================== å…”å­API å¤šç«™ç‚¹æ™ºèƒ½åˆ‡æ¢ ====================
    // ç«™ç‚¹åˆ—è¡¨ï¼ˆæŒ‰ä¼˜å…ˆçº§æ’åºï¼šå¹¿å· > æ·±åœ³ > ä¸»ç«™ > å¤‡ç”¨ï¼‰
    const TUZI_SITES = [
        { name: 'å¹¿å·', url: 'https://api.ourzhishi.top/v1/chat/completions' },
        { name: 'æ·±åœ³', url: 'https://apisz.ourzhishi.top/v1/chat/completions' },
        { name: 'ä¸»ç«™', url: 'https://api.tu-zi.com/v1/chat/completions' },
        { name: 'å¤‡ç”¨1-cdn', url: 'https://apius.tu-zi.com/v1/chat/completions' },
        { name: 'å¤‡ç”¨2-cdn', url: 'https://apicdn.tu-zi.com/v1/chat/completions' }
    ];
    
    // å¤šç«™ç‚¹çŠ¶æ€ç®¡ç†
    const tuziSiteManager = {
        currentIndex: 0,           // å½“å‰ä½¿ç”¨çš„ç«™ç‚¹ç´¢å¼•
        successCount: 0,           // è¿ç»­æˆåŠŸæ¬¡æ•°
        å›å½’æ£€æŸ¥é˜ˆå€¼: 10,          // æ¯æˆåŠŸNæ¬¡å°è¯•å›åˆ°æ›´é«˜ä¼˜å…ˆçº§ç«™ç‚¹
        
        // è·å–å½“å‰ç«™ç‚¹URL
        getCurrentUrl() {
            return TUZI_SITES[this.currentIndex].url;
        },
        
        // è·å–å½“å‰ç«™ç‚¹åç§°
        getCurrentName() {
            return TUZI_SITES[this.currentIndex].name;
        },
        
        // è¯·æ±‚æˆåŠŸæ—¶è°ƒç”¨
        onSuccess() {
            this.successCount++;
            console.log(`âœ… å…”å­API [${this.getCurrentName()}] è¯·æ±‚æˆåŠŸï¼Œè¿ç»­æˆåŠŸ: ${this.successCount}æ¬¡`);
            
            // å¦‚æœä¸æ˜¯æœ€é«˜ä¼˜å…ˆçº§ç«™ç‚¹ï¼Œä¸”è¿ç»­æˆåŠŸè¾¾åˆ°é˜ˆå€¼ï¼Œå°è¯•å›åˆ°æ›´é«˜ä¼˜å…ˆçº§
            if (this.currentIndex > 0 && this.successCount >= this.å›å½’æ£€æŸ¥é˜ˆå€¼) {
                console.log(`ğŸ”„ å°è¯•å›å½’åˆ°æ›´é«˜ä¼˜å…ˆçº§ç«™ç‚¹...`);
                this.currentIndex = 0;  // å›åˆ°æœ€é«˜ä¼˜å…ˆçº§ï¼ˆå¹¿å·ï¼‰
                this.successCount = 0;
            }
        },
        
        // è¯·æ±‚å¤±è´¥æ—¶è°ƒç”¨ï¼Œè¿”å›æ˜¯å¦è¿˜æœ‰ä¸‹ä¸€ä¸ªç«™ç‚¹å¯å°è¯•
        onFailure() {
            const failedSite = this.getCurrentName();
            this.successCount = 0;  // é‡ç½®æˆåŠŸè®¡æ•°
            
            if (this.currentIndex < TUZI_SITES.length - 1) {
                this.currentIndex++;
                console.log(`âš ï¸ å…”å­API [${failedSite}] å¤±è´¥ï¼Œåˆ‡æ¢åˆ° [${this.getCurrentName()}]`);
                return true;  // è¿˜æœ‰ä¸‹ä¸€ä¸ªç«™ç‚¹
            } else {
                console.log(`âŒ å…”å­API æ‰€æœ‰ç«™ç‚¹éƒ½å¤±è´¥äº†`);
                this.currentIndex = 0;  // é‡ç½®ï¼Œä¸‹æ¬¡ä»å¤´å¼€å§‹
                return false;  // æ²¡æœ‰æ›´å¤šç«™ç‚¹äº†
            }
        },
        
        // é‡ç½®çŠ¶æ€ï¼ˆç”¨äºè°ƒè¯•ï¼‰
        reset() {
            this.currentIndex = 0;
            this.successCount = 0;
            console.log('ğŸ”„ å…”å­APIç«™ç‚¹ç®¡ç†å™¨å·²é‡ç½®');
        }
    };
    
    // åˆ‡æ¢AIæ¨¡å‹ï¼ˆæŒ‰é’®ç‚¹å‡»ï¼‰
    function switchAIModel(provider) {
        const config = AI_PROVIDERS[provider];
        if (!config) return;
        
        // æ›´æ–°éšè—çš„ select
        document.getElementById('ai-provider').value = provider;
        document.getElementById('ai-api-key').value = config.apiKey || '';
        
        // æ›´æ–°æŒ‰é’®çŠ¶æ€
        document.querySelectorAll('.ai-model-btn').forEach(btn => {
            btn.classList.remove('active');
            if (btn.dataset.provider === provider) {
                btn.classList.add('active');
            }
        });
        
        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        const statusEl = document.getElementById('ai-model-status');
        if (statusEl) {
            if (!config.apiKey) {
                // API Key æœªé…ç½®
                statusEl.innerHTML = 'âš ï¸ ' + config.name + 'ï¼šAPI Key æœªé…ç½®';
                statusEl.style.background = 'rgba(244,67,54,0.1)';
                statusEl.style.color = '#ef5350';
            } else {
                let regionText, bgColor, textColor;
                if (config.region === 'overseas') {
                    regionText = 'æµ·å¤–Cloudflareä»£ç†';
                    bgColor = 'rgba(255,152,0,0.1)';
                    textColor = '#ffa726';
                } else if (config.region === 'direct') {
                    regionText = 'ç¬¬ä¸‰æ–¹ä¸­è½¬ç›´è¿';
                    bgColor = 'rgba(33,150,243,0.1)';
                    textColor = '#64b5f6';
                } else {
                    regionText = 'å›½å†…ç›´è¿';
                    bgColor = 'rgba(76,175,80,0.1)';
                    textColor = '#81c784';
                }
                statusEl.innerHTML = 'âœ… å½“å‰ï¼š' + config.name + 'ï¼ˆ' + regionText + 'ï¼‰';
                statusEl.style.background = bgColor;
                statusEl.style.color = textColor;
            }
        }
        
        // ä¿å­˜é€‰æ‹©
        localStorage.setItem('ai_provider', provider);
        console.log('ğŸ¤– AIæ¨¡å‹åˆ‡æ¢ä¸º:', provider, config.name);
    }
    
    // ==================== AI é¢„å¤„ç†å‡½æ•° ====================
    // æ ‡å‡†åŒ–ç”¨æˆ·è¾“å…¥ï¼Œè®© AI æ›´å®¹æ˜“ç†è§£ï¼ˆç¡®å®šæ€§è§„åˆ™ï¼Œä¸ä¾èµ– AIï¼‰
    function normalizeForAI(text) {
        if (!text) return text;
        
        let result = text;
        
        // 1. åˆ†éš”ç¬¦ç»Ÿä¸€ä¸ºç©ºæ ¼ï¼ˆç‚¹ã€é€—å·ã€é¡¿å·ã€æ–œæ ã€çŸ­æ¨ªçº¿ï¼‰
        result = result.replace(/[\.ã€‚,ï¼Œã€\/\-]/g, ' ');
        
        // 2. é‡‘é¢ç¬¦å·ç»Ÿä¸€ä¸º"å„"
        // ç»Ÿä¸€ â†’ å„ï¼Œç»Ÿ â†’ å„ï¼ŒÃ— â†’ å„ï¼ŒX â†’ å„ï¼Œx â†’ å„ï¼Œ* â†’ å„ï¼Œ@ â†’ å„
        result = result.replace(/ç»Ÿä¸€/g, 'å„');
        result = result.replace(/ç»Ÿ(?!\d)/g, 'å„');  // "ç»Ÿ"åé¢ä¸æ˜¯æ•°å­—æ—¶æ‰æ›¿æ¢
        result = result.replace(/[Ã—\*@]/g, 'å„');
        // x/X åœ¨æ•°å­—åé¢æ—¶æ›¿æ¢ä¸º"å„"ï¼ˆå¦‚ 10x20 â†’ 10å„20ï¼‰
        result = result.replace(/(\d)\s*[xX]\s*(\d)/g, '$1å„$2');
        
        // 3. å»æ‰é‡‘é¢å•ä½
        result = result.replace(/å…ƒ|å—|åœ†/g, '');
        
        // 4. æ¸…ç†å¤šä½™ç©ºæ ¼
        result = result.replace(/\s+/g, ' ').trim();
        
        console.log('ğŸ”„ AIé¢„å¤„ç†:', text, 'â†’', result);
        return result;
    }
    
    // ==================== å¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯• ====================
    
    // å­˜å‚¨å„æ¨¡å‹çš„æµ‹è¯•ç»“æœï¼ˆ4ä¸ªæ¨¡å‹ï¼‰
    let multiModelResults = {
        deepseek: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
        qwen: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
        tuzi: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
        claude: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
        gpt: { status: 'pending', time: 0, raw: '', parsed: [], error: '' }
    };
    let currentViewingModel = 'deepseek';
    
    // è¿è¡Œå¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯•
    async function runMultiModelTest() {
        const input = document.getElementById('bet-input').value.trim();
        if (!input) {
            alert('è¯·å…ˆè¾“å…¥ä¸‹æ³¨å†…å®¹');
            return;
        }
        
        // æ˜¾ç¤ºå¼¹çª—
        document.getElementById('multi-model-modal').style.display = 'flex';
        
        // æ›´æ–°ç«™ç‚¹ä¿¡æ¯æ˜¾ç¤º
        const siteInfoEl = document.getElementById('tuzi-site-info');
        if (siteInfoEl) {
            siteInfoEl.textContent = 'å½“å‰ç«™ç‚¹: ' + tuziSiteManager.getCurrentName();
        }
        
        // é‡ç½®ç»“æœï¼ˆ4ä¸ªæ¨¡å‹ï¼‰
        multiModelResults = {
            deepseek: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
            qwen: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
            tuzi: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
            claude: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
            gpt: { status: 'running', time: 0, raw: '', parsed: [], error: '' }
        };
        
        // æ›´æ–°UIæ˜¾ç¤º"è¿è¡Œä¸­"
        ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'].forEach(model => {
            updateModelTabStatus(model, 'running', 'è¿è¡Œä¸­...');
        });
        
        // åˆ‡æ¢åˆ°ç¬¬ä¸€ä¸ªæ ‡ç­¾
        switchModelTab('deepseek');
        
        // æ„å»ºæç¤ºè¯ï¼ˆå¤ç”¨ç°æœ‰é€»è¾‘ï¼‰
        let userInput = input;
        
        // ã€é¢„å¤„ç†ã€‘æ ‡å‡†åŒ–åˆ†éš”ç¬¦å’Œé‡‘é¢ç¬¦å·ï¼ˆç¡®å®šæ€§è§„åˆ™ï¼Œä¸ä¾èµ–AIï¼‰
        userInput = normalizeForAI(userInput);
        
        const prompt = `ä½ æ˜¯ä¸‹æ³¨ç±»å‹åˆ†ç±»å™¨ã€‚ä»»åŠ¡ï¼šè¯†åˆ«æ¯æ¡ä¸‹æ³¨å±äºä»€ä¹ˆç©æ³•ç±»å‹ã€‚

ã€æ ¸å¿ƒè§„åˆ™ã€‘"å„"å­—çš„ä¸¤ç§ç”¨æ³•ï¼š
1. çº¯æ•°å­—+å„+é‡‘é¢ â†’ ç‰¹ç ï¼ˆæ¯ä¸ªå·ç ä¸‹æ³¨è¯¥é‡‘é¢ï¼‰
   ä¾‹ï¼š10 12 20 30å„20 â†’ ç‰¹ç ï¼Œ4ä¸ªå·ç æ¯ä¸ª20å…ƒ
2. ç”Ÿè‚–å+å„+é‡‘é¢ â†’ ç”Ÿè‚–ç‰¹ç ï¼ˆä¹°è¯¥ç”Ÿè‚–æ‰€æœ‰å·ç ï¼‰
   ä¾‹ï¼šä¹°çŒªå„10 â†’ ç”Ÿè‚–ç‰¹ç ï¼ŒçŒªçš„æ‰€æœ‰å·ç æ¯ä¸ª10å…ƒ

ã€ç©æ³•ç±»å‹ã€‘å…±23ç§ï¼š
1. ç‰¹ç  - å«"ç‰¹"å­—ï¼Œæˆ–çº¯æ•°å­—+å„+é‡‘é¢ï¼ˆå¦‚ 10 12 20å„10ï¼‰
2. ç”Ÿè‚–ç‰¹ç  - "ä¹°Xå„Y"æ ¼å¼ï¼ŒXæ˜¯ç”Ÿè‚–åï¼ˆå¦‚ ä¹°çŒªå„10ï¼‰
3. ç”Ÿè‚– - å•ä¸ªç”Ÿè‚–ä¸‹æ³¨å¦‚"çŒª10"ï¼ˆæ— "ä¹°"å’Œ"å„"ï¼‰
4. æ³¢è‰² - å«"çº¢/è“/ç»¿"+"æ³¢"
5. åŠæ³¢ - æ³¢è‰²+å¤§å°/å•åŒ
6. å¹³ç‰¹ä¸€è‚– - å«"å¹³ç‰¹"æˆ–"ä¸€å‹"
7. å¹³ç‰¹äºŒè¿è‚– - å«"äºŒè¿è‚–"æˆ–"äºŒå‹"
8. å¹³ç‰¹ä¸‰è¿è‚– - å«"ä¸‰è¿è‚–"æˆ–"ä¸‰å‹"
9-23. å…¶ä»–ç©æ³•...

ã€ç”¨æˆ·è¾“å…¥ã€‘
${userInput}

ã€è¾“å‡ºæ ¼å¼ã€‘ä¸¥æ ¼æŒ‰æ­¤JSONæ ¼å¼ï¼š
{"items":[{"type":"ç±»å‹","raw":"åŸæ–‡"}]}`;
        
        // å¹¶è¡Œè°ƒç”¨æ‰€æœ‰æ¨¡å‹ï¼ˆ5ä¸ªï¼‰
        const modelsToTest = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
        
        const promises = modelsToTest.map(async (modelKey) => {
            const config = AI_PROVIDERS[modelKey];
            if (!config || !config.apiKey) {
                multiModelResults[modelKey] = {
                    status: 'error',
                    time: 0,
                    raw: '',
                    parsed: [],
                    error: 'API Key æœªé…ç½®'
                };
                updateModelTabStatus(modelKey, 'error', 'æœªé…ç½®');
                return;
            }
            
            const startTime = Date.now();
            try {
                const result = await callAIAPI(prompt, modelKey, config.apiKey);
                const elapsed = Date.now() - startTime;
                
                if (result) {
                    // è§£æç»“æœ
                    let parsed = [];
                    try {
                        let jsonStr = result.trim();
                        if (jsonStr.startsWith('```')) {
                            jsonStr = jsonStr.replace(/```json?\n?/g, '').replace(/```/g, '').trim();
                        }
                        const aiResult = JSON.parse(jsonStr);
                        if (aiResult.items && Array.isArray(aiResult.items)) {
                            for (const item of aiResult.items) {
                                if (typeof extractValuesByType === 'function') {
                                    const extracted = extractValuesByType(item.type, item.raw);
                                    if (extracted && extracted.length > 0) {
                                        parsed.push(...extracted);
                                    } else {
                                        // å³ä½¿æå–å¤±è´¥ä¹Ÿæ˜¾ç¤ºåŸå§‹ä¿¡æ¯
                                        parsed.push({ type: item.type, target: item.raw, amount: 0, raw: item.raw });
                                    }
                                } else {
                                    parsed.push({ type: item.type, target: item.raw, amount: 0, raw: item.raw });
                                }
                            }
                        }
                    } catch (e) {
                        console.warn('è§£æJSONå¤±è´¥:', e);
                    }
                    
                    multiModelResults[modelKey] = {
                        status: parsed.length > 0 ? 'success' : 'warning',
                        time: elapsed,
                        raw: result,
                        parsed: parsed,
                        error: ''
                    };
                    
                    updateModelTabStatus(modelKey, parsed.length > 0 ? 'success' : 'warning', `è€—æ—¶: ${(elapsed/1000).toFixed(1)}s`);
                } else {
                    throw new Error('è¿”å›ç»“æœä¸ºç©º');
                }
            } catch (e) {
                const elapsed = Date.now() - startTime;
                multiModelResults[modelKey] = {
                    status: 'error',
                    time: elapsed,
                    raw: '',
                    parsed: [],
                    error: e.message
                };
                updateModelTabStatus(modelKey, 'error', 'è¯·æ±‚å¤±è´¥');
            }
            
            // å¦‚æœå½“å‰æ­£åœ¨æŸ¥çœ‹è¿™ä¸ªæ¨¡å‹ï¼Œæ›´æ–°æ˜¾ç¤º
            if (currentViewingModel === modelKey) {
                displayModelResult(modelKey);
            }
        });
        
        await Promise.all(promises);
        console.log('ğŸ”¬ å¤šæ¨¡å‹æµ‹è¯•å®Œæˆ:', multiModelResults);
    }
    
    // æ›´æ–°æ¨¡å‹æ ‡ç­¾çŠ¶æ€
    function updateModelTabStatus(model, status, timeText) {
        const tab = document.querySelector(`.model-tab[data-model="${model}"]`);
        if (tab) {
            tab.classList.remove('success', 'error', 'warning');
            if (status !== 'running') {
                tab.classList.add(status);
            }
        }
        const timeEl = document.getElementById(`tab-time-${model}`);
        if (timeEl) {
            timeEl.textContent = timeText;
        }
    }
    
    // åˆ‡æ¢æ¨¡å‹æ ‡ç­¾
    function switchModelTab(model) {
        currentViewingModel = model;
        
        // æ›´æ–°æ ‡ç­¾æ¿€æ´»çŠ¶æ€
        document.querySelectorAll('.model-tab').forEach(tab => {
            tab.classList.remove('active');
            if (tab.dataset.model === model) {
                tab.classList.add('active');
            }
        });
        
        // æ˜¾ç¤ºè¯¥æ¨¡å‹çš„ç»“æœ
        displayModelResult(model);
    }
    
    // æ˜¾ç¤ºæ¨¡å‹ç»“æœ
    function displayModelResult(model) {
        const result = multiModelResults[model];
        const config = AI_PROVIDERS[model];
        
        // åŸå§‹è¾“å‡º
        const rawEl = document.getElementById('model-raw-output');
        if (result.status === 'running') {
            rawEl.textContent = 'â³ æ­£åœ¨è¯·æ±‚ ' + (config?.name || model) + '...';
        } else if (result.status === 'error') {
            rawEl.textContent = 'âŒ é”™è¯¯: ' + result.error;
        } else {
            rawEl.textContent = result.raw || '(æ— è¾“å‡º)';
        }
        
        // è§£æç»“æœ
        const parsedEl = document.getElementById('model-parsed-result');
        if (result.status === 'running') {
            parsedEl.innerHTML = 'â³ ç­‰å¾…ç»“æœ...';
        } else if (result.status === 'error') {
            parsedEl.innerHTML = '<span style="color:#ef5350;">è¯·æ±‚å¤±è´¥</span>';
        } else if (result.parsed && result.parsed.length > 0) {
            parsedEl.innerHTML = result.parsed.map(bet => 
                `${bet.type} â†’ ${bet.numbers?.join(',') || bet.target || ''} Ã— ${bet.amount}å…ƒ`
            ).join('<br>');
        } else {
            parsedEl.innerHTML = '<span style="color:#ffa726;">æ— æ³•è§£ææˆ–ç»“æœä¸ºç©º</span>';
        }
        
        // çŠ¶æ€åŒºåŸŸ
        const statusEl = document.getElementById('model-status');
        const useBtnEl = document.getElementById('model-use-btn');
        
        if (result.status === 'running') {
            statusEl.innerHTML = 'â³ è¿è¡Œä¸­...';
            useBtnEl.style.display = 'none';
        } else if (result.status === 'success') {
            statusEl.innerHTML = `âœ… è§£ææˆåŠŸ (${result.parsed.length}æ¡ä¸‹æ³¨)`;
            useBtnEl.style.display = 'block';
        } else if (result.status === 'warning') {
            statusEl.innerHTML = 'âš ï¸ éƒ¨åˆ†é”™è¯¯';
            useBtnEl.style.display = 'block';
        } else {
            statusEl.innerHTML = 'âŒ è¯·æ±‚å¤±è´¥';
            useBtnEl.style.display = 'none';
        }
    }
    
    // ä½¿ç”¨å½“å‰æ¨¡å‹çš„ç»“æœ
    function useModelResult() {
        const result = multiModelResults[currentViewingModel];
        if (result && result.parsed && result.parsed.length > 0) {
            // å°†è§£æç»“æœåº”ç”¨åˆ°ä¸»ç•Œé¢
            parsedBets = result.parsed;
            
            // åˆ‡æ¢åˆ°è¯¥æ¨¡å‹
            switchAIModel(currentViewingModel);
            
            // å…³é—­å¼¹çª—
            closeMultiModelModal();
            
            // æ‰§è¡Œè®¡ç®—
            calculateBets();
            
            showAutoCloseToast('âœ… å·²é€‰ç”¨ ' + AI_PROVIDERS[currentViewingModel].name + ' çš„ç»“æœ');
        }
    }
    
    // å…³é—­å¤šæ¨¡å‹å¼¹çª—
    function closeMultiModelModal() {
        document.getElementById('multi-model-modal').style.display = 'none';
    }
    
    // ==================== ç»“æŸå¤šæ¨¡å‹å¯¹æ¯”æµ‹è¯• ====================
    
    // åˆ‡æ¢AIæ¨¡å‹
    function changeAIModel(provider) {
        // åŒæ­¥åˆ°éšè—çš„ select
        document.getElementById('ai-provider').value = provider;
        
        // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
        localStorage.setItem('ai_provider', provider);
        
        // æ›´æ–°æç¤ºä¿¡æ¯
        const config = AI_PROVIDERS[provider];
        const tipEl = document.getElementById('ai-model-tip');
        if (tipEl && config) {
            if (config.region === 'overseas') {
                tipEl.innerHTML = 'âš ï¸ å½“å‰ï¼š' + config.name + '<br><span style="color:#ffa726;">æµ·å¤–æ¨¡å‹éœ€å…ˆéƒ¨ç½²Cloudflare Worker</span>';
                tipEl.style.background = 'rgba(255,152,0,0.1)';
                tipEl.style.color = '#ffa726';
            } else if (config.region === 'direct') {
                tipEl.innerHTML = 'âœ… å½“å‰ï¼š' + config.name + 'ï¼ˆç¬¬ä¸‰æ–¹ä¸­è½¬ï¼Œç¨³å®šç›´è¿ï¼‰';
                tipEl.style.background = 'rgba(33,150,243,0.1)';
                tipEl.style.color = '#64b5f6';
            } else {
                tipEl.innerHTML = 'âœ… å½“å‰ï¼š' + config.name + 'ï¼ˆå›½å†…ç›´è¿ï¼Œé€Ÿåº¦å¿«ï¼‰';
                tipEl.style.background = 'rgba(76,175,80,0.1)';
                tipEl.style.color = '#81c784';
            }
        }
        
        console.log('AIæ¨¡å‹å·²åˆ‡æ¢ä¸º:', provider, config);
    }
    
    // æµ‹è¯•å½“å‰AIæ¨¡å‹
    async function testCurrentAI() {
        const provider = document.getElementById('ai-provider').value;
        const apiKey = document.getElementById('ai-api-key').value;
        const config = AI_PROVIDERS[provider];
        
        if (!apiKey) {
            alert('âŒ è¯·å…ˆé…ç½®API Key\n\nå½“å‰æ¨¡å‹: ' + config.name + '\n\n' + getAPIKeyGuide(provider));
            return;
        }
        
        showAutoCloseToast('ğŸ”„ æ­£åœ¨æµ‹è¯• ' + config.name + '...', 10000);
        
        try {
            const startTime = Date.now();
            const result = await callAIAPI('è¯·å›å¤"è¿æ¥æˆåŠŸ"å››ä¸ªå­—', provider, apiKey);
            const elapsed = Date.now() - startTime;
            
            if (result) {
                showAutoCloseToast('âœ… ' + config.name + ' è¿æ¥æˆåŠŸï¼\nå“åº”æ—¶é—´: ' + elapsed + 'ms');
            } else {
                alert('âŒ ' + config.name + ' è¿æ¥å¤±è´¥\nè¯·æ£€æŸ¥API Keyæ˜¯å¦æ­£ç¡®');
            }
        } catch (e) {
            alert('âŒ ' + config.name + ' è¿æ¥å¤±è´¥\n\né”™è¯¯: ' + e.message + '\n\n' + getErrorGuide(provider, e.message));
        }
    }
    
    // è·å–API Keyé…ç½®æŒ‡å—
    function getAPIKeyGuide(provider) {
        const guides = {
            deepseek: 'è·å–æ–¹å¼ï¼š\n1. è®¿é—® platform.deepseek.com\n2. æ³¨å†Œç™»å½•ååˆ›å»ºAPI Key',
            qwen: 'è·å–æ–¹å¼ï¼š\n1. è®¿é—® dashscope.console.aliyun.com\n2. å¼€é€šæ¨¡å‹æœåŠ¡å¹¶åˆ›å»ºAPI Key',
            tuzi: 'è·å–æ–¹å¼ï¼š\n1. è®¿é—® å…”å­APIå®˜ç½‘\n2. æ³¨å†Œåå……å€¼è·å–API Key',
            claude: 'ä½¿ç”¨å…”å­APIä¸­è½¬ï¼Œæ— éœ€å•ç‹¬è·å–',
            gpt: 'ä½¿ç”¨å…”å­APIä¸­è½¬ï¼Œæ— éœ€å•ç‹¬è·å–',
            openai: 'è·å–æ–¹å¼ï¼š\n1. è®¿é—® platform.openai.com\n2. åˆ›å»ºAPI Key\n\nâš ï¸ æ³¨æ„ï¼šéœ€å…ˆéƒ¨ç½²Cloudflare Workeræ‰èƒ½åœ¨å›½å†…ä½¿ç”¨'
        };
        return guides[provider] || 'è¯·åˆ°å¯¹åº”å¹³å°è·å–API Key';
    }
    
    // è·å–é”™è¯¯è¯Šæ–­æŒ‡å—
    function getErrorGuide(provider, errorMsg) {
        const config = AI_PROVIDERS[provider];
        if (config.region === 'overseas') {
            if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
                return 'å¯èƒ½åŸå› ï¼š\n1. Cloudflare Workeræœªæ­£ç¡®éƒ¨ç½²\n2. ç½‘ç»œè¿æ¥é—®é¢˜\n\nè¯·å…ˆæŒ‰ç…§éƒ¨ç½²æ•™ç¨‹é…ç½®Cloudflare Worker';
            }
        }
        if (errorMsg.includes('401') || errorMsg.includes('Unauthorized')) {
            return 'å¯èƒ½åŸå› ï¼šAPI Keyæ— æ•ˆæˆ–å·²è¿‡æœŸï¼Œè¯·é‡æ–°è·å–';
        }
        if (errorMsg.includes('429')) {
            return 'å¯èƒ½åŸå› ï¼šAPIè°ƒç”¨é¢‘ç‡è¶…é™æˆ–ä½™é¢ä¸è¶³';
        }
        return 'è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒAPI Keyé…ç½®';
    }
    
    // æµ‹è¯•AIè¿æ¥ï¼ˆä¿ç•™åŸå‡½æ•°å…¼å®¹ï¼‰
    async function testAIConnection() {
        const provider = document.getElementById('ai-provider').value;
        const apiKey = document.getElementById('ai-api-key').value;
        
        if (!apiKey) {
            alert('è¯·å…ˆè¾“å…¥API Key');
            return;
        }
        
        showAutoCloseToast('ğŸ”„ æ­£åœ¨æµ‹è¯•è¿æ¥...', 5000);
        
        try {
            const result = await callAIAPI('æµ‹è¯•è¿æ¥ï¼Œè¯·å›å¤"è¿æ¥æˆåŠŸ"', provider, apiKey);
            if (result) {
                showAutoCloseToast('âœ… AIè¿æ¥æˆåŠŸï¼');
            } else {
                alert('âŒ è¿æ¥å¤±è´¥ï¼Œè¯·æ£€æŸ¥API Key');
            }
        } catch (e) {
            alert('âŒ è¿æ¥å¤±è´¥: ' + e.message);
        }
    }
    
    // ==================== AI ä»£ç†é…ç½® ====================
    // é˜¿é‡Œäº‘å‡½æ•°ï¼ˆå›½å†…æ¨¡å‹ä½¿ç”¨ï¼Œé€Ÿåº¦å¿«ï¼‰
    const ALIYUN_PROXY_URL = 'https://dsai-api-smxmimoxbh.cn-hangzhou.fcapp.run';
    // Cloudflare Workerï¼ˆæµ·å¤–æ¨¡å‹ä½¿ç”¨ï¼Œå¯è®¿é—®Google/OpenAIï¼‰
    const CLOUDFLARE_PROXY_URL = 'https://ai-proxy.huzhirong6.workers.dev';
    
    // åˆ¤æ–­æ˜¯å¦éœ€è¦ä½¿ç”¨ä»£ç†ï¼ˆçº¿ä¸Šç¯å¢ƒéœ€è¦ï¼Œæœ¬åœ°ä¸éœ€è¦ï¼‰
    function shouldUseProxy() {
        const host = window.location.hostname;
        // æœ¬åœ°å¼€å‘ç¯å¢ƒä¸ä½¿ç”¨ä»£ç†
        return host !== 'localhost' && host !== '127.0.0.1' && !host.startsWith('192.168.');
    }
    
    // æ ¹æ®æ¨¡å‹åŒºåŸŸè·å–ä»£ç†URL
    // å›½å†…æ¨¡å‹ â†’ é˜¿é‡Œäº‘ï¼ˆé€Ÿåº¦å¿«ï¼‰
    // æµ·å¤–æ¨¡å‹ â†’ Cloudflareï¼ˆèƒ½è®¿é—®Google/OpenAIï¼‰
    // ç›´è¿æ¨¡å‹ â†’ è¿”å› nullï¼ˆç¬¬ä¸‰æ–¹ä¸­è½¬APIï¼Œç›´æ¥è°ƒç”¨ï¼‰
    function getProxyUrl(provider) {
        const config = AI_PROVIDERS[provider];
        if (config && config.region === 'direct') {
            console.log('ğŸ“¡ ç¬¬ä¸‰æ–¹ä¸­è½¬APIï¼Œç›´æ¥è°ƒç”¨æ— éœ€ä»£ç†');
            return null;  // ç›´è¿æ¨¡å¼ï¼Œä¸ä½¿ç”¨ä»£ç†
        }
        if (config && config.region === 'overseas') {
            console.log('ğŸ“¡ æµ·å¤–æ¨¡å‹ï¼Œä½¿ç”¨ Cloudflare ä»£ç†');
            return CLOUDFLARE_PROXY_URL;
        }
        console.log('ğŸ“¡ å›½å†…æ¨¡å‹ï¼Œä½¿ç”¨é˜¿é‡Œäº‘ä»£ç†');
        return ALIYUN_PROXY_URL;
    }
    
    // è°ƒç”¨AI APIï¼ˆå¢å¼ºç‰ˆï¼šè¯¦ç»†é”™è¯¯è¯Šæ–­ + é‡è¯•æœºåˆ¶ + å¤šç«™ç‚¹åˆ‡æ¢ï¼‰
    async function callAIAPI(prompt, provider, apiKey, retryCount = 0) {
        const config = AI_PROVIDERS[provider];
        if (!config) throw new Error('æœªçŸ¥çš„AIæœåŠ¡å•†');
        
        // ä¼˜å…ˆä½¿ç”¨å†…ç½®çš„ API Key
        const useApiKey = apiKey || config.apiKey;
        if (!useApiKey) throw new Error(config.name + ' çš„ API Key æœªé…ç½®');
        
        // æ·»åŠ è¶…æ—¶æ§åˆ¶ï¼ˆ60ç§’ï¼ŒæŸäº›æ¨¡å‹å“åº”è¾ƒæ…¢ï¼‰
        const controller = new AbortController();
        const timeoutMs = config.region === 'direct' ? 60000 : 30000;  // ä¸­è½¬APIç»™æ›´é•¿è¶…æ—¶
        const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
        
        // è®°å½•è¯·æ±‚æ¨¡å¼ï¼ˆç”¨äºè¯Šæ–­ï¼‰
        // æ ¹æ®æ¨¡å‹åŒºåŸŸé€‰æ‹©ä»£ç†ï¼šå›½å†…â†’é˜¿é‡Œäº‘ï¼Œæµ·å¤–â†’Cloudflareï¼Œç›´è¿â†’æ— ä»£ç†
        const proxyUrl = getProxyUrl(provider);
        const useProxy = shouldUseProxy() && proxyUrl;
        let proxyName, requestMode;
        if (config.region === 'direct') {
            requestMode = 'ç›´è¿æ¨¡å¼(ç¬¬ä¸‰æ–¹ä¸­è½¬)';
        } else if (useProxy) {
            proxyName = config.region === 'overseas' ? 'Cloudflare' : 'é˜¿é‡Œäº‘';
            requestMode = `ä»£ç†æ¨¡å¼(${proxyName})`;
        } else {
            requestMode = 'ç›´è¿æ¨¡å¼';
        }
        
        // å…”å­APIå¤šç«™ç‚¹æ”¯æŒ
        let tuziUrl = null;
        if (config.useTuziMultiSite) {
            tuziUrl = tuziSiteManager.getCurrentUrl();
            console.log(`ğŸ° å…”å­APIç«™ç‚¹: ${tuziSiteManager.getCurrentName()} - ${tuziUrl}`);
        }
        
        const targetUrl = useProxy ? proxyUrl : (tuziUrl || config.url);
        
        // ä¿å­˜è¯Šæ–­ä¿¡æ¯
        debugInfo.requestMode = requestMode;
        debugInfo.targetUrl = targetUrl;
        debugInfo.networkError = '';
        
        console.log(`ğŸŒ AIè¯·æ±‚æ¨¡å¼: ${requestMode}`);
        console.log(`ğŸŒ ç›®æ ‡URL: ${targetUrl}`);
        console.log(`ğŸŒ å½“å‰åŸŸå: ${window.location.hostname}`);
        
        try {
            let response;
            const startTime = Date.now();
            
            // åˆ¤æ–­æ˜¯å¦ä½¿ç”¨ä»£ç†
            if (useProxy) {
                // çº¿ä¸Šç¯å¢ƒï¼šé€šè¿‡é˜¿é‡Œäº‘å‡½æ•°ä»£ç†ï¼ˆå›½å†…ç¨³å®šï¼‰
                console.log('ä½¿ç”¨é˜¿é‡Œäº‘ä»£ç†æ¨¡å¼è°ƒç”¨AI API');
                const requestBody = {
                    provider: provider,
                    apiKey: useApiKey,
                    prompt: prompt,
                    model: config.model
                };
                // å¦‚æœæ˜¯å…”å­APIå¤šç«™ç‚¹ï¼Œä¼ å…¥å½“å‰ç«™ç‚¹URL
                if (tuziUrl) {
                    requestBody.tuziUrl = tuziUrl;
                }
                response = await fetch(proxyUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody),
                    signal: controller.signal
                });
            } else {
                // æœ¬åœ°ç¯å¢ƒï¼šç›´æ¥è°ƒç”¨ APIï¼ˆä½¿ç”¨å¤šç«™ç‚¹URLï¼‰
                console.log('ä½¿ç”¨ç›´è¿æ¨¡å¼è°ƒç”¨AI API');
                const directUrl = tuziUrl || config.url;
                response = await fetch(directUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${useApiKey}`
                    },
                    body: JSON.stringify({
                        model: config.model,
                        messages: [{ role: 'user', content: prompt }],
                        temperature: 0.1,
                        max_tokens: 2000,
                        stream: false  // å…”å­APIè¦æ±‚ï¼šGeminiæ¨¡å‹ä¸æ”¯æŒæµå¼è¾“å‡º
                    }),
                    signal: controller.signal
                });
            }
            
            clearTimeout(timeoutId);
            const elapsed = Date.now() - startTime;
            console.log(`ğŸŒ è¯·æ±‚è€—æ—¶: ${elapsed}ms, çŠ¶æ€ç : ${response.status}`);
            
            if (!response.ok) {
                const err = await response.text();
                debugInfo.networkError = `HTTP ${response.status}: ${err.substring(0, 200)}`;
                throw new Error(`APIé”™è¯¯: ${response.status} - ${err}`);
            }
            
            const responseText = await response.text();
            console.log('AI APIåŸå§‹å“åº”æ–‡æœ¬:', responseText);
            
            // è®°å½•åŸå§‹å“åº”ï¼ˆç”¨äºè¯Šæ–­ï¼‰
            debugInfo.rawResponse = responseText.substring(0, 500);
            
            // å°è¯•è§£æ JSON
            let data;
            try {
                data = JSON.parse(responseText);
            } catch (parseErr) {
                debugInfo.networkError = `JSONè§£æå¤±è´¥: ${responseText.substring(0, 100)}`;
                throw new Error('ä»£ç†è¿”å›éJSONæ•°æ®: ' + responseText.substring(0, 100));
            }
            
            console.log('AI APIè§£æå:', data);
            
            // æ£€æŸ¥æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
            if (data.error) {
                debugInfo.networkError = `APIè¿”å›é”™è¯¯: ${JSON.stringify(data.error).substring(0, 200)}`;
                throw new Error(data.error.message || JSON.stringify(data.error));
            }
            
            // æ£€æŸ¥å“åº”ç»“æ„ï¼ˆå…¼å®¹å…”å­APIçš„ data.data ç»“æ„å’Œæ ‡å‡† OpenAI ç»“æ„ï¼‰
            // å…”å­APIæ ¼å¼: { code: 0, data: { choices: [...] } }
            // æ ‡å‡†OpenAIæ ¼å¼: { choices: [...] }
            const responseData = data.data || data;  // å…”å­APIçš„æ•°æ®åœ¨data.dataé‡Œ
            const content = responseData.choices?.[0]?.message?.content;
            if (!content && responseData.choices) {
                debugInfo.networkError = `å“åº”ç»“æ„å¼‚å¸¸: choiceså­˜åœ¨ä½†contentä¸ºç©º`;
            } else if (!content) {
                debugInfo.networkError = `å“åº”æ— choiceså­—æ®µ: ${JSON.stringify(data).substring(0, 200)}`;
            }
            
            // ğŸ° å…”å­APIå¤šç«™ç‚¹ï¼šè¯·æ±‚æˆåŠŸ
            if (config.useTuziMultiSite && content) {
                tuziSiteManager.onSuccess();
            }
            
            return content || null;
        } catch (e) {
            clearTimeout(timeoutId);
            console.error('ğŸŒ ç½‘ç»œè¯·æ±‚å¤±è´¥:', e);
            
            const timeoutSec = timeoutMs / 1000;
            
            // ğŸ° å…”å­APIå¤šç«™ç‚¹ï¼šè¯·æ±‚å¤±è´¥ï¼Œå°è¯•åˆ‡æ¢ç«™ç‚¹
            if (config.useTuziMultiSite && retryCount < TUZI_SITES.length) {
                const hasNextSite = tuziSiteManager.onFailure();
                if (hasNextSite) {
                    console.log(`ğŸ”„ åˆ‡æ¢å…”å­APIç«™ç‚¹åé‡è¯•...`);
                    await new Promise(r => setTimeout(r, 500));  // ç­‰å¾…0.5ç§’åé‡è¯•
                    return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                }
            }
            
            if (e.name === 'AbortError') {
                // è¶…æ—¶æ—¶å°è¯•é‡è¯•ä¸€æ¬¡ï¼ˆä»…å¯¹ç›´è¿æ¨¡å¼ï¼‰
                if (config.region === 'direct' && retryCount < 1) {
                    console.log(`â±ï¸ ç¬¬${retryCount + 1}æ¬¡è¶…æ—¶ï¼Œæ­£åœ¨é‡è¯•...`);
                    return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                }
                debugInfo.networkError = `è¯·æ±‚è¶…æ—¶(${timeoutSec}ç§’)ï¼ŒAIå“åº”å¤ªæ…¢`;
                throw new Error(`AIè¯·æ±‚è¶…æ—¶(${timeoutSec}ç§’)`);
            }
            
            // è¯¦ç»†è®°å½•ç½‘ç»œé”™è¯¯
            if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
                debugInfo.networkError = `ç½‘ç»œé”™è¯¯: ${requestMode}è¯·æ±‚å¤±è´¥ï¼Œå¯èƒ½æ˜¯CORS/ç½‘ç»œé—®é¢˜`;
                // ç½‘ç»œé”™è¯¯æ—¶ä¹Ÿå°è¯•é‡è¯•ï¼ˆéå…”å­APIå¤šç«™ç‚¹æƒ…å†µï¼‰
                if (!config.useTuziMultiSite && retryCount < 1) {
                    console.log(`ğŸ”„ ç½‘ç»œé”™è¯¯ï¼Œæ­£åœ¨é‡è¯•...`);
                    await new Promise(r => setTimeout(r, 1000));  // ç­‰å¾…1ç§’åé‡è¯•
                    return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                }
            } else if (!debugInfo.networkError) {
                debugInfo.networkError = e.message;
            }
            
            throw e;
        }
    }
    
    // ã€ä¿®å¤æ‰‹æœºè¾“å…¥é—®é¢˜ã€‘å…¨è§’è½¬åŠè§’ + æ¸…ç†ä¸å¯è§å­—ç¬¦ï¼ˆå¢å¼ºç‰ˆï¼‰
    function normalizeFullWidth(str) {
        if (!str) return str;
        let result = str;
        
        // ========== 1. ç§»é™¤iOS/æ‰‹æœºè¾“å…¥æ³•äº§ç”Ÿçš„ä¸å¯è§å­—ç¬¦ ==========
        // é›¶å®½å­—ç¬¦ (Zero-width characters)
        result = result.replace(/[\u200B-\u200D\uFEFF]/g, '');
        // é›¶å®½ç©ºæ ¼ã€é›¶å®½è¿æ¥ç¬¦ã€é›¶å®½éè¿æ¥ç¬¦ã€BOM
        
        // å˜ä½“é€‰æ‹©å™¨ (Variation Selectors) - iOSå¸¸è§é—®é¢˜
        result = result.replace(/[\uFE00-\uFE0F]/g, '');
        
        // è½¯è¿å­—ç¬¦
        result = result.replace(/\u00AD/g, '');
        
        // å…¶ä»–ä¸å¯è§æ§åˆ¶å­—ç¬¦ï¼ˆä¿ç•™æ¢è¡Œç¬¦ \n \rï¼‰
        result = result.replace(/[\u0000-\u0009\u000B\u000C\u000E-\u001F\u007F-\u009F]/g, '');
        // æ³¨ï¼š\u000A=\n, \u000D=\r è¢«ä¿ç•™
        
        // ç»„åˆç”¨æ ‡è®°ï¼ˆCombining Marksï¼‰- å¯èƒ½å¯¼è‡´å­—ç¬¦æ˜¾ç¤ºå¼‚å¸¸
        result = result.replace(/[\u0300-\u036F]/g, '');
        
        // ========== 2. å…¨è§’è½¬åŠè§’ ==========
        // å…¨è§’æ•°å­—è½¬åŠè§’ (ï¼-ï¼™ â†’ 0-9)
        result = result.replace(/[ï¼-ï¼™]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));
        
        // å…¨è§’å­—æ¯è½¬åŠè§’ (ï¼¡-ï¼º, ï½-ï½š â†’ A-Z, a-z)
        result = result.replace(/[ï¼¡-ï¼ºï½-ï½š]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));
        
        // å…¨è§’ç©ºæ ¼è½¬åŠè§’
        result = result.replace(/\u3000/g, ' ');
        
        // ä¸é—´æ–­ç©ºæ ¼è½¬æ™®é€šç©ºæ ¼
        result = result.replace(/\u00A0/g, ' ');
        
        // ========== 3. ç‰¹æ®Šæ•°å­—å­—ç¬¦è½¬æ¢ ==========
        // åœˆæ•°å­— â‘ -â‘¨ â†’ 1-9
        const circledNums = {'\u2460':'1','\u2461':'2','\u2462':'3','\u2463':'4','\u2464':'5',
                            '\u2465':'6','\u2466':'7','\u2467':'8','\u2468':'9','\u2469':'10'};
        for (const [special, normal] of Object.entries(circledNums)) {
            result = result.split(special).join(normal);
        }
        
        // ä¸Šæ ‡æ•°å­— â°-â¹
        const superNums = {'\u2070':'0','\u00B9':'1','\u00B2':'2','\u00B3':'3','\u2074':'4',
                          '\u2075':'5','\u2076':'6','\u2077':'7','\u2078':'8','\u2079':'9'};
        for (const [special, normal] of Object.entries(superNums)) {
            result = result.split(special).join(normal);
        }
        
        // ========== 4. å…¨è§’æ ‡ç‚¹è½¬åŠè§’ ==========
        const punctMap = {
            '\uff0e': '.', '\uff0c': ',', '\u3001': ',', '\uff1a': ':', '\uff1b': ';',
            '\uff01': '!', '\uff1f': '?', '\u201c': '"', '\u201d': '"', '\u2018': "'", '\u2019': "'",
            '\uff08': '(', '\uff09': ')', '\u3010': '[', '\u3011': ']', '\uff5b': '{', '\uff5d': '}',
            '\uff0b': '+', '\uff0d': '-', '\uff1d': '=', '\uff0a': '*', '\uff0f': '/', '\uff05': '%',
            '\uff03': '#', '\uff06': '&', '\uff20': '@', '\uff04': '$', '\uff3e': '^', '\uff5c': '|',
            '\uff3c': '\\', '\uff5e': '~', '\uff40': '`', '\uff1c': '<', '\uff1e': '>',
            '\u2014': '-', '\u2013': '-', '\u2012': '-', '\u2010': '-', // å„ç§æ¨ªçº¿è½¬å‡å·
            '\u00D7': 'x', '\u2715': 'x', '\u2716': 'x', '\u2717': 'x', // ä¹˜å·è½¬x
            '\u00F7': '/'  // é™¤å·è½¬æ–œæ 
        };
        for (const [full, half] of Object.entries(punctMap)) {
            result = result.split(full).join(half);
        }
        
        // ========== 5. è§„èŒƒåŒ–æ¢è¡Œå’Œç©ºæ ¼ ==========
        // ç»Ÿä¸€æ¢è¡Œç¬¦ä¸º \n
        result = result.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
        // æ¸…ç†æ¯è¡Œé¦–å°¾ç©ºæ ¼ï¼Œä½†ä¿ç•™æ¢è¡Œ
        result = result.split('\n').map(line => line.replace(/[ \t]+/g, ' ').trim()).join('\n');
        // æ¸…ç†å¤šä¸ªè¿ç»­ç©ºè¡Œä¸ºå•ä¸ª
        result = result.replace(/\n{3,}/g, '\n\n');
        
        // ========== 6. è°ƒè¯•æ—¥å¿— ==========
        if (str !== result) {
            console.log('ğŸ“± å­—ç¬¦è§„èŒƒåŒ–:', {
                åŸå§‹: str,
                åŸå§‹é•¿åº¦: str.length,
                å¤„ç†å: result,
                å¤„ç†åé•¿åº¦: result.length,
                åŸå§‹å­—ç¬¦ç : [...str].map(c => c.charCodeAt(0).toString(16)).join(' ')
            });
        }
        
        return result;
    }
    
    // AIè§£æä¸‹æ³¨ä¿¡æ¯ï¼ˆä¼˜åŒ–ç‰ˆï¼šä¸¥æ ¼æ•°æ®ä¿æŠ¤ï¼‰
    async function parseWithAI(userInput) {
        // ä½¿ç”¨ getFormatSettings() è·å–å¸¦é»˜è®¤å€¼çš„è®¾ç½®ï¼ˆç¡®ä¿ aiEnabled å’Œ apiKey æœ‰é»˜è®¤å€¼ï¼‰
        const settings = getFormatSettings();
        if (!settings.aiEnabled || !settings.aiApiKey) {
            return null;
        }
        
        // ã€å…³é”®ä¿®å¤ã€‘é¢„å¤„ç†ï¼šå…¨è§’è½¬åŠè§’ï¼Œè§£å†³æ‰‹æœºè¾“å…¥é—®é¢˜
        const originalInput = userInput;
        userInput = normalizeFullWidth(userInput);
        
        // è®°å½•è§„èŒƒåŒ–ä¿¡æ¯ï¼ˆç”¨äºè¯Šæ–­æ‰‹æœºè¾“å…¥é—®é¢˜ï¼‰
        if (originalInput !== userInput) {
            console.log('ğŸ“± æ£€æµ‹åˆ°ç‰¹æ®Šå­—ç¬¦ï¼Œå·²è§„èŒƒåŒ–:', {
                åŸå§‹è¾“å…¥: originalInput,
                è§„èŒƒåŒ–å: userInput,
                åŸå§‹é•¿åº¦: originalInput.length,
                è§„èŒƒåŒ–åé•¿åº¦: userInput.length
            });
            debugInfo.normalizeInfo = `åŸå§‹(${originalInput.length}å­—ç¬¦) â†’ è§„èŒƒåŒ–(${userInput.length}å­—ç¬¦)`;
        } else {
            debugInfo.normalizeInfo = '';
        }
        
        const tema = appState.lotteryNumbers?.[6] || 'æœªçŸ¥';
        const pingma = appState.lotteryNumbers?.slice(0, 6).join(',') || 'æœªçŸ¥';
        
        // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
        // â•‘          ã€AIæç¤ºè¯ v2.0ã€‘è§„é¿æ•æ„Ÿè¯ + ä»£å·è¾“å‡º                  â•‘
        // â•‘  AIåªåšåˆ†ç±»ï¼ˆè¾“å‡ºä»£å·ï¼‰ï¼Œæ•°å€¼æå–ç”±ç¨‹åºæ­£åˆ™å®Œæˆ                  â•‘
        // â•‘  è¯¦è§ï¼šAIæç¤ºè¯ä¼˜åŒ–.md å’Œ AIæ™ºèƒ½è¯†åˆ«æ–¹æ¡ˆ.md                     â•‘
        // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
        const prompt = `ä½ æ˜¯æ•°æ®åˆ†æåˆ†ç±»å™¨ã€‚ä»»åŠ¡ï¼šåˆ¤æ–­æ¯æ¡ä¿¡æ¯çš„ç±»å‹ä»£å·ã€‚

ã€ç±»å‹ä»£å·ã€‘
TM=ç‰¹é€‰ SXTM=å±ç›¸ç‰¹é€‰ SX=å±ç›¸ BS=é¢œè‰²ç»„ BB=åŠç»„
PT1=ç»„åˆä¸€ PT2=ç»„åˆäºŒè¿ PT3=ç»„åˆä¸‰è¿ PT4=ç»„åˆå››è¿ PT5=ç»„åˆäº”è¿
PTW=ç»„åˆå°¾ LX=å…­é€‰ DP=å•é€‰ DXDS=å¤§å°å•åŒ
E2=äºŒé…äºŒ S3=ä¸‰é…ä¸‰ BZ=æ’é™¤ç»„ HX=åˆé€‰ LM=è¿é€‰
ZX=æ­£é€‰ ZH=æ€»è®¡ WX=äº”ç±» JY=åˆ†ç±» XS=å°èŒƒå›´ DS=å¤§èŒƒå›´

ã€è¯†åˆ«è§„åˆ™ã€‘æŒ‰ä¼˜å…ˆçº§ï¼š
1. "ä¹°"+å±ç›¸è¯+"å„"â†’SXTM
2. å«"ç‰¹"â†’TM
3. å«"å¹³ç‰¹/ä¸€å‹"â†’PT1 | "äºŒè¿/äºŒå‹"â†’PT2 | "ä¸‰è¿/ä¸‰å‹"â†’PT3 | "å››è¿"â†’PT4 | "äº”è¿"â†’PT5
4. å«"å¹³ç‰¹å°¾/å¹³å°¾"â†’PTW
5. å«"å…­è‚–"â†’LX
6. å«"Xä¸ä¸­"â†’BZ | "äºŒä¸­äºŒ"â†’E2 | "ä¸‰ä¸­ä¸‰"â†’S3
7. å«"åˆè‚–/Xè‚–"(éå…­è‚–)â†’HX
8. å«"å•å¹³/å¹³ç "â†’DP | "æ­£è‚–"â†’ZX
9. å«"çº¢æ³¢/è“æ³¢/ç»¿æ³¢"â†’BS | "çº¢å•/è“åŒ/ç»¿å¤§"ç­‰â†’BB
10. å«"æ€»å’Œ"â†’ZH | "é‡‘/æœ¨/æ°´/ç«/åœŸ"â†’WX | "å®¶ç¦½/é‡å…½"â†’JY
11. å«"å°æ•°"â†’XS | "å¤§æ•°"â†’DS
12. "å¤§/å°/å•/åŒ"+æ•°å€¼â†’DXDS
13. å±ç›¸è¯+æ•°å€¼(æ— ä¹°å„)â†’SX
14. çº¯æ•°å­—+æ•°å€¼â†’TM

ã€å±ç›¸è¯ã€‘é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª

ã€ä¸€è¡Œå¤šæ¡ç”¨é€—å·åˆ†éš”çš„è¦æ‹†åˆ†æˆç‹¬ç«‹é¡¹ã€‘

ã€ç¤ºä¾‹ã€‘
è¾“å…¥: ä¹°çŒªå„10
è¾“å‡º: [["SXTM","ä¹°çŒªå„10"]]

è¾“å…¥: çŒªx20
è¾“å‡º: [["SX","çŒªx20"]]

è¾“å…¥: 10 12 20å„30
è¾“å‡º: [["TM","10 12 20å„30"]]

è¾“å…¥: å¹³ç‰¹ç¾Š300ï¼Œä¸‰å‹ç¾Šé¸¡çŒ´100ï¼Œ35ï¼Œ47ï¼ŒX10
è¾“å‡º: [["PT1","å¹³ç‰¹ç¾Š300"],["PT3","ä¸‰å‹ç¾Šé¸¡çŒ´100"],["TM","35ï¼Œ47ï¼ŒX10"]]

è¾“å…¥: é¾™x10ï¼Œç‹—x80ï¼Œä¸€å‹ç‹—800
è¾“å‡º: [["SX","é¾™x10"],["SX","ç‹—x80"],["PT1","ä¸€å‹ç‹—800"]]

è¾“å…¥: å°æ•°å„20
è¾“å‡º: [["XS","å°æ•°å„20"]]

è¾“å…¥: äº”ä¸ä¸­01,02,03,04,05å„100
è¾“å‡º: [["BZ","äº”ä¸ä¸­01,02,03,04,05å„100"]]

ã€è¾“å…¥ã€‘
${userInput}

ã€è¾“å‡ºã€‘åªè¾“å‡ºJSONæ•°ç»„ï¼Œç¦æ­¢ä»»ä½•è§£é‡Šï¼š`;

        // ä¿å­˜è¾“å…¥åˆ°è°ƒè¯•ä¿¡æ¯
        debugInfo.aiInput = userInput;
        debugInfo.lastError = '';
        
        try {
            console.log('ğŸ¤– å¼€å§‹è°ƒç”¨AI API...');
            const result = await callAIAPI(prompt, settings.aiProvider, settings.aiApiKey);
            console.log('ğŸ¤– AIè¿”å›åŸå§‹ç»“æœ:', result);
            
            // ä¿å­˜AIåŸå§‹è¾“å‡º
            debugInfo.aiOutput = result || '(ç©º)';
            
            if (result) {
                // æå–JSONï¼ˆå¤„ç†å¯èƒ½çš„markdownä»£ç å—ï¼‰
                let jsonStr = result.trim();
                if (jsonStr.startsWith('```')) {
                    jsonStr = jsonStr.replace(/```json?\n?/g, '').replace(/```/g, '').trim();
                }
                
                console.log('ğŸ¤– è§£æJSON:', jsonStr);
                const aiResult = JSON.parse(jsonStr);
                console.log('ğŸ¤– AIè¯†åˆ«ç»“æœ:', aiResult);
                
                // ä¿å­˜è§£æåçš„JSON
                debugInfo.aiParsed = aiResult;
                
                // ã€ä»£å·â†’ç±»å‹åæ˜ å°„ã€‘
                const CODE_TO_TYPE = {
                    'TM': 'ç‰¹ç ', 'SXTM': 'ç”Ÿè‚–ç‰¹ç ', 'SX': 'ç”Ÿè‚–',
                    'BS': 'æ³¢è‰²', 'BB': 'åŠæ³¢',
                    'PT1': 'å¹³ç‰¹ä¸€è‚–', 'PT2': 'å¹³ç‰¹äºŒè¿è‚–', 'PT3': 'å¹³ç‰¹ä¸‰è¿è‚–',
                    'PT4': 'å¹³ç‰¹å››è¿è‚–', 'PT5': 'å¹³ç‰¹äº”è¿è‚–', 'PTW': 'å¹³ç‰¹å°¾æ•°',
                    'LX': 'å…­è‚–', 'DP': 'å•å¹³', 'DXDS': 'å¤§å°å•åŒ',
                    'E2': 'äºŒä¸­äºŒ', 'S3': 'ä¸‰ä¸­ä¸‰', 'BZ': 'ä¸ä¸­',
                    'HX': 'åˆè‚–', 'LM': 'è¿ç ', 'ZX': 'æ­£è‚–',
                    'ZH': 'æ€»å’Œ', 'WX': 'äº”è¡Œ', 'JY': 'å®¶é‡',
                    'XS': 'å°æ•°', 'DS': 'å¤§æ•°', 'UK': 'æœªçŸ¥'
                };
                
                // ã€æ ¸å¿ƒã€‘AIè¿”å›ä»£å·æ•°ç»„ï¼Œç¨‹åºæå–å…·ä½“æ•°å€¼
                // æ–°æ ¼å¼: [["ä»£å·","åŸæ–‡"],["ä»£å·","åŸæ–‡"]]
                // å…¼å®¹æ—§æ ¼å¼: {"items":[{"type":"ç±»å‹","raw":"åŸæ–‡"}]}
                const bets = [];
                
                if (Array.isArray(aiResult)) {
                    // æ–°æ ¼å¼: [["ä»£å·","åŸæ–‡"]]
                    for (const item of aiResult) {
                        if (Array.isArray(item) && item.length >= 2) {
                            const code = item[0];
                            const raw = item[1];
                            const type = CODE_TO_TYPE[code] || code; // ä»£å·è½¬ç±»å‹å
                            console.log('ğŸ¤– å¤„ç†é¡¹:', code, 'â†’', type, raw);
                            const extracted = extractValuesByType(type, raw);
                            console.log('ğŸ¤– æå–ç»“æœ:', extracted);
                            if (extracted && extracted.length > 0) {
                                bets.push(...extracted);
                            }
                        }
                    }
                } else if (aiResult.items && Array.isArray(aiResult.items)) {
                    // å…¼å®¹æ—§æ ¼å¼: {"items":[{"type":"ç±»å‹","raw":"åŸæ–‡"}]}
                    for (const item of aiResult.items) {
                        console.log('ğŸ¤– å¤„ç†é¡¹:', item);
                        const extracted = extractValuesByType(item.type, item.raw);
                        console.log('ğŸ¤– æå–ç»“æœ:', extracted);
                        if (extracted && extracted.length > 0) {
                            bets.push(...extracted);
                        }
                    }
                }
                
                console.log('ğŸ¤– æœ€ç»ˆbets:', bets);
                debugInfo.aiBets = bets;
                return { bets, unparsed: [] };
            } else {
                console.log('ğŸ¤– AIè¿”å›ç©ºç»“æœ');
                debugInfo.lastError = 'AIè¿”å›ç©ºç»“æœ';
            }
        } catch (e) {
            console.error('ğŸ¤– AIè§£æå¤±è´¥:', e);
            debugInfo.lastError = e.message || String(e);
        }
        return null;
    }
    
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘    ã€ç¨‹åºæå–æ¨¡å—ã€‘æ ¹æ®AIè¯†åˆ«çš„ç±»å‹ï¼Œç”¨æ­£åˆ™æå–å…·ä½“æ•°å€¼          â•‘
    // â•‘    AIåªè´Ÿè´£åˆ†ç±»ï¼Œæ•°å€¼æå–ç”±ç¨‹åºå®Œæˆï¼Œ100%å‡†ç¡®                   â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    function extractValuesByType(type, rawText) {
        const bets = [];
        // é¢„å¤„ç†ï¼š+å·æ›¿æ¢ä¸º10ï¼ˆç”¨æˆ·ä¹ æƒ¯ç”¨+è¡¨ç¤ºåï¼‰
        let text = rawText.replace(/\+/g, '10');
        text = convertChineseNumber(text); // è½¬æ¢ä¸­æ–‡æ•°å­—
        const shengxiaoList = ['é¼ ', 'ç‰›', 'è™', 'å…”', 'é¾™', 'è›‡', 'é©¬', 'ç¾Š', 'çŒ´', 'é¸¡', 'ç‹—', 'çŒª'];
        
        switch (type) {
            case 'ç‰¹ç ': {
                // æå–ç‰¹ç ï¼šæ•°å­—(1-49) + é‡‘é¢
                // æ¨¡å¼1: "ç‰¹43 20" "ç‰¹ç 05 100"
                const teMatch = text.match(/ç‰¹ç ?\s*(\d+)\s*[,ï¼Œ]?\s*(\d+)/);
                if (teMatch) {
                    const num = parseInt(teMatch[1]);
                    if (num >= 1 && num <= 49) {
                        bets.push({ type: 'ç‰¹ç ', number: num, amount: parseInt(teMatch[2]), raw: rawText });
                    }
                    break;
                }
                // æ¨¡å¼2: "31.34å„20" å¤šå·ç 
                const multiMatch = text.match(/(\d+(?:[.,ï¼Œ\s]+\d+)+)å„(\d+)/);
                if (multiMatch) {
                    const nums = multiMatch[1].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(multiMatch[2]);
                    nums.forEach(n => bets.push({ type: 'ç‰¹ç ', number: n, amount, raw: rawText }));
                    break;
                }
                // æ¨¡å¼3: "46,45,X50" Xè¡¨ç¤ºé‡‘é¢
                const xMatch = text.match(/(\d+(?:[,ï¼Œ\s]+\d+)*)[,ï¼Œ\s]*[XxÃ—](\d+)/);
                if (xMatch) {
                    const nums = xMatch[1].split(/[,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(xMatch[2]);
                    nums.forEach(n => bets.push({ type: 'ç‰¹ç ', number: n, amount, raw: rawText }));
                    break;
                }
                // æ¨¡å¼4: ç®€å• "43 20"
                const simpleMatch = text.match(/(\d{1,2})\s+(\d+)/);
                if (simpleMatch) {
                    const num = parseInt(simpleMatch[1]);
                    if (num >= 1 && num <= 49) {
                        bets.push({ type: 'ç‰¹ç ', number: num, amount: parseInt(simpleMatch[2]), raw: rawText });
                    }
                }
                break;
            }
            
            case 'ç”Ÿè‚–ç‰¹ç ': {
                // ã€é‡è¦ã€‘"ä¹°çŒªå„10" = ä¹°çŒªçš„å·ç (7,19,31,43)å„10å…ƒåšç‰¹ç ï¼Œç”¨ç‰¹ç èµ”ç‡43
                const buyMatch = text.match(/ä¹°([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)å„?(\d+)/);
                if (buyMatch) {
                    const animals = buyMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(buyMatch[2]);
                    // æŠŠæ¯ä¸ªç”Ÿè‚–è½¬æ¢ä¸ºå¯¹åº”çš„å·ç ï¼Œæ¯ä¸ªå·ç éƒ½æ˜¯ä¸€æ³¨ç‰¹ç 
                    for (const sx of animals) {
                        const sxNums = LHC_DATA.shengxiao[sx] || [];
                        sxNums.forEach(num => {
                            bets.push({ type: 'ç‰¹ç ', number: num, amount, raw: rawText, fromShengxiao: sx });
                        });
                    }
                }
                break;
            }
            
            case 'ç”Ÿè‚–': {
                // ç”Ÿè‚–ç©æ³•ï¼šä¹°æŸç”Ÿè‚–ä¸­å¥–ï¼Œèµ”ç‡12
                // æ¨¡å¼1: "é¸¡é¼ çŒ´X10" "é¾™x10"
                const xSxMatch = text.match(/([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)[XxÃ—](\d+)/);
                if (xSxMatch) {
                    const animals = xSxMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(xSxMatch[2]);
                    animals.forEach(sx => bets.push({ type: 'ç”Ÿè‚–', value: sx, amount, raw: rawText }));
                    break;
                }
                // æ¨¡å¼2: å•ä¸ªç”Ÿè‚– "çŒª 100" "çŒª100"
                for (const sx of shengxiaoList) {
                    const sxMatch = text.match(new RegExp(`${sx}\\s*(\\d+)`));
                    if (sxMatch) {
                        bets.push({ type: 'ç”Ÿè‚–', value: sx, amount: parseInt(sxMatch[1]), raw: rawText });
                    }
                }
                break;
            }
            
            case 'æ³¢è‰²': {
                // "çº¢æ³¢50" "è“æ³¢ 100"
                const boseMatch = text.match(/(çº¢|è“|ç»¿)æ³¢?\s*(\d+)/);
                if (boseMatch) {
                    bets.push({ type: 'æ³¢è‰²', value: boseMatch[1] + 'æ³¢', amount: parseInt(boseMatch[2]), raw: rawText });
                }
                break;
            }
            
            case 'åŠæ³¢': {
                // "çº¢å•50" "è“åŒ100" "ç»¿å¤§200"
                const banboMatch = text.match(/(çº¢|è“|ç»¿)(å¤§|å°|å•|åŒ)\s*(\d+)/);
                if (banboMatch) {
                    bets.push({ type: 'åŠæ³¢', value: banboMatch[1] + banboMatch[2], amount: parseInt(banboMatch[3]), raw: rawText });
                }
                break;
            }
            
            case 'å¹³ç‰¹ä¸€è‚–': {
                // "å¹³ç‰¹çŒ´é¸¡å„200" "ä¸€å‹çŒª10"
                const pingteMatch = text.match(/(?:å¹³ç‰¹|ä¸€å‹)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)å„?(\d+)/);
                if (pingteMatch) {
                    const animals = pingteMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(pingteMatch[2]);
                    animals.forEach(sx => bets.push({ type: 'å¹³ç‰¹ä¸€è‚–', value: sx, amount, raw: rawText }));
                }
                break;
            }
            
            case 'å¹³ç‰¹äºŒè¿è‚–': {
                // "äºŒè¿è‚–çŒ´é¸¡200" "äºŒå‹çŒ´é¸¡200"
                const pt2Match = text.match(/(?:äºŒè¿è‚–|äºŒå‹|å¹³ç‰¹äºŒè¿)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (pt2Match) {
                    const animals = pt2Match[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(pt2Match[2]);
                    bets.push({ type: 'å¹³ç‰¹äºŒè¿è‚–', value: animals.join(''), amount, raw: rawText });
                }
                break;
            }
            
            case 'å¹³ç‰¹ä¸‰è¿è‚–': {
                // "ä¸‰è¿è‚–çŒ´é¸¡ç‹—200" "ä¸‰å‹çŒ´é¸¡ç‹—200"
                const pt3Match = text.match(/(?:ä¸‰è¿è‚–|ä¸‰å‹|å¹³ç‰¹ä¸‰è¿)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (pt3Match) {
                    const animals = pt3Match[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(pt3Match[2]);
                    bets.push({ type: 'å¹³ç‰¹ä¸‰è¿è‚–', value: animals.join(''), amount, raw: rawText });
                }
                break;
            }
            
            case 'å¹³ç‰¹å››è¿è‚–': {
                // "å››è¿è‚–çŒ´é¸¡ç‹—çŒª200"
                const pt4Match = text.match(/(?:å››è¿è‚–|å¹³ç‰¹å››è¿)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (pt4Match) {
                    const animals = pt4Match[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(pt4Match[2]);
                    bets.push({ type: 'å¹³ç‰¹å››è¿è‚–', value: animals.join(''), amount, raw: rawText });
                }
                break;
            }
            
            case 'å¹³ç‰¹äº”è¿è‚–': {
                // "äº”è¿è‚–çŒ´é¸¡ç‹—çŒªé¼ 200"
                const pt5Match = text.match(/(?:äº”è¿è‚–|å¹³ç‰¹äº”è¿)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (pt5Match) {
                    const animals = pt5Match[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(pt5Match[2]);
                    bets.push({ type: 'å¹³ç‰¹äº”è¿è‚–', value: animals.join(''), amount, raw: rawText });
                }
                break;
            }
            
            case 'å¹³ç‰¹å°¾æ•°': {
                // "å¹³ç‰¹å°¾5 100" "å¹³å°¾5 100"
                const ptwMatch = text.match(/(?:å¹³ç‰¹å°¾|å¹³å°¾)(\d)\s*(\d+)/);
                if (ptwMatch) {
                    bets.push({ type: 'å¹³ç‰¹å°¾æ•°', value: ptwMatch[1], amount: parseInt(ptwMatch[2]), raw: rawText });
                }
                break;
            }
            
            case 'å…­è‚–': {
                // "å…­è‚–é¼ ç‰›è™å…”é¾™è›‡200"
                const liuxiaoMatch = text.match(/å…­è‚–([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (liuxiaoMatch) {
                    const animals = liuxiaoMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(liuxiaoMatch[2]);
                    bets.push({ type: 'å…­è‚–', value: animals.join(''), amount, raw: rawText });
                }
                break;
            }
            
            case 'å•å¹³': {
                // "å•å¹³05 100" "å¹³ç 05 100"
                const danpingMatch = text.match(/(?:å•å¹³|å¹³ç )\s*(\d+)\s*(\d+)/);
                if (danpingMatch) {
                    const num = parseInt(danpingMatch[1]);
                    if (num >= 1 && num <= 49) {
                        bets.push({ type: 'å•å¹³', number: num, amount: parseInt(danpingMatch[2]), raw: rawText });
                    }
                    break;
                }
                // å¤šå·ç : "å•å¹³05.08.12å„100"
                const multiDPMatch = text.match(/(?:å•å¹³|å¹³ç )\s*(\d+(?:[.,ï¼Œ\s]+\d+)+)å„?(\d+)/);
                if (multiDPMatch) {
                    const nums = multiDPMatch[1].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(multiDPMatch[2]);
                    nums.forEach(n => bets.push({ type: 'å•å¹³', number: n, amount, raw: rawText }));
                }
                break;
            }
            
            case 'å¤§å°å•åŒ': {
                // "å¤§100" "å° 50" "å•åŒå„20"
                const dxdsMatch = text.match(/(å¤§|å°|å•|åŒ)\s*(\d+)/g);
                if (dxdsMatch) {
                    dxdsMatch.forEach(m => {
                        const parts = m.match(/(å¤§|å°|å•|åŒ)\s*(\d+)/);
                        if (parts) {
                            bets.push({ type: 'å¤§å°å•åŒ', value: parts[1], amount: parseInt(parts[2]), raw: rawText });
                        }
                    });
                }
                break;
            }
            
            case 'äºŒä¸­äºŒ': {
                // "äºŒä¸­äºŒ 01,02,03 å„100"
                const ez2Match = text.match(/äºŒä¸­äºŒ\s*(\d+(?:[.,ï¼Œ\s]+\d+)+)å„?(\d+)/);
                if (ez2Match) {
                    const nums = ez2Match[1].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(ez2Match[2]);
                    bets.push({ type: 'äºŒä¸­äºŒ', numbers: nums, amount, raw: rawText });
                }
                break;
            }
            
            case 'ä¸‰ä¸­ä¸‰': {
                // "ä¸‰ä¸­ä¸‰ 01,02,03,04 å„100"
                const sz3Match = text.match(/ä¸‰ä¸­ä¸‰\s*(\d+(?:[.,ï¼Œ\s]+\d+)+)å„?(\d+)/);
                if (sz3Match) {
                    const nums = sz3Match[1].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(sz3Match[2]);
                    bets.push({ type: 'ä¸‰ä¸­ä¸‰', numbers: nums, amount, raw: rawText });
                }
                break;
            }
            
            case 'ä¸ä¸­': {
                // "äº”ä¸ä¸­01,02,03,04,05å„100" "åäºŒä¸ä¸­01-12å„100"
                const bzMatch = text.match(/(äº”|å…­|ä¸ƒ|å…«|ä¹|å|åä¸€|åäºŒ)ä¸ä¸­\s*(\d+(?:[.,ï¼Œ\s]+\d+)+)å„?(\d+)/);
                if (bzMatch) {
                    const countMap = {'äº”':5,'å…­':6,'ä¸ƒ':7,'å…«':8,'ä¹':9,'å':10,'åä¸€':11,'åäºŒ':12};
                    const count = countMap[bzMatch[1]] || 5;
                    const nums = bzMatch[2].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(bzMatch[3]);
                    bets.push({ type: 'ä¸ä¸­', subType: bzMatch[1] + 'ä¸ä¸­', numbers: nums, count, amount, raw: rawText });
                }
                break;
            }
            
            case 'åˆè‚–': {
                // "åˆè‚–é¼ ç‰›200" "ä¸‰è‚–é¼ ç‰›è™200"ï¼ˆéå…­è‚–ï¼‰
                const hxMatch = text.match(/(?:åˆè‚–|[äºŒä¸‰å››äº”]è‚–)([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)\s*(\d+)/);
                if (hxMatch) {
                    const animals = hxMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(hxMatch[2]);
                    bets.push({ type: 'åˆè‚–', value: animals.join(''), count: animals.length, amount, raw: rawText });
                }
                break;
            }
            
            case 'è¿ç ': {
                // "äºŒå…¨ä¸­01,02å„100" "ä¸‰å…¨ä¸­01,02,03å„100" "äºŒä¸­ç‰¹01,02å„100" "ç‰¹ä¸²01,02å„100"
                const lianmaTypes = ['äºŒå…¨ä¸­', 'ä¸‰å…¨ä¸­', 'äºŒä¸­ç‰¹', 'ä¸‰ä¸­ç‰¹', 'ç‰¹ä¸²'];
                for (const lt of lianmaTypes) {
                    const lmMatch = text.match(new RegExp(`${lt}\\s*(\\d+(?:[.,ï¼Œ\\s]+\\d+)+)å„?(\\d+)`));
                    if (lmMatch) {
                        const nums = lmMatch[1].split(/[.,ï¼Œ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                        const amount = parseInt(lmMatch[2]);
                        bets.push({ type: 'è¿ç ', subType: lt, numbers: nums, amount, raw: rawText });
                        break;
                    }
                }
                break;
            }
            
            case 'æ­£è‚–': {
                // "æ­£è‚–çŒª100" "æ­£è‚–é¼ ç‰›å„100"
                const zxMatch = text.match(/æ­£è‚–([é¼ ç‰›è™å…”é¾™è›‡é©¬ç¾ŠçŒ´é¸¡ç‹—çŒª]+)å„?(\d+)/);
                if (zxMatch) {
                    const animals = zxMatch[1].split('').filter(a => shengxiaoList.includes(a));
                    const amount = parseInt(zxMatch[2]);
                    animals.forEach(sx => bets.push({ type: 'æ­£è‚–', value: sx, amount, raw: rawText }));
                }
                break;
            }
            
            case 'æ€»å’Œ': {
                // "æ€»å’Œå¤§100" "æ€»å’Œå•100"
                const zhMatch = text.match(/æ€»å’Œ(å¤§|å°|å•|åŒ)\s*(\d+)/);
                if (zhMatch) {
                    bets.push({ type: 'æ€»å’Œ', value: 'æ€»å’Œ' + zhMatch[1], amount: parseInt(zhMatch[2]), raw: rawText });
                }
                break;
            }
            
            case 'äº”è¡Œ': {
                // "é‡‘100" "æœ¨100"
                const wxMatch = text.match(/(é‡‘|æœ¨|æ°´|ç«|åœŸ)\s*(\d+)/);
                if (wxMatch) {
                    bets.push({ type: 'äº”è¡Œ', value: wxMatch[1], amount: parseInt(wxMatch[2]), raw: rawText });
                }
                break;
            }
            
            case 'å®¶é‡': {
                // "å®¶ç¦½100" "é‡å…½100"
                const jyMatch = text.match(/(å®¶ç¦½|é‡å…½)\s*(\d+)/);
                if (jyMatch) {
                    bets.push({ type: 'å®¶é‡', value: jyMatch[1], amount: parseInt(jyMatch[2]), raw: rawText });
                }
                break;
            }
            
            case 'å°æ•°': {
                // "å°æ•°å„20" - 1-24æ‰€æœ‰å·ç å„20å…ƒ
                const xsMatch = text.match(/å°æ•°å„?(\d+)/);
                if (xsMatch) {
                    const amount = parseInt(xsMatch[1]);
                    // å°æ•° = 1-24
                    for (let n = 1; n <= 24; n++) {
                        bets.push({ type: 'ç‰¹ç ', number: n, amount, raw: rawText, fromXiaoshu: true });
                    }
                }
                break;
            }
            
            case 'å¤§æ•°': {
                // "å¤§æ•°å„20" - 25-49æ‰€æœ‰å·ç å„20å…ƒ
                const dsMatch = text.match(/å¤§æ•°å„?(\d+)/);
                if (dsMatch) {
                    const amount = parseInt(dsMatch[1]);
                    // å¤§æ•° = 25-49
                    for (let n = 25; n <= 49; n++) {
                        bets.push({ type: 'ç‰¹ç ', number: n, amount, raw: rawText, fromDashu: true });
                    }
                }
                break;
            }
            
            default: {
                // æœªçŸ¥ç±»å‹ï¼Œå°è¯•é€šç”¨æå–
                const numMatch = text.match(/(\d+)\s*[å…ƒå—]?$/);
                if (numMatch) {
                    bets.push({ type: 'æœªçŸ¥', value: text, amount: parseInt(numMatch[1]), raw: rawText });
                }
            }
        }
        
        return bets;
    }
    
    // ==================== å‚æ•°è®¾ç½® ====================
    function saveParamSettings() {
        const settings = {
            omitYuan: document.getElementById('param-omit-yuan').checked,
            omitMa: document.getElementById('param-omit-ma').checked,
            autoCorrect: document.getElementById('param-auto-correct').checked,
            fuzzyShengxiao: document.getElementById('param-fuzzy-shengxiao').checked,
            defaultUnit: document.getElementById('param-default-unit').value,
            customRules: document.getElementById('custom-calc-rules').value
        };
        localStorage.setItem('lhc_param_settings', JSON.stringify(settings));
        alert('âœ… å‚æ•°è®¾ç½®å·²ä¿å­˜ï¼');
    }
    
    function loadParamSettings() {
        const saved = localStorage.getItem('lhc_param_settings');
        if (saved) {
            const settings = JSON.parse(saved);
            if (document.getElementById('param-omit-yuan')) {
                document.getElementById('param-omit-yuan').checked = settings.omitYuan !== false;
                document.getElementById('param-omit-ma').checked = settings.omitMa !== false;
                document.getElementById('param-auto-correct').checked = settings.autoCorrect !== false;
                document.getElementById('param-fuzzy-shengxiao').checked = settings.fuzzyShengxiao !== false;
                document.getElementById('param-default-unit').value = settings.defaultUnit || '1';
                document.getElementById('custom-calc-rules').value = settings.customRules || '';
            }
        }
    }
    
    function copyResult() {
        const result = document.getElementById('result-content').textContent;
        copyToClipboard(result);
    }
    
    // å…¼å®¹iOSçš„å¤åˆ¶å‡½æ•°
    function copyToClipboard(text) {
        // æ–¹æ³•1: ç°ä»£API
        if (navigator.clipboard && navigator.clipboard.writeText) {
            navigator.clipboard.writeText(text).then(() => {
                showAutoCloseToast('âœ… ç»“æœå·²å¤åˆ¶ï¼');
            }).catch(() => {
                fallbackCopy(text);
            });
        } else {
            fallbackCopy(text);
        }
    }
    
    // å¤‡ç”¨å¤åˆ¶æ–¹æ³•ï¼ˆå…¼å®¹iOSï¼‰
    function fallbackCopy(text) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        textarea.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:200px;z-index:9999;font-size:16px;';
        document.body.appendChild(textarea);
        
        // iOSç‰¹æ®Šå¤„ç†
        const range = document.createRange();
        range.selectNodeContents(textarea);
        const selection = window.getSelection();
        selection.removeAllRanges();
        selection.addRange(range);
        textarea.setSelectionRange(0, text.length);
        
        try {
            document.execCommand('copy');
            showAutoCloseToast('âœ… ç»“æœå·²å¤åˆ¶ï¼');
        } catch (e) {
            showAutoCloseToast('âŒ å¤åˆ¶å¤±è´¥ï¼Œè¯·æ‰‹åŠ¨å¤åˆ¶', 3000);
        }
        
        document.body.removeChild(textarea);
    }
    
    // è‡ªåŠ¨å…³é—­çš„æç¤ºï¼ˆçº¦2ç§’ï¼‰
    function showAutoCloseToast(msg, duration = 2000) {
        const toast = document.createElement('div');
        toast.innerHTML = msg;
        toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
        document.body.appendChild(toast);
        setTimeout(() => toast.remove(), duration);
    }
    
    // â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    // â•‘                    ã€æ¨¡å—3ã€‘èµ”ç‡è®¾ç½®æ¨¡å—                        â•‘
    // â•‘  æ–‡ä»¶åˆ†ç¦»æ—¶æå–åˆ°: js/odds.js                                   â•‘
    // â•‘  åŠŸèƒ½: èµ”ç‡çš„è¯»å–ã€ä¿å­˜ã€å¯¼å…¥å¯¼å‡º                               â•‘
    // â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
    
    // ç”Ÿæˆå¯¼å‡ºæ•°æ®
    function getExportData() {
        const allOdds = collectAllOdds();
        return {
            version: '1.0',
            type: 'odds_only',
            exportTime: new Date().toLocaleString('zh-CN'),
            odds: allOdds
        };
    }
    
    // ç”Ÿæˆæ–‡ä»¶å
    function getExportFileName() {
        const date = new Date();
        const dateStr = `${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2,'0')}${date.getDate().toString().padStart(2,'0')}`;
        return `èµ”ç‡é…ç½®_${dateStr}.txt`;
    }
    
    // æ˜¾ç¤ºå¯¼å‡ºé€‰é¡¹
    function showExportOptions() {
        document.getElementById('export-modal').classList.add('show');
    }
    
    function hideExportModal() {
        document.getElementById('export-modal').classList.remove('show');
    }
    
    // å¤åˆ¶é…ç½®æ–‡æœ¬
    function exportCopy() {
        hideExportModal();
        const jsonStr = JSON.stringify(getExportData());
        copyToClipboard(jsonStr);
    }
    
    // æ–¹å¼3ï¼šä¸‹è½½æ–‡ä»¶
    function exportDownload() {
        hideExportModal();
        const jsonStr = JSON.stringify(getExportData());
        const fileName = getExportFileName();
        downloadFile(fileName, jsonStr);
    }
    
    // ä¸‹è½½æ–‡ä»¶å‡½æ•°
    function downloadFile(fileName, content) {
        const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = fileName;
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        
        setTimeout(() => {
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }, 100);
        
        // æç¤ºä¸‹è½½ä½ç½®
        const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
        const isAndroid = /Android/.test(navigator.userAgent);
        
        let tip = 'âœ… é…ç½®æ–‡ä»¶å·²ä¸‹è½½ï¼\n\næ–‡ä»¶åï¼š' + fileName;
        
        if (isIOS) {
            tip += '\n\nğŸ“ æŸ¥æ‰¾æ–‡ä»¶æ–¹æ³•ï¼š\n';
            tip += '1. æ‰“å¼€ã€Œæ–‡ä»¶ã€Appï¼ˆè“è‰²æ–‡ä»¶å¤¹å›¾æ ‡ï¼‰\n';
            tip += '2. ç‚¹å‡»ã€Œæµè§ˆã€\n';
            tip += '3. é€‰æ‹©ã€Œä¸‹è½½é¡¹ã€æˆ–ã€ŒiCloudäº‘ç›˜ã€';
        } else if (isAndroid) {
            tip += '\n\nğŸ“ æŸ¥æ‰¾æ–‡ä»¶æ–¹æ³•ï¼š\n';
            tip += '1. æ‰“å¼€ã€Œæ–‡ä»¶ç®¡ç†ã€æˆ–ã€Œæˆ‘çš„æ–‡ä»¶ã€\n';
            tip += '2. æ‰¾åˆ°ã€Œä¸‹è½½ã€æˆ–ã€ŒDownloadã€æ–‡ä»¶å¤¹';
        } else {
            tip += '\n\nğŸ“ æŸ¥æ‰¾æ–‡ä»¶æ–¹æ³•ï¼š\n';
            tip += 'æŒ‰ Ctrl+J æ‰“å¼€æµè§ˆå™¨ä¸‹è½½è®°å½•';
        }
        
        alert(tip);
    }
    
    function showExportFallback(jsonStr) {
        // å¼¹çª—æ˜¾ç¤ºé…ç½®ä¾›æ‰‹åŠ¨å¤åˆ¶
        const textarea = document.createElement('textarea');
        textarea.value = jsonStr;
        textarea.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:200px;z-index:9999;font-size:12px;';
        document.body.appendChild(textarea);
        textarea.select();
        
        alert('è¯·æ‰‹åŠ¨å¤åˆ¶ä¸‹é¢çš„é…ç½®æ–‡æœ¬ï¼š');
        
        setTimeout(() => {
            document.body.removeChild(textarea);
        }, 30000);
    }
    
    function showImportModal() {
        document.getElementById('import-modal').classList.add('show');
        document.getElementById('import-textarea').value = '';
        document.getElementById('import-file').value = '';
    }
    
    function hideImportModal() {
        document.getElementById('import-modal').classList.remove('show');
    }
    
    // å¤„ç†æ–‡ä»¶é€‰æ‹©
    function handleFileSelect(event) {
        const file = event.target.files[0];
        if (!file) return;
        
        const reader = new FileReader();
        reader.onload = function(e) {
            const content = e.target.result;
            document.getElementById('import-textarea').value = content;
            // è‡ªåŠ¨å¯¼å…¥
            importConfig();
        };
        reader.onerror = function() {
            alert('âŒ æ–‡ä»¶è¯»å–å¤±è´¥');
        };
        reader.readAsText(file);
    }
    
    function importConfig() {
        const jsonStr = document.getElementById('import-textarea').value.trim();
        
        if (!jsonStr) {
            alert('âŒ è¯·ç²˜è´´èµ”ç‡é…ç½®æ•°æ®ï¼');
            return;
        }
        
        try {
            const importData = JSON.parse(jsonStr);
            
            // éªŒè¯æ•°æ®æ ¼å¼
            if (!importData.version || !importData.odds) {
                throw new Error('æ— æ•ˆçš„é…ç½®æ ¼å¼');
            }
            
            // å¯¼å…¥èµ”ç‡è®¾ç½®
            applyAllOdds(importData.odds);
            
            // ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨
            saveOddsToStorage();
            
            hideImportModal();
            alert('âœ… èµ”ç‡é…ç½®å¯¼å…¥æˆåŠŸï¼\n\nå¯¼å…¥æ—¶é—´ï¼š' + (importData.exportTime || 'æœªçŸ¥'));
            
        } catch (e) {
            alert('âŒ å¯¼å…¥å¤±è´¥ï¼šé…ç½®æ ¼å¼é”™è¯¯\n\nè¯·ç¡®ä¿ç²˜è´´çš„æ˜¯å®Œæ•´çš„èµ”ç‡é…ç½®æ•°æ®ã€‚');
        }
    }
    
    // æ”¶é›†æ‰€æœ‰èµ”ç‡è¾“å…¥æ¡†çš„å€¼
    function collectAllOdds() {
        const odds = {};
        const inputs = document.querySelectorAll('.odds-item-input');
        inputs.forEach(input => {
            odds[input.id] = parseFloat(input.value) || 0;
        });
        return odds;
    }
    
    // åº”ç”¨æ‰€æœ‰èµ”ç‡åˆ°è¾“å…¥æ¡†
    function applyAllOdds(odds) {
        for (const [id, value] of Object.entries(odds)) {
            const input = document.getElementById(id);
            if (input) {
                input.value = value;
            }
        }
    }
    
    // ä¿å­˜èµ”ç‡åˆ°æœ¬åœ°å­˜å‚¨
    function saveOddsToStorage() {
        const odds = collectAllOdds();
        localStorage.setItem('lhc_odds', JSON.stringify(odds));
    }
    
    // åŠ è½½èµ”ç‡ä»æœ¬åœ°å­˜å‚¨
    function loadOddsFromStorage() {
        const saved = localStorage.getItem('lhc_odds');
        if (saved) {
            try {
                const odds = JSON.parse(saved);
                applyAllOdds(odds);
            } catch(e) {}
        }
    }
    
    // ==================== ç‰ˆæœ¬æ›´æ–°æ£€æµ‹ ====================
    const APP_VERSION = 'v1.0.2';  // å½“å‰ç‰ˆæœ¬å·ï¼Œä¸ sw.js ä¿æŒä¸€è‡´ï¼ˆç¼“å­˜ä¼˜å…ˆç­–ç•¥ï¼‰
    
    // æ³¨å†Œ Service Worker å¹¶æ£€æµ‹æ›´æ–°
    if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./sw.js').then(registration => {
            console.log('âœ… Service Worker æ³¨å†ŒæˆåŠŸ');
            
            // æ£€æµ‹æ›´æ–°
            registration.addEventListener('updatefound', () => {
                const newWorker = registration.installing;
                newWorker.addEventListener('statechange', () => {
                    if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                        // æœ‰æ–°ç‰ˆæœ¬å¯ç”¨ï¼Œæ˜¾ç¤ºæ›´æ–°æç¤º
                        showUpdateNotification();
                    }
                });
            });
        }).catch(err => {
            console.log('Service Worker æ³¨å†Œå¤±è´¥:', err);
        });
        
        // ç›‘å¬æ¥è‡ª Service Worker çš„æ¶ˆæ¯
        navigator.serviceWorker.addEventListener('message', event => {
            if (event.data && event.data.type === 'SW_UPDATED') {
                console.log('ğŸ“¦ æ£€æµ‹åˆ°æ–°ç‰ˆæœ¬:', event.data.version);
                showUpdateNotification();
            }
        });
    }
    
    // æ˜¾ç¤ºæ›´æ–°æç¤º
    function showUpdateNotification() {
        // å¦‚æœå·²ç»æ˜¾ç¤ºè¿‡ï¼Œä¸é‡å¤æ˜¾ç¤º
        if (document.getElementById('update-notification')) return;
        
        const notification = document.createElement('div');
        notification.id = 'update-notification';
        notification.innerHTML = `
            <div style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
                background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
                color:white;padding:15px 20px;border-radius:12px;
                box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:99999;
                display:flex;align-items:center;gap:15px;max-width:90%;
                animation:slideUp 0.3s ease-out;">
                <div style="flex:1;">
                    <div style="font-weight:bold;margin-bottom:3px;">ğŸ‰ å‘ç°æ–°ç‰ˆæœ¬</div>
                    <div style="font-size:12px;opacity:0.9;">ç‚¹å‡»åˆ·æ–°è·å–æœ€æ–°åŠŸèƒ½</div>
                </div>
                <button onclick="location.reload()" 
                    style="background:white;color:#764ba2;border:none;
                    padding:8px 16px;border-radius:6px;font-weight:bold;
                    cursor:pointer;white-space:nowrap;">
                    ç«‹å³åˆ·æ–°
                </button>
                <button onclick="this.parentElement.parentElement.remove()" 
                    style="background:transparent;color:white;border:none;
                    font-size:18px;cursor:pointer;padding:0 5px;">
                    âœ•
                </button>
            </div>
        `;
        document.body.appendChild(notification);
        
        // æ·»åŠ åŠ¨ç”»æ ·å¼
        if (!document.getElementById('update-animation-style')) {
            const style = document.createElement('style');
            style.id = 'update-animation-style';
            style.textContent = `
                @keyframes slideUp {
                    from { transform: translateX(-50%) translateY(100px); opacity: 0; }
                    to { transform: translateX(-50%) translateY(0); opacity: 1; }
                }
            `;
            document.head.appendChild(style);
        }
    }
    
    // æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬ï¼ˆå¯é€‰ï¼Œè°ƒè¯•ç”¨ï¼‰
    console.log('ğŸ“± å…­å”ç«ç®­è®¡ç®—å™¨ ' + APP_VERSION);
    
    // åˆå§‹åŒ–
    init();
    </script>
</body>
</html>
