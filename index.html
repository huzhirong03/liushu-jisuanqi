    <!DOCTYPE html>
    <!--
    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë                      ÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô® - ÁâàÊú¨‰ø°ÊÅØ                              ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  ÁâàÊú¨Âè∑: v2.4.9                                                            ‚ïë
    ‚ïë  Êõ¥Êñ∞Êó•Êúü: 2025-12-21                                                      ‚ïë
    ‚ïë  ÊèêÁ§∫ËØçÁâàÊú¨: v2.1                                                          ‚ïë
    ‚ïë  ÊµãËØïÁî®‰æãÁâàÊú¨: v1.1 (35‰∏™Áî®‰æã)                                             ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  Êõ¥Êñ∞Êó•Âøó:                                                                 ‚ïë
    ‚ïë  v1.9.0 - ÊèêÁ§∫ËØç‰ºòÂåñv2                                                     ‚ïë
    ‚ïë    - ÊîØÊåÅÁîüËÇñ+xÊ†ºÂºèÔºàÈæôx10„ÄÅÁãóX80„ÄÅÁå¥È∏°x50Ôºâ                                ‚ïë
    ‚ïë    - ÊîØÊåÅÂ∞èÊï∞/Â§ßÊï∞/ÂçïÊï∞/ÂèåÊï∞ËåÉÂõ¥                                           ‚ïë
    ‚ïë    - ÊîØÊåÅÂ§öÁßçÂàÜÈöîÁ¨¶ÔºàÁ©∫Ê†º/ÁÇπ/ÈÄóÂè∑/È°øÂè∑/ÊñúÊù†/Ê®™Êù†Ôºâ                          ‚ïë
    ‚ïë    - ÊîØÊåÅ‰∏≠ÊñáÈáëÈ¢ùÔºàÂêÑ‰∫åÂçÅ„ÄÅÂêÑ‰∏ÄÁôæÔºâ                                        ‚ïë
    ‚ïë    - Êñ∞Â¢ûR29/R30ÁêÜÁî±‰ª£Á†Å                                                   ‚ïë
    ‚ïë    - Êñ∞Â¢ûÊâπÈáèËæπÁºòÊµãËØïÂäüËÉΩÔºà32‰∏™Áî®‰æãÔºâ                                       ‚ïë
    ‚ïë    - ÊµãËØïÂÆåÊàêËá™Âä®ÂØºÂá∫JSON+CSV                                              ‚ïë
    ‚ïë  v1.8.0 - Ê®°ÂûãÊØîÊãºÁ≥ªÁªü                                                     ‚ïë
    ‚ïë    - 5ËΩÆÊµãËØï„ÄÅÊ†áÂáÜÁ≠îÊ°àÂØπÊØî„ÄÅCSVÂØºÂá∫„ÄÅËØÑÂàÜÁªüËÆ°                              ‚ïë
    ‚ïë  v1.7.0 - ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπÊô∫ËÉΩÂàáÊç¢                                            ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  ‚ö†Ô∏è Êñ∞ÂØπËØùÂøÖËØª: PROJECT_INFO.md (ÂåÖÂê´È°πÁõÆÁªìÊûÑ„ÄÅÊ®°ÂûãÈÖçÁΩÆ„ÄÅÊµãËØïÂéÜÂè≤)          ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

    ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
    ‚ïë                      ÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô® - ‰ª£Á†ÅÁ¥¢Âºï                              ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë                                                                           ‚ïë
    ‚ïë  „ÄêÊü•ÊâæÊñπÊ≥ï„ÄëÊåâ Ctrl+F ÊêúÁ¥¢ÂÖ≥ÈîÆËØç                                          ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  1. ÈªòËÆ§ÂºÄÂ•ñÂè∑Á†ÅÔºàÊµãËØïÁî®Ôºâ                                                  ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêÊµãËØïÁî®„ÄëÈªòËÆ§ÂºÄÂ•ñÂè∑Á†Å                                            ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  2. Ê†ºÂºèËß£ÊûêÊ®°ÂùóÔºàËß£Êûê‰∏ãÊ≥®ÊñáÊú¨Ôºâ                                            ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêÊ®°Âùó1„ÄëÊ†ºÂºèËß£ÊûêÊ®°Âùó                                             ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  3. ËÆ°ÁÆóÈÄªËæëÊ®°ÂùóÔºàËÆ°ÁÆó‰∏≠Â•ñÁªìÊûúÔºâ                                            ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêÊ®°Âùó2„ÄëËÆ°ÁÆóÈÄªËæëÊ®°Âùó                                             ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  4. ËµîÁéáËÆæÁΩÆÊ®°ÂùóÔºàËµîÁéáËØªÂÜôÂØºÂÖ•ÂØºÂá∫Ôºâ                                        ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêÊ®°Âùó3„ÄëËµîÁéáËÆæÁΩÆÊ®°Âùó                                             ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  5. ÂØºÂá∫/ÂØºÂÖ•ËµîÁéáÊåâÈíÆ                                                      ‚ïë
    ‚ïë     ‰ΩçÁΩÆ: ÊøÄÊ¥ª‰ºöÂëòÈ°µÈù¢ ‚Üí ËµîÁéáÈÖçÁΩÆÂ§á‰ªΩ                                       ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  ‚òÖ‚òÖ‚òÖ 6. „ÄêAIÊèêÁ§∫ËØç„ÄëÂ§ßÊ®°ÂûãËæìÂÖ•ÊèêÁ§∫ËØç ‚òÖ‚òÖ‚òÖ                                  ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêAIÊèêÁ§∫ËØçÂºÄÂßã„Äë                                                  ‚ïë
    ‚ïë     ËØ¥Êòé: ÂèëÈÄÅÁªôDeepSeekÂ§ßÊ®°ÂûãÁöÑÊèêÁ§∫ËØçÔºåÊéßÂà∂AIÂ¶Ç‰ΩïËß£ÊûêÁî®Êà∑ËæìÂÖ•              ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  ‚òÖ‚òÖ‚òÖ 7. „ÄêAIË∞ÉËØïÊòæÁ§∫„ÄëÊµãËØïÂÆåÊàêÂêéÂà†Èô§ ‚òÖ‚òÖ‚òÖ                                  ‚ïë
    ‚ïë     ÊêúÁ¥¢: „ÄêAIË∞ÉËØïÊòæÁ§∫„Äë                                                    ‚ïë
    ‚ïë     ËØ¥Êòé: ÂëäËØâAI"Âà†Èô§AIË∞ÉËØïÊòæÁ§∫‰ª£Á†Å"Âç≥ÂèØÁßªÈô§                               ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  „ÄêÊîØÊåÅÁöÑÁé©Ê≥ïÁ±ªÂûã„ÄëÂÖ±24Áßç                                                   ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  ÁâπÁ†ÅÁ±ª:     ÁâπÁ†Å„ÄÅÁîüËÇñÁâπÁ†ÅÔºà‰π∞XÂêÑYÔºâ„ÄÅÂ§ßÂ∞èÂçïÂèå                             ‚ïë
    ‚ïë  Âπ≥ÁâπÁ±ª:     Âπ≥Áâπ‰∏ÄËÇñ(‰∏ÄÂèã)„ÄÅÂπ≥Áâπ‰∫åËøûËÇñ(‰∫åÂèã)„ÄÅÂπ≥Áâπ‰∏âËøûËÇñ(‰∏âÂèã)„ÄÅ           ‚ïë
    ‚ïë             Âπ≥ÁâπÂõõËøûËÇñ„ÄÅÂπ≥Áâπ‰∫îËøûËÇñ„ÄÅÂπ≥ÁâπÂ∞æÊï∞                               ‚ïë
    ‚ïë  ÁîüËÇñÁ±ª:     ÁîüËÇñ„ÄÅÂÖ≠ËÇñ„ÄÅÁâπËÇñ„ÄÅÂêàËÇñ„ÄÅÊ≠£ËÇñ                                    ‚ïë
    ‚ïë  Ê≥¢Ëâ≤Á±ª:     Ê≥¢Ëâ≤„ÄÅÂçäÊ≥¢(Á∫¢Âçï/Á∫¢Âèå/ËìùÂçï/ËìùÂèå/ÁªøÂ§ß/ÁªøÂ∞èÁ≠â)                    ‚ïë
    ‚ïë  Âπ≥Á†ÅÁ±ª:     ÂçïÂπ≥/Âπ≥Á†Å                                                     ‚ïë
    ‚ïë  ËøûÁ†ÅÁ±ª:     ‰∫å‰∏≠‰∫å„ÄÅ‰∏â‰∏≠‰∏â„ÄÅ‰∫åÂÖ®‰∏≠„ÄÅ‰∏âÂÖ®‰∏≠„ÄÅ‰∫å‰∏≠Áâπ„ÄÅ‰∏â‰∏≠Áâπ„ÄÅÁâπ‰∏≤           ‚ïë
    ‚ïë  ‰∏ç‰∏≠Á±ª:     ‰∫î‰∏ç‰∏≠~ÂçÅ‰∫å‰∏ç‰∏≠                                               ‚ïë
    ‚ïë  ÂÖ∂‰ªñ:       ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå„ÄÅ‰∫îË°å„ÄÅÂÆ∂Á¶ΩÈáéÂÖΩ„ÄÅÂ§¥Â∞æÊï∞                           ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  „ÄêÈáçË¶ÅÂå∫ÂàÜ„Äë"‰π∞Áå™ÂêÑ10" vs "Áå™x10"                                          ‚ïë
    ‚ïë  ‰π∞Áå™ÂêÑ10 ‚Üí ÁîüËÇñÁâπÁ†ÅÔºö‰π∞Áå™ÁöÑÂè∑Á†Å(7,19,31,43)ÂêÑ10ÂÖÉ=40ÂÖÉÔºåËµîÁéá43            ‚ïë
    ‚ïë  Áå™x10   ‚Üí ÁîüËÇñÁâπÁ†ÅÔºöÁå™ÁöÑÂè∑Á†ÅÂêÑ10ÂÖÉÔºàÂêå‰∏äÔºâ                                ‚ïë
    ‚ïë  Áå™10    ‚Üí ÁîüËÇñÔºö‰π∞Áå™ÁîüËÇñ10ÂÖÉÔºåËµîÁéá12                                      ‚ïë
    ‚ïë                                                                           ‚ïë
    ‚ïë  „ÄêÂà´ÂêçÊò†Â∞Ñ„Äë                                                              ‚ïë
    ‚ïë  ‰∏ÄÂèã=Âπ≥Áâπ‰∏ÄËÇñ  ‰∫åÂèã=Âπ≥Áâπ‰∫åËøûËÇñ  ‰∏âÂèã=Âπ≥Áâπ‰∏âËøûËÇñ  Âπ≥Á†Å=ÂçïÂπ≥  +=ÂçÅ(Âè∑Á†Å)     ‚ïë
    ‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
    ‚ïë  ‚òÖ‚òÖ‚òÖ 8. „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÂ§ßÊ®°ÂûãÊµãËØïÁ≥ªÁªüÔºàÂêéÊúüÂà†Èô§Ôºâ ‚òÖ‚òÖ‚òÖ                   ‚ïë
    ‚ïë     ÊêúÁ¥¢: „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„Äë                                                ‚ïë
    ‚ïë     ËØ¥Êòé: Áî®‰∫éÊØîÊãºÂêÑÂ§ßÊ®°ÂûãÊÄßËÉΩÔºåÊâæÂà∞ÊúÄÈÄÇÂêàÁöÑÊ®°ÂûãÁªÑÂêà                        ‚ïë
    ‚ïë     Âà†Èô§: ÂëäËØâAI"Âà†Èô§‰∏¥Êó∂-Ê®°ÂûãÊØîÊãºÂäüËÉΩ"Âç≥ÂèØÁßªÈô§                            ‚ïë
    ‚ïë     ÂåÖÂê´: 5ËΩÆÊµãËØï„ÄÅËæπÁºòÊµãËØï„ÄÅÊ†áÂáÜÁ≠îÊ°àÂØπÊØî„ÄÅCSV+JSONÂØºÂá∫                    ‚ïë
    ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
    -->
    <html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
        <meta name="apple-mobile-web-app-title" content="ÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô®">
        <meta name="theme-color" content="#1a1a2e">
        
        <title>ÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô®</title>
        <link rel="manifest" href="manifest.json">
        <link rel="apple-touch-icon" href="icon-192.png">
        
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }
            
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'PingFang SC', 'Helvetica Neue', Arial, sans-serif;
                background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
                min-height: 100vh;
                color: #fff;
                padding: 15px;
                padding-top: max(15px, env(safe-area-inset-top));
                padding-bottom: max(15px, env(safe-area-inset-bottom));
            }
            
            .container {
                max-width: 500px;
                margin: 0 auto;
            }
            
            /* È°∂ÈÉ®Ê†áÈ¢ò */
            .header {
                text-align: center;
                padding: 15px 0;
            }
            
            .header h1 {
                font-size: 24px;
                color: #e94560;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 8px;
            }
            
            .header h1::before {
                content: '';
                width: 20px;
                height: 20px;
                background: #e94560;
                border-radius: 4px;
            }
            
            /* ‰ø°ÊÅØÂç°Áâá */
            .info-row {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .info-card {
                flex: 1;
                background: rgba(255, 255, 255, 0.1);
                backdrop-filter: blur(10px);
                border-radius: 12px;
                padding: 12px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .info-card.large {
                flex: 2;
            }
            
            .info-card-label {
                font-size: 11px;
                color: #888;
                margin-bottom: 5px;
            }
            
            .info-card-value {
                font-size: 13px;
                color: #fff;
                font-family: 'Courier New', monospace;
                word-break: break-all;
            }
            
            .info-card-value.highlight {
                color: #fbbf24;
                font-weight: bold;
            }
            
            /* ÂäüËÉΩÊåâÈíÆÂå∫ */
            .btn-row {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
            }
            
            .btn {
                flex: 1;
                padding: 10px 8px;
                border: none;
                border-radius: 8px;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 3px;
                max-width: 100px;
            }
            
            .btn-primary {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
            }
            
            .btn-success {
                background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
                color: white;
            }
            
            .btn-warning {
                background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
                color: white;
            }
            
            .btn:active {
                transform: scale(0.95);
            }
            
            .btn-icon {
                font-size: 16px;
            }
            
            .btn-row {
                justify-content: center;
            }
            
            /* ÂºÄÂ•ñÊòæÁ§∫Âå∫ */
            .lottery-display {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .lottery-title {
                font-size: 14px;
                color: #888;
                margin-bottom: 12px;
                text-align: center;
            }
            
            .lottery-balls {
                display: flex;
                justify-content: center;
                align-items: center;
                flex-wrap: nowrap;
                gap: 6px;
                overflow-x: auto;
            }
            
            .ball-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1px;
                flex-shrink: 0;
            }
            
            .ball {
                width: 34px;
                height: 34px;
                min-width: 34px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 13px;
                font-weight: bold;
                color: white;
                text-shadow: 1px 1px 2px rgba(0,0,0,0.3);
                box-shadow: 0 4px 8px rgba(0,0,0,0.3), inset 0 -3px 6px rgba(0,0,0,0.2), inset 0 3px 6px rgba(255,255,255,0.3);
                /* Âä®ÁîªÊïàÊûú */
                opacity: 0;
                transform: scale(0.5);
                animation: ballAppear 0.4s ease-out forwards;
                animation-delay: var(--delay, 0s);
            }
            
            @keyframes ballAppear {
                to {
                    opacity: 1;
                    transform: scale(1);
                }
            }
            
            /* Á¶ÅÁî®Âä®ÁîªÊó∂Á´ãÂç≥ÊòæÁ§∫ */
            .ball.no-anim {
                opacity: 1;
                transform: scale(1);
                animation: none;
            }
            
            .ball.red { background: linear-gradient(145deg, #ff6b6b, #c0392b); }
            .ball.blue { background: linear-gradient(145deg, #4dabf7, #2980b9); }
            .ball.green { background: linear-gradient(145deg, #51cf66, #27ae60); }
            
            .ball-info {
                font-size: 10px;
                color: #aaa;
                white-space: nowrap;
                font-weight: 500;
            }
            
            .ball-plus {
                font-size: 14px;
                color: #666;
                margin: 0 1px;
                flex-shrink: 0;
            }
            
            .lottery-empty {
                text-align: center;
                color: #666;
                padding: 20px;
                font-size: 14px;
            }
            
            /* ËæìÂÖ•Ê°ÜÂå∫ */
            .input-section {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
                border: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .input-section-title {
                font-size: 14px;
                color: #888;
                margin-bottom: 10px;
            }
            
            .input-textarea {
                width: 100%;
                height: 200px;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                padding: 12px;
                color: #fff;
                font-size: 14px;
                font-family: 'Courier New', monospace;
                resize: none;
                outline: none;
            }
            
            .input-textarea::placeholder {
                color: #666;
            }
            
            .input-textarea:focus {
                border-color: #e94560;
            }
            
            /* Êìç‰ΩúÊåâÈíÆ */
            .action-row {
                display: flex;
                gap: 10px;
            }
            
            .btn-calculate {
                flex: 2;
                background: linear-gradient(90deg, #e94560, #ff6b6b);
                color: white;
                padding: 16px;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
            }
            
            .btn-clear {
                flex: 1;
                background: rgba(255, 255, 255, 0.1);
                color: #fff;
                padding: 16px;
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 10px;
                font-size: 14px;
                cursor: pointer;
            }
            
            .btn-check {
                flex: 1;
                padding: 16px;
                border: none;
                border-radius: 10px;
                background: linear-gradient(90deg, #9b59b6, #8e44ad);
                color: white;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
            }
            
            /* Ê†∏ÂØπËØ¶ÊÉÖÈ°µÊ†∑Âºè */
            .check-summary {
                background: rgba(0,0,0,0.3);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }
            
            .check-summary-item {
                text-align: center;
            }
            
            .check-summary-label {
                font-size: 12px;
                color: #888;
                margin-bottom: 5px;
            }
            
            .check-summary-value {
                font-size: 18px;
                font-weight: bold;
            }
            
            .check-summary-value.win {
                color: #e74c3c;
            }
            
            .check-summary-value.lose {
                color: #2ecc71;
            }
            
            .check-detail-list {
                display: flex;
                flex-direction: column;
                gap: 10px;
            }
            
            .check-detail-item {
                background: rgba(255,255,255,0.05);
                border-radius: 10px;
                padding: 12px;
                border-left: 3px solid #666;
            }
            
            .check-detail-item.win {
                border-left-color: #e74c3c;
                background: rgba(231, 76, 60, 0.1);
            }
            
            .check-detail-item.lose {
                border-left-color: #2ecc71;
                background: rgba(46, 204, 113, 0.1);
            }
            
            .check-detail-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 8px;
            }
            
            .check-detail-type {
                font-size: 13px;
                color: #fff;
                font-weight: bold;
            }
            
            .check-detail-badge {
                font-size: 11px;
                padding: 2px 8px;
                border-radius: 10px;
                background: #e74c3c;
                color: white;
            }
            
            .check-detail-badge.miss {
                background: #666;
            }
            
            .check-detail-info {
                font-size: 12px;
                color: #888;
                margin-bottom: 5px;
            }
            
            .check-detail-calc {
                font-size: 12px;
                color: #aaa;
                font-family: 'Courier New', monospace;
            }
            
            .check-detail-result {
                font-size: 16px;
                font-weight: bold;
                text-align: right;
                margin-top: 8px;
            }
            
            .check-detail-result.win {
                color: #e74c3c;
            }
            
            .check-detail-result.lose {
                color: #2ecc71;
            }
            
            /* È°µÈù¢ÂàáÊç¢ */
            .page {
                display: none;
            }
            
            .page.active {
                display: block;
            }
            
            /* Â≠êÈ°µÈù¢Â§¥ÈÉ® */
            .page-header {
                display: flex;
                align-items: center;
                padding: 15px 0;
                margin-bottom: 15px;
            }
            
            .btn-back {
                background: none;
                border: none;
                color: #fff;
                font-size: 24px;
                cursor: pointer;
                padding: 5px 15px 5px 0;
            }
            
            .page-title {
                font-size: 18px;
                font-weight: bold;
            }
            
            /* ËÆæÁΩÆÈ°π */
            .setting-group {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
            }
            
            .setting-group-title {
                font-size: 14px;
                color: #e94560;
                margin-bottom: 15px;
                font-weight: bold;
            }
            
            .setting-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            }
            
            .setting-item:last-child {
                border-bottom: none;
            }
            
            .setting-label {
                font-size: 14px;
            }
            
            .setting-input {
                width: 100px;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 6px;
                padding: 8px 12px;
                color: #fbbf24;
                font-size: 14px;
                text-align: right;
                outline: none;
            }
            
            .setting-input:focus {
                border-color: #e94560;
            }
            
            /* ÂèÇÁÖßË°® */
            .ref-table-wrap {
                overflow-x: auto;
                margin-top: 5px;
            }
            
            .ref-table {
                width: 100%;
                border-collapse: collapse;
                font-size: 13px;
            }
            
            .ref-table th {
                background: rgba(233, 69, 96, 0.3);
                padding: 10px 8px;
                text-align: left;
                color: #fff;
                font-weight: bold;
                white-space: nowrap;
            }
            
            .ref-table td {
                padding: 10px 8px;
                border-bottom: 1px solid rgba(255, 255, 255, 0.1);
                color: #ddd;
            }
            
            .ref-table tr:nth-child(even) {
                background: rgba(255, 255, 255, 0.03);
            }
            
            .ref-table .num-red { color: #e74c3c; font-weight: bold; }
            .ref-table .num-blue { color: #3498db; font-weight: bold; }
            .ref-table .num-green { color: #2ecc71; font-weight: bold; }
            
            /* ÊøÄÊ¥ªÈ°µÈù¢ */
            .machine-code-display {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                padding: 15px;
                text-align: center;
                margin-bottom: 15px;
            }
            
            .machine-code-value {
                font-family: 'Courier New', monospace;
                font-size: 20px;
                color: #fbbf24;
                letter-spacing: 2px;
            }
            
            .license-input {
                width: 100%;
                background: rgba(0, 0, 0, 0.3);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                padding: 15px;
                color: #fff;
                font-size: 16px;
                font-family: 'Courier New', monospace;
                text-align: center;
                outline: none;
                margin-bottom: 15px;
            }
            
            .btn-activate {
                width: 100%;
                background: linear-gradient(90deg, #27ae60, #2ecc71);
                color: white;
                padding: 16px;
                border: none;
                border-radius: 10px;
                font-size: 16px;
                font-weight: bold;
                cursor: pointer;
            }
            
            /* AIÊ®°ÂûãÂàáÊç¢ÊåâÈíÆ */
            .ai-model-btn {
                flex: 1;
                min-width: 60px;
                padding: 10px 12px;
                background: rgba(255, 255, 255, 0.1);
                border: 1px solid rgba(255, 255, 255, 0.2);
                border-radius: 8px;
                color: #ccc;
                font-size: 12px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s;
            }
            .ai-model-btn:hover {
                background: rgba(255, 255, 255, 0.15);
                border-color: rgba(255, 255, 255, 0.3);
            }
            .ai-model-btn.active {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                border-color: #667eea;
                color: white;
                box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
            }
            .ai-model-btn.disabled {
                opacity: 0.5;
                cursor: not-allowed;
            }
            
            /* Â§öÊ®°ÂûãÂØπÊØîÊ†áÁ≠æ */
            .model-tab {
                flex: 1;
                padding: 10px 8px;
                background: transparent;
                border: none;
                border-bottom: 2px solid transparent;
                color: #888;
                cursor: pointer;
                transition: all 0.3s;
                text-align: center;
            }
            .model-tab:hover {
                background: rgba(255,255,255,0.05);
            }
            .model-tab.active {
                color: #fff;
                border-bottom-color: #667eea;
                background: rgba(102,126,234,0.1);
            }
            .model-tab.success {
                color: #81c784;
            }
            .model-tab.error {
                color: #ef5350;
            }
            .model-tab.warning {
                color: #ffa726;
            }
            .model-tab-name {
                font-size: 12px;
                font-weight: 600;
            }
            .model-tab-time {
                font-size: 10px;
                margin-top: 2px;
                opacity: 0.8;
            }
            
            .status-card {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
                text-align: center;
            }
            
            .status-label {
                font-size: 12px;
                color: #888;
            }
            
            .status-value {
                font-size: 18px;
                font-weight: bold;
                margin-top: 5px;
            }
            
            .status-value.active { color: #2ecc71; }
            .status-value.trial { color: #f39c12; }
            .status-value.expired { color: #e74c3c; }
            
            /* ÁªìÊûúÊòæÁ§∫ */
            .result-section {
                background: rgba(255, 255, 255, 0.05);
                border-radius: 12px;
                padding: 15px;
                margin-bottom: 15px;
                display: none;
            }
            
            .result-section.show {
                display: block;
            }
            
            .result-title {
                font-size: 14px;
                color: #e94560;
                margin-bottom: 10px;
                font-weight: bold;
            }
            
            .result-content {
                background: rgba(0, 0, 0, 0.3);
                border-radius: 8px;
                padding: 12px;
                font-family: 'Courier New', monospace;
                font-size: 13px;
                white-space: pre-wrap;
                word-break: break-all;
                max-height: 300px;
                overflow-y: auto;
            }
            
            .result-buttons {
                display: flex;
                gap: 10px;
                margin-top: 10px;
            }
            
            .btn-copy-result {
                flex: 1;
                background: linear-gradient(90deg, #3498db, #2980b9);
                color: white;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
            }
            
            .btn-feedback {
                flex: 1;
                background: linear-gradient(90deg, #e74c3c, #c0392b);
                color: white;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-size: 13px;
                font-weight: bold;
                cursor: pointer;
            }

            /* ÂºÄÂ•ñËæìÂÖ• */
            .lottery-input-row {
                display: flex;
                gap: 8px;
                margin-bottom: 15px;
                flex-wrap: wrap;
            }
            
            .lottery-num-input {
                width: 45px;
                height: 45px;
                background: rgba(0, 0, 0, 0.3);
                border: 2px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                color: #fff;
                font-size: 16px;
                font-weight: bold;
                text-align: center;
                outline: none;
            }
            
            .lottery-num-input:focus {
                border-color: #e94560;
            }
            
            .lottery-num-input.special {
                border-color: #fbbf24;
                color: #fbbf24;
            }
            
            .plus-sign {
                display: flex;
                align-items: center;
                font-size: 20px;
                color: #666;
            }
            
            .num-input-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 4px;
            }
            
            .num-label {
                font-size: 10px;
                color: #888;
            }
            
            .lottery-num-input {
                width: 40px;
                height: 40px;
                background: rgba(0, 0, 0, 0.4);
                border: 2px solid rgba(255, 255, 255, 0.2);
                border-radius: 50%;
                color: #fff;
                font-size: 14px;
                font-weight: bold;
                text-align: center;
                outline: none;
            }
            
            .lottery-num-input:focus {
                border-color: #e94560;
            }
            
            .lottery-num-input.special {
                border-color: #fbbf24;
                color: #fbbf24;
            }
            
            .lottery-num-input.special:focus {
                border-color: #fbbf24;
                box-shadow: 0 0 8px rgba(251, 191, 36, 0.5);
            }
            
            .lottery-input-row {
                display: flex;
                gap: 8px;
                margin-bottom: 15px;
                flex-wrap: wrap;
                align-items: flex-end;
            }
            
            /* ÂØºÂÖ•ÂØºÂá∫ÊåâÈíÆ */
            .config-btn-row {
                display: flex;
                gap: 10px;
                margin-bottom: 15px;
                justify-content: center;
            }
            
            .btn-config {
                padding: 8px 16px;
                border: 1px solid rgba(255,255,255,0.2);
                border-radius: 6px;
                font-size: 12px;
                cursor: pointer;
                transition: all 0.3s;
                background: rgba(255,255,255,0.1);
                color: #fff;
            }
            
            .btn-config:active {
                transform: scale(0.95);
            }
            
            .btn-export {
                border-color: #3498db;
                color: #3498db;
            }
            
            .btn-import {
                border-color: #2ecc71;
                color: #2ecc71;
            }
            
            /* ÂØºÂÖ•ÂºπÁ™ó */
            .import-modal {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                z-index: 1000;
                align-items: center;
                justify-content: center;
                padding: 20px;
            }
            
            .import-modal.show {
                display: flex;
            }
            
            .import-modal-content {
                background: #1a1a2e;
                border-radius: 12px;
                padding: 20px;
                width: 100%;
                max-width: 400px;
                border: 1px solid rgba(255,255,255,0.1);
            }
            
            .import-modal-title {
                font-size: 16px;
                font-weight: bold;
                margin-bottom: 15px;
                color: #2ecc71;
            }
            
            .import-textarea {
                width: 100%;
                height: 150px;
                background: rgba(0,0,0,0.3);
                border: 1px solid rgba(255,255,255,0.2);
                border-radius: 8px;
                color: #fff;
                padding: 10px;
                font-size: 12px;
                font-family: 'Courier New', monospace;
                resize: none;
                margin-bottom: 15px;
            }
            
            .import-modal-btns {
                display: flex;
                gap: 10px;
            }
            
            .import-modal-btns button {
                flex: 1;
                padding: 12px;
                border: none;
                border-radius: 8px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
            }
            
            .btn-import-confirm {
                background: linear-gradient(90deg, #2ecc71, #27ae60);
                color: white;
            }
            
            .btn-import-cancel {
                background: rgba(255,255,255,0.1);
                color: #888;
            }
            
            /* ËµîÁéáËÆæÁΩÆÊñ∞Â∏ÉÂ±Ä */
            .odds-layout {
                display: flex;
                height: calc(100vh - 120px);
                gap: 0;
            }
            
            .odds-menu {
                width: 90px;
                background: rgba(0,0,0,0.3);
                border-radius: 10px 0 0 10px;
                overflow-y: auto;
                flex-shrink: 0;
            }
            
            .odds-menu-item {
                padding: 15px 10px;
                text-align: center;
                font-size: 13px;
                color: #888;
                cursor: pointer;
                border-bottom: 1px solid rgba(255,255,255,0.05);
                transition: all 0.3s;
            }
            
            .odds-menu-item:hover {
                background: rgba(255,255,255,0.05);
            }
            
            .odds-menu-item.active {
                background: rgba(233, 69, 96, 0.2);
                color: #e94560;
                border-left: 3px solid #e94560;
            }
            
            .odds-content {
                flex: 1;
                background: rgba(0,0,0,0.2);
                border-radius: 0 10px 10px 0;
                padding: 15px;
                overflow-y: auto;
            }
            
            .odds-panel {
                display: none;
            }
            
            .odds-panel.active {
                display: block;
            }
            
            .odds-panel-title {
                font-size: 14px;
                color: #e94560;
                margin-bottom: 15px;
                padding-bottom: 10px;
                border-bottom: 1px solid rgba(255,255,255,0.1);
            }
            
            .odds-item {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 12px 0;
                border-bottom: 1px solid rgba(255,255,255,0.05);
            }
            
            .odds-item-label {
                font-size: 13px;
                color: #ccc;
            }
            
            .odds-item-input {
                width: 80px;
                background: rgba(0,0,0,0.3);
                border: 1px solid rgba(255,255,255,0.2);
                border-radius: 6px;
                color: #fff;
                padding: 8px;
                font-size: 14px;
                text-align: center;
            }
            
            .odds-note {
                font-size: 12px;
                color: #888;
                padding: 8px 10px;
                background: rgba(0,0,0,0.2);
                border-radius: 6px;
                margin-bottom: 10px;
                border-left: 3px solid #e94560;
            }
            
            .odds-save-btn {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: linear-gradient(90deg, #e94560, #c23a51);
                color: white;
                padding: 12px 40px;
                border: none;
                border-radius: 25px;
                font-size: 14px;
                font-weight: bold;
                cursor: pointer;
                box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
            }
        </style>
    </head>
    <body>
        <div class="container">
            <!-- ‰∏ªÈ°µÈù¢ -->
            <div class="page active" id="page-main">
                <div class="header">
                    <h1 style="color:#e94560;">üöÄÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô®</h1>
                </div>
                
                <!-- ÂäüËÉΩÊåâÈíÆ - 4‰∏™ -->
                <div class="btn-row">
                    <button class="btn btn-primary" onclick="showPage('page-lottery')">
                        <span class="btn-icon">üéØ</span>
                        <span>ÂºÄÂ•ñËÆæÁΩÆ</span>
                    </button>
                    <button class="btn btn-success" onclick="showPage('page-odds')">
                        <span class="btn-icon">‚öôÔ∏è</span>
                        <span>ËµîÁéáËÆæÁΩÆ</span>
                    </button>
                    <button class="btn" onclick="showPage('page-format')" style="background:linear-gradient(135deg,#e91e63,#9c27b0);">
                        <span class="btn-icon">‚úèÔ∏è</span>
                        <span>Ëá™ÂÆö‰πâÊ†ºÂºè</span>
                    </button>
                    <button class="btn btn-warning" onclick="showPage('page-params')">
                        <span class="btn-icon">üîß</span>
                        <span>ÂèÇÊï∞ËÆæÁΩÆ</span>
                    </button>
                </div>
                
                <!-- ÂºÄÂ•ñÊòæÁ§∫ - ‰∏ä‰∏ãÂ∏ÉÂ±Ä -->
                <div class="lottery-display" style="padding:10px;">
                    <!-- È°∂ÈÉ®ÔºöÊ†áÈ¢ò + ÂàáÊç¢ÊåâÈíÆ -->
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                        <div style="display:flex;align-items:center;gap:6px;">
                            <span id="lottery-type-name" style="color:#e94560;font-weight:bold;font-size:15px;">Êñ∞Êæ≥</span>
                            <span id="lottery-issue" style="color:#888;font-size:12px;">Á¨¨xxxÊúü</span>
                            <span style="color:#888;font-size:12px;">ÂºÄÂ•ñÁªìÊûú</span>
                        </div>
                        <div style="display:flex;gap:6px;align-items:center;">
                            <button id="btn-hk" onclick="switchLotteryType('hk')" class="lottery-switch-btn" style="padding:5px 12px;border-radius:5px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #4CAF50;background:transparent;color:#4CAF50;">È¶ôÊ∏Ø</button>
                            <button id="btn-xam" onclick="switchLotteryType('xam')" class="lottery-switch-btn active" style="padding:5px 12px;border-radius:5px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #e94560;background:transparent;color:#e94560;">Êñ∞Êæ≥</button>
                        </div>
                    </div>
                    <!-- ‰∏ãÊñπÔºöÂºÄÂ•ñÂè∑Á†ÅÔºàÁ¥ßÂáëÂ∏ÉÂ±ÄÔºâ+ Â§çÂà∂ÊåâÈíÆ -->
                    <div style="display:flex;align-items:center;gap:8px;">
                        <div class="lottery-balls" id="lottery-balls" style="gap:4px;justify-content:flex-start;flex:1;">
                            <div class="lottery-empty">ËØ∑ÂÖàËÆæÁΩÆÂºÄÂ•ñÂè∑Á†Å</div>
                        </div>
                        <button onclick="copyLotteryResult()" style="padding:6px 12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:12px;cursor:pointer;white-space:nowrap;flex-shrink:0;">Â§çÂà∂</button>
                    </div>
                </div>
                
                <!-- ËæìÂÖ•Ê°Ü - Ê†áÈ¢òË°åÂ∏¶ÊåâÈíÆ -->
                <div class="input-section" style="flex:1;display:flex;flex-direction:column;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <div class="input-section-title" style="margin-bottom:0;">Á≤òË¥¥‰∏ãÊ≥®‰ø°ÊÅØ</div>
                        <div style="display:flex;gap:6px;align-items:center;">
                            <!-- Ë∞ÉËØïÊåâÈíÆ -->
                            <button onclick="showAIDebug()" style="padding:4px 8px;background:linear-gradient(90deg,#9b59b6,#8e44ad);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="Êü•ÁúãAIËØÜÂà´ËØ¶ÊÉÖ">ü§ñAI</button>
                            <button onclick="showLocalDebug()" style="padding:4px 8px;background:linear-gradient(90deg,#27ae60,#229954);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="Êü•ÁúãÁ®ãÂ∫èËØÜÂà´ËØ¶ÊÉÖ">üìãÁ®ãÂ∫è</button>
                            <!-- Â§öÊ®°ÂûãÂØπÊØîÊåâÈíÆ - Áõ¥Êé•ÊâìÂºÄÂºπÁ™óÔºåÊîØÊåÅËæπÁºòÊµãËØï -->
                            <button onclick="openMultiModelModal()" style="padding:4px 8px;background:linear-gradient(90deg,#f39c12,#e67e22);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="Â§öÊ®°ÂûãÂØπÊØîÊµãËØï">üî¨ÂØπÊØî</button>
                            <!-- ÂàÜÁªÑÁºñËæëÊåâÈíÆ -->
                            <button onclick="showGroupEditor()" style="padding:4px 8px;background:linear-gradient(90deg,#667eea,#764ba2);color:white;border:none;border-radius:4px;font-size:10px;cursor:pointer;" title="ÊâãÂä®ÁºñËæëÂàÜÁªÑ">üì¶ÂàÜÁªÑ</button>
                            <!-- ÂéüÊúâÊåâÈíÆ -->
                            <button onclick="showCheckDetail()" style="padding:6px 12px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:6px;font-size:12px;cursor:pointer;">üîç Ê†∏ÂØπ</button>
                            <button onclick="clearInput()" style="padding:6px 12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:12px;cursor:pointer;">Ê∏ÖÁ©∫</button>
                            <button onclick="calculateBets()" style="padding:6px 12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;">üìä ÂºÄÂßãËÆ°ÁÆó</button>
                        </div>
                    </div>
                    <textarea class="input-textarea" id="bet-input" style="flex:1;min-height:200px;" placeholder="Á≤òË¥¥‰∏ãÊ≥®‰ø°ÊÅØÔºåÊîØÊåÅÊô∫ËÉΩÂàÜÁªÑËÆ°ÁÆóÁõà‰∫è

üìå ÂàÜÁªÑËßÑÂàôÔºöÁ©∫‰∏ÄË°å = ÂàÜÈöî‰∏çÂêåÁªÑ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
‰π∞Áå™ÂêÑ10
Áâπ43 20ÂÖÉ
                    ‚Üê Á©∫Ë°åÂàÜÈöî
39x200
31.34ÂêÑ‰∫åÂçÅ
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí° ‰πüÂèØÁÇπÂáª„Äåüì¶ÂàÜÁªÑ„ÄçÊåâÈíÆÊâãÂä®ÁºñËæëÂàÜÁªÑ

üìù ÊîØÊåÅÊ†ºÂºèÔºö
‚Ä¢ ÁîüËÇñÔºö‰π∞Áå™ÂêÑ10„ÄÅÈæôx10„ÄÅÁå¥È∏°x50
‚Ä¢ ÁâπÁ†ÅÔºöÁâπ43 20ÂÖÉ„ÄÅ31.34ÂêÑ‰∫åÂçÅ
‚Ä¢ Â§öÂè∑Ôºö10 12 20 22ÂêÑ20"></textarea>
                </div>
                
                <!-- ÁªìÊûúÊòæÁ§∫ -->
                <div class="result-section" id="result-section">
                    <div class="result-title">ËÆ°ÁÆóÁªìÊûú</div>
                    <div class="result-content" id="result-content"></div>
                    <div class="result-buttons">
                        <button class="btn-copy-result" onclick="copyResult()">üìã Â§çÂà∂ÁªìÊûú</button>
                        <button class="btn-feedback" onclick="showFeedbackModal()">‚ùå ÁªìÊûúÊúâËØØÔºüÊèê‰∫§ÂèçÈ¶à</button>
                    </div>
                </div>
            </div>
            
            <!-- ÂºÄÂ•ñËÆæÁΩÆÈ°µÈù¢ -->
            <div class="page" id="page-lottery">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">ÂºÄÂ•ñËÆæÁΩÆ</div>
                </div>
                
                <!-- Âø´ÈÄüÁ≤òË¥¥Ëß£Êûê -->
                <div class="setting-group" style="padding:12px;">
                    <!-- Ê†áÈ¢òË°åÔºöÊ†áÈ¢ò + ÊåâÈíÆ -->
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                        <div class="setting-group-title" style="margin-bottom:0;">Âø´ÈÄüÁ≤òË¥¥ÂºÄÂ•ñÂè∑Á†Å</div>
                        <button onclick="parseLotteryInput()" style="padding:6px 15px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;">
                            üîç Ëß£ÊûêÂπ∂Â°´ÂÖ•
                        </button>
                    </div>
                    <!-- Â§ßËæìÂÖ•Ê°Ü -->
                    <textarea id="paste-lottery-input" placeholder="Á§∫ËåÉËæìÂÖ•Ê†ºÂºèÔºö&#10;01 08 09 15 24 26 Áâπ27&#10;01.08.09.15.24.26.27&#10;01,08,09,15,24,26 Áâπ27" style="width:100%;height:100px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;padding:12px;font-size:15px;resize:none;line-height:1.6;"></textarea>
                    <!-- Ëß£ÊûêÈ¢ÑËßà -->
                    <div id="parse-preview" style="display:none;margin-top:8px;padding:8px;background:rgba(0,0,0,0.3);border-radius:8px;text-align:center;">
                        <div id="parse-preview-balls" style="display:flex;justify-content:center;align-items:center;gap:5px;flex-wrap:nowrap;"></div>
                    </div>
                </div>
                
                <div class="setting-group" style="padding:12px;">
                    <!-- Ê†áÈ¢òË°åÔºöÊ†áÈ¢ò + ÊåâÈíÆ -->
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                        <div class="setting-group-title" style="margin-bottom:0;">ÂºÄÂ•ñÂè∑Á†Å</div>
                        <button onclick="saveLotteryNumbers()" style="padding:6px 15px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:6px;font-size:13px;cursor:pointer;">‰øùÂ≠òÂºÄÂ•ñÂè∑Á†Å</button>
                    </div>
                    <!-- ÂçïË°åÊòæÁ§∫7‰∏™ËæìÂÖ•Ê°Ü -->
                    <div style="display:flex;align-items:center;justify-content:center;gap:4px;flex-wrap:nowrap;">
                        <input type="text" class="lottery-num-input" id="num1" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <input type="text" class="lottery-num-input" id="num2" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <input type="text" class="lottery-num-input" id="num3" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <input type="text" class="lottery-num-input" id="num4" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <input type="text" class="lottery-num-input" id="num5" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <input type="text" class="lottery-num-input" id="num6" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #555;color:#fff;">
                        <span style="color:#e94560;font-weight:bold;font-size:16px;margin:0 2px;">+</span>
                        <input type="text" class="lottery-num-input special" id="num-special" maxlength="2" oninput="formatNumInput(this)" onblur="padNumInput(this)" style="width:36px;height:36px;border-radius:50%;text-align:center;font-size:14px;font-weight:bold;background:#333;border:2px solid #f5a623;color:#f5a623;">
                    </div>
                    <div style="display:flex;justify-content:center;gap:4px;margin-top:4px;font-size:10px;color:#666;">
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:36px;text-align:center;">Âπ≥Á†Å</span>
                        <span style="width:20px;"></span>
                        <span style="width:36px;text-align:center;color:#f5a623;">Áâπ</span>
                    </div>
                </div>
                
                <!-- ÂéÜÂè≤ËÆ∞ÂΩïÈÄâÊã© -->
                <div class="setting-group" style="padding:12px;">
                    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
                        <div class="setting-group-title" style="margin-bottom:0;">üìú ÂéÜÂè≤ÂºÄÂ•ñËÆ∞ÂΩïÔºàÊúÄËøë10ÊúüÔºâ</div>
                        <button onclick="fetchHistoryData()" style="padding:5px 10px;background:linear-gradient(90deg,#9b59b6,#8e44ad);color:white;border:none;border-radius:5px;font-size:11px;cursor:pointer;">üîÑ ÊâãÂä®Ëé∑Âèñ</button>
                    </div>
                    
                    <!-- ÂΩ©ÁßçÈÄâÊã©Ê†áÁ≠æ -->
                    <div style="display:flex;gap:6px;margin-bottom:10px;">
                        <button id="history-btn-xam" onclick="switchHistoryType('xam')" class="history-type-btn active" style="flex:1;padding:8px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #e94560;background:rgba(233,69,96,0.2);color:#e94560;">Êñ∞Êæ≥Èó®</button>
                        <button id="history-btn-hk" onclick="switchHistoryType('hk')" class="history-type-btn" style="flex:1;padding:8px;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;border:2px solid #4CAF50;background:transparent;color:#4CAF50;">È¶ôÊ∏Ø</button>
                    </div>
                    
                    <!-- ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®ÔºàÂèØÊªëÂä®Ôºâ -->
                    <div id="history-list" style="max-height:220px;overflow-y:auto;background:rgba(0,0,0,0.2);border-radius:8px;padding:6px;-webkit-overflow-scrolling:touch;">
                        <div style="text-align:center;color:#666;font-size:12px;padding:20px;">üîÑ Ê≠£Âú®Ëá™Âä®Âä†ËΩΩÂéÜÂè≤ËÆ∞ÂΩï...</div>
                    </div>
                    
                    <!-- ÂºÄÂ•ñÊó∂Èó¥ÊèêÁ§∫ -->
                    <div style="font-size:10px;color:#666;text-align:center;margin-top:8px;">
                        ‚è∞ ÂºÄÂ•ñÊó∂Èó¥ÔºöÊñ∞Êæ≥Èó® 21:30 | È¶ôÊ∏Ø 21:30ÔºàÂë®‰∫åÂõõÂÖ≠Ôºâ| Êæ≥Èó® 22:30
                    </div>
                </div>
                
                <!-- Ëá™Âä®Ëé∑ÂèñÂºÄÂ•ñ -->
                <div class="setting-group" style="padding:12px;">
                    <div class="setting-group-title" style="margin-bottom:10px;">üì° Ëá™Âä®Ëé∑ÂèñÂºÄÂ•ñÊï∞ÊçÆ</div>
                    
                    <!-- ÂΩ©ÁßçÈÄâÊã© -->
                    <div style="display:flex;gap:8px;margin-bottom:10px;">
                        <select id="lottery-type-select" style="flex:1;padding:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:8px;color:#fff;font-size:14px;">
                            <option value="xam" selected>üá≤üá¥ Êñ∞Êæ≥Èó®ÂÖ≠ÂêàÂΩ©</option>
                            <option value="hk">üá≠üá∞ È¶ôÊ∏ØÂÖ≠ÂêàÂΩ©</option>
                            <option value="am">üá≤üá¥ „ä£Êæ≥Èó®ÂÖ≠ÂêàÂΩ©</option>
                        </select>
                        <button onclick="fetchLotteryData()" style="padding:10px 20px;background:linear-gradient(90deg,#4CAF50,#45a049);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;white-space:nowrap;">
                            üì° Ëé∑ÂèñÊúÄÊñ∞
                        </button>
                    </div>
                    
                    <!-- Ëé∑ÂèñÁä∂ÊÄÅÊòæÁ§∫ -->
                    <div id="fetch-status" style="display:none;padding:10px;background:rgba(0,0,0,0.3);border-radius:8px;font-size:13px;text-align:center;"></div>
                    
                    <!-- APIÊù•Ê∫êÊèêÁ§∫ -->
                    <div style="font-size:11px;color:#666;text-align:center;margin-top:8px;">
                        Êï∞ÊçÆÊù•Ê∫êÔºöMarksix6ÔºàËá™Âä®Ëé∑ÂèñÔºâ
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">Â±ûÊÄßÂèÇÁÖßË°®</div>
                    <button class="btn btn-primary" onclick="showPage('page-reference')" style="width:100%;max-width:none;">
                        <span>üìñ Êü•ÁúãÁîüËÇñ/Ê≥¢Ëâ≤/‰∫îË°åÂØπÁÖßË°®</span>
                    </button>
                </div>
            </div>
            
            <!-- ËµîÁéáËÆæÁΩÆÈ°µÈù¢ -->
            <div class="page" id="page-odds">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">ËµîÁéáËÆæÁΩÆ</div>
                </div>
                
                <div class="odds-layout">
                    <!-- Â∑¶‰æßËèúÂçïÔºàÊåâÁî®Êà∑Êèê‰æõÁöÑÁé©Ê≥ïÁ±ªÂûãÔºâ -->
                    <div class="odds-menu">
                        <div class="odds-menu-item active" onclick="showOddsPanel('tema')">ÁâπÁ†Å</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('daxiao')">Â§ßÂ∞èÂçïÂèå</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('pingte')">Âπ≥Áâπ‰∏ÄËÇñ</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('pingte2')">Âπ≥ÁâπËøûËÇñ</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('pingtew')">Âπ≥ÁâπÂ∞æÊï∞</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('liuxiao')">ÂÖ≠ËÇñ</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('texiao')">ÁâπËÇñ</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('danping')">ÂçïÂπ≥(Âπ≥Á†Å)</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('bose')">Ê≥¢Ëâ≤</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('banbo')">ÂçäÊ≥¢</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('lianma')">ËøûÁ†Å</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('buzhong')">‰∏ç‰∏≠</div>
                        <div class="odds-menu-item" onclick="showOddsPanel('qita')">ÂÖ∂‰ªñ</div>
                    </div>
                    
                    <!-- Âè≥‰æßÂÜÖÂÆπÔºàÊåâÊñ∞Áé©Ê≥ïÁ±ªÂûãÔºâ -->
                    <div class="odds-content">
                        <!-- ÁâπÁ†Å -->
                        <div class="odds-panel active" id="panel-tema">
                            <div class="odds-panel-title">ÁâπÁ†ÅËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁâπÁ†Å</span>
                                <input type="number" class="odds-item-input" id="odds-tema" value="43">
                            </div>
                        </div>
                        
                        <!-- Â§ßÂ∞èÂçïÂèå -->
                        <div class="odds-panel" id="panel-daxiao">
                            <div class="odds-panel-title">Â§ßÂ∞èÂçïÂèåËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Â§ß</span>
                                <input type="number" class="odds-item-input" id="odds-da" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Â∞è</span>
                                <input type="number" class="odds-item-input" id="odds-xiao" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âçï</span>
                                <input type="number" class="odds-item-input" id="odds-dan" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âèå</span>
                                <input type="number" class="odds-item-input" id="odds-shuang" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàÂ§ß</span>
                                <input type="number" class="odds-item-input" id="odds-heda" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàÂ∞è</span>
                                <input type="number" class="odds-item-input" id="odds-hexiao" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàÂçï</span>
                                <input type="number" class="odds-item-input" id="odds-hedan" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàÂèå</span>
                                <input type="number" class="odds-item-input" id="odds-heshuang" value="1.98" step="0.01">
                            </div>
                        </div>
                        
                        <!-- Âπ≥Áâπ‰∏ÄËÇñ -->
                        <div class="odds-panel" id="panel-pingte">
                            <div class="odds-panel-title">Âπ≥Áâπ‰∏ÄËÇñËµîÁéáÔºàÂà´ÂêçÔºö‰∏ÄÂèãÔºâ</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥Áâπ‰∏ÄËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-pingte1" value="11" step="0.1">
                            </div>
                        </div>
                        
                        <!-- Âπ≥ÁâπËøûËÇñ -->
                        <div class="odds-panel" id="panel-pingte2">
                            <div class="odds-panel-title">Âπ≥ÁâπËøûËÇñËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥Áâπ‰∫åËøûËÇñÔºà‰∫åÂèãÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-pingte2x" value="26" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥Áâπ‰∏âËøûËÇñÔºà‰∏âÂèãÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-pingte3x" value="66" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥ÁâπÂõõËøûËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-pingte4x" value="180" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥Áâπ‰∫îËøûËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-pingte5x" value="500" step="0.1">
                            </div>
                        </div>
                        
                        <!-- Âπ≥ÁâπÂ∞æÊï∞ -->
                        <div class="odds-panel" id="panel-pingtew">
                            <div class="odds-panel-title">Âπ≥ÁâπÂ∞æÊï∞ËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Âπ≥ÁâπÂ∞æÊï∞</span>
                                <input type="number" class="odds-item-input" id="odds-pingtew" value="2.8" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ÂÖ≠ËÇñ -->
                        <div class="odds-panel" id="panel-liuxiao">
                            <div class="odds-panel-title">ÂÖ≠ËÇñËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂÖ≠ËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-liuxiao" value="4.2" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ÁâπËÇñ -->
                        <div class="odds-panel" id="panel-texiao">
                            <div class="odds-panel-title">ÁâπËÇñËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁâπËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-texiao" value="12" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ÂçïÂπ≥ÔºàÂπ≥Á†ÅÔºâ -->
                        <div class="odds-panel" id="panel-danping">
                            <div class="odds-panel-title">ÂçïÂπ≥ÔºàÂπ≥Á†ÅÔºâËµîÁéá</div>
                            <div class="odds-note">ËØ¥ÊòéÔºöÊåáÈô§ÁâπÁ†ÅÂ§ñÁöÑ6‰∏™Ê≠£Á†Å</div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂçïÂπ≥/Âπ≥Á†Å</span>
                                <input type="number" class="odds-item-input" id="odds-danping" value="8" step="0.1">
                            </div>
                        </div>
                        
                        <!-- Ê≥¢Ëâ≤ -->
                        <div class="odds-panel" id="panel-bose">
                            <div class="odds-panel-title">Ê≥¢Ëâ≤ËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Á∫¢Ê≥¢</span>
                                <input type="number" class="odds-item-input" id="odds-red" value="2.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ËìùÊ≥¢</span>
                                <input type="number" class="odds-item-input" id="odds-blue" value="2.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁªøÊ≥¢</span>
                                <input type="number" class="odds-item-input" id="odds-green" value="2.8" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ÂçäÊ≥¢ -->
                        <div class="odds-panel" id="panel-banbo">
                            <div class="odds-panel-title">ÂçäÊ≥¢ËµîÁéá</div>
                            <div class="odds-note">Ê†ºÂºèÔºöÊ≥¢Ëâ≤+Â§ßÂ∞è/ÂçïÂèåÔºåÂ¶ÇÔºöÁ∫¢Âçï„ÄÅËìùÂèå„ÄÅÁªøÂ§ß</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Á∫¢Â§ß</span>
                                <input type="number" class="odds-item-input" id="odds-red-da" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Á∫¢Â∞è</span>
                                <input type="number" class="odds-item-input" id="odds-red-xiao" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Á∫¢Âçï</span>
                                <input type="number" class="odds-item-input" id="odds-red-dan" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Á∫¢Âèå</span>
                                <input type="number" class="odds-item-input" id="odds-red-shuang" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ËìùÂ§ß</span>
                                <input type="number" class="odds-item-input" id="odds-blue-da" value="5" step="0.1">
                        </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ËìùÂ∞è</span>
                                <input type="number" class="odds-item-input" id="odds-blue-xiao" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ËìùÂçï</span>
                                <input type="number" class="odds-item-input" id="odds-blue-dan" value="5" step="0.1">
                        </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ËìùÂèå</span>
                                <input type="number" class="odds-item-input" id="odds-blue-shuang" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁªøÂ§ß</span>
                                <input type="number" class="odds-item-input" id="odds-green-da" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁªøÂ∞è</span>
                                <input type="number" class="odds-item-input" id="odds-green-xiao" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁªøÂçï</span>
                                <input type="number" class="odds-item-input" id="odds-green-dan" value="5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÁªøÂèå</span>
                                <input type="number" class="odds-item-input" id="odds-green-shuang" value="5" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ËøûÁ†Å -->
                        <div class="odds-panel" id="panel-lianma">
                            <div class="odds-panel-title">ËøûÁ†ÅËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫å‰∏≠‰∫å</span>
                                <input type="number" class="odds-item-input" id="odds-2z2" value="42" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∏â‰∏≠‰∏â</span>
                                <input type="number" class="odds-item-input" id="odds-3z3" value="200" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫åÂÖ®‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-2qz" value="21" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∏âÂÖ®‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-3qz" value="75" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫å‰∏≠Áâπ</span>
                                <input type="number" class="odds-item-input" id="odds-2zt" value="8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∏â‰∏≠Áâπ</span>
                                <input type="number" class="odds-item-input" id="odds-3zt" value="25" step="0.1">
                        </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Áâπ‰∏≤</span>
                                <input type="number" class="odds-item-input" id="odds-techuan" value="4.5" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ‰∏ç‰∏≠ -->
                        <div class="odds-panel" id="panel-buzhong">
                            <div class="odds-panel-title">‰∏ç‰∏≠ËµîÁéáÔºàËá™ÈÄâ‰∏ç‰∏≠Ôºâ</div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫î‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-5bz" value="2.2" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂÖ≠‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-6bz" value="2.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∏É‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-7bz" value="3.6" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂÖ´‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-8bz" value="4.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰πù‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-9bz" value="6.5" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂçÅ‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-10bz" value="9" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂçÅ‰∏Ä‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-11bz" value="12" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂçÅ‰∫å‰∏ç‰∏≠</span>
                                <input type="number" class="odds-item-input" id="odds-12bz" value="16" step="0.1">
                            </div>
                        </div>
                        
                        <!-- ÂÖ∂‰ªñÁé©Ê≥ï -->
                        <div class="odds-panel" id="panel-qita">
                            <div class="odds-panel-title">ÂÖ∂‰ªñÁé©Ê≥ïËµîÁéá</div>
                            <div class="odds-item">
                                <span class="odds-item-label">Ê≠£ËÇñ</span>
                                <input type="number" class="odds-item-input" id="odds-zhengxiao" value="2" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàËÇñÔºà2ËÇñÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-hexiao2" value="6" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàËÇñÔºà3ËÇñÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-hexiao3" value="4" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂêàËÇñÔºà4ËÇñÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-hexiao4" value="3" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÊÄªÂíåÂ§ß</span>
                                <input type="number" class="odds-item-input" id="odds-zongda" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÊÄªÂíåÂ∞è</span>
                                <input type="number" class="odds-item-input" id="odds-zongxiao" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÊÄªÂíåÂçï</span>
                                <input type="number" class="odds-item-input" id="odds-zongdan" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÊÄªÂíåÂèå</span>
                                <input type="number" class="odds-item-input" id="odds-zongshuang" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÂÆ∂Á¶Ω</span>
                                <input type="number" class="odds-item-input" id="odds-jiaqin" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">ÈáéÂÖΩ</span>
                                <input type="number" class="odds-item-input" id="odds-yeshou" value="1.98" step="0.01">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Â§¥Êï∞Ôºà0-4Â§¥Ôºâ</span>
                                <input type="number" class="odds-item-input" id="odds-toushu" value="4" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">Â∞æÊï∞Ôºà0-9Â∞æÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-weishu" value="9" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫îË°åÔºàÈáëÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-wuxing-jin" value="4.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫îË°åÔºàÊú®Ôºâ</span>
                                <input type="number" class="odds-item-input" id="odds-wuxing-mu" value="4.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫îË°åÔºàÊ∞¥Ôºâ</span>
                                <input type="number" class="odds-item-input" id="odds-wuxing-shui" value="5.8" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫îË°åÔºàÁÅ´Ôºâ</span>
                                <input type="number" class="odds-item-input" id="odds-wuxing-huo" value="4" step="0.1">
                            </div>
                            <div class="odds-item">
                                <span class="odds-item-label">‰∫îË°åÔºàÂúüÔºâ</span>
                                <input type="number" class="odds-item-input" id="odds-wuxing-tu" value="5.4" step="0.1">
                            </div>
                        </div>
                    </div>
                </div>
                
                <button class="odds-save-btn" onclick="saveOdds()">üíæ ‰øùÂ≠òËµîÁéá</button>
            </div>
            
            <!-- Ëá™ÂÆö‰πâÊ†ºÂºèÈ°µÈù¢ -->
            <div class="page" id="page-format">
                <div class="page-header" style="margin-bottom:8px;">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">Ëá™ÂÆö‰πâÊ†ºÂºè</div>
                </div>
                
                <!-- üÜï v3.6 Ëá™ÂÆö‰πâËØÜÂà´ËßÑÂàô -->
                <div class="setting-group" style="background:linear-gradient(135deg,rgba(251,191,36,0.1),rgba(245,158,11,0.1));border:1px solid rgba(251,191,36,0.3);margin-top:0;">
                    <div class="setting-group-title" style="color:#fbbf24;">üéØ Ëá™ÂÆö‰πâËØÜÂà´ËßÑÂàô</div>
                    <div style="font-size:12px;color:#888;margin-bottom:10px;">
                        ËÆæÁΩÆÂÖ≥ÈîÆËØçËÆ©Á≥ªÁªü<b style="color:#f59e0b;">Ëá™Âä®ËØÜÂà´</b>ÂØπÂ∫îÁöÑÁé©Ê≥ïÁ±ªÂûã
                    </div>
                    
                    <!-- ËßÑÂàôÂàóË°® -->
                    <div id="custom-rules-list" style="max-height:300px;overflow-y:auto;margin-bottom:12px;">
                        <!-- Âä®ÊÄÅÁîüÊàê -->
                    </div>
                    
                    <!-- Ê∑ªÂä†Êñ∞ËßÑÂàôÔºàÁÆÄÊ¥Å‰∏ªÁïåÈù¢Ôºâ -->
                    <div style="background:rgba(0,0,0,0.2);padding:12px;border-radius:8px;margin-bottom:12px;">
                        <div style="font-size:11px;color:#888;margin-bottom:8px;">‚ûï Ê∑ªÂä†Êñ∞ËßÑÂàô</div>
                        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap;">
                            <input type="text" id="new-rule-keyword" placeholder="ÂÖ≥ÈîÆËØçÔºàÂ¶ÇÔºöÂ∞èÁ†ÅÔºâ" style="flex:1;min-width:100px;padding:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:13px;">
                            <select id="new-rule-type" onchange="onRuleTypeChange()" style="flex:1;min-width:120px;padding:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:13px;">
                                <option value="">ÈÄâÊã©Á±ªÂûã</option>
                                <optgroup label="‚îÄ‚îÄ‚îÄ ÁâπÁ†ÅÁõ∏ÂÖ≥ ‚îÄ‚îÄ‚îÄ">
                                    <option value="T01">ÁâπÁ†ÅÔºàÂçïÂè∑Ôºâ</option>
                                    <option value="T01_EXPAND">ÁâπÁ†ÅÔºàÂ±ïÂºÄÂ§öÂè∑Ôºâ</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ Â§ßÂ∞èÂçïÂèå ‚îÄ‚îÄ‚îÄ">
                                    <option value="XS">Â∞èÊï∞ (1-24)</option>
                                    <option value="DS">Â§ßÊï∞ (25-48)</option>
                                    <option value="ODD">ÂçïÊï∞</option>
                                    <option value="EVEN">ÂèåÊï∞</option>
                                    <option value="HXS">ÂêàÂ∞è (0-6)</option>
                                    <option value="HDS">ÂêàÂ§ß (7-13)</option>
                                    <option value="HODD">ÂêàÂçï</option>
                                    <option value="HEVEN">ÂêàÂèå</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ Ê≥¢Ëâ≤ ‚îÄ‚îÄ‚îÄ">
                                    <option value="C1">Á∫¢Ê≥¢</option>
                                    <option value="C2">ËìùÊ≥¢</option>
                                    <option value="C3">ÁªøÊ≥¢</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ ÁîüËÇñÁ±ª ‚îÄ‚îÄ‚îÄ">
                                    <option value="PT1">Âπ≥Áâπ‰∏ÄËÇñ</option>
                                    <option value="TX">ÁâπËÇñ</option>
                                    <option value="ZX">Ê≠£ËÇñ</option>
                                    <option value="SX">ÁîüËÇñ</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ Âπ≥Áâπ ‚îÄ‚îÄ‚îÄ">
                                    <option value="PT2">Âπ≥Áâπ‰∫åËøûËÇñ</option>
                                    <option value="PT3">Âπ≥Áâπ‰∏âËøûËÇñ</option>
                                    <option value="PTW">Âπ≥ÁâπÂ∞æÊï∞</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ ËøûÁ†Å ‚îÄ‚îÄ‚îÄ">
                                    <option value="E2">‰∫å‰∏≠‰∫å</option>
                                    <option value="S3">‰∏â‰∏≠‰∏â</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ ‰∏ç‰∏≠ ‚îÄ‚îÄ‚îÄ">
                                    <option value="BZ5">‰∫î‰∏ç‰∏≠</option>
                                    <option value="BZ6">ÂÖ≠‰∏ç‰∏≠</option>
                                    <option value="BZ7">‰∏É‰∏ç‰∏≠</option>
                                    <option value="BZ8">ÂÖ´‰∏ç‰∏≠</option>
                                    <option value="BZ9">‰πù‰∏ç‰∏≠</option>
                                    <option value="BZ10">ÂçÅ‰∏ç‰∏≠</option>
                                </optgroup>
                                <optgroup label="‚îÄ‚îÄ‚îÄ ÂÖ∂‰ªñ ‚îÄ‚îÄ‚îÄ">
                                    <option value="DP">ÂçïÂπ≥/Âπ≥Á†Å</option>
                                    <option value="TS">Â§¥Êï∞</option>
                                    <option value="WS">Â∞æÊï∞</option>
                                    <option value="WX">‰∫îË°å</option>
                                    <option value="JY">ÂÆ∂Á¶ΩÈáéÂÖΩ</option>
                                    <option value="ZH">ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå</option>
                                    <option value="BB">ÂçäÊ≥¢</option>
                                    <option value="SX6">ÂÖ≠ËÇñ</option>
                                    <option value="HX">ÂêàËÇñ</option>
                                </optgroup>
                            </select>
                        </div>
                        <button onclick="addCustomRule()" style="width:100%;margin-top:10px;padding:10px;background:linear-gradient(90deg,#f59e0b,#d97706);color:white;border:none;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;">
                            ‚ûï Ê∑ªÂä†ËßÑÂàô
                        </button>
                    </div>
                    
                    <div style="display:flex;align-items:center;gap:8px;">
                        <div style="flex:1;font-size:10px;color:#666;padding:8px;background:rgba(0,0,0,0.2);border-radius:6px;">
                            ‚ö†Ô∏è ÂÖ≥ÈîÆËØçÂè™Â°´ÂêçÁß∞Ôºå‰∏çÂ∏¶ÈáëÈ¢ù<br>
                            üí° ËØÜÂà´È°∫Â∫èÔºöËá™ÂÆö‰πâËßÑÂàô ‚Üí Á≥ªÁªüËßÑÂàô ‚Üí AIÊô∫ËÉΩËØÜÂà´
                        </div>
                        <button onclick="showCustomRuleHelp()" style="padding:8px 12px;background:rgba(102,126,234,0.3);border:1px solid rgba(102,126,234,0.5);border-radius:6px;color:#a78bfa;font-size:11px;cursor:pointer;white-space:nowrap;">
                            ‚ùìÂ∏ÆÂä©
                        </button>
                    </div>
                </div>
                
                <!-- üÜï v3.7 Ëá™ÂÆö‰πâËßÑÂàôÂ∏ÆÂä©ÂºπÁ™ó -->
                <div id="custom-rule-help-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10000;overflow-y:auto;">
                    <div style="max-width:400px;margin:30px auto;background:#1a1a2e;border-radius:12px;overflow:hidden;">
                        <div style="background:linear-gradient(90deg,#667eea,#764ba2);padding:15px;display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-weight:bold;color:#fff;font-size:16px;">‚ùì Ëá™ÂÆö‰πâËßÑÂàô‰ΩøÁî®ËØ¥Êòé</span>
                            <button onclick="closeCustomRuleHelp()" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">√ó</button>
                        </div>
                        <div style="padding:16px;font-size:13px;color:#ccc;line-height:1.6;">
                            <div style="margin-bottom:16px;">
                                <div style="color:#fbbf24;font-weight:bold;margin-bottom:8px;">üìå ÂäüËÉΩËØ¥Êòé</div>
                                <div style="color:#999;">ÂΩìÁ≥ªÁªüÊó†Ê≥ïËØÜÂà´ÊÇ®ËæìÂÖ•ÁöÑËØçËØ≠Êó∂ÔºåÊÇ®ÂèØ‰ª•Âú®ËøôÈáåÊ∑ªÂä†ËßÑÂàôÔºåÂëäËØâÁ≥ªÁªüËøô‰∏™ËØçËØ≠‰ª£Ë°®‰ªÄ‰πàÁé©Ê≥ïÁ±ªÂûã„ÄÇ</div>
                            </div>
                            
                            <div style="margin-bottom:16px;">
                                <div style="color:#4ade80;font-weight:bold;margin-bottom:8px;">‚úÖ Ê≠£Á°ÆÁ§∫‰æã</div>
                                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;font-size:12px;">
                                    ‚Ä¢ ÂÖ≥ÈîÆËØçÂ°´Ôºö<b style="color:#fff;">Â∞èÁêÉ</b>ÔºåÁ±ªÂûãÈÄâÔºö<b style="color:#fff;">ÁâπÁ†Å(Â±ïÂºÄÂ§öÂè∑)</b><br>
                                    ‚Ä¢ ÂÖ≥ÈîÆËØçÂ°´Ôºö<b style="color:#fff;">Á∫¢</b>ÔºåÁ±ªÂûãÈÄâÔºö<b style="color:#fff;">Á∫¢Ê≥¢</b><br>
                                    ‚Ä¢ ÂÖ≥ÈîÆËØçÂ°´Ôºö<b style="color:#fff;">Áå™Áå™</b>ÔºåÁ±ªÂûãÈÄâÔºö<b style="color:#fff;">ÁîüËÇñ</b>
                                </div>
                            </div>
                            
                            <div style="margin-bottom:16px;">
                                <div style="color:#f87171;font-weight:bold;margin-bottom:8px;">‚ùå ÈîôËØØÁ§∫‰æã</div>
                                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;font-size:12px;">
                                    ‚Ä¢ <s style="color:#888;">Â∞èÁêÉ 100</s> ‚Üê ‰∏çË¶ÅÂ∏¶ÈáëÈ¢ù<br>
                                    ‚Ä¢ <s style="color:#888;">Â∞èÁêÉÂêÑ20</s> ‚Üê ‰∏çË¶ÅÂ∏¶"ÂêÑ"Â≠ó
                                </div>
                            </div>
                            
                            <div style="margin-bottom:16px;">
                                <div style="color:#60a5fa;font-weight:bold;margin-bottom:8px;">üí° ‰ΩøÁî®ÊµÅÁ®ã</div>
                                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;font-size:12px;">
                                    1. Âú®Â∑¶ËæπËæìÂÖ•Ê°ÜÂ°´ÂÜô<b style="color:#fff;">ÂÖ≥ÈîÆËØç</b><br>
                                    2. Âú®Âè≥Ëæπ‰∏ãÊãâÊ°ÜÈÄâÊã©<b style="color:#fff;">ÂØπÂ∫îÁ±ªÂûã</b><br>
                                    3. ÁÇπÂáª<b style="color:#f59e0b;">Ê∑ªÂä†ËßÑÂàô</b>ÊåâÈíÆ<br>
                                    4. ÁÇπÂáª<b style="color:#e94560;">‰øùÂ≠òËÆæÁΩÆ</b>Âç≥ÂèØÁîüÊïà
                                </div>
                            </div>
                            
                            <div style="margin-bottom:12px;">
                                <div style="color:#c084fc;font-weight:bold;margin-bottom:8px;">üîÑ ËØÜÂà´È°∫Â∫è</div>
                                <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;font-size:12px;">
                                    Á≥ªÁªü‰ºöÊåâ‰ª•‰∏ãÈ°∫Â∫èËØÜÂà´ÊÇ®ÁöÑËæìÂÖ•Ôºö<br>
                                    <b style="color:#fbbf24;">‚ë† ÊÇ®ËÆæÁΩÆÁöÑËßÑÂàô</b> ‚Üí <b style="color:#60a5fa;">‚ë° Á≥ªÁªüÂÜÖÁΩÆËßÑÂàô</b> ‚Üí <b style="color:#4ade80;">‚ë¢ AIÊô∫ËÉΩËØÜÂà´</b>
                                </div>
                            </div>
                            
                            <button onclick="closeCustomRuleHelp()" style="width:100%;padding:12px;background:linear-gradient(90deg,#667eea,#764ba2);color:#fff;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;margin-top:8px;">
                                ÊàëÁü•ÈÅì‰∫Ü
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- üÜï v3.6 ÁâπÁ†ÅÂ±ïÂºÄËÆæÁΩÆÂºπÁ™ó -->
                <div id="expand-modal" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.85);z-index:10000;overflow-y:auto;">
                    <div style="max-width:400px;margin:40px auto;background:#1a1a2e;border-radius:12px;overflow:hidden;">
                        <div style="background:linear-gradient(90deg,#f59e0b,#d97706);padding:15px;display:flex;justify-content:space-between;align-items:center;">
                            <span style="font-weight:bold;color:#fff;font-size:16px;">üìä ÁâπÁ†ÅÂ±ïÂºÄËÆæÁΩÆ</span>
                            <button onclick="closeExpandModal()" style="background:none;border:none;color:#fff;font-size:20px;cursor:pointer;">√ó</button>
                        </div>
                        <div style="padding:20px;">
                            <div style="margin-bottom:20px;">
                                <div style="font-size:12px;color:#888;margin-bottom:8px;">ÂÖ≥ÈîÆËØçÔºö<b id="expand-modal-keyword" style="color:#fbbf24;"></b></div>
                            </div>
                            
                            <!-- Âø´Êç∑È¢ÑËÆæÊåâÈíÆ -->
                            <div style="margin-bottom:20px;">
                                <div style="font-size:13px;color:#fff;margin-bottom:10px;font-weight:bold;">üöÄ Âø´Êç∑È¢ÑËÆæÔºàÁÇπÂáªËá™Âä®Â°´ÂÖÖÔºâ</div>
                                
                                <div style="margin-bottom:12px;">
                                    <div style="font-size:11px;color:#888;margin-bottom:6px;">Â§ßÂ∞èËåÉÂõ¥Ôºö</div>
                                    <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                        <button onclick="fillPreset('small')" class="preset-btn" style="padding:8px 12px;background:rgba(76,175,80,0.2);border:1px solid #4caf50;border-radius:6px;color:#81c784;font-size:11px;cursor:pointer;">Â∞èÊï∞ 1-24</button>
                                        <button onclick="fillPreset('big')" class="preset-btn" style="padding:8px 12px;background:rgba(244,67,54,0.2);border:1px solid #f44336;border-radius:6px;color:#ef9a9a;font-size:11px;cursor:pointer;">Â§ßÊï∞ 25-49</button>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom:12px;">
                                    <div style="font-size:11px;color:#888;margin-bottom:6px;">Â∞æÊï∞Ôºö</div>
                                    <div style="display:flex;flex-wrap:wrap;gap:4px;">
                                        <button onclick="fillPreset('tail0')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ0</button>
                                        <button onclick="fillPreset('tail1')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ1</button>
                                        <button onclick="fillPreset('tail2')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ2</button>
                                        <button onclick="fillPreset('tail3')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ3</button>
                                        <button onclick="fillPreset('tail4')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ4</button>
                                        <button onclick="fillPreset('tail5')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ5</button>
                                        <button onclick="fillPreset('tail6')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ6</button>
                                        <button onclick="fillPreset('tail7')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ7</button>
                                        <button onclick="fillPreset('tail8')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ8</button>
                                        <button onclick="fillPreset('tail9')" class="preset-btn" style="padding:6px 10px;background:rgba(156,39,176,0.2);border:1px solid #9c27b0;border-radius:4px;color:#ce93d8;font-size:10px;cursor:pointer;">Â∞æ9</button>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom:12px;">
                                    <div style="font-size:11px;color:#888;margin-bottom:6px;">Ê≥¢Ëâ≤Ôºö</div>
                                    <div style="display:flex;flex-wrap:wrap;gap:6px;">
                                        <button onclick="fillPreset('red')" class="preset-btn" style="padding:8px 12px;background:rgba(244,67,54,0.2);border:1px solid #f44336;border-radius:6px;color:#ef9a9a;font-size:11px;cursor:pointer;">üî¥ Á∫¢Ê≥¢ 17‰∏™</button>
                                        <button onclick="fillPreset('blue')" class="preset-btn" style="padding:8px 12px;background:rgba(33,150,243,0.2);border:1px solid #2196f3;border-radius:6px;color:#90caf9;font-size:11px;cursor:pointer;">üîµ ËìùÊ≥¢ 16‰∏™</button>
                                        <button onclick="fillPreset('green')" class="preset-btn" style="padding:8px 12px;background:rgba(76,175,80,0.2);border:1px solid #4caf50;border-radius:6px;color:#81c784;font-size:11px;cursor:pointer;">üü¢ ÁªøÊ≥¢ 16‰∏™</button>
                                    </div>
                                </div>
                                
                                <div style="margin-bottom:12px;">
                                    <div style="font-size:11px;color:#888;margin-bottom:6px;">ÁîüËÇñÔºà2025ËõáÂπ¥ÔºâÔºö</div>
                                    <div style="display:flex;flex-wrap:wrap;gap:4px;">
                                        <button onclick="fillPreset('Z1')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê≠Èº†4‰∏™</button>
                                        <button onclick="fillPreset('Z2')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêÇÁâõ4‰∏™</button>
                                        <button onclick="fillPreset('Z3')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêØËôé4‰∏™</button>
                                        <button onclick="fillPreset('Z4')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê∞ÂÖî4‰∏™</button>
                                        <button onclick="fillPreset('Z5')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê≤Èæô4‰∏™</button>
                                        <button onclick="fillPreset('Z6')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêçËõá5‰∏™</button>
                                        <button onclick="fillPreset('Z7')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê¥È©¨4‰∏™</button>
                                        <button onclick="fillPreset('Z8')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêëÁæä4‰∏™</button>
                                        <button onclick="fillPreset('Z9')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêµÁå¥4‰∏™</button>
                                        <button onclick="fillPreset('Z10')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üêîÈ∏°4‰∏™</button>
                                        <button onclick="fillPreset('Z11')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê∂Áãó4‰∏™</button>
                                        <button onclick="fillPreset('Z12')" class="preset-btn" style="padding:6px 10px;background:rgba(255,152,0,0.2);border:1px solid #ff9800;border-radius:4px;color:#ffcc80;font-size:10px;cursor:pointer;">üê∑Áå™4‰∏™</button>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Â∑≤ÈÄâÂè∑Á†Å -->
                            <div style="margin-bottom:20px;">
                                <div style="font-size:13px;color:#fff;margin-bottom:8px;font-weight:bold;">üìù Â∑≤ÈÄâÂè∑Á†Å</div>
                                <textarea id="expand-numbers-input" placeholder="ÁÇπÂáª‰∏äÊñπÊåâÈíÆËá™Âä®Â°´ÂÖÖÔºåÊàñÊâãÂä®ËæìÂÖ•ÔºàÂ¶ÇÔºö1,2,3,4,5Ôºâ" style="width:100%;height:60px;padding:10px;background:rgba(0,0,0,0.3);border:1px solid rgba(255,255,255,0.2);border-radius:6px;color:#fff;font-size:12px;resize:none;box-sizing:border-box;"></textarea>
                                <div id="expand-numbers-count" style="font-size:10px;color:#888;margin-top:4px;text-align:right;">Â∑≤ÈÄâ 0 ‰∏™Âè∑Á†Å</div>
                            </div>
                            
                            <!-- ÈáëÈ¢ùÊ®°Âºè -->
                            <div style="margin-bottom:20px;">
                                <div style="font-size:13px;color:#fff;margin-bottom:8px;font-weight:bold;">üí∞ ÈáëÈ¢ùÊ®°Âºè</div>
                                <div style="display:flex;gap:10px;">
                                    <label style="flex:1;display:flex;align-items:center;gap:6px;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;cursor:pointer;">
                                        <input type="radio" name="amount-mode" value="each" checked style="width:16px;height:16px;">
                                        <span style="font-size:11px;color:#ccc;">ÊØè‰∏™Âè∑Á†ÅËØ•ÈáëÈ¢ù</span>
                                    </label>
                                    <label style="flex:1;display:flex;align-items:center;gap:6px;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;cursor:pointer;">
                                        <input type="radio" name="amount-mode" value="total" style="width:16px;height:16px;">
                                        <span style="font-size:11px;color:#ccc;">ÊÄªÈáëÈ¢ùÂπ≥ÂùáÂàÜ</span>
                                    </label>
                                </div>
                            </div>
                            
                            <!-- Êìç‰ΩúÊåâÈíÆ -->
                            <div style="display:flex;gap:10px;">
                                <button onclick="closeExpandModal()" style="flex:1;padding:12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:13px;cursor:pointer;">ÂèñÊ∂à</button>
                                <button onclick="confirmExpandRule()" style="flex:1;padding:12px;background:linear-gradient(90deg,#f59e0b,#d97706);color:#fff;border:none;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;">‚úì Á°ÆÂÆöÊ∑ªÂä†</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <button onclick="saveFormatSettings()" style="width:100%;padding:12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;margin-top:15px;">
                    üíæ ‰øùÂ≠òËÆæÁΩÆ
                </button>
                
                <button onclick="resetFormatSettings()" style="width:100%;padding:10px;background:transparent;color:#888;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:13px;cursor:pointer;margin-top:10px;">
                    üîÑ ÊÅ¢Â§çÈªòËÆ§ËÆæÁΩÆ
                </button>
            </div>
            
            <!-- ÂèÇÊï∞ËÆæÁΩÆÈ°µÈù¢ -->
            <div class="page" id="page-params">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">ÂèÇÊï∞ËÆæÁΩÆ</div>
                </div>
                
                <!-- AIÊô∫ËÉΩËß£ÊûêËÆæÁΩÆÔºà‰ªéËá™ÂÆö‰πâÊ†ºÂºèÈ°µÈù¢ÁßªÂÖ•Ôºâ -->
                <div class="setting-group" style="background:linear-gradient(135deg,rgba(102,126,234,0.2),rgba(118,75,162,0.2));border:1px solid rgba(102,126,234,0.3);">
                    <div class="setting-group-title" style="color:#a78bfa;">ü§ñ AIÊô∫ËÉΩËß£Êûê</div>
                    <div style="font-size:12px;color:#888;margin-bottom:12px;">
                        ÂºÄÂêØÂêéÂèØËá™Âä®ËØÜÂà´ÂêÑÁßçÂ§çÊùÇÊ†ºÂºèÔºåÊó†ÈúÄÊâãÂä®ÈÖçÁΩÆ
                    </div>
                    
                    <div class="setting-item">
                        <span class="setting-item-label">ÂêØÁî®AIÊô∫ËÉΩËß£Êûê</span>
                        <input type="checkbox" id="ai-parse-enabled" checked style="width:20px;height:20px;">
                    </div>
                    
                    <!-- AIÊ®°ÂûãÂàáÊç¢ÊåâÈíÆ -->
                    <div style="margin-top:12px;">
                        <div style="font-size:12px;color:#888;margin-bottom:8px;">ÈÄâÊã©AIÊ®°ÂûãÔºö</div>
                        <div id="ai-model-buttons" style="display:flex;gap:8px;flex-wrap:wrap;">
                            <button type="button" class="ai-model-btn active" data-provider="openrouter" onclick="switchAIModel('openrouter')">
                                üåê Ë∞∑Ê≠å
                            </button>
                            <button type="button" class="ai-model-btn" data-provider="deepseek" onclick="switchAIModel('deepseek')">
                                üöÄ DS
                            </button>
                            <button type="button" class="ai-model-btn" data-provider="zhipu" onclick="switchAIModel('zhipu')">
                                üß† Êô∫Ë∞±
                            </button>
                            <button type="button" class="ai-model-btn" data-provider="qwen" onclick="switchAIModel('qwen')">
                                ‚òÅÔ∏è ÂçÉÈóÆ
                            </button>
                            <button type="button" class="ai-model-btn" data-provider="claude" onclick="switchAIModel('claude')">
                                ü§ñ Claude
                            </button>
                            <button type="button" class="ai-model-btn" data-provider="gpt" onclick="switchAIModel('gpt')">
                                üí° GPT
                            </button>
                        </div>
                        <div id="ai-model-status" style="margin-top:8px;padding:8px;background:rgba(139,92,246,0.1);border-radius:6px;font-size:11px;color:#a78bfa;">
                            ‚úÖ ÂΩìÂâçÔºöGemini 3 FlashÔºàOpenRouter ¬∑ È¶ôÊ∏ØÊúçÂä°Âô®Ôºâ
                        </div>
                    </div>
                    
                    <!-- ÈöêËóèÁöÑÈÖçÁΩÆ -->
                    <div style="display:none;">
                        <select id="ai-provider">
                            <option value="openrouter" selected>Gemini 3 Flash (OpenRouter)</option>
                            <option value="deepseek">DeepSeek</option>
                            <option value="zhipu">Êô∫Ë∞±GLM</option>
                            <option value="qwen">ÈÄö‰πâÂçÉÈóÆ</option>
                            <option value="claude">Claude Opus</option>
                            <option value="gpt">GPT 5.1</option>
                            <option value="tuzi">Gemini 3 Pro</option>
                        </select>
                        <input type="hidden" id="ai-api-key" value="">
                    </div>
                </div>
                
                <!-- ÂØºÂÖ•ÂØºÂá∫ÈÖçÁΩÆÔºà‰ªéËá™ÂÆö‰πâÊ†ºÂºèÈ°µÈù¢ÁßªÂÖ•Ôºâ -->
                <div class="setting-group">
                    <div class="setting-group-title">üì¶ ÂØºÂÖ•/ÂØºÂá∫ÈÖçÁΩÆ</div>
                    <div style="font-size:12px;color:#888;margin-bottom:12px;">
                        ÂØºÂá∫ÈÖçÁΩÆÂèØÂú®ÂÖ∂‰ªñËÆæÂ§áÂØºÂÖ•‰ΩøÁî®
                    </div>
                    <div style="display:flex;gap:8px;">
                        <button onclick="exportAllSettings()" style="flex:1;padding:10px;background:rgba(102,126,234,0.2);color:#a78bfa;border:1px solid rgba(102,126,234,0.3);border-radius:6px;font-size:12px;cursor:pointer;">
                            üì§ ÂØºÂá∫ÈÖçÁΩÆ
                        </button>
                        <button onclick="document.getElementById('import-file-params').click()" style="flex:1;padding:10px;background:rgba(76,175,80,0.2);color:#81c784;border:1px solid rgba(76,175,80,0.3);border-radius:6px;font-size:12px;cursor:pointer;">
                            üì• ÂØºÂÖ•ÈÖçÁΩÆ
                        </button>
                        <input type="file" id="import-file-params" accept=".json" style="display:none;" onchange="importAllSettings(event)">
                    </div>
                    <div style="font-size:10px;color:#666;margin-top:8px;">
                        ÂåÖÂê´ÔºöËá™ÂÆö‰πâËßÑÂàô + ÂÄçÁéáËÆæÁΩÆ
                    </div>
                </div>
                
                <button onclick="saveParamSettings()" style="width:100%;padding:12px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;margin-top:15px;">
                    üíæ ‰øùÂ≠òËÆæÁΩÆ
                </button>
            </div>
            
            <!-- ÊøÄÊ¥ªÈ°µÈù¢ -->
            <div class="page" id="page-activate">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">ÊøÄÊ¥ª‰ºöÂëò</div>
                </div>
                
                <div class="status-card">
                    <div class="status-label">ÊéàÊùÉÁä∂ÊÄÅ</div>
                    <div class="status-value trial" id="license-status">ËØïÁî®ÊúüÂâ©‰Ωô 7 Â§©</div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">ËÆæÂ§áÊú∫Âô®Á†Å</div>
                    <div class="machine-code-display">
                        <div class="machine-code-value" id="machine-code">ÁîüÊàê‰∏≠...</div>
                    </div>
                    <button class="btn btn-primary" onclick="copyMachineCode()" style="width:100%;">
                        <span>üìã Â§çÂà∂Êú∫Âô®Á†Å</span>
                    </button>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">ËæìÂÖ•ÊøÄÊ¥ªÁ†Å</div>
                    <input type="text" class="license-input" id="license-input" placeholder="XXXX-XXXX-XXXX-XXXX">
                    <button class="btn-activate" onclick="activateLicense()">üîì ÊøÄÊ¥ª</button>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">ËµîÁéáÈÖçÁΩÆÂ§á‰ªΩ</div>
                    <div class="config-btn-row">
                    <button class="btn-config btn-export" onclick="showExportOptions()">üì§ ÂØºÂá∫ÈÖçÁΩÆ</button>
                    <button class="btn-config btn-import" onclick="showImportModal()">üì• ÂØºÂÖ•ÈÖçÁΩÆ</button>
                    </div>
                </div>
                
            </div>
            
            <!-- Ê†∏ÂØπËØ¶ÊÉÖÈ°µÈù¢ -->
            <div class="page" id="page-check">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-main')">‚Üê</button>
                    <div class="page-title">Ê†∏ÂØπËØ¶ÊÉÖ</div>
                </div>
                
                <!-- Ê±áÊÄª‰ø°ÊÅØ -->
                <div class="check-summary">
                    <div class="check-summary-item">
                        <div class="check-summary-label">ÊÄª‰∏ãÊ≥®</div>
                        <div class="check-summary-value" id="check-total-bet">0</div>
                    </div>
                    <div class="check-summary-item">
                        <div class="check-summary-label">‰∏≠Â•ñÊ≥®Êï∞</div>
                        <div class="check-summary-value" id="check-win-count">0</div>
                    </div>
                    <div class="check-summary-item">
                        <div class="check-summary-label">ÁªìÁÆóÁªìÊûú</div>
                        <div class="check-summary-value" id="check-result">0</div>
                    </div>
                </div>
                
                <!-- ËØ¶ÁªÜÂàóË°® -->
                <div class="setting-group">
                    <div class="setting-group-title">‰∏ãÊ≥®ÊòéÁªÜ</div>
                    <div class="check-detail-list" id="check-detail-list">
                        <!-- Âä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
            
            <!-- ÂèÇÁÖßË°®È°µÈù¢ -->
            <div class="page" id="page-reference">
                <div class="page-header">
                    <button class="btn-back" onclick="showPage('page-lottery')">‚Üê</button>
                    <div class="page-title">Â±ûÊÄßÂèÇÁÖß</div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">ÁîüËÇñÂèÇÁÖßË°®</div>
                    <div class="ref-table-wrap">
                        <table class="ref-table" id="ref-shengxiao"></table>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">‰∫îË°åÂèÇÁÖßË°®</div>
                    <div class="ref-table-wrap">
                        <table class="ref-table" id="ref-wuxing"></table>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">Ê≥¢Ëâ≤ÂèÇÁÖßË°®</div>
                    <div class="ref-table-wrap">
                        <table class="ref-table" id="ref-bose"></table>
                    </div>
                </div>
                
                <div class="setting-group">
                    <div class="setting-group-title">ÂÆ∂Á¶ΩÈáéÂÖΩÂèÇÁÖßË°®</div>
                    <div class="ref-table-wrap">
                        <table class="ref-table" id="ref-jiaqin"></table>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- üÜï ÂàÜÁªÑÁºñËæëÂô®ÂºπÁ™ó v2.4 -->
        <div class="import-modal" id="group-editor-modal" style="display:none;">
            <div class="import-modal-content" style="max-width:95%;width:450px;max-height:85vh;overflow:hidden;display:flex;flex-direction:column;">
                <div class="import-modal-title" style="display:flex;justify-content:space-between;align-items:center;">
                    <span>üì¶ ÊâãÂä®ÂàÜÁªÑÁºñËæë</span>
                    <button onclick="closeGroupEditor()" style="background:none;border:none;color:#888;font-size:20px;cursor:pointer;">√ó</button>
                </div>
                
                <div style="padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1);font-size:12px;color:#888;">
                    üí° ÊèêÁ§∫ÔºöÁÇπÂáªË°å‰πãÈó¥ÁöÑ <span style="color:#667eea;">„Äå+ÂàÜÁªÑÁ∫ø„Äç</span> ÊåâÈíÆÊù•ÂàÜÈöî‰∏çÂêåÁªÑ
                </div>
                
                <!-- Ë°åÂàóË°®Âå∫Âüü -->
                <div id="group-editor-lines" style="flex:1;overflow-y:auto;padding:12px 0;">
                    <!-- Âä®ÊÄÅÁîüÊàê -->
                </div>
                
                <!-- Â∫ïÈÉ®ÊåâÈíÆ -->
                <div style="display:flex;gap:8px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.1);">
                    <button onclick="resetGroupEditor()" style="flex:1;padding:10px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:6px;font-size:13px;cursor:pointer;">üîÑ ÈáçÁΩÆ</button>
                    <button onclick="applyGroupEdits()" style="flex:2;padding:10px;background:linear-gradient(90deg,#667eea,#764ba2);color:white;border:none;border-radius:6px;font-size:13px;font-weight:bold;cursor:pointer;">‚úÖ Â∫îÁî®ÂàÜÁªÑ</button>
                </div>
            </div>
        </div>
        
        <!-- Â§öÊ®°ÂûãÂØπÊØîÊµãËØïÂºπÁ™ó -->
        <div class="import-modal" id="multi-model-modal" style="display:none;">
            <div class="import-modal-content" style="max-width:95%;width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;">
                <div class="import-modal-title" style="display:flex;justify-content:space-between;align-items:center;">
                    <span>üî¨ Â§öÊ®°ÂûãÂØπÊØîÊµãËØï</span>
                    <span id="tuzi-site-info" style="font-size:11px;color:#4ade80;background:rgba(74,222,128,0.1);padding:2px 8px;border-radius:4px;margin-left:8px;">ÂΩìÂâçÁ´ôÁÇπ: ÂπøÂ∑û</span>
                    <button onclick="closeMultiModelModal()" style="background:none;border:none;color:#888;font-size:20px;cursor:pointer;">√ó</button>
                </div>
                
                <!-- „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊµãËØïÊéßÂà∂Âå∫ -->
                <div id="model-test-control" style="padding:8px 0;border-bottom:1px solid rgba(255,255,255,0.1);display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
                    <div style="display:flex;align-items:center;gap:4px;">
                        <label style="font-size:11px;color:#888;">Ê†áÂáÜÁ≠îÊ°à:</label>
                        <select id="standard-answer" style="padding:4px 8px;border-radius:4px;border:1px solid rgba(255,255,255,0.2);background:rgba(0,0,0,0.3);color:#fff;font-size:11px;">
                            <option value="">--ËØ∑ÈÄâÊã©--</option>
                            <optgroup label="ÁâπÁ†ÅÁ±ª">
                                <option value="ÁâπÁ†Å">ÁâπÁ†Å</option>
                                <option value="ÁîüËÇñÁâπÁ†Å">ÁîüËÇñÁâπÁ†Å</option>
                                <option value="Â§ßÂ∞èÂçïÂèå">Â§ßÂ∞èÂçïÂèå</option>
                            </optgroup>
                            <optgroup label="Âπ≥ÁâπÁ±ª">
                                <option value="Âπ≥Áâπ‰∏ÄËÇñ">Âπ≥Áâπ‰∏ÄËÇñ(‰∏ÄÂèã)</option>
                                <option value="Âπ≥Áâπ‰∫åËøûËÇñ">Âπ≥Áâπ‰∫åËøûËÇñ(‰∫åÂèã)</option>
                                <option value="Âπ≥Áâπ‰∏âËøûËÇñ">Âπ≥Áâπ‰∏âËøûËÇñ(‰∏âÂèã)</option>
                                <option value="Âπ≥ÁâπÂõõËøûËÇñ">Âπ≥ÁâπÂõõËøûËÇñ</option>
                                <option value="Âπ≥Áâπ‰∫îËøûËÇñ">Âπ≥Áâπ‰∫îËøûËÇñ</option>
                                <option value="Âπ≥ÁâπÂ∞æÊï∞">Âπ≥ÁâπÂ∞æÊï∞</option>
                            </optgroup>
                            <optgroup label="ÁîüËÇñÁ±ª">
                                <option value="ÁîüËÇñ">ÁîüËÇñ</option>
                                <option value="ÂÖ≠ËÇñ">ÂÖ≠ËÇñ</option>
                                <option value="ÁâπËÇñ">ÁâπËÇñ</option>
                                <option value="ÂêàËÇñ">ÂêàËÇñ</option>
                                <option value="Ê≠£ËÇñ">Ê≠£ËÇñ</option>
                            </optgroup>
                            <optgroup label="Ê≥¢Ëâ≤Á±ª">
                                <option value="Ê≥¢Ëâ≤">Ê≥¢Ëâ≤</option>
                                <option value="ÂçäÊ≥¢">ÂçäÊ≥¢</option>
                            </optgroup>
                            <optgroup label="Âπ≥Á†ÅÁ±ª">
                                <option value="ÂçïÂπ≥">ÂçïÂπ≥/Âπ≥Á†Å</option>
                            </optgroup>
                            <optgroup label="ËøûÁ†ÅÁ±ª">
                                <option value="‰∫å‰∏≠‰∫å">‰∫å‰∏≠‰∫å</option>
                                <option value="‰∏â‰∏≠‰∏â">‰∏â‰∏≠‰∏â</option>
                                <option value="‰∫åÂÖ®‰∏≠">‰∫åÂÖ®‰∏≠</option>
                                <option value="‰∏âÂÖ®‰∏≠">‰∏âÂÖ®‰∏≠</option>
                                <option value="‰∫å‰∏≠Áâπ">‰∫å‰∏≠Áâπ</option>
                                <option value="‰∏â‰∏≠Áâπ">‰∏â‰∏≠Áâπ</option>
                                <option value="Áâπ‰∏≤">Áâπ‰∏≤</option>
                            </optgroup>
                            <optgroup label="‰∏ç‰∏≠Á±ª">
                                <option value="‰∫î‰∏ç‰∏≠">‰∫î‰∏ç‰∏≠</option>
                                <option value="ÂÖ≠‰∏ç‰∏≠">ÂÖ≠‰∏ç‰∏≠</option>
                                <option value="‰∏É‰∏ç‰∏≠">‰∏É‰∏ç‰∏≠</option>
                                <option value="ÂÖ´‰∏ç‰∏≠">ÂÖ´‰∏ç‰∏≠</option>
                                <option value="‰πù‰∏ç‰∏≠">‰πù‰∏ç‰∏≠</option>
                                <option value="ÂçÅ‰∏ç‰∏≠">ÂçÅ‰∏ç‰∏≠</option>
                                <option value="ÂçÅ‰∏Ä‰∏ç‰∏≠">ÂçÅ‰∏Ä‰∏ç‰∏≠</option>
                                <option value="ÂçÅ‰∫å‰∏ç‰∏≠">ÂçÅ‰∫å‰∏ç‰∏≠</option>
                            </optgroup>
                            <optgroup label="ÂÖ∂‰ªñ">
                                <option value="ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå">ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå</option>
                                <option value="‰∫îË°å">‰∫îË°å</option>
                                <option value="ÂÆ∂Á¶ΩÈáéÂÖΩ">ÂÆ∂Á¶ΩÈáéÂÖΩ</option>
                                <option value="Â§¥Â∞æÊï∞">Â§¥Â∞æÊï∞</option>
                            </optgroup>
                        </select>
                    </div>
                    <button onclick="runMultiRoundTest(5)" style="padding:4px 10px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:4px;font-size:11px;cursor:pointer;">
                        üîÑ 5ËΩÆÊµãËØï
                    </button>
                    <button onclick="runEdgeCaseTest()" id="edge-test-btn" style="padding:4px 10px;background:linear-gradient(90deg,#e74c3c,#c0392b);color:white;border:none;border-radius:4px;font-size:11px;cursor:pointer;">
                        üß™ ËæπÁºòÊµãËØï
                    </button>
                    <span id="test-progress" style="font-size:11px;color:#888;display:none;">ËøõÂ∫¶: 0/5</span>
                    <button onclick="exportTestReport()" id="export-btn" style="padding:4px 10px;background:linear-gradient(90deg,#27ae60,#2ecc71);color:white;border:none;border-radius:4px;font-size:11px;cursor:pointer;display:none;">
                        üìä ÂØºÂá∫CSV
                    </button>
                </div>
                
                <!-- Ê®°ÂûãÊ†áÁ≠æÂàáÊç¢ -->
                <div id="model-tabs" style="display:flex;gap:0;margin-bottom:0;border-bottom:1px solid rgba(255,255,255,0.1);">
                    <button class="model-tab active" data-model="openrouter" onclick="switchModelTab('openrouter')">
                        <div class="model-tab-name">Gemini</div>
                        <div class="model-tab-time" id="tab-time-openrouter">Á≠âÂæÖ‰∏≠...</div>
                    </button>
                    <button class="model-tab" data-model="deepseek" onclick="switchModelTab('deepseek')">
                        <div class="model-tab-name">DeepSeek</div>
                        <div class="model-tab-time" id="tab-time-deepseek">Á≠âÂæÖ‰∏≠...</div>
                    </button>
                    <button class="model-tab" data-model="qwen" onclick="switchModelTab('qwen')">
                        <div class="model-tab-name">ÈÄö‰πâÂçÉÈóÆ</div>
                        <div class="model-tab-time" id="tab-time-qwen">Á≠âÂæÖ‰∏≠...</div>
                    </button>
                    <button class="model-tab" data-model="claude" onclick="switchModelTab('claude')">
                        <div class="model-tab-name">Claude</div>
                        <div class="model-tab-time" id="tab-time-claude">Á≠âÂæÖ‰∏≠...</div>
                    </button>
                    <button class="model-tab" data-model="gpt" onclick="switchModelTab('gpt')">
                        <div class="model-tab-name">GPT4o</div>
                        <div class="model-tab-time" id="tab-time-gpt">Á≠âÂæÖ‰∏≠...</div>
                    </button>
                </div>
                
                <!-- ÂØπÊØîÂÜÖÂÆπÂå∫Âüü -->
                <div style="flex:1;overflow-y:auto;padding:12px 0;">
                    <!-- ÂéüÂßãËæìÂá∫ -->
                    <div style="margin-bottom:12px;">
                        <div style="font-size:11px;color:#888;margin-bottom:4px;">[ÂéüÂßãËæìÂá∫ÂÜÖÂÆπ]</div>
                        <div id="model-raw-output" style="background:rgba(0,0,0,0.3);border-radius:6px;padding:10px;font-size:12px;color:#ccc;max-height:150px;overflow-y:auto;font-family:monospace;white-space:pre-wrap;word-break:break-all;">
                            Á≠âÂæÖËøêË°å...
                        </div>
                    </div>
                    
                    <!-- Ëß£ÊûêÁªìÊûú -->
                    <div style="margin-bottom:12px;">
                        <div style="font-size:11px;color:#888;margin-bottom:4px;">[Ëß£ÊûêÁªìÊûú]</div>
                        <div id="model-parsed-result" style="background:rgba(0,0,0,0.3);border-radius:6px;padding:10px;font-size:12px;color:#81c784;max-height:120px;overflow-y:auto;">
                            Á≠âÂæÖËøêË°å...
                        </div>
                    </div>
                    
                    <!-- Áä∂ÊÄÅÂíåÊìç‰Ωú -->
                    <div id="model-status-area" style="display:flex;justify-content:space-between;align-items:center;padding:10px;background:rgba(255,255,255,0.05);border-radius:6px;">
                        <div id="model-status" style="font-size:12px;color:#888;">
                            ‚è≥ Á≠âÂæÖËøêË°å
                        </div>
                        <button id="model-use-btn" onclick="useModelResult()" style="display:none;padding:8px 16px;background:linear-gradient(90deg,#27ae60,#2ecc71);color:white;border:none;border-radius:6px;font-size:12px;font-weight:bold;cursor:pointer;">
                            ‚úÖ ÈÄâÁî®Ê≠§ÁªìÊûú
                        </button>
                    </div>
                </div>
                
                <!-- Â∫ïÈÉ®Êìç‰Ωú -->
                <div style="padding-top:12px;border-top:1px solid rgba(255,255,255,0.1);display:flex;gap:10px;">
                    <button onclick="runMultiModelTest()" style="flex:1;padding:12px;background:linear-gradient(90deg,#667eea,#764ba2);color:white;border:none;border-radius:8px;font-size:14px;font-weight:bold;cursor:pointer;">
                        üîÑ ÈáçÊñ∞ÊµãËØï
                    </button>
                    <button onclick="closeMultiModelModal()" style="flex:1;padding:12px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:14px;cursor:pointer;">
                        ÂÖ≥Èó≠
                    </button>
                </div>
            </div>
        </div>
        
        <!-- ÂØºÂá∫ÈÄâÈ°πÂºπÁ™ó -->
        <div class="import-modal" id="export-modal">
            <div class="import-modal-content">
                <div class="import-modal-title">üì§ ÂØºÂá∫ÈÖçÁΩÆ</div>
                <div style="display:flex;flex-direction:column;gap:12px;">
                    <button onclick="exportCopy()" style="width:100%;padding:15px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;border:none;border-radius:10px;font-size:14px;font-weight:bold;cursor:pointer;">
                        üìã Â§çÂà∂ÈÖçÁΩÆÊñáÊú¨ÔºàÊé®ËçêÔºâ
                    </button>
                    <div style="color:#888;font-size:12px;text-align:center;">
                        Â§çÂà∂ÂêéÂèØÁõ¥Êé•Á≤òË¥¥Âà∞ÂæÆ‰ø°ÂèëÈÄÅ
                    </div>
                    <button onclick="exportDownload()" style="width:100%;padding:15px;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.2);border-radius:10px;font-size:14px;cursor:pointer;">
                        üíæ ‰∏ãËΩΩ‰∏∫Êñá‰ª∂
                    </button>
                </div>
                <button onclick="hideExportModal()" style="width:100%;padding:12px;background:transparent;color:#666;border:none;font-size:14px;cursor:pointer;margin-top:15px;">
                    ÂèñÊ∂à
                </button>
            </div>
        </div>
        
        <!-- ÂØºÂÖ•ÈÖçÁΩÆÂºπÁ™ó -->
        <div class="import-modal" id="import-modal">
            <div class="import-modal-content">
                <div class="import-modal-title">üì• ÂØºÂÖ•ÈÖçÁΩÆ</div>
                
                <div style="background:rgba(46,204,113,0.1);border:1px solid rgba(46,204,113,0.3);border-radius:8px;padding:12px;margin-bottom:15px;">
                    <div style="color:#2ecc71;font-size:13px;font-weight:bold;margin-bottom:8px;">üí° Êé®ËçêÊñπÂºèÔºöÁ≤òË¥¥ÂØºÂÖ•</div>
                    <div style="color:#888;font-size:12px;">
                        1. Âú®ÂæÆ‰ø°ÊâìÂºÄÊî∂Âà∞ÁöÑÈÖçÁΩÆÊñá‰ª∂<br>
                        2. ÈïøÊåâÂÜÖÂÆπ ‚Üí ÂÖ®ÈÄâ ‚Üí Â§çÂà∂<br>
                        3. ÂõûÂà∞ËøôÈáåÁ≤òË¥¥Âà∞‰∏ãÊñπËæìÂÖ•Ê°Ü
                    </div>
                </div>
                
                <textarea class="import-textarea" id="import-textarea" placeholder="ÈïøÊåâÊ≠§Â§ÑÁ≤òË¥¥ÈÖçÁΩÆÂÜÖÂÆπ...&#10;&#10;Ôºà‰ªéÂæÆ‰ø°Â§çÂà∂ÁöÑÈÖçÁΩÆÊñáÊú¨Ôºâ" style="height:120px;"></textarea>
                
                <button onclick="importConfig()" style="width:100%;padding:14px;background:linear-gradient(90deg,#2ecc71,#27ae60);color:white;border:none;border-radius:8px;font-size:15px;font-weight:bold;cursor:pointer;margin:10px 0;">
                    ‚úÖ Á°ÆËÆ§ÂØºÂÖ•
                </button>
                
                <div style="text-align:center;color:#666;font-size:12px;margin:15px 0;">‚Äî ÊàñËÄÖÈÄâÊã©Êñá‰ª∂ ‚Äî</div>
                
                <!-- Êñá‰ª∂ÈÄâÊã© - Âè™Êé•ÂèóÊñáÊú¨Êñá‰ª∂ÔºåÈÅøÂÖçÊòæÁ§∫ÊãçÁÖßÈÄâÈ°π -->
                <input type="file" id="import-file" accept=".txt,.json,text/plain,application/json" style="display:none;" onchange="handleFileSelect(event)">
                <button onclick="document.getElementById('import-file').click()" style="width:100%;padding:12px;background:rgba(255,255,255,0.1);color:#aaa;border:1px solid rgba(255,255,255,0.2);border-radius:8px;font-size:13px;cursor:pointer;">
                    üìÅ ‰ªéÊñá‰ª∂AppÈÄâÊã©
                </button>
                
                <button onclick="hideImportModal()" style="width:100%;padding:12px;background:transparent;color:#666;border:none;font-size:13px;cursor:pointer;margin-top:10px;">
                    ÂèñÊ∂à
                </button>
            </div>
        </div>
        
        <!-- ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó -->
        <!-- ‚ïë          Á≤æÂáÜÁ∫†ÈîôÁâà - ÂèçÈ¶àÈ°µÈù¢ÔºàÁ¥ßÂáëÂàóË°®ËÆæËÆ°Ôºâ                   ‚ïë -->
        <!-- ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù -->
        <div class="page" id="page-feedback">
            <!-- È°∂ÈÉ®Âõ∫ÂÆöÊ†è -->
            <div id="feedback-fixed-header" style="position:sticky;top:0;z-index:100;background:linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);padding:10px 12px;border-bottom:1px solid rgba(255,255,255,0.1);">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
                    <button class="btn-back" onclick="showPage('page-main')" style="padding:5px 10px;background:rgba(255,255,255,0.1);border:none;border-radius:5px;color:#fff;font-size:14px;cursor:pointer;">‚Üê ËøîÂõû</button>
                </div>
                
                <!-- üÜï v3.11.24 ÂºÄÂ•ñÂè∑Á†ÅÂå∫ÂüüÔºàÊúüÂè∑Âú®Â∑¶ÔºåÂè∑Á†ÅÁêÉÂú®Âè≥ÔºâÊîØÊåÅÂèåÂºÄÂ•ñ -->
                <div id="fb-lottery-section" style="margin-bottom:8px;">
                    <!-- Âä®ÊÄÅÊ∏≤Êüì -->
                </div>
                
                <div style="display:flex;justify-content:space-between;font-size:12px;color:#aaa;flex-wrap:wrap;gap:4px;">
                    <span>ÊÄªÊäï: <span id="fb-total-bet" style="color:#fff;">0</span>ÂÖÉ</span>
                    <span>‰∏≠<span id="fb-win-count" style="color:#4caf50;">0</span>Ê≥®</span>
                    <span>Ê¥æÂΩ©: <span id="fb-win-amount" style="color:#fbbf24;">0</span>ÂÖÉ</span>
                    <span>Áõà‰∫è: <span id="fb-total-result" style="font-weight:bold;">+0</span></span>
                </div>
            </div>
            
            <!-- ÂàóË°®ÂÆπÂô® -->
            <div id="feedback-list" style="padding:10px;"></div>
            
            <!-- Â∫ïÈÉ®Êèê‰∫§ÊåâÈíÆÔºàÂõ∫ÂÆöÔºâ -->
            <div style="position:sticky;bottom:0;padding:10px 12px;background:linear-gradient(0deg, #1a1a2e 80%, transparent);border-top:1px solid rgba(255,255,255,0.05);">
                <button id="fb-submit-btn" onclick="submitFeedbackNew()" style="width:100%;padding:14px;background:linear-gradient(90deg,#e94560,#c23a51);color:white;border:none;border-radius:10px;font-size:15px;font-weight:bold;cursor:pointer;">
                    üì§ Êèê‰∫§ÈîôËØØÊä•Âëä (Â∑≤ÈÄâ <span id="fb-error-count">0</span> È°π)
                    </button>
                <div style="text-align:center;color:#555;font-size:10px;margin-top:6px;">
                    ‰ªÖÊèê‰∫§Ê†áËÆ∞‰∏∫ÈîôËØØÁöÑÊù°ÁõÆ
                </div>
            </div>
        </div>
        
        <script>
        // ==================== ÂÖ≠ÂêàÂΩ©Êï∞ÊçÆ ====================
        const LHC_DATA = {
            // ÁîüËÇñÂØπÂ∫îÂè∑Á†ÅÔºà2024Âπ¥‰∏∫Âü∫ÂáÜÔºâ
            shengxiao: {
                'Èº†': [6, 18, 30, 42],
                'Áâõ': [5, 17, 29, 41],
                'Ëôé': [4, 16, 28, 40],
                'ÂÖî': [3, 15, 27, 39],
                'Èæô': [2, 14, 26, 38],
                'Ëõá': [1, 13, 25, 37, 49],
                'È©¨': [12, 24, 36, 48],
                'Áæä': [11, 23, 35, 47],
                'Áå¥': [10, 22, 34, 46],
                'È∏°': [9, 21, 33, 45],
                'Áãó': [8, 20, 32, 44],
                'Áå™': [7, 19, 31, 43]
            },
            
            // ‰∫îË°åÂØπÂ∫îÂè∑Á†Å
            wuxing: {
                'Èáë': [3, 4, 11, 12, 25, 26, 33, 34, 41, 42],
                'Êú®': [7, 8, 15, 16, 23, 24, 37, 38, 45, 46],
                'Ê∞¥': [13, 14, 21, 22, 29, 30, 43, 44],
                'ÁÅ´': [1, 2, 9, 10, 17, 18, 31, 32, 39, 40, 47, 48],
                'Âúü': [5, 6, 19, 20, 27, 28, 35, 36, 49]
            },
            
            // Ê≥¢Ëâ≤ÂØπÂ∫îÂè∑Á†Å
            bose: {
                'Á∫¢Ê≥¢': [1, 2, 7, 8, 12, 13, 18, 19, 23, 24, 29, 30, 34, 35, 40, 45, 46],
                'ËìùÊ≥¢': [3, 4, 9, 10, 14, 15, 20, 25, 26, 31, 36, 37, 41, 42, 47, 48],
                'ÁªøÊ≥¢': [5, 6, 11, 16, 17, 21, 22, 27, 28, 32, 33, 38, 39, 43, 44, 49]
            },
            
            // ÂÆ∂Á¶ΩÈáéÂÖΩ
            jiaqin: {
                'ÂÆ∂Á¶Ω': ['Áâõ', 'È©¨', 'Áæä', 'È∏°', 'Áãó', 'Áå™'],
                'ÈáéÂÖΩ': ['Èº†', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'Áå¥']
            }
        };
        
        // ==================== Áä∂ÊÄÅÁÆ°ÁêÜ ====================
        let appState = {
            lotteryNumbers: [],  // ÂΩìÂâçÊòæÁ§∫ÁöÑÂºÄÂ•ñÂè∑Á†Å [1,2,3,4,5,6,ÁâπÁ†Å]
            currentLotteryType: 'xam',  // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÂΩ©ÁßçÔºöxam=Êñ∞Êæ≥Èó®, hk=È¶ôÊ∏Ø
            lotteryData: {
                xam: { numbers: [], issue: '', time: '', source: '' },  // Êñ∞Êæ≥Èó®Êï∞ÊçÆ
                hk: { numbers: [], issue: '', time: '', source: '' }    // È¶ôÊ∏ØÊï∞ÊçÆ
            },
            lotteryHistory: {
                xam: [],  // Êñ∞Êæ≥Èó®ÂéÜÂè≤ËÆ∞ÂΩïÔºåÊúÄÂ§ö10Êúü [{numbers, issue, time, source}, ...]
                hk: []    // È¶ôÊ∏ØÂéÜÂè≤ËÆ∞ÂΩïÔºåÊúÄÂ§ö10Êúü
            },
            odds: {
                tema: 43,
                shengxiao: 12,
                red: 2.8,
                blue: 2.8,
                green: 2.8,
                daxiao: 2,
                danshuang: 2
            },
            machineCode: '',
            isActivated: false,
            trialDaysLeft: 7
        };
        
        // ==================== Ë∞ÉËØï‰ø°ÊÅØÂ≠òÂÇ®ÔºàÂÆåÊï¥Êï∞ÊçÆÈìæÊù° v3.2Ôºâ ====================
        let debugInfo = {
            // üìå Á¨¨1-2Ê≠•ÔºöËæìÂÖ•Èò∂ÊÆµ
            originalInput: '',     // Áî®Êà∑ÂéüÂßãËæìÂÖ•
            sanitizedInput: '',    // ‰ª£Âè∑ËΩ¨Êç¢ÂêéÁöÑËæìÂÖ•ÔºàZ‰ª£Âè∑Ê†ºÂºèÔºâ
            normalizeInfo: '',     // ËßÑËåÉÂåñ‰ø°ÊÅØ
            
            // üìå Á¨¨3Ê≠•ÔºöAI/Ê≠£ÂàôÈò∂ÊÆµ
            aiInput: '',           // ÂèëÈÄÅÁªôAIÁöÑÂÜÖÂÆπ
            aiOutput: '',          // AIÂéüÂßãËæìÂá∫
            aiParsed: null,        // AIËß£ÊûêÂêéÁöÑJSON
            modelUsed: '',         // ‰ΩøÁî®ÁöÑÊ®°Âûã: regex / deepseek / zhipu...
            latencyMs: 0,          // AIÂìçÂ∫îËÄóÊó∂(ÊØ´Áßí)
            
            // üìå Á¨¨4Ê≠•ÔºöÂêéÁ´ØËØÜÂà´ÁªìÊûúÔºàüÜï v3.1 Êñ∞Â¢ûÔºâ
            extractItems: [],      // Ê≠£Âàô/AI ËØÜÂà´ÁöÑÊØèÊù°ËØ¶ÊÉÖ [{code,zodiac,nums,amt,raw}]
            
            // üìå Á¨¨5Ê≠•ÔºöÂêéÁ´ØËÆ°ÁÆóÁªìÊûúÔºàüÜï v3.1 Êñ∞Â¢ûÔºâ
            calcInputCount: 0,     // ËØÜÂà´Êù°Êï∞ÔºàËæìÂÖ•Ôºâ
            calcOutputCount: 0,    // Â±ïÂºÄÂêéÊù°Êï∞ÔºàËæìÂá∫Ôºâ‚≠êÂÖ≥ÈîÆÔºÅSXTMÂ∫îÂ±ïÂºÄ‰∏∫4Êù°
            calcItems: [],         // ËÆ°ÁÆóÂêéÊØèÊù°ËØ¶ÊÉÖ [{code,n,a,z,w,v,r,idx}]
            calcS1: 0,             // ÊÄªÊäïÂÖ•
            calcS2: 0,             // ÂëΩ‰∏≠Êï∞
            calcS3: 0,             // ÂëΩ‰∏≠ÈáëÈ¢ù
            calcS4: 0,             // ÁªìÁÆó
            backendVersion: '',    // üÜï v3.2.1 ÂêéÁ´ØÁâàÊú¨
            
            // üìå ÁΩëÁªúËØäÊñ≠
            requestMode: '',       // ËØ∑Ê±ÇÊ®°Âºè
            targetUrl: '',         // ÁõÆÊ†áÂú∞ÂùÄ
            networkError: '',      // ÁΩëÁªúÈîôËØØ
            rawResponse: '',       // ÂéüÂßãÂìçÂ∫î
            
            // üìå Ëß£ÊûêÁªìÊûú
            aiBets: [],            // AIËØÜÂà´ÁöÑ‰∏ãÊ≥®ÂàóË°®
            localBets: [],         // Êú¨Âú∞Ëß£ÊûêÁöÑ‰∏ãÊ≥®ÂàóË°®
            
            // üìå ÈîôËØØ‰ø°ÊÅØ
            lastError: ''          // ÊúÄÂêé‰∏ÄÊ¨°ÈîôËØØ
        };
        
        // ÊòæÁ§∫AIËØÜÂà´ËØ¶ÊÉÖ
        function showAIDebug() {
            let content = `<div style="max-height:70vh;overflow:auto;font-size:13px;line-height:1.6;">`;
            content += `<h3 style="color:#9b59b6;margin:0 0 10px;">ü§ñ AIËØÜÂà´ËØ¶ÊÉÖ</h3>`;
            
            if (debugInfo.lastError) {
                content += `<div style="background:#c0392b;padding:10px;border-radius:6px;margin-bottom:10px;">
                    <strong>‚ùå ÈîôËØØÔºö</strong>${debugInfo.lastError}
                </div>`;
            }
            
            // ÊòæÁ§∫ÁΩëÁªúËØäÊñ≠‰ø°ÊÅØ
            if (debugInfo.requestMode || debugInfo.networkError) {
                content += `<div style="background:rgba(52,152,219,0.3);padding:10px;border-radius:6px;margin-bottom:10px;">
                    <strong>üåê ÁΩëÁªúËØäÊñ≠Ôºö</strong><br>
                    <small>ËØ∑Ê±ÇÊ®°Âºè: ${debugInfo.requestMode || 'Êú™Áü•'}</small><br>
                    <small>ÁõÆÊ†áÂú∞ÂùÄ: ${(debugInfo.targetUrl || '').substring(0, 50)}...</small>`;
                if (debugInfo.networkError) {
                    content += `<br><span style="color:#e74c3c;"><strong>‚ö†Ô∏è ${debugInfo.networkError}</strong></span>`;
                }
                if (debugInfo.rawResponse && !debugInfo.aiOutput) {
                    content += `<br><small style="color:#95a5a6;">ÂéüÂßãÂìçÂ∫î: ${(debugInfo.rawResponse || '').substring(0, 100)}...</small>`;
                }
                content += `</div>`;
            }
            
            // ÊòæÁ§∫Â≠óÁ¨¶ËßÑËåÉÂåñ‰ø°ÊÅØÔºàËØäÊñ≠ÊâãÊú∫ËæìÂÖ•ÈóÆÈ¢òÔºâ
            if (debugInfo.normalizeInfo) {
                content += `<div style="background:rgba(241,196,15,0.3);padding:10px;border-radius:6px;margin-bottom:10px;">
                    <strong>üì± Â≠óÁ¨¶ËßÑËåÉÂåñÔºö</strong>${debugInfo.normalizeInfo}
                    <br><small style="color:#f1c40f;">ÔºàÊ£ÄÊµãÂà∞ÁâπÊÆäÂ≠óÁ¨¶ÔºåÂ∑≤Ëá™Âä®ËΩ¨Êç¢Ôºâ</small>
                </div>`;
            }
            
            content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>üì§ AIËæìÂÖ•ÔºàÁî®Êà∑ÂéüÊñáÔºâÔºö</strong><br>
                <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;">${debugInfo.aiInput || 'Êó†'}</pre>
            </div>`;
            
            content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>üì• AIÂéüÂßãËæìÂá∫Ôºö</strong><br>
                <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${debugInfo.aiOutput || 'Êó†'}</pre>
            </div>`;
            
            content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>üîç AIËØÜÂà´ÁªìÊûúÔºö</strong><br>`;
            if (debugInfo.aiParsed && debugInfo.aiParsed.items) {
                content += `<table style="width:100%;border-collapse:collapse;margin-top:8px;">
                    <tr style="background:rgba(0,0,0,0.3);"><th style="padding:6px;border:1px solid #555;">ÂéüÊñá</th><th style="padding:6px;border:1px solid #555;">AIËØÜÂà´Á±ªÂûã</th></tr>`;
                for (const item of debugInfo.aiParsed.items) {
                    content += `<tr><td style="padding:6px;border:1px solid #555;">${item.raw || ''}</td><td style="padding:6px;border:1px solid #555;color:#9b59b6;font-weight:bold;">${item.type || ''}</td></tr>`;
                }
                content += `</table>`;
            } else {
                content += `<span style="color:#888;">Êó†ËØÜÂà´ÁªìÊûú</span>`;
            }
            content += `</div>`;
            
            content += `<div style="background:rgba(155,89,182,0.2);padding:10px;border-radius:6px;">
                <strong>üìä ÊúÄÁªàÊèêÂèñÁöÑ‰∏ãÊ≥®Ôºà${debugInfo.aiBets.length}Êù°ÔºâÔºö</strong><br>`;
            if (debugInfo.aiBets.length > 0) {
                content += `<pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${JSON.stringify(debugInfo.aiBets, null, 2)}</pre>`;
            } else {
                content += `<span style="color:#888;">Êó†</span>`;
            }
            content += `</div></div>`;
            
            showDebugModal('ü§ñ AIËØÜÂà´ËØ¶ÊÉÖ', content);
        }
        
        // ÊòæÁ§∫Á®ãÂ∫èËØÜÂà´ËØ¶ÊÉÖ
        function showLocalDebug() {
            const input = document.getElementById('bet-input').value.trim();
            
            // ÈáçÊñ∞ÊâßË°åÊú¨Âú∞Ëß£Êûê
            const localBets = parseBetInput(input);
            debugInfo.localBets = localBets;
            
            let content = `<div style="max-height:70vh;overflow:auto;font-size:13px;line-height:1.6;">`;
            content += `<h3 style="color:#27ae60;margin:0 0 10px;">üìã Á®ãÂ∫èÊú¨Âú∞ËØÜÂà´ËØ¶ÊÉÖ</h3>`;
            
            content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>üì§ ËæìÂÖ•ÔºàÁî®Êà∑ÂéüÊñáÔºâÔºö</strong><br>
                <pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;">${input || 'Êó†'}</pre>
            </div>`;
            
            content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;margin-bottom:10px;">
                <strong>üîç ÈÄêË°åËØÜÂà´ÁªìÊûúÔºö</strong><br>`;
            const lines = input.split('\n').filter(l => l.trim());
            if (lines.length > 0) {
                content += `<table style="width:100%;border-collapse:collapse;margin-top:8px;">
                    <tr style="background:rgba(0,0,0,0.3);"><th style="padding:6px;border:1px solid #555;">ÂéüÊñá</th><th style="padding:6px;border:1px solid #555;">Á®ãÂ∫èËØÜÂà´Á±ªÂûã</th></tr>`;
                for (const line of lines) {
                    const lineBets = parseBetLine(line.trim());
                    const types = lineBets.map(b => b.type).join(', ') || 'Êú™ËØÜÂà´';
                    content += `<tr><td style="padding:6px;border:1px solid #555;">${line}</td><td style="padding:6px;border:1px solid #555;color:#27ae60;font-weight:bold;">${types}</td></tr>`;
                }
                content += `</table>`;
            } else {
                content += `<span style="color:#888;">Êó†ËæìÂÖ•</span>`;
            }
            content += `</div>`;
            
            content += `<div style="background:rgba(39,174,96,0.2);padding:10px;border-radius:6px;">
                <strong>üìä ÊúÄÁªàÊèêÂèñÁöÑ‰∏ãÊ≥®Ôºà${localBets.length}Êù°ÔºâÔºö</strong><br>`;
            if (localBets.length > 0) {
                content += `<pre style="white-space:pre-wrap;margin:5px 0;background:rgba(0,0,0,0.3);padding:8px;border-radius:4px;max-height:200px;overflow:auto;">${JSON.stringify(localBets, null, 2)}</pre>`;
            } else {
                content += `<span style="color:#888;">Êó†</span>`;
            }
            content += `</div></div>`;
            
            showDebugModal('üìã Á®ãÂ∫èËØÜÂà´ËØ¶ÊÉÖ', content);
        }
        
        // ÊòæÁ§∫Ë∞ÉËØïÂºπÁ™ó
        function showDebugModal(title, content) {
            // ÁßªÈô§Â∑≤ÊúâÂºπÁ™ó
            const existing = document.getElementById('debug-modal');
            if (existing) existing.remove();
            
            const modal = document.createElement('div');
            modal.id = 'debug-modal';
            modal.innerHTML = `
                <div style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.8);z-index:99999;display:flex;justify-content:center;align-items:center;padding:20px;">
                    <div style="background:#1a1a2e;border-radius:12px;max-width:600px;width:100%;max-height:90vh;overflow:hidden;box-shadow:0 10px 40px rgba(0,0,0,0.5);">
                        <div style="display:flex;justify-content:space-between;align-items:center;padding:15px 20px;background:rgba(0,0,0,0.3);border-bottom:1px solid rgba(255,255,255,0.1);">
                            <span style="font-weight:bold;font-size:16px;">${title}</span>
                            <button onclick="document.getElementById('debug-modal').remove()" style="background:none;border:none;color:white;font-size:24px;cursor:pointer;padding:0 5px;">√ó</button>
                        </div>
                        <div style="padding:20px;overflow:auto;max-height:calc(90vh - 60px);">
                            ${content}
                        </div>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // ==================== ÂàùÂßãÂåñ ====================
        async function init() {
            console.log('üöÄ [init] Â∫îÁî®ÂàùÂßãÂåñÂºÄÂßã...');
            console.log('üìç [init] ÂΩìÂâçURL:', window.location.href);
            console.log('‚è∞ [init] ÂàùÂßãÂåñÊó∂Èó¥:', new Date().toLocaleString('zh-CN'));
            
            try {
                // ÁîüÊàêÊú∫Âô®Á†Å
                console.log('üîë [init] ÁîüÊàêÊú∫Âô®Á†Å...');
                appState.machineCode = await generateMachineCode();
                document.getElementById('machine-code').textContent = appState.machineCode;
                console.log('‚úÖ [init] Êú∫Âô®Á†ÅÁîüÊàêÂÆåÊàê:', appState.machineCode);
                
                // Âä†ËΩΩ‰øùÂ≠òÁöÑÈÖçÁΩÆ
                console.log('üìÇ [init] Âä†ËΩΩÊú¨Âú∞ÈÖçÁΩÆ...');
                loadConfig();
                console.log('‚úÖ [init] ÈÖçÁΩÆÂä†ËΩΩÂÆåÊàê');
                
                // ÊÅ¢Â§çAIÊ®°ÂûãÈÄâÊã©
                const savedAIProvider = localStorage.getItem('ai_provider') || 'openrouter';
                switchAIModel(savedAIProvider);
                console.log('ü§ñ [init] AIÊ®°Âûã:', savedAIProvider);
                
                // Á°Æ‰øùÈªòËÆ§ÂΩ©Áßç‰∏∫Êñ∞Êæ≥Èó®
                if (!appState.currentLotteryType) {
                    appState.currentLotteryType = 'xam';
                }
                console.log('üéØ [init] ÂΩìÂâçÂΩ©Áßç:', appState.currentLotteryType);
                
                // Âä†ËΩΩËµîÁéáËÆæÁΩÆ
                console.log('üí∞ [init] Âä†ËΩΩËµîÁéáËÆæÁΩÆ...');
                loadOddsFromStorage();
                
                // Ê£ÄÊü•ÊøÄÊ¥ªÁä∂ÊÄÅ
                console.log('üîê [init] Ê£ÄÊü•ÊøÄÊ¥ªÁä∂ÊÄÅ...');
                checkLicense();
                console.log('‚úÖ [init] ÊøÄÊ¥ªÁä∂ÊÄÅ:', appState.isActivated ? 'Â∑≤ÊøÄÊ¥ª' : 'Êú™ÊøÄÊ¥ª');
                
                // Ê∏≤ÊüìÂèÇÁÖßË°®
                renderReferenceTables();
                
                // Êõ¥Êñ∞ÊòæÁ§∫
                updateDisplay();
                
                // Êõ¥Êñ∞ÂàáÊç¢ÊåâÈíÆÁä∂ÊÄÅ
                updateSwitchButtons();
                
                // Â¶ÇÊûúÊ≤°ÊúâÊï∞ÊçÆÔºåÂ∞ùËØïËá™Âä®Ëé∑ÂèñÔºà‰∏çÈòªÂ°ûÔºâ
                console.log('üîÑ [init] ÂºÄÂßãËá™Âä®Ëé∑ÂèñÊï∞ÊçÆ...');
                tryAutoFetchOnce();
                
                // Ëá™Âä®Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩïÔºàÊñ∞Êæ≥Èó®ÂíåÈ¶ôÊ∏ØÂêåÊ≠•Êõ¥Êñ∞10Êù°Ôºâ
                console.log('üìú [init] Ëá™Âä®Ëé∑ÂèñÂéÜÂè≤ÂºÄÂ•ñËÆ∞ÂΩï...');
                fetchHistoryData().then(() => {
                    console.log('‚úÖ [init] ÂéÜÂè≤ËÆ∞ÂΩïËé∑ÂèñÂÆåÊàê');
                }).catch(err => {
                    console.warn('‚ö†Ô∏è [init] ÂéÜÂè≤ËÆ∞ÂΩïËé∑ÂèñÂ§±Ë¥•:', err);
                });
                
                // ÂêØÂä®ÂºÄÂ•ñÊó∂ÊÆµËá™Âä®Âà∑Êñ∞
                startLiveRefresh();
                
                console.log('‚úÖ [init] Â∫îÁî®ÂàùÂßãÂåñÂÆåÊàêÔºÅ');
            } catch (error) {
                console.error('‚ùå [init] ÂàùÂßãÂåñÂá∫Èîô:', error);
            }
        }
        
        // ==================== ÂºÄÂ•ñÊó∂ÊÆµËá™Âä®Âà∑Êñ∞ÔºàÁõ¥Êí≠ÊïàÊûúÔºâ ====================
        let liveRefreshInterval = null;
        let checkLiveInterval = null;
        // üÜï v3.11.22 ËÆ∞ÂΩï‰∏äÊ¨°ÂºÄÂ•ñÂè∑Á†ÅÔºåÁî®‰∫éÂà§Êñ≠Âè∑Á†ÅÊòØÂê¶ÂèòÂåñ
        let lastLotteryNumbersStr = '';
        let liveAnimationStopped = false;  // Ê†áËÆ∞Âä®ÁîªÊòØÂê¶Â∑≤ÂÅúÊ≠¢ÔºàÂè∑Á†ÅÂÆåÊï¥ÂêéÔºâ
        
        // Ê£ÄÊü•ÊòØÂê¶Âú®ÂºÄÂ•ñÊó∂ÊÆµÔºà21:29 - 21:40Ôºâ
        function isLiveTime() {
            const now = new Date();
            const hours = now.getHours();
            const minutes = now.getMinutes();
            // 21:29 Âà∞ 21:40
            if (hours === 21 && minutes >= 29 && minutes <= 40) {
                return true;
            }
            return false;
        }
        
        // üÜï v3.11.22 Ê£ÄÊü•Âè∑Á†ÅÊòØÂê¶ÂÆåÊï¥Ôºà7‰∏™ÊúâÊïàÂè∑Á†ÅÔºâ
        function isLotteryNumbersComplete(numbers) {
            if (!numbers || numbers.length !== 7) return false;
            // Ê£ÄÊü•ÊâÄÊúâÂè∑Á†ÅÈÉΩÊòØÊúâÊïàÁöÑÔºà1-49Ôºâ
            return numbers.every(n => n >= 1 && n <= 49);
        }
        
        // üÜï v3.11.22 Ê£ÄÊü•Âè∑Á†ÅÊòØÂê¶ÊúâÂèòÂåñ
        function hasLotteryNumbersChanged(numbers) {
            const currentStr = numbers ? numbers.join(',') : '';
            const changed = currentStr !== lastLotteryNumbersStr;
            lastLotteryNumbersStr = currentStr;
            return changed;
        }
        
        // ÂêØÂä®ÂºÄÂ•ñÊó∂ÊÆµËá™Âä®Âà∑Êñ∞ÔºàÂèÇËÄÉ index2.htmlÔºöÂºÄÂ•ñÊó∂ÊÆµÊØè5ÁßíÂà∑Êñ∞Ôºâ
        function startLiveRefresh() {
            // ÊØèÂàÜÈíüÊ£ÄÊü•ÊòØÂê¶ËøõÂÖ•ÂºÄÂ•ñÊó∂ÊÆµ
            checkLiveInterval = setInterval(() => {
                if (isLiveTime()) {
                    // ËøõÂÖ•ÂºÄÂ•ñÊó∂ÊÆµÔºåÂºÄÂßãÈ´òÈ¢ëÂà∑Êñ∞
                    if (!liveRefreshInterval) {
                        console.log('üì° ËøõÂÖ•ÂºÄÂ•ñÊó∂ÊÆµÔºåÂºÄÂßãÊØè5ÁßíËá™Âä®Âà∑Êñ∞...');
                        showLiveToast('üì° ÂºÄÂ•ñÁõ¥Êí≠Ê®°ÂºèÂ∑≤ÂºÄÂêØ');
                        // üÜï ÈáçÁΩÆÁä∂ÊÄÅ
                        lastLotteryNumbersStr = '';
                        liveAnimationStopped = false;
                        liveRefreshInterval = setInterval(async () => {
                            await doLiveRefresh();
                        }, 5000); // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°Ôºà‰∏éindex2.html‰∏ÄËá¥Ôºâ
                    }
                } else {
                    // ÈÄÄÂá∫ÂºÄÂ•ñÊó∂ÊÆµÔºåÂÅúÊ≠¢È´òÈ¢ëÂà∑Êñ∞
                    if (liveRefreshInterval) {
                        console.log('‚èπÔ∏è ÂºÄÂ•ñÊó∂ÊÆµÁªìÊùüÔºåÂÅúÊ≠¢Ëá™Âä®Âà∑Êñ∞');
                        clearInterval(liveRefreshInterval);
                        liveRefreshInterval = null;
                        // üÜï ÈáçÁΩÆÁä∂ÊÄÅ
                        lastLotteryNumbersStr = '';
                        liveAnimationStopped = false;
                    }
                }
            }, 60000); // ÊØèÂàÜÈíüÊ£ÄÊü•‰∏ÄÊ¨°
            
            // Á´ãÂç≥Ê£ÄÊü•‰∏ÄÊ¨°
            if (isLiveTime() && !liveRefreshInterval) {
                console.log('üì° ÂΩìÂâçÂú®ÂºÄÂ•ñÊó∂ÊÆµÔºåÂºÄÂßãËá™Âä®Âà∑Êñ∞...');
                showLiveToast('üì° ÂºÄÂ•ñÁõ¥Êí≠Ê®°ÂºèÂ∑≤ÂºÄÂêØ');
                // üÜï ÈáçÁΩÆÁä∂ÊÄÅ
                lastLotteryNumbersStr = '';
                liveAnimationStopped = false;
                liveRefreshInterval = setInterval(async () => {
                    await doLiveRefresh();
                }, 5000); // ÊØè5ÁßíÂà∑Êñ∞‰∏ÄÊ¨°
            }
        }
        
        // üÜï v3.11.22 Áõ¥Êí≠Âà∑Êñ∞Ê†∏ÂøÉÈÄªËæë
        async function doLiveRefresh() {
            try {
                // ÂÖàËÆ∞ÂΩïÂΩìÂâçÂè∑Á†ÅÂ≠óÁ¨¶‰∏≤ÔºàÁî®‰∫éÊØîËæÉÔºâ
                const oldNumbersStr = (appState.lotteryNumbers || []).join(',');
                
                // Ëé∑ÂèñÂâçÂÖàÁ¶ÅÁî®Âä®ÁîªÔºåËÆ© fetchAllLotteryData ÂÜÖÈÉ®ÁöÑÊ∏≤Êüì‰∏çÂ∏¶Âä®Áîª
                window.isLiveAnimationEnabled = false;
                
                // Ëé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆÔºàÂÜÖÈÉ®‰ºöÊ∏≤Êüì‰∏ÄÊ¨°Ôºå‰ΩÜ‰∏çÂ∏¶Âä®ÁîªÔºâ
                await fetchAllLotteryData();
                
                const newNumbers = appState.lotteryNumbers;
                const newNumbersStr = (newNumbers || []).join(',');
                const isComplete = isLotteryNumbersComplete(newNumbers);
                const hasChanged = newNumbersStr !== oldNumbersStr;
                
                // Êõ¥Êñ∞ËÆ∞ÂΩï
                lastLotteryNumbersStr = newNumbersStr;
                
                // Âà§Êñ≠ÊòØÂê¶Â∫îËØ•Êí≠ÊîæÂä®Áîª
                if (isComplete && !hasChanged && lastLotteryNumbersStr === newNumbersStr) {
                    // Âè∑Á†ÅÂÆåÊï¥‰∏îÊú™ÂèòÂåñ ‚Üí Â∑≤ÁªèÂºÄÂÆåÔºåÂÅúÊ≠¢Âä®Áîª
                    if (!liveAnimationStopped) {
                        console.log('‚úÖ ÂºÄÂ•ñÂè∑Á†ÅÂ∑≤ÂÖ®ÈÉ®ÂºÄÂá∫ÔºåÂÅúÊ≠¢Âä®ÁîªÊïàÊûú');
                        showLiveToast('‚úÖ ÂºÄÂ•ñÂÆåÊàê');
                        liveAnimationStopped = true;
                    }
                    // ‰∏çÈúÄË¶ÅÈáçÊñ∞Ê∏≤ÊüìÔºåÂ∑≤ÁªèÂú® fetchAllLotteryData ‰∏≠Ê∏≤ÊüìËøá‰∫Ü
                } else if (hasChanged) {
                    // Âè∑Á†ÅÊúâÂèòÂåñ ‚Üí Êí≠ÊîæÂä®Áîª
                    console.log('üîÑ Âè∑Á†ÅÊúâÊõ¥Êñ∞ÔºåÊí≠ÊîæÂä®Áîª', oldNumbersStr, '‚Üí', newNumbersStr);
                    window.isLiveAnimationEnabled = true;
                    liveAnimationStopped = false;
                    // ÈáçÊñ∞Ê∏≤Êüì‰ª•ÊòæÁ§∫Âä®Áîª
                    renderLotteryBalls();
                    // Ê∏≤ÊüìÂÆåÂêéÈáçÁΩÆÊ†áÂøó
                    window.isLiveAnimationEnabled = false;
                }
                // else: Âè∑Á†ÅÊú™ÂèòÂåñ‰ΩÜ‰∏çÂÆåÊï¥ÔºàÁ≠âÂæÖ‰∏≠Ôºâ‚Üí Â∑≤ÁªèÊ∏≤ÊüìËøá‰∫ÜÔºå‰∏çÈúÄË¶ÅÈ¢ùÂ§ñÊìç‰Ωú
            } catch (e) {
                console.log('Áõ¥Êí≠Âà∑Êñ∞Â§±Ë¥•', e);
            }
        }
        
        // ÊòæÁ§∫Áõ¥Êí≠ÊèêÁ§∫
        function showLiveToast(msg) {
            const toast = document.createElement('div');
            toast.innerHTML = msg;
            toast.style.cssText = 'position:fixed;top:20%;left:50%;transform:translateX(-50%);background:linear-gradient(90deg,#e94560,#c23a51);color:white;padding:12px 20px;border-radius:8px;font-size:13px;z-index:9999;box-shadow:0 4px 15px rgba(233,69,96,0.4);';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
        
        
        // ‰ªé data.json Âä†ËΩΩÈ¢ÑËé∑ÂèñÁöÑÊï∞ÊçÆÔºàGitHub Actions ÊñπÊ°àÔºâ
        async function loadDataFromJSON() {
            console.log('üîÑ [loadDataFromJSON] ÂºÄÂßã‰ªé data.json Âä†ËΩΩÊï∞ÊçÆ...');
            try {
                const url = './data.json?t=' + Date.now();
                console.log('üì° [loadDataFromJSON] ËØ∑Ê±ÇURL:', url);
                
                const response = await fetch(url);
                console.log('üì• [loadDataFromJSON] ÂìçÂ∫îÁä∂ÊÄÅ:', response.status, response.statusText);
                
                if (!response.ok) {
                    console.warn('‚ö†Ô∏è [loadDataFromJSON] ÂìçÂ∫î‰∏çOKÔºåËøîÂõûfalse');
                    return false;
                }
                
                const data = await response.json();
                console.log('üìä [loadDataFromJSON] Ëé∑ÂèñÂà∞ÁöÑÊï∞ÊçÆ:', JSON.stringify(data, null, 2));
                
                if (!data) {
                    console.warn('‚ö†Ô∏è [loadDataFromJSON] Êï∞ÊçÆ‰∏∫Á©∫ÔºåËøîÂõûfalse');
                    return false;
                }
                
                let loaded = false;
                
                // Âä†ËΩΩÊñ∞Êæ≥Èó®Êï∞ÊçÆ
                if (data.xam && data.xam.numbers && data.xam.numbers.length === 7) {
                    console.log('üé∞ [loadDataFromJSON] Êñ∞Êæ≥Èó®Êï∞ÊçÆÊúâÊïà:', data.xam.numbers.join(','));
                    appState.lotteryData['xam'] = {
                        numbers: data.xam.numbers,
                        issue: data.xam.issue,
                        time: data.xam.time,
                        source: 'data.json'
                    };
                    addToHistory('xam', data.xam);
                    loaded = true;
                } else {
                    console.warn('‚ö†Ô∏è [loadDataFromJSON] Êñ∞Êæ≥Èó®Êï∞ÊçÆÊó†ÊïàÊàñ‰∏çÂÆåÊï¥');
                }
                
                // Âä†ËΩΩÈ¶ôÊ∏ØÊï∞ÊçÆ
                if (data.hk && data.hk.numbers && data.hk.numbers.length === 7) {
                    console.log('üé∞ [loadDataFromJSON] È¶ôÊ∏ØÊï∞ÊçÆÊúâÊïà:', data.hk.numbers.join(','));
                    appState.lotteryData['hk'] = {
                        numbers: data.hk.numbers,
                        issue: data.hk.issue,
                        time: data.hk.time,
                        source: 'data.json'
                    };
                    addToHistory('hk', data.hk);
                    loaded = true;
                } else {
                    console.warn('‚ö†Ô∏è [loadDataFromJSON] È¶ôÊ∏ØÊï∞ÊçÆÊó†ÊïàÊàñ‰∏çÂÆåÊï¥');
                }
                
                if (loaded) {
                    // Âä†ËΩΩÂΩìÂâçÂΩ©ÁßçÊï∞ÊçÆ
                    const currentData = appState.lotteryData[appState.currentLotteryType];
                    console.log('üìå [loadDataFromJSON] ÂΩìÂâçÂΩ©Áßç:', appState.currentLotteryType);
                    
                    if (currentData && currentData.numbers && currentData.numbers.length === 7) {
                        appState.lotteryNumbers = currentData.numbers;
                        console.log('‚úÖ [loadDataFromJSON] ËÆæÁΩÆÂΩìÂâçÂè∑Á†Å:', appState.lotteryNumbers.join(','));
                    }
                    
                    saveConfig();
                    renderLotteryBalls();
                    renderHistoryList();
                    
                    console.log('‚úÖ [loadDataFromJSON] Êï∞ÊçÆÂä†ËΩΩÊàêÂäüÔºåÊõ¥Êñ∞Êó∂Èó¥:', data.updateTime);
                } else {
                    console.warn('‚ö†Ô∏è [loadDataFromJSON] Ê≤°ÊúâÊúâÊïàÊï∞ÊçÆË¢´Âä†ËΩΩ');
                }
                
                return loaded;
            } catch (e) {
                console.error('‚ùå [loadDataFromJSON] Âä†ËΩΩÂ§±Ë¥•:', e.message, e);
                return false;
            }
        }
        
        // üÜï v3.11.23 ÊØèÊ¨°ÊâìÂºÄÈ°µÈù¢ÈÉΩËá™Âä®Ëé∑ÂèñÊúÄÊñ∞ÂºÄÂ•ñÊï∞ÊçÆ
        async function tryAutoFetchOnce() {
            console.log('üîÑ [tryAutoFetchOnce] Ëá™Âä®Ëé∑ÂèñÊúÄÊñ∞ÂºÄÂ•ñÊï∞ÊçÆ...');
            showAutoFetchStatus('üîÑ Ê≠£Âú®Âä†ËΩΩÊúÄÊñ∞ÂºÄÂ•ñÊï∞ÊçÆ...');
            
            // ÊñπÊ°à1Ôºö‰ºòÂÖà‰ªé data.json ËØªÂèñÔºàGitHub Actions È¢ÑËé∑ÂèñÁöÑÊï∞ÊçÆÔºåÊõ¥Êñ∞È¢ëÁéáÈ´òÔºâ
            try {
                const jsonLoaded = await loadDataFromJSON();
                if (jsonLoaded) {
                    console.log('‚úÖ [tryAutoFetchOnce] ‰ªé data.json Âä†ËΩΩÊàêÂäü');
                    showAutoFetchStatus('‚úÖ ÂºÄÂ•ñÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞', 'success');
                    setTimeout(hideAutoFetchStatus, 2000);
                    return;
                }
            } catch (e) {
                console.log('‚ö†Ô∏è [tryAutoFetchOnce] data.json Âä†ËΩΩÂ§±Ë¥•:', e.message);
            }
            
            // ÊñπÊ°à2Ôºödata.json Â§±Ë¥•ÔºåÂ∞ùËØïÁõ¥Êé•Ë∞ÉÁî® APIÔºàÂ§áÈÄâÊñπÊ°àÔºâ
            console.log('üîÑ [tryAutoFetchOnce] data.json Â§±Ë¥•ÔºåÂ∞ùËØïË∞ÉÁî® API...');
            showAutoFetchStatus('üîÑ Ê≠£Âú®Ëé∑ÂèñÊúÄÊñ∞Êï∞ÊçÆ...');
            
            let success = false;
            for (let retry = 0; retry < 2 && !success; retry++) {
                try {
                    if (retry > 0) {
                        showAutoFetchStatus(`üîÑ ÈáçËØïËé∑Âèñ‰∏≠...(${retry}/2)`);
                        await new Promise(r => setTimeout(r, 1000));
                    }
                    await fetchAllLotteryData();
                    
                    const newXamData = appState.lotteryData['xam'];
                    const newHkData = appState.lotteryData['hk'];
                    if ((newXamData && newXamData.numbers && newXamData.numbers.length === 7) ||
                        (newHkData && newHkData.numbers && newHkData.numbers.length === 7)) {
                        success = true;
                        console.log('‚úÖ [tryAutoFetchOnce] API Ëé∑ÂèñÊàêÂäü');
                        showAutoFetchStatus('‚úÖ ÂºÄÂ•ñÊï∞ÊçÆÂ∑≤Êõ¥Êñ∞', 'success');
                    }
                } catch (e) {
                    console.log(`‚ö†Ô∏è [tryAutoFetchOnce] APIËé∑ÂèñÂ§±Ë¥•(Â∞ùËØï${retry + 1}):`, e.message);
                }
            }
            
            if (!success) {
                // ÊñπÊ°à3ÔºöAPI‰πüÂ§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠òÔºàÂ¶ÇÊûúÊúâÔºâ
                const xamData = appState.lotteryData['xam'];
                const hkData = appState.lotteryData['hk'];
                if ((xamData && xamData.numbers && xamData.numbers.length === 7) ||
                    (hkData && hkData.numbers && hkData.numbers.length === 7)) {
                    console.log('‚ö†Ô∏è [tryAutoFetchOnce] ‰ΩøÁî®Êú¨Âú∞ÁºìÂ≠òÊï∞ÊçÆ');
                    showAutoFetchStatus('‚ö†Ô∏è ÁΩëÁªúÂºÇÂ∏∏Ôºå‰ΩøÁî®ÁºìÂ≠òÊï∞ÊçÆ', 'warning');
                } else {
                    showAutoFetchStatus('‚ö†Ô∏è Ëé∑ÂèñÂ§±Ë¥•ÔºåËØ∑ÊâãÂä®Ëé∑Âèñ', 'warning');
                }
            }
            
            setTimeout(hideAutoFetchStatus, 3000);
        }
        
        // ÊòæÁ§∫Ëá™Âä®Ëé∑ÂèñÁä∂ÊÄÅ
        function showAutoFetchStatus(msg, type = 'loading') {
            let statusDiv = document.getElementById('auto-fetch-status');
            if (!statusDiv) {
                statusDiv = document.createElement('div');
                statusDiv.id = 'auto-fetch-status';
                statusDiv.style.cssText = 'position:fixed;top:60px;left:50%;transform:translateX(-50%);padding:10px 20px;border-radius:8px;font-size:13px;z-index:9999;transition:opacity 0.3s;';
                document.body.appendChild(statusDiv);
            }
            
            statusDiv.innerHTML = msg;
            statusDiv.style.opacity = '1';
            
            if (type === 'success') {
                statusDiv.style.background = 'linear-gradient(90deg,#2ecc71,#27ae60)';
                statusDiv.style.color = 'white';
            } else if (type === 'warning') {
                statusDiv.style.background = 'linear-gradient(90deg,#f39c12,#e67e22)';
                statusDiv.style.color = 'white';
            } else {
                statusDiv.style.background = 'linear-gradient(90deg,#667eea,#764ba2)';
                statusDiv.style.color = 'white';
            }
        }
        
        // ÈöêËóèËá™Âä®Ëé∑ÂèñÁä∂ÊÄÅ
        function hideAutoFetchStatus() {
            const statusDiv = document.getElementById('auto-fetch-status');
            if (statusDiv) {
                statusDiv.style.opacity = '0';
                setTimeout(() => statusDiv.remove(), 300);
            }
        }
        
        // Ëé∑ÂèñÊâÄÊúâÂΩ©ÁßçÊï∞ÊçÆ
        async function fetchAllLotteryData() {
            const api = LOTTERY_APIS.marksix6;
            
            // Ëé∑ÂèñÊï∞ÊçÆÔºàÂèØËÉΩÊäõÂá∫ÂºÇÂ∏∏Ôºâ
            const data = await fetchWithProxy(api.url);
            
            let hasValidData = false;
            
            // Ëß£ÊûêÊñ∞Êæ≥Èó®Êï∞ÊçÆ
            const xamResult = api.parse(data, 'xam');
            if (xamResult && xamResult.numbers && xamResult.numbers.length === 7) {
                appState.lotteryData['xam'] = {
                    numbers: xamResult.numbers,
                    issue: xamResult.issue,
                    time: xamResult.time,
                    source: xamResult.source
                };
                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                addToHistory('xam', xamResult);
                hasValidData = true;
            }
            
            // Ëß£ÊûêÈ¶ôÊ∏ØÊï∞ÊçÆ
            const hkResult = api.parse(data, 'hk');
            if (hkResult && hkResult.numbers && hkResult.numbers.length === 7) {
                appState.lotteryData['hk'] = {
                    numbers: hkResult.numbers,
                    issue: hkResult.issue,
                    time: hkResult.time,
                    source: hkResult.source
                };
                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                addToHistory('hk', hkResult);
                hasValidData = true;
            }
            
            // Â¶ÇÊûúÊ≤°ÊúâËé∑ÂèñÂà∞‰ªª‰ΩïÊúâÊïàÊï∞ÊçÆÔºåÊäõÂá∫ÈîôËØØ
            if (!hasValidData) {
                throw new Error('Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•ÔºåÊú™Ëé∑ÂèñÂà∞ÊúâÊïàÂºÄÂ•ñÂè∑Á†Å');
            }
            
            // Âä†ËΩΩÂΩìÂâçÂΩ©ÁßçÁöÑÊï∞ÊçÆ
            const currentData = appState.lotteryData[appState.currentLotteryType];
            if (currentData && currentData.numbers && currentData.numbers.length === 7) {
                appState.lotteryNumbers = currentData.numbers;
            }
            
            // ‰øùÂ≠òÂπ∂Âà∑Êñ∞ÊòæÁ§∫
            saveConfig();
            renderLotteryBalls();
            renderHistoryList();  // Âà∑Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
            
            return true; // ËøîÂõûÊàêÂäüÊ†áÂøó
        }
        
        // ==================== Êú∫Âô®Á†ÅÁîüÊàê ====================
        async function generateMachineCode() {
            const components = [];
            
            // CanvasÊåáÁ∫π
            try {
                const canvas = document.createElement('canvas');
                const ctx = canvas.getContext('2d');
                ctx.textBaseline = 'top';
                ctx.font = '14px Arial';
                ctx.fillText('LHC', 2, 2);
                components.push(canvas.toDataURL().slice(-50));
            } catch (e) {
                components.push('no-canvas');
            }
            
            // Â±èÂπï‰ø°ÊÅØ
            components.push(`${screen.width}x${screen.height}x${screen.colorDepth}`);
            components.push(Intl.DateTimeFormat().resolvedOptions().timeZone);
            components.push(navigator.language);
            components.push(navigator.platform);
            components.push(navigator.hardwareConcurrency || 'unknown');
            
            const raw = components.join('|');
            const hashBuffer = await crypto.subtle.digest('SHA-256', new TextEncoder().encode(raw));
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('').toUpperCase();
            
            return `${hashHex.slice(0, 4)}-${hashHex.slice(4, 8)}-${hashHex.slice(8, 12)}-${hashHex.slice(12, 16)}`;
        }
        
        // ==================== È°µÈù¢ÂàáÊç¢ ====================
        function showPage(pageId) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(pageId).classList.add('active');
            
            // ÊâìÂºÄÂºÄÂ•ñËÆæÁΩÆÈ°µÈù¢Êó∂ÔºåÊõ¥Êñ∞ËæìÂÖ•Ê°ÜÊòæÁ§∫ÂíåÂéÜÂè≤ËÆ∞ÂΩï
            if (pageId === 'page-lottery') {
                updateLotteryInputsDisplay();
                renderHistoryList();
            }
            
            // ÊâìÂºÄÂèÇÁÖßË°®È°µÈù¢Êó∂ÔºåÈáçÊñ∞Ê∏≤ÊüìË°®Ê†º
            if (pageId === 'page-reference') {
                renderReferenceTables();
            }
            
            // ÊâìÂºÄËá™ÂÆö‰πâÊ†ºÂºèÈ°µÈù¢Êó∂ÔºåÂä†ËΩΩËÆæÁΩÆ
            if (pageId === 'page-format') {
                loadFormatSettings();
            }
            
            // ÊâìÂºÄÂèÇÊï∞ËÆæÁΩÆÈ°µÈù¢Êó∂ÔºåÂä†ËΩΩËÆæÁΩÆ
            if (pageId === 'page-params') {
                loadParamSettings();
            }
        }
        
        // Êõ¥Êñ∞ÂºÄÂ•ñËÆæÁΩÆÈ°µÈù¢ÁöÑËæìÂÖ•Ê°ÜÊòæÁ§∫
        function updateLotteryInputsDisplay() {
            if (appState.lotteryNumbers && appState.lotteryNumbers.length >= 7) {
                for (let i = 0; i < 6; i++) {
                    const num = appState.lotteryNumbers[i];
                    const input = document.getElementById('num' + (i + 1));
                    if (num > 0) {
                        input.value = String(num).padStart(2, '0');
                        updateInputColor(input, num, false);
                    }
                }
                const specialNum = appState.lotteryNumbers[6];
                const specialInput = document.getElementById('num-special');
                if (specialNum > 0) {
                    specialInput.value = String(specialNum).padStart(2, '0');
                    updateInputColor(specialInput, specialNum, true);
                }
            }
            // ÈöêËóèÈ¢ÑËßà
            hideParsePreview();
        }
        
        // ==================== ÈÖçÁΩÆ‰øùÂ≠ò/Âä†ËΩΩ ====================
        function saveConfig() {
            localStorage.setItem('lhc_config', JSON.stringify(appState));
        }
        
        function loadConfig() {
            const saved = localStorage.getItem('lhc_config');
            if (saved) {
                const config = JSON.parse(saved);
                appState = { ...appState, ...config };
                
                // ÊÅ¢Â§çËµîÁéáËæìÂÖ•Ê°ÜÔºàÂÆâÂÖ®Ê£ÄÊü•ÂÖÉÁ¥†ÊòØÂê¶Â≠òÂú®Ôºâ
                const setInputValue = (id, value) => {
                    const el = document.getElementById(id);
                    if (el && value !== undefined) el.value = value;
                };
                if (appState.odds) {
                    setInputValue('odds-tema', appState.odds.tema);
                    setInputValue('odds-shengxiao', appState.odds.shengxiao);
                    setInputValue('odds-red', appState.odds.red);
                    setInputValue('odds-blue', appState.odds.blue);
                    setInputValue('odds-green', appState.odds.green);
                    setInputValue('odds-daxiao', appState.odds.daxiao);
                    setInputValue('odds-danshuang', appState.odds.danshuang);
                }
            }
            
            // Á°Æ‰øùlotteryDataÁªìÊûÑÂ≠òÂú®
            if (!appState.lotteryData) {
                appState.lotteryData = {
                    xam: { numbers: [], issue: '', time: '', source: '' },
                    hk: { numbers: [], issue: '', time: '', source: '' }
                };
            }
            
            // Á°Æ‰øùÂéÜÂè≤ËÆ∞ÂΩïÁªìÊûÑÂ≠òÂú®
            if (!appState.lotteryHistory) {
                appState.lotteryHistory = {
                    xam: [],
                    hk: []
                };
            }
            
            // ÈªòËÆ§ÂΩ©Áßç‰∏∫Êñ∞Êæ≥Èó®
            if (!appState.currentLotteryType) {
                appState.currentLotteryType = 'xam';
            }
            
            // Â¶ÇÊûúÂΩìÂâçÂΩ©ÁßçÊúâÊï∞ÊçÆÔºåÂä†ËΩΩÂà∞lotteryNumbers
            const currentData = appState.lotteryData[appState.currentLotteryType];
            if (currentData && currentData.numbers && currentData.numbers.length === 7) {
                appState.lotteryNumbers = currentData.numbers;
            }
        }
        
        // ==================== ÂºÄÂ•ñÂè∑Á†Å ====================
        
        // Ëß£ÊûêÁ≤òË¥¥ÁöÑÂºÄÂ•ñÂè∑Á†Å
        function parseLotteryInput() {
            let input = document.getElementById('paste-lottery-input').value.trim();
            
            if (!input) {
                alert('ËØ∑ÂÖàÁ≤òË¥¥ÂºÄÂ•ñÂè∑Á†ÅÔºÅ');
                return;
            }
            
            // ÂÆπÈîôÂ§ÑÁêÜÔºöÂêàÂπ∂Â§ö‰∏™ËøûÁª≠Á©∫Ê†º‰∏∫Âçï‰∏™Á©∫Ê†º
            input = input.replace(/\s+/g, ' ');
            
            // ÊèêÂèñÁâπÁ†ÅÔºàÂ¶ÇÊûúÊúâ"Áâπ"Â≠óÊ†áËØÜÔºâ
            let specialNum = null;
            let cleanInput = input;
            
            // Ê£ÄÊü•ÊòØÂê¶Êúâ"Áâπ"Â≠óÊ†áËØÜÁâπÁ†Å
            const teMatch = input.match(/Áâπ\s*(\d+)/);
            if (teMatch) {
                specialNum = parseInt(teMatch[1]);
                cleanInput = input.replace(/Áâπ\s*\d+/, '').trim();
            }
            
            // Áî®ÂêÑÁßçÂàÜÈöîÁ¨¶ÂàÜÂâ≤ÔºöÁ©∫Ê†º„ÄÅÁÇπ„ÄÅÈÄóÂè∑„ÄÅ‰∏≠ÊñáÈÄóÂè∑„ÄÅÈ°øÂè∑
            const parts = cleanInput.split(/[\s.,Ôºå„ÄÅ„ÄÇ]+/).filter(p => p);
            
            // Ëß£ÊûêÊï∞Â≠ó
            const nums = [];
            const invalidParts = [];
            for (const part of parts) {
                const num = parseInt(part);
                if (!isNaN(num) && num >= 1 && num <= 49) {
                    nums.push(num);
                } else if (part && !/^\s*$/.test(part)) {
                    invalidParts.push(part);
                }
            }
            
            // Â¶ÇÊûúÊ≤°Êúâ"Áâπ"Ê†áËØÜÔºåÊúÄÂêé‰∏Ä‰∏™Â∞±ÊòØÁâπÁ†Å
            if (specialNum === null && nums.length >= 7) {
                specialNum = nums.pop();
            }
            
            // È™åËØÅÊï∞Èáè
            if (nums.length !== 6 || !specialNum) {
                showFormatErrorModal(nums, specialNum, invalidParts, input);
                hideParsePreview();
                return;
            }
            
            if (specialNum < 1 || specialNum > 49) {
                showFormatErrorModal(nums, specialNum, ['ÁâπÁ†ÅË∂ÖÂá∫ËåÉÂõ¥'], input);
                hideParsePreview();
                return;
            }
            
            // ÂêàÂπ∂ÊâÄÊúâÂè∑Á†ÅÊ£ÄÊü•ÈáçÂ§ç
            const allNums = [...nums, specialNum];
            const uniqueNums = new Set(allNums);
            if (uniqueNums.size !== allNums.length) {
                const seen = {};
                const duplicates = [];
                for (const n of allNums) {
                    if (seen[n]) duplicates.push(n);
                    seen[n] = true;
                }
                showDuplicateErrorModal([...new Set(duplicates)]);
                hideParsePreview();
                return;
            }
            
            // Â°´ÂÖ•ËæìÂÖ•Ê°ÜÂπ∂Êõ¥Êñ∞ËæìÂÖ•Ê°ÜËÉåÊôØËâ≤
            for (let i = 0; i < 6; i++) {
                const numInput = document.getElementById('num' + (i + 1));
                numInput.value = String(nums[i]).padStart(2, '0');
                updateInputColor(numInput, nums[i]);
            }
            const specialInput = document.getElementById('num-special');
            specialInput.value = String(specialNum).padStart(2, '0');
            updateInputColor(specialInput, specialNum, true);
            
            // ÊòæÁ§∫Â∏¶Ê≥¢Ëâ≤ÁöÑÈ¢ÑËßà
            showParsePreview(nums, specialNum);
            
            // Ê∏ÖÁ©∫Á≤òË¥¥Ê°Ü
            document.getElementById('paste-lottery-input').value = '';
            
            // ÊèêÁ§∫Áî®Êà∑ÁÇπÂáª‰øùÂ≠òÊåâÈíÆ
            const toast = document.createElement('div');
            toast.innerHTML = '‚úÖ Ëß£ÊûêÊàêÂäüÔºÅËØ∑ÁÇπÂáª<b>„Äå‰øùÂ≠òÂºÄÂ•ñÂè∑Á†Å„Äç</b>ÊåâÈíÆÂ∫îÁî®';
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.9);color:#4CAF50;padding:15px 20px;border-radius:10px;font-size:13px;z-index:9999;text-align:center;max-width:280px;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2500);
        }
        
        // ÊòæÁ§∫Ê†ºÂºèÈîôËØØÂºπÁ™ó
        function showFormatErrorModal(nums, specialNum, invalidParts, originalInput) {
            const correctFormat = '01 08 09 15 24 26 Áâπ27';
            
            // ÂàõÂª∫ÂºπÁ™óHTML
            let html = `
            <div id="format-error-modal" style="position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.7);display:flex;align-items:center;justify-content:center;z-index:9999;padding:20px;">
                <div style="background:#fff;border-radius:12px;padding:20px;max-width:320px;width:100%;color:#333;">
                    <div style="font-size:18px;font-weight:bold;margin-bottom:15px;">‚ùå Ê†ºÂºèÈîôËØØÔºÅ</div>
                    
                    <div style="margin-bottom:12px;">
                        <div style="color:#666;font-size:13px;">ÊÇ®ËæìÂÖ•ÁöÑÔºö</div>
                        <div style="font-size:14px;word-break:break-all;">${originalInput}</div>
                    </div>
                    
                    <div style="margin-bottom:12px;">
                        <div style="color:#666;font-size:13px;">ËØÜÂà´Âà∞Ôºö</div>
                        <div style="font-size:14px;">${nums.length}‰∏™Âπ≥Á†Å${specialNum ? ' + 1‰∏™ÁâπÁ†Å' : ''}</div>
                    </div>
                    
                    ${invalidParts.length > 0 ? `
                    <div style="margin-bottom:12px;">
                        <div style="color:#666;font-size:13px;">Êó†Ê≥ïËØÜÂà´ÁöÑÂÜÖÂÆπÔºö</div>
                        <div style="font-size:14px;color:#e74c3c;">${invalidParts.join(', ')}</div>
                    </div>
                    ` : ''}
                    
                    <div style="border-top:1px solid #eee;margin:15px 0;"></div>
                    
                    <div style="color:#e94560;font-size:13px;margin-bottom:8px;">ÁÇπÂáªÂè≥‰∏ãËßíÂ§çÂà∂ÊåâÈíÆÂ§çÂà∂Ê≠£Á°ÆÊ†ºÂºè</div>
                    <div style="display:flex;align-items:center;gap:8px;background:#f5f5f5;padding:10px;border-radius:8px;">
                        <span style="color:#2ecc71;font-size:16px;">‚úÖ</span>
                        <div>
                            <div style="font-size:12px;color:#888;">Ê≠£Á°ÆÊ†ºÂºèÁ§∫‰æãÔºö</div>
                            <div style="font-size:15px;font-weight:bold;">${correctFormat}</div>
                        </div>
                    </div>
                    
                    <div style="display:flex;gap:10px;margin-top:20px;">
                        <button onclick="closeFormatErrorModal()" style="flex:1;padding:12px;background:#f0f0f0;border:none;border-radius:8px;font-size:14px;cursor:pointer;color:#666;">ÂèñÊ∂à</button>
                        <button onclick="copyFormatAndClose('${correctFormat}')" style="flex:1;padding:12px;background:#e94560;border:none;border-radius:8px;font-size:14px;cursor:pointer;color:#fff;font-weight:bold;">Â§çÂà∂</button>
                    </div>
                </div>
            </div>`;
            
            // Ê∑ªÂä†Âà∞È°µÈù¢
            document.body.insertAdjacentHTML('beforeend', html);
        }
        
        function closeFormatErrorModal() {
            const modal = document.getElementById('format-error-modal');
            if (modal) modal.remove();
        }
        
        function copyFormatAndClose(text) {
            copyToClipboard(text);
            closeFormatErrorModal();
            alert('‚úÖ Â∑≤Â§çÂà∂Ê≠£Á°ÆÊ†ºÂºèÔºÅ');
        }
        
        // ÊòæÁ§∫ÈáçÂ§çÂè∑Á†ÅÈîôËØØÂºπÁ™ó
        function showDuplicateErrorModal(duplicates) {
            const dupStr = duplicates.map(n => String(n).padStart(2,'0')).join(', ');
            alert('‚ùå Âè∑Á†ÅÈáçÂ§çÔºÅ\n\nÈáçÂ§çÁöÑÂè∑Á†ÅÔºö' + dupStr + '\n\nÂºÄÂ•ñÂè∑Á†Å‰∏çËÉΩÊúâÈáçÂ§çÔºåËØ∑Ê£ÄÊü•ÂêéÈáçÊñ∞ËæìÂÖ•„ÄÇ');
        }
        
        // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
        function copyToClipboard(text) {
            if (navigator.clipboard) {
                navigator.clipboard.writeText(text);
            } else {
                const textarea = document.createElement('textarea');
                textarea.value = text;
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
            }
        }
        
        // Ê†πÊçÆÂè∑Á†ÅÊõ¥Êñ∞ËæìÂÖ•Ê°ÜËÉåÊôØËâ≤
        function updateInputColor(input, num, isSpecial = false) {
            const color = getNumberColor(num);
            const colorMap = {
                'red': '#c23a51',
                'blue': '#3a5fc2',
                'green': '#3a8c4a'
            };
            input.style.background = colorMap[color] || '#333';
            input.style.borderColor = isSpecial ? '#f5a623' : colorMap[color] || '#555';
        }
        
        // ÊòæÁ§∫Ëß£ÊûêÈ¢ÑËßà
        function showParsePreview(nums, specialNum) {
            const preview = document.getElementById('parse-preview');
            const balls = document.getElementById('parse-preview-balls');
            
            let html = '';
            // 6‰∏™Âπ≥Á†Å
            for (let i = 0; i < 6; i++) {
                const num = nums[i];
                const color = getNumberColor(num);
                const colorMap = { 'red': '#c23a51', 'blue': '#3a5fc2', 'green': '#3a8c4a' };
                html += `<div style="width:32px;height:32px;border-radius:50%;background:${colorMap[color]};display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:bold;">${String(num).padStart(2,'0')}</div>`;
            }
            // + Âè∑
            html += `<span style="color:#e94560;font-weight:bold;font-size:14px;margin:0 2px;">+</span>`;
            // ÁâπÁ†Å
            const specialColor = getNumberColor(specialNum);
            const colorMap = { 'red': '#c23a51', 'blue': '#3a5fc2', 'green': '#3a8c4a' };
            html += `<div style="width:32px;height:32px;border-radius:50%;background:${colorMap[specialColor]};border:2px solid #f5a623;display:flex;align-items:center;justify-content:center;color:#fff;font-size:13px;font-weight:bold;">${String(specialNum).padStart(2,'0')}</div>`;
            
            balls.innerHTML = html;
            preview.style.display = 'block';
        }
        
        // ÈöêËóèËß£ÊûêÈ¢ÑËßà
        function hideParsePreview() {
            document.getElementById('parse-preview').style.display = 'none';
        }
        
        // Ê†ºÂºèÂåñÊï∞Â≠óËæìÂÖ•ÔºàÂè™ÂÖÅËÆ∏Êï∞Â≠óÔºâ
        function formatNumInput(input) {
            // Âè™‰øùÁïôÊï∞Â≠ó
            let value = input.value.replace(/[^0-9]/g, '');
            
            // Â¶ÇÊûúËæìÂÖ•‰∫ÜÈùûÊï∞Â≠óÔºåÊèêÁ§∫ÈîôËØØ
            if (input.value !== value && input.value !== '') {
                input.style.borderColor = '#e74c3c';
                setTimeout(() => {
                    input.style.borderColor = input.classList.contains('special') ? '#fbbf24' : 'rgba(255, 255, 255, 0.2)';
                }, 500);
            }
            
            // ÈôêÂà∂ÊúÄÂ§ßÂÄº49
            if (parseInt(value) > 49) {
                value = '49';
            }
            
            input.value = value;
        }
        
        // Â§±ÁÑ¶Êó∂Ë°•0
        function padNumInput(input) {
            let value = input.value.trim();
            if (value === '') {
                // Ê∏ÖÁ©∫Êó∂ÈáçÁΩÆÈ¢úËâ≤
                input.style.background = '#333';
                input.style.borderColor = input.id === 'num-special' ? '#f5a623' : '#555';
                return;
            }
            
            let num = parseInt(value);
            if (isNaN(num) || num < 1) {
                input.value = '';
                input.style.background = '#333';
                input.style.borderColor = input.id === 'num-special' ? '#f5a623' : '#555';
                return;
            }
            
            if (num > 49) num = 49;
            
            // Ë°•0Ôºö1-9 ‚Üí 01-09
            input.value = num.toString().padStart(2, '0');
            
            // Êõ¥Êñ∞ËÉåÊôØËâ≤‰∏∫Ê≥¢Ëâ≤
            const isSpecial = input.id === 'num-special';
            updateInputColor(input, num, isSpecial);
        }
        
        function saveLotteryNumbers() {
            const nums = [];
            let hasError = false;
            
            for (let i = 1; i <= 6; i++) {
                const input = document.getElementById('num' + i);
                const val = parseInt(input.value) || 0;
                if (val < 1 || val > 49) {
                    hasError = true;
                    input.style.borderColor = '#e74c3c';
                } else {
                    input.style.borderColor = 'rgba(255, 255, 255, 0.2)';
                }
                nums.push(val);
            }
            
            const specialInput = document.getElementById('num-special');
            const special = parseInt(specialInput.value) || 0;
            if (special < 1 || special > 49) {
                hasError = true;
                specialInput.style.borderColor = '#e74c3c';
            } else {
                specialInput.style.borderColor = '#fbbf24';
            }
            nums.push(special);
            
            if (hasError || nums.some(n => n < 1 || n > 49)) {
                alert('ËØ∑ËæìÂÖ•Ê≠£Á°ÆÁöÑÂè∑Á†ÅÔºà1-49ÔºâÔºÅ');
                return;
            }
            
            // Ê£ÄÊü•ÈáçÂ§çÂè∑Á†Å
            const uniqueNums = new Set(nums);
            if (uniqueNums.size !== nums.length) {
                // ÊâæÂá∫ÈáçÂ§çÁöÑÂè∑Á†Å
                const seen = {};
                const duplicates = [];
                for (const n of nums) {
                    if (seen[n]) {
                        duplicates.push(n);
                    }
                    seen[n] = true;
                }
                alert('‚ö†Ô∏è ÂºÄÂ•ñÂè∑Á†Å‰∏çËÉΩÈáçÂ§çÔºÅ\n\nÈáçÂ§çÁöÑÂè∑Á†ÅÔºö' + [...new Set(duplicates)].map(n => String(n).padStart(2,'0')).join(', '));
                return;
            }
            
            appState.lotteryNumbers = nums;
            
            // ÂêåÊ≠•‰øùÂ≠òÂà∞ÂΩìÂâçÂΩ©ÁßçÁöÑÊï∞ÊçÆ
            const currentType = appState.currentLotteryType || 'xam';
            if (appState.lotteryData[currentType]) {
                appState.lotteryData[currentType].numbers = nums;
                // Â¶ÇÊûúÊ≤°ÊúâÊúüÂè∑Ôºå‰øùÊåÅÂéüÊúâÊúüÂè∑
            }
            
            saveConfig();
            updateDisplay();
            showPage('page-main');
            
            // ÊòæÁ§∫ÁÆÄÁü≠ÊèêÁ§∫Ôºà‰∏çÈòªÂ°ûÔºâ
            const toast = document.createElement('div');
            toast.innerHTML = '‚úÖ ÂºÄÂ•ñÂè∑Á†ÅÂ∑≤‰øùÂ≠ò';
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
        }
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë              „ÄêÊ®°Âùó4„ÄëËá™Âä®Ëé∑ÂèñÂºÄÂ•ñÊï∞ÊçÆ - APIË∞ÉÁî®               ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // APIÈÖçÁΩÆÔºà‰∏â‰∏™APIÊ∫êÔºåËá™Âä®ÂàáÊç¢Ôºâ
        const LOTTERY_APIS = {
            // API 1: Marksix6ÔºàÊé®ËçêÔºåÊï∞ÊçÆÊúÄÂÆåÊï¥Ôºâ
            marksix6: {
                name: 'Marksix6',
                url: 'https://marksix6.net/index.php?api=1',
                // ÂΩ©ÁßçÊò†Â∞Ñ
                lotteryMap: {
                    'hk': 'È¶ôÊ∏ØÂΩ©',
                    'xam': 'Êñ∞Êæ≥Èó®ÂΩ©',
                    'am': 'Êæ≥Èó®ÂΩ©'
                },
                parse: function(data, lotteryType) {
                    const targetName = this.lotteryMap[lotteryType];
                    if (!data.lottery_data) return null;
                    
                    const lottery = data.lottery_data.find(l => l.name === targetName);
                    if (!lottery) return null;
                    
                    // Ëß£ÊûêÂºÄÂ•ñÂè∑Á†Å
                    const numbers = lottery.openCode.split(',').map(n => parseInt(n.trim()));
                    if (numbers.length !== 7) return null;
                    
                    return {
                        numbers: numbers,
                        issue: lottery.expect,
                        time: lottery.openTime,
                        zodiac: lottery.zodiac,
                        wave: lottery.wave,
                        source: 'Marksix6'
                    };
                }
            },
            
            // ÔºàÂ∑≤Âà†Èô§‰∏çÂèØÁî®ÁöÑ 1234ÂºÄÂ•ñÁΩë Âíå 168ÂºÄÂ•ñÁΩëÔºâ
        };
        
        // ÊòæÁ§∫Ëé∑ÂèñÁä∂ÊÄÅ
        function showFetchStatus(message, type) {
            const statusEl = document.getElementById('fetch-status');
            statusEl.style.display = 'block';
            
            let color = '#fff';
            let bgColor = 'rgba(0,0,0,0.3)';
            
            if (type === 'success') {
                color = '#4CAF50';
                bgColor = 'rgba(76, 175, 80, 0.2)';
            } else if (type === 'error') {
                color = '#e74c3c';
                bgColor = 'rgba(231, 76, 60, 0.2)';
            } else if (type === 'loading') {
                color = '#f5a623';
                bgColor = 'rgba(245, 166, 35, 0.2)';
            }
            
            statusEl.style.color = color;
            statusEl.style.background = bgColor;
            statusEl.innerHTML = message;
        }
        
        // ÈöêËóèÁä∂ÊÄÅ
        function hideFetchStatus() {
            document.getElementById('fetch-status').style.display = 'none';
        }
        
        // ÈÄöËøáCORS‰ª£ÁêÜËé∑ÂèñÊï∞ÊçÆÔºàËß£ÂÜ≥Ë∑®ÂüüÈóÆÈ¢òÔºâ
        async function fetchWithProxy(url, timeout = 8000) {
            // ÂàõÂª∫Ë∂ÖÊó∂ÊéßÂà∂Âô®
            const createTimeoutController = (ms) => {
                const controller = new AbortController();
                setTimeout(() => controller.abort(), ms);
                return controller;
            };
            
            // ÊñπÊ≥ï1: Áõ¥Êé•Â∞ùËØïËØ∑Ê±ÇÔºàÂ¶ÇÊûúÊúçÂä°Âô®ÊîØÊåÅCORSÔºâ
            try {
                const controller = createTimeoutController(timeout);
                const response = await fetch(url, {
                    method: 'GET',
                    headers: { 'Accept': 'application/json' },
                    signal: controller.signal
                });
                if (response.ok) {
                    return await response.json();
                }
            } catch (e) {
                console.log('Áõ¥Êé•ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÂ∞ùËØï‰ª£ÁêÜ...', e.message);
            }
            
            // ÊñπÊ≥ï2: Â∞ùËØï‰ΩøÁî®Â§ö‰∏™ÂÖ¨ÂÖ±CORS‰ª£ÁêÜÔºàÂ¢ûÂä†Êõ¥Â§öÁ®≥ÂÆö‰ª£ÁêÜÔºâ
            const corsProxies = [
                // ‰ª£ÁêÜ1: corsproxy.ioÔºàÁ®≥ÂÆöÊÄßËæÉÂ•ΩÔºâ
                `https://corsproxy.io/?${encodeURIComponent(url)}`,
                // ‰ª£ÁêÜ2: alloriginsÔºàÂ§áÁî®Ôºâ
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                // ‰ª£ÁêÜ3: cors-anywhere ÈïúÂÉè
                `https://proxy.cors.sh/${url}`,
                // ‰ª£ÁêÜ4: thingproxy
                `https://thingproxy.freeboard.io/fetch/${url}`
            ];
            
            for (const proxyUrl of corsProxies) {
                try {
                    const controller = createTimeoutController(timeout);
                    const response = await fetch(proxyUrl, {
                        signal: controller.signal,
                        headers: {
                            'x-cors-api-key': 'temp_key', // Êüê‰∫õ‰ª£ÁêÜÈúÄË¶Å
                        }
                    });
                    if (response.ok) {
                        const text = await response.text();
                        try {
                            return JSON.parse(text);
                        } catch (parseErr) {
                            console.log('JSONËß£ÊûêÂ§±Ë¥•:', proxyUrl);
                            continue;
                        }
                    }
                } catch (e) {
                    console.log('‰ª£ÁêÜËØ∑Ê±ÇÂ§±Ë¥•:', proxyUrl.split('?')[0], e.message);
                }
            }
            
            throw new Error('ÊâÄÊúâËØ∑Ê±ÇÊñπÂºèÈÉΩÂ§±Ë¥•‰∫ÜÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•');
        }
        
        // ‰∏ªÂáΩÊï∞ÔºöËé∑ÂèñÂºÄÂ•ñÊï∞ÊçÆ
        async function fetchLotteryData() {
            const lotteryType = document.getElementById('lottery-type-select').value;
            const lotteryNames = {
                'hk': 'È¶ôÊ∏ØÂÖ≠ÂêàÂΩ©',
                'xam': 'Êñ∞Êæ≥Èó®ÂÖ≠ÂêàÂΩ©',
                'am': '„ä£Êæ≥Èó®ÂÖ≠ÂêàÂΩ©'
            };
            
            showFetchStatus('üîÑ Ê≠£Âú®Ëé∑Âèñ ' + lotteryNames[lotteryType] + ' ÊúÄÊñ∞ÂºÄÂ•ñÊï∞ÊçÆ...', 'loading');
            
            // ‰ΩøÁî® Marksix6 APIÔºàÂîØ‰∏ÄÂèØÁî®ÁöÑAPIÔºâ
            const api = LOTTERY_APIS.marksix6;
            
            showFetchStatus(`üîÑ Ê≠£Âú®Ëé∑Âèñ ${api.name} Êï∞ÊçÆ...`, 'loading');
            
            try {
                // Ëé∑ÂèñÊï∞ÊçÆ
                const data = await fetchWithProxy(api.url);
                console.log(`${api.name} ËøîÂõû:`, data);
                
                // Ëß£ÊûêÊï∞ÊçÆ
                const result = api.parse(data, lotteryType);
                
                if (result && result.numbers && result.numbers.length === 7) {
                    // ÊàêÂäüËé∑ÂèñÊï∞ÊçÆ
                    applyLotteryResult(result, lotteryNames[lotteryType], lotteryType);
                    return;
                }
                
                showFetchStatus('‚ùå Êï∞ÊçÆËß£ÊûêÂ§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï', 'error');
            } catch (error) {
                console.error(`${api.name} Â§±Ë¥•:`, error);
                showFetchStatus('‚ùå Ëé∑ÂèñÊï∞ÊçÆÂ§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÁΩëÁªúÊàñÁ®çÂêéÈáçËØï', 'error');
            }
        }
        
        // Â∫îÁî®Ëé∑ÂèñÂà∞ÁöÑÂºÄÂ•ñÁªìÊûú
        function applyLotteryResult(result, lotteryName, lotteryType) {
            // ‰øùÂ≠òÂà∞ÂØπÂ∫îÂΩ©ÁßçÁöÑÊï∞ÊçÆ
            if (lotteryType && appState.lotteryData[lotteryType]) {
                appState.lotteryData[lotteryType] = {
                    numbers: result.numbers,
                    issue: result.issue,
                    time: result.time,
                    source: result.source
                };
                // Ê∑ªÂä†Âà∞ÂéÜÂè≤ËÆ∞ÂΩï
                addToHistory(lotteryType, result);
                renderHistoryList();  // Âà∑Êñ∞ÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
            }
            
            // Â°´ÂÖ•ËæìÂÖ•Ê°Ü
            for (let i = 0; i < 6; i++) {
                const input = document.getElementById('num' + (i + 1));
                input.value = String(result.numbers[i]).padStart(2, '0');
                updateInputColor(input, result.numbers[i], false);
            }
            
            const specialInput = document.getElementById('num-special');
            specialInput.value = String(result.numbers[6]).padStart(2, '0');
            updateInputColor(specialInput, result.numbers[6], true);
            
            // ÊòæÁ§∫ÊàêÂäü‰ø°ÊÅØ
            let statusMsg = `‚úÖ Ëé∑ÂèñÊàêÂäüÔºÅ<br>`;
            statusMsg += `<b>${lotteryName}</b> Á¨¨ <b>${result.issue}</b> Êúü<br>`;
            statusMsg += `ÂºÄÂ•ñÂè∑Á†ÅÔºö<b>${result.numbers.slice(0, 6).map(n => String(n).padStart(2, '0')).join(' ')} + ${String(result.numbers[6]).padStart(2, '0')}</b><br>`;
            if (result.time) {
                statusMsg += `ÂºÄÂ•ñÊó∂Èó¥Ôºö${result.time}<br>`;
            }
            statusMsg += `<span style="font-size:11px;color:#888;">Êï∞ÊçÆÊù•Ê∫êÔºö${result.source}</span>`;
            
            showFetchStatus(statusMsg, 'success');
            
            // ÊòæÁ§∫È¢ÑËßà
            showParsePreview(result.numbers.slice(0, 6), result.numbers[6]);
            
            // ‰øùÂ≠òÈÖçÁΩÆ
            saveConfig();
        }
        
        // ÂàáÊç¢ËµîÁéáÈù¢Êùø
        function showOddsPanel(panelId) {
            // ÂàáÊç¢ËèúÂçïÈÄâ‰∏≠Áä∂ÊÄÅ
            document.querySelectorAll('.odds-menu-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ÂàáÊç¢ÂÜÖÂÆπÈù¢Êùø
            document.querySelectorAll('.odds-panel').forEach(panel => {
                panel.classList.remove('active');
            });
            document.getElementById('panel-' + panelId).classList.add('active');
        }
        
        function updateDisplay() {
            // Êõ¥Êñ∞ÂºÄÂ•ñÂè∑Á†ÅÊòæÁ§∫
            renderLotteryBalls();
        }
        
        function renderLotteryBalls() {
            const container = document.getElementById('lottery-balls');
            const typeNameEl = document.getElementById('lottery-type-name');
            const issueEl = document.getElementById('lottery-issue');
            
            // Êõ¥Êñ∞ÂΩ©ÁßçÂêçÁß∞ÂíåÊúüÂè∑
            const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø' };
            if (typeNameEl) typeNameEl.textContent = typeNames[appState.currentLotteryType] || 'Êñ∞Êæ≥';
            
            const currentData = appState.lotteryData[appState.currentLotteryType];
            if (issueEl) {
                if (currentData && currentData.issue) {
                    issueEl.textContent = 'Á¨¨' + currentData.issue + 'Êúü';
                } else {
                    issueEl.textContent = 'Á¨¨xxxÊúü';
                }
            }
            
            // Êõ¥Êñ∞ÂàáÊç¢ÊåâÈíÆÁä∂ÊÄÅ
            updateSwitchButtons();
            
            if (!appState.lotteryNumbers || appState.lotteryNumbers.length < 7 || appState.lotteryNumbers[0] === 0) {
                container.innerHTML = '<div class="lottery-empty">ËØ∑ÂÖàËÆæÁΩÆÂºÄÂ•ñÂè∑Á†Å</div>';
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶ÊòØÁõ¥Êí≠Ê®°ÂºèÔºàÂè™ÊúâÁõ¥Êí≠Âà∑Êñ∞Êó∂ÊâçÊúâÂä®ÁîªÔºâ
            const isLive = window.isLiveAnimationEnabled || false;
            
            let html = '';
            for (let i = 0; i < 6; i++) {
                const num = appState.lotteryNumbers[i];
                const color = getNumberColor(num);
                const shengxiao = getNumberShengxiao(num);
                const wuxing = getNumberWuxing(num);
                
                if (isLive) {
                    const delay = i * 0.15;
                    html += `
                        <div class="ball-wrapper">
                            <div class="ball ${color}" style="--delay:${delay}s">${String(num).padStart(2, '0')}</div>
                            <div class="ball-info">${shengxiao}/${wuxing}</div>
                        </div>
                    `;
                } else {
                    html += `
                        <div class="ball-wrapper">
                            <div class="ball ${color} no-anim">${String(num).padStart(2, '0')}</div>
                            <div class="ball-info">${shengxiao}/${wuxing}</div>
                        </div>
                    `;
                }
            }
            
            html += '<span class="ball-plus">+</span>';
            
            // ÁâπÁ†Å
            const special = appState.lotteryNumbers[6];
            const specialColor = getNumberColor(special);
            const specialShengxiao = getNumberShengxiao(special);
            const specialWuxing = getNumberWuxing(special);
            
            if (isLive) {
                const specialDelay = 6 * 0.15 + 0.2;
                html += `
                    <div class="ball-wrapper">
                        <div class="ball ${specialColor}" style="--delay:${specialDelay}s">${String(special).padStart(2, '0')}</div>
                        <div class="ball-info">${specialShengxiao}/${specialWuxing}</div>
                    </div>
                `;
            } else {
                html += `
                    <div class="ball-wrapper">
                        <div class="ball ${specialColor} no-anim">${String(special).padStart(2, '0')}</div>
                        <div class="ball-info">${specialShengxiao}/${specialWuxing}</div>
                    </div>
                `;
            }
            
            container.innerHTML = html;
            
            // ÈáçÁΩÆÁõ¥Êí≠Âä®ÁîªÊ†áÂøó
            window.isLiveAnimationEnabled = false;
        }
        
        // ÂàáÊç¢ÂΩ©Áßç
        function switchLotteryType(type) {
            appState.currentLotteryType = type;
            
            // Âä†ËΩΩÂØπÂ∫îÂΩ©ÁßçÁöÑÊï∞ÊçÆ
            const data = appState.lotteryData[type];
            if (data && data.numbers && data.numbers.length === 7) {
                appState.lotteryNumbers = data.numbers;
            } else {
                appState.lotteryNumbers = [];
            }
            
            // ‰øùÂ≠òÂπ∂Âà∑Êñ∞ÊòæÁ§∫
            saveConfig();
            renderLotteryBalls();
        }
        
        // ==================== ÂéÜÂè≤ËÆ∞ÂΩïÂäüËÉΩ ====================
        
        let currentHistoryType = 'xam';  // ÂΩìÂâçÂéÜÂè≤ËÆ∞ÂΩïÊòæÁ§∫ÁöÑÂΩ©Áßç
        
        // ÂàáÊç¢ÂéÜÂè≤ËÆ∞ÂΩïÂΩ©Áßç
        function switchHistoryType(type) {
            currentHistoryType = type;
            
            // Êõ¥Êñ∞ÊåâÈíÆÊ†∑Âºè
            const btnXam = document.getElementById('history-btn-xam');
            const btnHk = document.getElementById('history-btn-hk');
            
            if (btnXam && btnHk) {
                if (type === 'xam') {
                    btnXam.style.background = 'rgba(233,69,96,0.2)';
                    btnHk.style.background = 'transparent';
                } else {
                    btnHk.style.background = 'rgba(76,175,80,0.2)';
                    btnXam.style.background = 'transparent';
                }
            }
            
            renderHistoryList();
        }
        
        // Ê∏≤ÊüìÂéÜÂè≤ËÆ∞ÂΩïÂàóË°®
        function renderHistoryList() {
            const container = document.getElementById('history-list');
            if (!container) return;
            
            // Á°Æ‰øùÂéÜÂè≤ËÆ∞ÂΩïÁªìÊûÑÂ≠òÂú®
            if (!appState.lotteryHistory) {
                appState.lotteryHistory = { xam: [], hk: [] };
            }
            
            const history = appState.lotteryHistory[currentHistoryType] || [];
            
            if (history.length === 0) {
                container.innerHTML = '<div style="text-align:center;color:#666;font-size:12px;padding:20px;">ÊöÇÊó†ÂéÜÂè≤ËÆ∞ÂΩïÔºåËØ∑ÁÇπÂáª"ÊâãÂä®Ëé∑Âèñ"ÊåâÈíÆ</div>';
                return;
            }
            
            let html = '';
            history.forEach((item, index) => {
                const numbersStr = item.numbers.slice(0, 6).map(n => String(n).padStart(2, '0')).join(' ') + 
                                ' + ' + String(item.numbers[6]).padStart(2, '0');
                const isFirst = index === 0;
                
                // ËÆ°ÁÆóÊó•ÊúüÔºö‰ªéÊúüÂè∑Êé®ÁÆóÔºàÂÅáËÆæÊØèÂ§©‰∏ÄÊúüÔºå‰ªéÊúÄÊñ∞‰∏ÄÊúüÁöÑÊó•ÊúüÂæÄÂâçÊé®Ôºâ
                let dateStr = '';
                if (item.time) {
                    // Â¶ÇÊûúÊúâÊó∂Èó¥‰ø°ÊÅØÔºåÁõ¥Êé•‰ΩøÁî®
                    const match = item.time.match(/(\d{4}-\d{2}-\d{2})/);
                    if (match) {
                        dateStr = match[1].substring(5); // Âèñ MM-DD
                    }
                } else if (isFirst && appState.lotteryData[currentHistoryType]?.time) {
                    // ÊúÄÊñ∞‰∏ÄÊúü‰ΩøÁî®ÂΩìÂâçÊï∞ÊçÆÁöÑÊó∂Èó¥
                    const match = appState.lotteryData[currentHistoryType].time.match(/(\d{4}-\d{2}-\d{2})/);
                    if (match) {
                        dateStr = match[1].substring(5);
                    }
                }
                
                html += `
                    <div onclick="selectHistoryItem('${currentHistoryType}', ${index})" 
                        style="display:flex;justify-content:space-between;align-items:center;padding:8px;margin-bottom:4px;background:${isFirst ? 'rgba(233,69,96,0.15)' : 'rgba(255,255,255,0.05)'};border-radius:6px;cursor:pointer;border:1px solid ${isFirst ? 'rgba(233,69,96,0.3)' : 'transparent'};">
                        <div style="flex:1;">
                            <div style="font-size:11px;color:#888;margin-bottom:2px;">
                                Á¨¨${item.issue}Êúü
                                ${dateStr ? '<span style="color:#4CAF50;margin-left:6px;">' + dateStr + '</span>' : ''}
                                ${isFirst ? '<span style="color:#e94560;font-weight:bold;margin-left:6px;">ÊúÄÊñ∞</span>' : ''}
                            </div>
                            <div style="font-size:13px;color:#fff;font-family:monospace;">${numbersStr}</div>
                        </div>
                        <button onclick="event.stopPropagation();selectHistoryItem('${currentHistoryType}', ${index})" 
                                style="padding:4px 10px;background:linear-gradient(90deg,#3498db,#2980b9);color:white;border:none;border-radius:4px;font-size:11px;cursor:pointer;">ÈÄâÁî®</button>
                    </div>
                `;
            });
            
            container.innerHTML = html;
        }
        
        // ÈÄâÊã©ÂéÜÂè≤ËÆ∞ÂΩï
        function selectHistoryItem(type, index) {
            if (!appState.lotteryHistory || !appState.lotteryHistory[type]) return;
            
            const item = appState.lotteryHistory[type][index];
            if (!item || !item.numbers) return;
            
            // ËÆæÁΩÆ‰∏∫ÂΩìÂâçÊï∞ÊçÆ
            appState.lotteryNumbers = item.numbers.slice();
            appState.currentLotteryType = type;
            appState.lotteryData[type] = {
                numbers: item.numbers.slice(),
                issue: item.issue,
                time: item.time,
                source: item.source
            };
            
            // Â°´ÂÖ•ËæìÂÖ•Ê°Ü
            for (let i = 0; i < 6; i++) {
                const input = document.getElementById('num' + (i + 1));
                if (input) {
                    input.value = String(item.numbers[i]).padStart(2, '0');
                    updateInputColor(input, item.numbers[i], false);
                }
            }
            const specialInput = document.getElementById('num-special');
            if (specialInput) {
                specialInput.value = String(item.numbers[6]).padStart(2, '0');
                updateInputColor(specialInput, item.numbers[6], true);
            }
            
            // ÊòæÁ§∫È¢ÑËßà
            showParsePreview(item.numbers.slice(0, 6), item.numbers[6]);
            
            saveConfig();
            renderLotteryBalls();
            
            // Ëá™Âä®ËøîÂõû‰∏ªÈ°µÔºåÊòæÁ§∫ÁÆÄÁü≠ÊèêÁ§∫
            showPage('page-main');
            
            // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫Ôºà‰∏çÈòªÂ°ûÔºâ
            const toast = document.createElement('div');
            toast.innerHTML = `‚úÖ Â∑≤Â∫îÁî®Á¨¨${item.issue}Êúü`;
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 1500);
        }
        
        // Ê∑ªÂä†ÂéÜÂè≤ËÆ∞ÂΩïÔºàËé∑ÂèñÊñ∞Êï∞ÊçÆÊó∂Ë∞ÉÁî®Ôºâ
        function addToHistory(type, data) {
            if (!data || !data.numbers || data.numbers.length < 7) return;
            
            // Á°Æ‰øùÂéÜÂè≤ËÆ∞ÂΩïÁªìÊûÑÂ≠òÂú®
            if (!appState.lotteryHistory) {
                appState.lotteryHistory = { xam: [], hk: [] };
            }
            if (!appState.lotteryHistory[type]) {
                appState.lotteryHistory[type] = [];
            }
            
            const history = appState.lotteryHistory[type];
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®Áõ∏ÂêåÊúüÂè∑
            const existingIndex = history.findIndex(h => h.issue === data.issue);
            if (existingIndex !== -1) {
                // Â∑≤Â≠òÂú®ÔºåÊõ¥Êñ∞Êï∞ÊçÆ
                history[existingIndex] = {
                    numbers: data.numbers.slice(),
                    issue: data.issue,
                    time: data.time,
                    source: data.source
                };
            } else {
                // ‰∏çÂ≠òÂú®ÔºåÊ∑ªÂä†Âà∞ÊúÄÂâçÈù¢
                history.unshift({
                    numbers: data.numbers.slice(),
                    issue: data.issue,
                    time: data.time,
                    source: data.source
                });
                
                // ‰øùÊåÅÊúÄÂ§ö10Êúü
                if (history.length > 10) {
                    history.pop();
                }
            }
            
            saveConfig();
        }
        
        // ÊâπÈáèÊ∑ªÂä†ÂéÜÂè≤ËÆ∞ÂΩïÔºà‰ªéAPIÁöÑhistoryÂ≠óÊÆµËß£ÊûêÔºâ
        function addHistoryFromAPI(type, historyArray, latestOpenTime) {
            if (!historyArray || !Array.isArray(historyArray)) return;
            
            // Á°Æ‰øùÂéÜÂè≤ËÆ∞ÂΩïÁªìÊûÑÂ≠òÂú®
            if (!appState.lotteryHistory) {
                appState.lotteryHistory = { xam: [], hk: [] };
            }
            if (!appState.lotteryHistory[type]) {
                appState.lotteryHistory[type] = [];
            }
            
            // Ëß£ÊûêÊúÄÊñ∞ÁöÑÂºÄÂ•ñÊó•Êúü
            let latestDate = null;
            if (latestOpenTime) {
                const match = latestOpenTime.match(/(\d{4})-(\d{2})-(\d{2})/);
                if (match) {
                    latestDate = new Date(parseInt(match[1]), parseInt(match[2]) - 1, parseInt(match[3]));
                }
            }
            
            // Ëß£ÊûêÂéÜÂè≤ËÆ∞ÂΩïÊ†ºÂºè: "2025129 ÊúüÔºö49,19,28,10,17,45,01"
            const parsedHistory = [];
            for (let i = 0; i < Math.min(historyArray.length, 10); i++) {
                const item = historyArray[i];
                // ÂåπÈÖçÊ†ºÂºè: "ÊúüÂè∑ ÊúüÔºöÂè∑Á†Å"
                const match = item.match(/(\d+)\s*Êúü[Ôºö:]\s*([\d,]+)/);
                if (match) {
                    const issue = match[1];
                    const numbers = match[2].split(',').map(n => parseInt(n.trim()));
                    if (numbers.length === 7) {
                        let dateStr = '';
                        
                        if (type === 'xam') {
                            // Êñ∞Êæ≥Èó®ÔºöÊØèÂ§©‰∏ÄÊúüÔºåÂèØ‰ª•Êé®ÁÆóÊó•Êúü
                            if (latestDate) {
                                const date = new Date(latestDate);
                                date.setDate(date.getDate() - i);
                                dateStr = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                            }
                        } else if (type === 'hk' && i === 0 && latestOpenTime) {
                            // È¶ôÊ∏ØÔºöÊØèÂë®‰∫å„ÄÅÂõõ„ÄÅÂÖ≠ÂºÄÂ•ñÔºåÂè™ÊúâÊúÄÊñ∞‰∏ÄÊúüÊòæÁ§∫Êó•Êúü
                            dateStr = latestOpenTime;
                        }
                        // È¶ôÊ∏ØÂéÜÂè≤ËÆ∞ÂΩï‰∏çÊòæÁ§∫Êó•ÊúüÔºàÂõ†‰∏∫ÊØèÂë®3ÊúüÔºåÊó†Ê≥ïÁÆÄÂçïÊé®ÁÆóÔºâ
                        
                        parsedHistory.push({
                            numbers: numbers,
                            issue: issue,
                            time: dateStr,
                            source: 'Marksix6ÂéÜÂè≤'
                        });
                    }
                }
            }
            
            // ÊõøÊç¢ÂéÜÂè≤ËÆ∞ÂΩï
            appState.lotteryHistory[type] = parsedHistory;
            saveConfig();
        }
        
        // Ëé∑ÂèñÂéÜÂè≤ÂºÄÂ•ñËÆ∞ÂΩï
        async function fetchHistoryData() {
            const api = LOTTERY_APIS.marksix6;
            
            // ÊòæÁ§∫Âä†ËΩΩÊèêÁ§∫
            const historyList = document.getElementById('history-list');
            if (historyList) {
                historyList.innerHTML = '<div style="text-align:center;color:#9b59b6;font-size:12px;padding:20px;">üîÑ Ê≠£Âú®Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩï...</div>';
            }
            
            try {
                // ‰ΩøÁî® fetchWithProxy Ëß£ÂÜ≥CORSÈóÆÈ¢ò
                const data = await fetchWithProxy(api.url);
                
                if (!data.lottery_data) {
                    throw new Error('Êï∞ÊçÆÊ†ºÂºèÈîôËØØ');
                }
                
                // Ëß£ÊûêÊñ∞Êæ≥Èó®ÂéÜÂè≤
                const xamLottery = data.lottery_data.find(l => l.name === 'Êñ∞Êæ≥Èó®ÂΩ©');
                if (xamLottery && xamLottery.history) {
                    addHistoryFromAPI('xam', xamLottery.history, xamLottery.openTime);
                }
                
                // Ëß£ÊûêÈ¶ôÊ∏ØÂéÜÂè≤
                const hkLottery = data.lottery_data.find(l => l.name === 'È¶ôÊ∏ØÂΩ©');
                if (hkLottery && hkLottery.history) {
                    addHistoryFromAPI('hk', hkLottery.history, hkLottery.openTime);
                }
                
                // Âà∑Êñ∞ÊòæÁ§∫
                renderHistoryList();
                
                // ÊòæÁ§∫ÊàêÂäüÊèêÁ§∫
                const toast = document.createElement('div');
                toast.innerHTML = '‚úÖ ÂéÜÂè≤ËÆ∞ÂΩïËé∑ÂèñÊàêÂäü';
                toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.8);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
                document.body.appendChild(toast);
                setTimeout(() => toast.remove(), 1500);
                
            } catch (e) {
                console.error('Ëé∑ÂèñÂéÜÂè≤ËÆ∞ÂΩïÂ§±Ë¥•:', e);
                if (historyList) {
                    historyList.innerHTML = '<div style="text-align:center;color:#e94560;font-size:12px;padding:20px;">‚ùå Ëé∑ÂèñÂ§±Ë¥•ÔºåËØ∑ÈáçËØï</div>';
                }
            }
        }
        
        // Â§çÂà∂ÂºÄÂ•ñÁªìÊûú
        function copyLotteryResult() {
            const currentData = appState.lotteryData[appState.currentLotteryType];
            if (!currentData || !currentData.numbers || currentData.numbers.length < 7) {
                alert('ÊöÇÊó†ÂºÄÂ•ñÁªìÊûúÂèØÂ§çÂà∂');
                return;
            }
            
            // ÁÆÄÂåñÂêçÁß∞ÔºöÊñ∞Â••„ÄÅÈ¶ôÂÖ≠
            const typeNames = { xam: 'Êñ∞Â••', hk: 'È¶ôÂÖ≠', am: 'Êæ≥Èó®' };
            const typeName = typeNames[appState.currentLotteryType] || 'ÂÖ≠Âêà';
            const numbers = currentData.numbers;
            
            // Âè∑Á†ÅÊ†ºÂºèÔºö‰∏§‰∏§ÂàÜÁªÑÔºåÁâπÁ†ÅÂâçÁî®"Áâπ"
            // Ê†ºÂºèÔºö31 26  44 21  22 34 Áâπ 16
            const n = numbers.map(num => String(num).padStart(2, '0'));
            const numbersStr = `${n[0]} ${n[1]}  ${n[2]} ${n[3]}  ${n[4]} ${n[5]} Áâπ ${n[6]}`;
            
            // ÁîüËÇñÊ†ºÂºèÔºö‰∏éÂè∑Á†ÅÂØπÈΩê
            // Ê†ºÂºèÔºöÁå™  Èæô  Áãó  È∏°  Áå¥  Áå¥      Ëôé
            const sx = numbers.map(num => getNumberShengxiao(num));
            const shengxiaoStr = `${sx[0]}  ${sx[1]}  ${sx[2]}  ${sx[3]}  ${sx[4]}  ${sx[5]}      ${sx[6]}`;
            
            // È¢úËâ≤Ê†ºÂºèÔºö‰∏éÂè∑Á†ÅÂØπÈΩê
            // Ê†ºÂºèÔºöËìù  Ëìù  Áªø  Áªø  Áªø  Á∫¢      Áªø
            const colorMap = { red: 'Á∫¢', blue: 'Ëìù', green: 'Áªø' };
            const colors = numbers.map(num => colorMap[getNumberColor(num)] || '?');
            const colorStr = `${colors[0]}  ${colors[1]}  ${colors[2]}  ${colors[3]}  ${colors[4]}  ${colors[5]}      ${colors[6]}`;
            
            // Êó∂Èó¥Ê†ºÂºèÔºàÂè™‰øùÁïôÊó•ÊúüÈÉ®ÂàÜÔºâ
            let dateStr = 'Êú™Áü•';
            if (currentData.time) {
                const match = currentData.time.match(/(\d{4}-\d{2}-\d{2})/);
                if (match) {
                    dateStr = match[1];
                }
            }
            
            const text = `„Äê${typeName}„ÄëÁ¨¨${currentData.issue}Êúü\nÂè∑Á†ÅÔºö${numbersStr}\nÁîüËÇñÔºö${shengxiaoStr}\nÈ¢úËâ≤Ôºö${colorStr}\nÊó∂Èó¥Ôºö${dateStr}`;
            
            // Â§çÂà∂Âà∞Ââ™Ë¥¥Êùø
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showCopySuccess();
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }
        
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.left = '-9999px';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showCopySuccess();
            } catch (e) {
                alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂');
            }
            document.body.removeChild(textarea);
        }
        
        function showCopySuccess() {
            // ÊòæÁ§∫Â§çÂà∂ÊàêÂäüÊèêÁ§∫Ôºà2ÁßíÂêéËá™Âä®ÂÖ≥Èó≠Ôºâ
            const toast = document.createElement('div');
            toast.innerHTML = '‚úÖ Â∑≤Â§çÂà∂ÂºÄÂ•ñÁªìÊûú';
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 2000);  // 2ÁßíÂêéËá™Âä®ÂÖ≥Èó≠
        }
        
        // Êõ¥Êñ∞ÂàáÊç¢ÊåâÈíÆÁä∂ÊÄÅ
        function updateSwitchButtons() {
            const btnXam = document.getElementById('btn-xam');
            const btnHk = document.getElementById('btn-hk');
            
            if (btnXam && btnHk) {
                if (appState.currentLotteryType === 'xam') {
                    btnXam.style.background = '#e94560';
                    btnXam.style.color = '#fff';
                    btnHk.style.background = 'transparent';
                    btnHk.style.color = '#4CAF50';
                } else {
                    btnHk.style.background = '#4CAF50';
                    btnHk.style.color = '#fff';
                    btnXam.style.background = 'transparent';
                    btnXam.style.color = '#e94560';
                }
            }
        }
        
        function getNumberColor(num) {
            if (LHC_DATA.bose['Á∫¢Ê≥¢'].includes(num)) return 'red';
            if (LHC_DATA.bose['ËìùÊ≥¢'].includes(num)) return 'blue';
            if (LHC_DATA.bose['ÁªøÊ≥¢'].includes(num)) return 'green';
            return 'blue';
        }
        
        function getNumberShengxiao(num) {
            for (let [sx, nums] of Object.entries(LHC_DATA.shengxiao)) {
                if (nums.includes(num)) return sx;
            }
            return '';
        }
        
        function getNumberWuxing(num) {
            for (let [wx, nums] of Object.entries(LHC_DATA.wuxing)) {
                if (nums.includes(num)) return wx;
            }
            return '';
        }
        
        // ==================== ËµîÁéáËÆæÁΩÆ ====================
        function saveOdds() {
            // ‰øùÂ≠òÊâÄÊúâËµîÁéáËæìÂÖ•Ê°ÜÁöÑÂÄº
            saveOddsToStorage();
            
            showPage('page-main');
            alert('ËµîÁéáËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
        }
        
        // ==================== ÊøÄÊ¥ªÂäüËÉΩ ====================
        function checkLicense() {
            const statusEl = document.getElementById('license-status');
            
            // Ê£ÄÊü•ËØïÁî®Êúü
            let installTime = localStorage.getItem('lhc_install_time');
            if (!installTime) {
                installTime = Date.now().toString();
                localStorage.setItem('lhc_install_time', installTime);
            }
            
            const elapsed = Date.now() - parseInt(installTime);
            const daysLeft = Math.max(0, 7 - Math.floor(elapsed / (24 * 60 * 60 * 1000)));
            appState.trialDaysLeft = daysLeft;
            
            // Ê£ÄÊü•ÊøÄÊ¥ªÁä∂ÊÄÅ
            const licenseData = localStorage.getItem('lhc_license');
            if (licenseData) {
                const data = JSON.parse(licenseData);
                if (data.activated) {
                    appState.isActivated = true;
                    statusEl.textContent = 'Â∑≤ÊøÄÊ¥ª ‚úì';
                    statusEl.className = 'status-value active';
                    return;
                }
            }
            
            if (daysLeft > 0) {
                statusEl.textContent = `ËØïÁî®ÊúüÂâ©‰Ωô ${daysLeft} Â§©`;
                statusEl.className = 'status-value trial';
            } else {
                statusEl.textContent = 'ËØïÁî®ÊúüÂ∑≤ËøáÔºåËØ∑ÊøÄÊ¥ª';
                statusEl.className = 'status-value expired';
            }
        }
        
        function copyMachineCode() {
            navigator.clipboard.writeText(appState.machineCode).then(() => {
                alert('Êú∫Âô®Á†ÅÂ∑≤Â§çÂà∂ÔºÅ');
            }).catch(() => {
                const input = document.createElement('input');
                input.value = appState.machineCode;
                document.body.appendChild(input);
                input.select();
                document.execCommand('copy');
                document.body.removeChild(input);
                alert('Êú∫Âô®Á†ÅÂ∑≤Â§çÂà∂ÔºÅ');
            });
        }
        
        function activateLicense() {
            const code = document.getElementById('license-input').value.trim().toUpperCase();
            if (!code) {
                alert('ËØ∑ËæìÂÖ•ÊøÄÊ¥ªÁ†Å');
                return;
            }
            
            // ËøôÈáåÂÆûÁé∞ÊøÄÊ¥ªÈ™åËØÅÈÄªËæë
            // ÁÆÄÂçïÁ§∫‰æãÔºöÈ™åËØÅÊøÄÊ¥ªÁ†ÅÊ†ºÂºè
            if (code.length >= 16) {
                localStorage.setItem('lhc_license', JSON.stringify({
                    activated: true,
                    code: code,
                    time: Date.now()
                }));
                appState.isActivated = true;
                checkLicense();
                alert('ÊøÄÊ¥ªÊàêÂäüÔºÅ');
            } else {
                alert('ÊøÄÊ¥ªÁ†ÅÊó†ÊïàÔºåËØ∑Ê£ÄÊü•ÂêéÈáçËØï');
            }
        }
        
        // ==================== ÂèÇÁÖßË°®Ê∏≤Êüì ====================
        function renderReferenceTables() {
            // ÁîüËÇñË°®
            let sxHtml = '<tr><th>ÁîüËÇñ</th><th>ÂØπÂ∫îÂè∑Á†Å</th></tr>';
            for (let [sx, nums] of Object.entries(LHC_DATA.shengxiao)) {
                const numsStr = nums.map(n => {
                    const color = getNumberColor(n);
                    return `<span class="num-${color}">${String(n).padStart(2, '0')}</span>`;
                }).join(' ');
                sxHtml += `<tr><td>${sx}</td><td>${numsStr}</td></tr>`;
            }
            document.getElementById('ref-shengxiao').innerHTML = sxHtml;
            
            // ‰∫îË°åË°®
            let wxHtml = '<tr><th>‰∫îË°å</th><th>ÂØπÂ∫îÂè∑Á†Å</th></tr>';
            for (let [wx, nums] of Object.entries(LHC_DATA.wuxing)) {
                const numsStr = nums.map(n => {
                    const color = getNumberColor(n);
                    return `<span class="num-${color}">${String(n).padStart(2, '0')}</span>`;
                }).join(' ');
                wxHtml += `<tr><td>${wx}</td><td>${numsStr}</td></tr>`;
            }
            document.getElementById('ref-wuxing').innerHTML = wxHtml;
            
            // Ê≥¢Ëâ≤Ë°®
            let bsHtml = '<tr><th>Ê≥¢Ëâ≤</th><th>ÂØπÂ∫îÂè∑Á†Å</th></tr>';
            for (let [bs, nums] of Object.entries(LHC_DATA.bose)) {
                const colorClass = bs === 'Á∫¢Ê≥¢' ? 'red' : bs === 'ËìùÊ≥¢' ? 'blue' : 'green';
                const numsStr = nums.map(n => `<span class="num-${colorClass}">${String(n).padStart(2, '0')}</span>`).join(' ');
                bsHtml += `<tr><td>${bs}</td><td>${numsStr}</td></tr>`;
            }
            document.getElementById('ref-bose').innerHTML = bsHtml;
            
            // ÂÆ∂Á¶ΩÈáéÂÖΩË°®
            let jqHtml = '<tr><th>Á±ªÂûã</th><th>ÁîüËÇñ</th></tr>';
            for (let [type, sxList] of Object.entries(LHC_DATA.jiaqin)) {
                jqHtml += `<tr><td>${type}</td><td>${sxList.join(' ')}</td></tr>`;
            }
            document.getElementById('ref-jiaqin').innerHTML = jqHtml;
        }
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë                    „ÄêÊ®°Âùó1„ÄëÊ†ºÂºèËß£ÊûêÊ®°Âùó                        ‚ïë
        // ‚ïë  Êñá‰ª∂ÂàÜÁ¶ªÊó∂ÊèêÂèñÂà∞: js/parser.js                                 ‚ïë
        // ‚ïë  ÂäüËÉΩ: Ëß£ÊûêÁî®Êà∑ËæìÂÖ•ÁöÑ‰∏ãÊ≥®ÊñáÊú¨ÔºåËØÜÂà´Áé©Ê≥ïÂíåÈáëÈ¢ù                    ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // Â≠òÂÇ®Ëß£ÊûêÂêéÁöÑ‰∏ãÊ≥®Êï∞ÊçÆ
        let parsedBets = [];
        let calcResults = [];
        let parsedGroups = [];  // Â≠òÂÇ®ÂàÜÁªÑ‰ø°ÊÅØ
        let parsedLines = [];   // üÜï Â≠òÂÇ®Ë°åÁ∫ßÊï∞ÊçÆÔºàÁî®‰∫éÂ∞èÁ•®ÂºèÊ∏≤ÊüìÔºâ
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // „ÄêÂàÜÁªÑËß£ÊûêÁ≥ªÁªü v3.0„Äë‰∏•Ê†ºÁ©∫Ë°åÂàÜÁªÑ + Ë°åÁ∫ßËøΩË∏™ + ÂéüÊñáÁªëÂÆö
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        /**
         * Ëß£Êûê‰∏ãÊ≥®‰ø°ÊÅØÔºàÂÖ•Âè£ÂáΩÊï∞Ôºâ- ‰∏•Ê†ºÂàÜÁªÑ + Ë°åÁ∫ßËøΩË∏™
         * @param {string} input - Áî®Êà∑ËæìÂÖ•ÁöÑÂéüÂßãÊñáÊú¨
         * @param {boolean} returnGroups - ÊòØÂê¶ËøîÂõûÂàÜÁªÑ‰ø°ÊÅØ
         * @returns {Array} - Ëß£ÊûêÂêéÁöÑ‰∏ãÊ≥®ÂàóË°®ÔºàÂ∏¶ groupId, lineId, originalLineÔºâ
         */
        function parseBetInput(input, returnGroups = false) {
            const bets = [];
            parsedGroups = [];
            parsedLines = [];
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // „ÄêÈ¢ÑÂ§ÑÁêÜ„ÄëÁªü‰∏ÄÊç¢Ë°åÁ¨¶Ê†ºÂºèÔºåËß£ÂÜ≥ÂæÆ‰ø°/Ë∑®Âπ≥Âè∞Â§çÂà∂Á≤òË¥¥ÈóÆÈ¢ò
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            let normalizedInput = input
                .replace(/\r\n/g, '\n')     // WindowsÊç¢Ë°å ‚Üí Unix
                .replace(/\r/g, '\n')       // ËÄÅMacÊç¢Ë°å ‚Üí Unix
                .trim();                     // ÁßªÈô§È¶ñÂ∞æÁ©∫ÁôΩ
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // „ÄêÁ¨¨‰∏ÄÂ±ÇÂàáÂâ≤„Äë‰∏•Ê†ºÊåâÁ©∫Ë°åÂàÜÁªÑ v2.4.6
            // üÜï ÊîπËøõÔºöÈÄêË°åÊ£ÄÊµãÁ©∫Ë°åÔºàÂè™ÂåÖÂê´Á©∫ÁôΩÂ≠óÁ¨¶ÁöÑË°åÔºâÔºåÈÅøÂÖçË°åÈ¶ñÁ©∫Ê†ºÂπ≤Êâ∞ÂàÜÁªÑ
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const allLines = normalizedInput.split('\n');
            const groupTexts = [];
            let currentGroup = [];
            
            for (const line of allLines) {
                const trimmedLine = line.trim();
                if (trimmedLine === '') {
                    // Á©∫Ë°åÔºöÂ¶ÇÊûúÂΩìÂâçÁªÑÊúâÂÜÖÂÆπÔºåÂàôÁªìÊùüÂΩìÂâçÁªÑ
                    if (currentGroup.length > 0) {
                        groupTexts.push(currentGroup.join('\n'));
                        currentGroup = [];
                    }
                } else {
                    // ÈùûÁ©∫Ë°åÔºöÊ∑ªÂä†Âà∞ÂΩìÂâçÁªÑÔºàÂ∑≤trimËøáÔºâ
                    currentGroup.push(trimmedLine);
                }
            }
            // Ê∑ªÂä†ÊúÄÂêé‰∏ÄÁªÑ
            if (currentGroup.length > 0) {
                groupTexts.push(currentGroup.join('\n'));
            }
            
            console.log(`üì¶ ÂàÜÁªÑÂàáÂâ≤ v2.4.6: Ê£ÄÊµãÂà∞ ${allLines.length} Ë°åÔºåÂàÜÊàê ${groupTexts.length} ÁªÑ`);
            
            console.log(`üì¶ ÂàÜÁªÑÂàáÂâ≤: ÂÖ± ${groupTexts.length} ‰∏™ÁªÑ`);
            
            let globalLineIndex = 0;  // ÂÖ®Â±ÄË°åÂè∑ÔºàÁî®‰∫éÂèçÈ¶àÈ°µÂÆö‰ΩçÔºâ
            
            groupTexts.forEach((groupText, groupIndex) => {
                const groupId = groupIndex + 1;
                
                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                // „ÄêÁ¨¨‰∫åÂ±ÇÂàáÂâ≤„ÄëÁªÑÂÜÖÊåâÂçïÊç¢Ë°åÂàÜË°å
                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                const lines = groupText.split('\n').map(l => l.trim()).filter(l => l);
                const groupBets = [];
                const groupLineData = [];
                
                console.log(`  üìã ÁªÑ${groupId}: ${lines.length}Ë°å`);
                
                lines.forEach((originalLine, lineIndexInGroup) => {
                    const lineId = `${groupId}-${lineIndexInGroup}`;  // ÂîØ‰∏ÄË°åÊ†áËØÜ
                    
                    // Â∞ùËØïËß£ÊûêËØ•Ë°å
                    let parsed = null;
                    let isError = false;
                    
                    try {
                        parsed = parseBetLine(originalLine);
                    } catch (e) {
                        console.warn(`    ‚ö†Ô∏è Ë°å${lineId}Ëß£ÊûêÂºÇÂ∏∏:`, e.message);
                        isError = true;
                    }
                    
                    // ÊûÑÂª∫Ë°åÁ∫ßÊï∞ÊçÆ
                    const lineData = {
                        lineId: lineId,
                        groupId: groupId,
                        lineIndexInGroup: lineIndexInGroup,
                        globalLineIndex: globalLineIndex,
                        originalLine: originalLine,  // üîë ÂÖ≥ÈîÆÔºö‰øùÁïôÂÆåÊï¥ÂéüÊñá
                        bets: [],
                        betCount: 0,
                        isError: isError,
                        parseError: isError ? 'Ëß£ÊûêÂ§±Ë¥•' : null
                    };
                    
                    if (parsed && parsed.length > 0) {
                        // Ëß£ÊûêÊàêÂäüÔºö‰∏∫ÊØè‰∏™betÁªëÂÆöË°åÁ∫ß‰ø°ÊÅØ
                        parsed.forEach((bet, betIndex) => {
                            bet.groupId = groupId;
                            bet.lineId = lineId;
                            bet.originalLine = originalLine;  // üîë ÊØè‰∏™betÈÉΩÁªëÂÆöÂéüÊñá
                            bet.globalLineIndex = globalLineIndex;
                            bet.betIndexInLine = betIndex;
                            
                            lineData.bets.push(bet);
                            groupBets.push(bet);
                            bets.push(bet);
                        });
                        lineData.betCount = parsed.length;
                        console.log(`    ‚úÖ Ë°å${lineId}: "${originalLine.substring(0,20)}..." ‚Üí ${parsed.length}Ê≥®`);
                    } else {
                        // Ëß£ÊûêÂ§±Ë¥•ÊàñÊó†ÁªìÊûúÔºöÁîüÊàêÂç†‰ΩçÂØπË±°
                        const placeholderBet = {
                            type: 'Êú™ËØÜÂà´',
                            value: '',
                            amount: 0,
                            groupId: groupId,
                            lineId: lineId,
                            originalLine: originalLine,  // üîë ‰øùÁïôÂéüÊñáÔºÅ
                            globalLineIndex: globalLineIndex,
                            betIndexInLine: 0,
                            isError: true,
                            parseError: 'Êú™ËÉΩËß£ÊûêÂá∫ÊúâÊïà‰∏ãÊ≥®'
                        };
                        lineData.bets.push(placeholderBet);
                        lineData.betCount = 0;
                        lineData.isError = true;
                        groupBets.push(placeholderBet);
                        bets.push(placeholderBet);
                        console.log(`    ‚ùå Ë°å${lineId}: "${originalLine.substring(0,20)}..." ‚Üí Êú™ËØÜÂà´`);
                    }
                    
                    parsedLines.push(lineData);
                    groupLineData.push(lineData);
                    globalLineIndex++;
                });
                
                // ‰øùÂ≠òÂàÜÁªÑ‰ø°ÊÅØ
                parsedGroups.push({
                    id: groupId,
                    rawText: groupText,
                    lines: groupLineData,
                    bets: groupBets,
                    betCount: groupBets.filter(b => !b.isError).length,
                    lineCount: lines.length
                });
            });
            
            console.log(`üìä Ëß£ÊûêÂÆåÊàê: ${parsedGroups.length}ÁªÑ, ${parsedLines.length}Ë°å, ${bets.length}Ê≥®`);
            
            if (returnGroups) {
                return { bets, groups: parsedGroups, lines: parsedLines };
            }
            return bets;
        }
        
        /**
         * üÜï Â≠§ÂÑøË°åÊ£ÄÊµã - ËØÜÂà´ÂèØËÉΩÊòØÊâãËØØÊç¢Ë°åÁöÑË°å
         * ËßÑÂàôÔºöÂÖ®ÊòØÊï∞Â≠ó/ÂàÜÈöîÁ¨¶Ôºå‰∏îÊ≤°ÊúâÈáëÈ¢ùÂÖ≥ÈîÆËØçÔºàÂêÑ/ÂÖÉ/x/XÔºâ
         * @param {string} input - Áî®Êà∑ËæìÂÖ•
         * @returns {Array} - Ê£ÄÊµãÂà∞ÁöÑÂ≠§ÂÑøË°å‰ø°ÊÅØ
         */
        function detectOrphanLines(input) {
            const orphans = [];
            const lines = input.split('\n');
            
            // ÈáëÈ¢ùÂÖ≥ÈîÆËØçÊ≠£Âàô
            const amountKeywords = /[ÂêÑÂÖÉxX√óÂùóÈí±]/;
            // Á∫ØÊï∞Â≠ó/ÂàÜÈöîÁ¨¶Ë°åÊ≠£ÂàôÔºàÂÖÅËÆ∏Á©∫Ê†º„ÄÅÈÄóÂè∑„ÄÅÁÇπ„ÄÅÊñúÊù†Ôºâ
            const pureNumberLine = /^[\d\s,Ôºå.„ÄÇ\/\-]+$/;
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÁ∫ØÊï∞Â≠óË°åÔºàÊ≤°ÊúâÈáëÈ¢ùÂÖ≥ÈîÆËØçÔºâ
                if (pureNumberLine.test(line) && !amountKeywords.test(line)) {
                    // Ê£ÄÊü•‰∏ã‰∏ÄË°åÊòØÂê¶Â≠òÂú®‰∏îÊúâÈáëÈ¢ù
                    const nextLine = lines[i + 1]?.trim() || '';
                    
                    // Âè™ÊúâÂΩì‰∏ã‰∏ÄË°åÊúâÂÜÖÂÆπÊó∂ÊâçÊ†áËÆ∞‰∏∫Â≠§ÂÑøË°å
                    if (nextLine && amountKeywords.test(nextLine)) {
                        orphans.push({
                            lineIndex: i,
                            lineNumber: i + 1,  // ‰∫∫Á±ªÂèØËØªÁöÑË°åÂè∑
                            content: line,
                            nextLineContent: nextLine,
                            suggestMerge: true
                        });
                    }
                }
            }
            
            return orphans;
        }
        
        /**
         * üÜï ÊòæÁ§∫Â≠§ÂÑøË°åÁ°ÆËÆ§ÂºπÁ™ó
         * @param {Array} orphans - Ê£ÄÊµãÂà∞ÁöÑÂ≠§ÂÑøË°å
         * @param {string} input - ÂéüÂßãËæìÂÖ•
         * @returns {Promise<string>} - Â§ÑÁêÜÂêéÁöÑËæìÂÖ•
         */
        function showOrphanConfirmDialog(orphans, input) {
            return new Promise((resolve) => {
                if (orphans.length === 0) {
                    resolve(input);
                    return;
                }
                
                const orphan = orphans[0];  // ‰∏ÄÊ¨°Â§ÑÁêÜ‰∏Ä‰∏™
                
                const dialogHtml = `
                    <div style="text-align:left;">
                        <div style="background:rgba(255,193,7,0.2);padding:12px;border-radius:8px;margin-bottom:12px;border-left:3px solid #ffc107;">
                            <div style="color:#ffc107;font-weight:bold;margin-bottom:8px;">‚ö†Ô∏è Ê£ÄÊµãÂà∞ÂèØËÉΩÁöÑÊñ≠Ë°å</div>
                            <div style="font-size:12px;color:#aaa;margin-bottom:4px;">Á¨¨ ${orphan.lineNumber} Ë°å‰ºº‰πéÂè™ÊúâÂè∑Á†ÅÔºåÊ≤°ÊúâÈáëÈ¢ùÔºö</div>
                        </div>
                        
                        <div style="background:rgba(0,0,0,0.3);padding:10px;border-radius:6px;margin-bottom:10px;font-family:monospace;">
                            <div style="color:#888;font-size:10px;margin-bottom:2px;">Á¨¨${orphan.lineNumber}Ë°å:</div>
                            <div style="color:#fbbf24;font-size:14px;font-weight:bold;">${orphan.content}</div>
                            <div style="color:#444;margin:4px 0;">‚Üì (Êç¢Ë°å)</div>
                            <div style="color:#888;font-size:10px;margin-bottom:2px;">Á¨¨${orphan.lineNumber + 1}Ë°å:</div>
                            <div style="color:#fff;font-size:14px;">${orphan.nextLineContent}</div>
                        </div>
                        
                        <div style="font-size:12px;color:#888;margin-bottom:12px;">
                            üí° <strong>Âª∫ËÆÆ</strong>ÔºöÂ¶ÇÊûúÊòØÊâãËØØÊç¢Ë°åÔºåÂèØ‰ª•ÂêàÂπ∂Ëøô‰∏§Ë°å
                        </div>
                        
                        <div style="display:flex;gap:10px;">
                            <button onclick="window._orphanResolve('merge')" style="flex:1;padding:10px;background:linear-gradient(135deg,#4caf50,#45a049);color:white;border:none;border-radius:6px;font-weight:bold;cursor:pointer;">
                                ‚úÖ ÂêàÂπ∂Ëøô‰∏§Ë°å
                            </button>
                            <button onclick="window._orphanResolve('keep')" style="flex:1;padding:10px;background:rgba(255,255,255,0.1);color:#aaa;border:1px solid #444;border-radius:6px;cursor:pointer;">
                                ‰øùÊåÅÂéüÊ†∑
                            </button>
                        </div>
                    </div>
                `;
                
                showCustomModal('üîç Êñ≠Ë°åÊ£ÄÊµã', dialogHtml);
                
                window._orphanResolve = (action) => {
                    closeCustomModal();
                    
                    if (action === 'merge') {
                        // ÂêàÂπ∂ÔºöÂà†Èô§ËØ•Ë°åÁöÑÊç¢Ë°åÁ¨¶
                        const lines = input.split('\n');
                        lines[orphan.lineIndex] = lines[orphan.lineIndex] + ' ' + lines[orphan.lineIndex + 1];
                        lines.splice(orphan.lineIndex + 1, 1);
                        const newInput = lines.join('\n');
                        
                        // Êõ¥Êñ∞ËæìÂÖ•Ê°Ü
                        document.getElementById('bet-input').value = newInput;
                        showAutoCloseToast('‚úÖ Â∑≤ÂêàÂπ∂Á¨¨' + orphan.lineNumber + 'Ë°å', 2000);
                        
                        // ÈÄíÂΩíÊ£ÄÊµãÂâ©‰ΩôÂ≠§ÂÑøË°å
                        const remainingOrphans = detectOrphanLines(newInput);
                        if (remainingOrphans.length > 0) {
                            showOrphanConfirmDialog(remainingOrphans, newInput).then(resolve);
                        } else {
                            resolve(newInput);
                        }
                    } else {
                        // ‰øùÊåÅÂéüÊ†∑ÔºåÁªßÁª≠Ê£ÄÊµã‰∏ã‰∏Ä‰∏™
                        const remainingOrphans = orphans.slice(1);
                        if (remainingOrphans.length > 0) {
                            showOrphanConfirmDialog(remainingOrphans, input).then(resolve);
                        } else {
                            resolve(input);
                        }
                    }
                };
            });
        }
        
        // Ëé∑ÂèñÊ†ºÂºèËÆæÁΩÆ
        // API Key Â∑≤ÁßªËá≥ÈòøÈáå‰∫ëÂáΩÊï∞ÁéØÂ¢ÉÂèòÈáèÔºåÂâçÁ´Ø‰∏çÂÜçÂ≠òÂÇ®
        function getFormatSettings() {
            try {
                const saved = JSON.parse(localStorage.getItem('lhc_format_settings') || '{}');
                // AIÈÖçÁΩÆÔºöKeyÂú®ÂêéÁ´ØÔºåÂâçÁ´ØÂè™ÈúÄË¶ÅÁü•ÈÅìÊòØÂê¶ÂêØÁî®Âíå‰ΩøÁî®Âì™‰∏™Ê®°Âûã
                // „Äê‰øÆÂ§ç„Äë‰ºòÂÖà‰ªé ai_provider ËØªÂèñÁî®Êà∑ÂàáÊç¢ÁöÑÊ®°ÂûãÈÄâÊã©
                saved.aiProvider = localStorage.getItem('ai_provider') || saved.aiProvider || 'openrouter';
                if (saved.aiEnabled === undefined) {
                    saved.aiEnabled = true; // ÈªòËÆ§ÂêØÁî®
                }
                return saved;
            } catch(e) {
                return {
                    aiEnabled: true,
                    aiProvider: localStorage.getItem('ai_provider') || 'openrouter'
                };
            }
        }
        
        // Ëß£ÊûêËá™ÂÆö‰πâÂÖ≥ÈîÆËØç
        function parseCustomKeywords(line, settings) {
            const bets = [];
            const keywords = (settings.customKeywords || '').split('\n').filter(k => k.trim());
            
            for (const kw of keywords) {
                const [key, playType] = kw.split('=').map(s => s.trim());
                if (key && playType && line.includes(key)) {
                    // ÊèêÂèñÂÖ≥ÈîÆËØçÂêéÈù¢ÁöÑÊï∞Â≠ó‰Ωú‰∏∫ÈáëÈ¢ù
                    const amountMatch = line.match(new RegExp(key + '.*?(\\d+)'));
                    if (amountMatch) {
                        // ÊèêÂèñÂèØËÉΩÁöÑÂè∑Á†ÅÊàñÁîüËÇñ
                        const numMatch = line.match(/(\d+)/g);
                        if (numMatch && numMatch.length >= 2) {
                            bets.push({ 
                                type: playType, 
                                value: numMatch[0], 
                                number: parseInt(numMatch[0]),
                                amount: parseInt(numMatch[numMatch.length - 1]), 
                                raw: line 
                            });
                            return bets;
                        }
                    }
                }
            }
            return null;
        }
        
        // Â¢ûÂº∫ÁâàËß£ÊûêÂçïË°å‰∏ãÊ≥®
        function parseBetLine(line) {
            const bets = [];
            const settings = getFormatSettings();
            const shengxiaoList = ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'];
            
            // „ÄêÂÖ≥ÈîÆ‰øÆÂ§ç„ÄëÈ¢ÑÂ§ÑÁêÜÔºöÂÖ®ËßíËΩ¨ÂçäËßíÔºàËß£ÂÜ≥ÊâãÊú∫ËæìÂÖ•ÈóÆÈ¢òÔºâ
            if (typeof normalizeFullWidth === 'function') {
                line = normalizeFullWidth(line);
            }
            
            // È¢ÑÂ§ÑÁêÜÔºöËΩ¨Êç¢‰∏≠ÊñáÊï∞Â≠ó
            if (settings.cnNumber !== false) {
            line = convertChineseNumber(line);
            }
            
            // È¢ÑÂ§ÑÁêÜÔºöÊ∏ÖÁêÜÂ§ö‰ΩôÁ©∫Ê†º
            if (settings.ignoreSpace !== false) {
                line = line.replace(/\s+/g, ' ').trim();
            }
            
            // È¢ÑÂ§ÑÁêÜÔºöÂêåÈü≥Â≠óÁ∫†Ê≠£
            if (settings.autoCorrect !== false) {
                line = correctHomophones(line);
            }
            
            // ‰ºòÂÖàÊ£ÄÊü•Ëá™ÂÆö‰πâÂÖ≥ÈîÆËØç
            const customResult = parseCustomKeywords(line, settings);
            if (customResult && customResult.length > 0) {
                return customResult;
            }
            
            // ========== Ê®°Âºè1: Â§öÂè∑Á†ÅÂêÑ‰∏ãÊ≥® ==========
            // "31.34ÂêÑ20" Êàñ "31 34ÂêÑ20" Êàñ "31,34ÂêÑ20"
            if (settings.tplMultiNum !== false) {
                const multiMatch = line.match(/^(\d+[\s.,Ôºå„ÄÅ]+\d+(?:[\s.,Ôºå„ÄÅ]+\d+)*)ÂêÑ(\d+)ÂÖÉ?$/);
            if (multiMatch) {
                    const nums = multiMatch[1].split(/[\s.,Ôºå„ÄÅ]+/).map(n => parseInt(n));
                const amount = parseInt(multiMatch[2]);
                for (const num of nums) {
                        if (num >= 1 && num <= 49) {
                    bets.push({ type: 'ÁâπÁ†Å', number: num, amount: amount, raw: line });
                }
                    }
                    if (bets.length) return bets;
                }
            }
            
            // ========== Ê®°Âºè2: ÁâπÁ†Å‰∏ãÊ≥® ==========
            // "Áâπ43 20ÂÖÉ" "ÁâπÁ†Å 05 100" "Áâπ43 20"
            if (settings.tplTema !== false) {
                const temaMatch = line.match(/ÁâπÁ†Å?\s*(\d+)\s*[,Ôºå]?\s*(\d+)ÂÖÉ?/);
            if (temaMatch) {
                bets.push({ type: 'ÁâπÁ†Å', number: parseInt(temaMatch[1]), amount: parseInt(temaMatch[2]), raw: line });
                return bets;
                }
            }
            
            // ========== Ê®°Âºè3: XË°®Á§∫ÈáëÈ¢ù ==========
            // "46,45,X50" "22Ôºå33ÔºåX15" "È∏°Èº†Áå¥X10"
            if (settings.tplXAmount !== false) {
                // Êï∞Â≠ó+XÈáëÈ¢ù
                const xNumMatch = line.match(/(\d+(?:[,Ôºå„ÄÅ\s]+\d+)*)[,Ôºå„ÄÅ\s]*[Xx](\d+)/);
                if (xNumMatch) {
                    const nums = xNumMatch[1].split(/[,Ôºå„ÄÅ\s]+/).map(n => parseInt(n)).filter(n => n >= 1 && n <= 49);
                    const amount = parseInt(xNumMatch[2]);
                    for (const num of nums) {
                        bets.push({ type: 'ÁâπÁ†Å', number: num, amount: amount, raw: line });
                    }
                    if (bets.length) return bets;
                }
                
                // ÁîüËÇñ+XÈáëÈ¢ù
                const xSxMatch = line.match(/([Èº†ÁâõËôéÂÖîÈæôËõáÈ©¨ÁæäÁå¥È∏°ÁãóÁå™]+)[Xx](\d+)/);
                if (xSxMatch) {
                    const animals = xSxMatch[1].split('');
                    const amount = parseInt(xSxMatch[2]);
                    for (const sx of animals) {
                        if (shengxiaoList.includes(sx)) {
                            bets.push({ type: 'ÁîüËÇñ', value: sx, amount: amount, raw: line });
                        }
                    }
                    if (bets.length) return bets;
                }
            }
            
            // ========== Ê®°Âºè4: ‰π∞ÁîüËÇñ ==========
            // "‰π∞Áå™ÂêÑ10" "‰π∞ÈæôÂêÑ20" "‰π∞Áå™10"
            if (settings.tplShengxiao !== false) {
                const buyMatch = line.match(/‰π∞([Èº†ÁâõËôéÂÖîÈæôËõáÈ©¨ÁæäÁå¥È∏°ÁãóÁå™]+)ÂêÑ?(\d+)ÂÖÉ?/);
                if (buyMatch) {
                    const animals = buyMatch[1].split('');
                    const amount = parseInt(buyMatch[2]);
                    for (const sx of animals) {
                        if (shengxiaoList.includes(sx)) {
                            bets.push({ type: 'ÁîüËÇñ', value: sx, amount: amount, raw: line });
                        }
                    }
                    if (bets.length) return bets;
                }
                
                // ÂçïÁã¨ÁîüËÇñ "Èæô 200" "Áå™200"
            for (const sx of shengxiaoList) {
                    const sxMatch = line.match(new RegExp(`^${sx}\\s*(\\d+)ÂÖÉ?$`));
                if (sxMatch) {
                    bets.push({ type: 'ÁîüËÇñ', value: sx, amount: parseInt(sxMatch[1]), raw: line });
                    return bets;
                    }
                }
            }
            
            // ========== Ê®°Âºè5: Â∞æÊï∞‰∏ãÊ≥® ==========
            // "5Â∞æ100" "Â∞æ5 100"
            if (settings.tplWei !== false) {
                const weiMatch = line.match(/(\d)Â∞æ\s*(\d+)ÂÖÉ?/) || line.match(/Â∞æ(\d)\s*(\d+)ÂÖÉ?/);
                if (weiMatch) {
                    bets.push({ type: 'Â∞æÊï∞', value: weiMatch[1], amount: parseInt(weiMatch[2]), raw: line });
                    return bets;
                }
            }
            
            // ========== Ê®°Âºè6: Â§öËÇñ‰∏ãÊ≥® ==========
            // "ÂÖ≠ËÇñÈº†ÁæäÈ∏°ÁâõÈ©¨‰∫å200" "‰∏âËÇñÈæôËôéËõá100"
            if (settings.tplDuoxiao !== false) {
                const duoxiaoMatch = line.match(/([‰∏Ä‰∫å‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅ]+ËÇñ|ËÇñ)([Èº†ÁâõËôéÂÖîÈæôËõáÈ©¨ÁæäÁå¥È∏°ÁãóÁå™]+)\s*(\d+)ÂÖÉ?/);
                if (duoxiaoMatch) {
                    const animals = duoxiaoMatch[2].split('');
                    const amount = parseInt(duoxiaoMatch[3]);
                    for (const sx of animals) {
                        if (shengxiaoList.includes(sx)) {
                            bets.push({ type: 'Â§öËÇñ', value: sx, amount: amount, raw: line });
                        }
                    }
                    if (bets.length) return bets;
                }
            }
            
            // ========== Ê®°Âºè7: Âπ≥ÁâπÁîüËÇñ ==========
            // "Âπ≥ÁâπÁå¥È∏°ÂêÑ200" "Âπ≥ÁâπÁå™100"
            if (settings.tplPingte !== false) {
                const pingteMatch = line.match(/Âπ≥Áâπ([Èº†ÁâõËôéÂÖîÈæôËõáÈ©¨ÁæäÁå¥È∏°ÁãóÁå™]+)ÂêÑ?(\d+)ÂÖÉ?/);
                if (pingteMatch) {
                    const animals = pingteMatch[1].split('');
                    const amount = parseInt(pingteMatch[2]);
                    for (const sx of animals) {
                        if (shengxiaoList.includes(sx)) {
                            bets.push({ type: 'Âπ≥ÁâπÁîüËÇñ', value: sx, amount: amount, raw: line });
                        }
                    }
                    if (bets.length) return bets;
                }
            }
            
            // ========== Ê®°Âºè8: Ê≥¢Ëâ≤ ==========
            // "Á∫¢Ê≥¢ 50" "Á∫¢ 50" "ËìùÊ≥¢100"
            if (settings.tplBose !== false) {
                const boseMatch = line.match(/(Á∫¢|Ëìù|Áªø)Ê≥¢?\s*(\d+)ÂÖÉ?/);
            if (boseMatch) {
                bets.push({ type: 'Ê≥¢Ëâ≤', value: boseMatch[1] + 'Ê≥¢', amount: parseInt(boseMatch[2]), raw: line });
                return bets;
                }
            }
            
            // ========== Ê®°Âºè9: ‰∏§Èù¢ÔºàÂ§ßÂ∞èÂçïÂèåÔºâ ==========
            // "Â§ß 100" "Â∞è100" "ÂçïÂèåÂêÑ50"
            if (settings.tplDxds !== false) {
                const dxdsMatch = line.match(/^(Â§ß|Â∞è|Âçï|Âèå)\s*(\d+)ÂÖÉ?$/);
            if (dxdsMatch) {
                bets.push({ type: '‰∏§Èù¢', value: dxdsMatch[1], amount: parseInt(dxdsMatch[2]), raw: line });
                return bets;
                }
                
                // "ÂçïÂèåÂêÑ50"
                const dxdsGeMatch = line.match(/(Â§ßÂ∞è|ÂçïÂèå)ÂêÑ(\d+)ÂÖÉ?/);
                if (dxdsGeMatch) {
                    const types = dxdsGeMatch[1].split('');
                    const amount = parseInt(dxdsGeMatch[2]);
                    for (const t of types) {
                        bets.push({ type: '‰∏§Èù¢', value: t, amount: amount, raw: line });
                    }
                    if (bets.length) return bets;
                }
            }
            
            // ========== Ê®°Âºè10: Á∫ØÊï∞Â≠ó+ÈáëÈ¢ù ==========
            // "43 20" ÁÆÄÂÜôÂΩ¢Âºè
            const simpleMatch = line.match(/^(\d{1,2})\s+(\d+)ÂÖÉ?$/);
            if (simpleMatch) {
                const num = parseInt(simpleMatch[1]);
                if (num >= 1 && num <= 49) {
                    bets.push({ type: 'ÁâπÁ†Å', number: num, amount: parseInt(simpleMatch[2]), raw: line });
                    return bets;
                }
            }
            
            // ========== Ê®°Âºè11: Â§öÁîüËÇñÂêÑ‰∏ãÊ≥® ==========
            // "Èº†ÁæäÈ∏°ÁâõÈ©¨ÂêÑ200"
            const multiSxMatch = line.match(/^([Èº†ÁâõËôéÂÖîÈæôËõáÈ©¨ÁæäÁå¥È∏°ÁãóÁå™]{2,})ÂêÑ(\d+)ÂÖÉ?$/);
            if (multiSxMatch) {
                const animals = multiSxMatch[1].split('');
                const amount = parseInt(multiSxMatch[2]);
                for (const sx of animals) {
                    if (shengxiaoList.includes(sx)) {
                        bets.push({ type: 'ÁîüËÇñ', value: sx, amount: amount, raw: line });
                    }
                }
                if (bets.length) return bets;
            }
            
            return null;
        }
        
        // ÂêåÈü≥Â≠óÁ∫†Ê≠£
        function correctHomophones(str) {
            const corrections = {
                'Áå™': ['‰∏ª', 'Êú±', 'Áè†', 'ËØ∏'],
                'Áâõ': ['Â¶û', 'Á∫Ω', 'ÈíÆ'],
                'Ëôé': ['Êà∑', 'Ê≤™', 'Êä§'],
                'Èæô': ['ÈöÜ', 'ËÅã', 'Á¨º'],
                'Ëõá': ['Ëàç', 'Ê∂â', 'ËÆæ'],
                'È©¨': ['Â¶à', 'Á†Å', 'Áéõ','Âêó'],
                'Áæä': ['Èò≥', 'Êâ¨', 'Êù®', 'Ê¥ã'],
                'Áå¥': ['‰æØ', 'ÂÄô', 'Âñâ'],
                'È∏°': ['Êú∫', 'Âü∫', 'ÊøÄ', 'Âèä'],
                'Áãó': ['Â§ü', 'Ë¥≠', 'ÊûÑ', 'Ê≤ü'],
                'Èº†': ['Êöë', 'Êï∞', 'Â±û', 'ÁΩ≤'],
                'ÂÖî': ['Âêê', 'Âõæ', 'Âúü', 'ÈÄî']
            };
            
            for (const [correct, wrongs] of Object.entries(corrections)) {
                for (const wrong of wrongs) {
                    str = str.replace(new RegExp(wrong, 'g'), correct);
                }
            }
            return str;
        }
        
        // ËΩ¨Êç¢‰∏≠ÊñáÊï∞Â≠óÔºàÊô∫ËÉΩÁâàÔºöÊ≠£Á°ÆÂ§ÑÁêÜÂêÑÁßç‰∏≠ÊñáÊï∞Â≠óÊ†ºÂºèÔºâ
        function convertChineseNumber(str) {
            // ÂÆö‰πâ‰∏≠ÊñáÊï∞Â≠óÊò†Â∞Ñ
            const digitMap = {'Èõ∂':0,'‰∏Ä':1,'‰∫å':2,'‰∏§':2,'‰∏â':3,'Âõõ':4,'‰∫î':5,'ÂÖ≠':6,'‰∏É':7,'ÂÖ´':8,'‰πù':9};
            
            // Â§ÑÁêÜÂÆåÊï¥ÁöÑ‰∏≠ÊñáÊï∞Â≠óÔºàÂ¶Ç"‰∫åÂçÅ‰∫î"„ÄÅ"‰∏ÄÁôæ‰∫åÂçÅ"Á≠âÔºâ
            function parseChineseNum(cnStr) {
                let result = 0;
                let temp = 0;
                
                for (let i = 0; i < cnStr.length; i++) {
                    const char = cnStr[i];
                    if (digitMap[char] !== undefined) {
                        temp = digitMap[char];
                    } else if (char === 'ÂçÅ') {
                        if (temp === 0 && i === 0) temp = 1; // "ÂçÅ"ÂºÄÂ§¥Ë°®Á§∫10
                        result += temp * 10;
                        temp = 0;
                    } else if (char === 'Áôæ') {
                        result += temp * 100;
                        temp = 0;
                    } else if (char === 'ÂçÉ') {
                        result += temp * 1000;
                        temp = 0;
                    }
                }
                result += temp; // Âä†‰∏äÊúÄÂêéÁöÑ‰∏™‰ΩçÊï∞
                return result;
            }
            
            // ÂåπÈÖç‰∏≠ÊñáÊï∞Â≠ó‰∏≤Âπ∂ÊõøÊç¢
            // ÂåπÈÖçÊ®°ÂºèÔºöËøûÁª≠ÁöÑ‰∏≠ÊñáÊï∞Â≠óÂ≠óÁ¨¶
            const cnNumPattern = /[Èõ∂‰∏Ä‰∫å‰∏§‰∏âÂõõ‰∫îÂÖ≠‰∏ÉÂÖ´‰πùÂçÅÁôæÂçÉ]+/g;
            
            str = str.replace(cnNumPattern, (match) => {
                const num = parseChineseNum(match);
                return num.toString();
            });
            
            return str;
        }
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë                    „ÄêÊ®°Âùó2„ÄëËÆ°ÁÆóÈÄªËæëÊ®°Âùó                        ‚ïë
        // ‚ïë  Êñá‰ª∂ÂàÜÁ¶ªÊó∂ÊèêÂèñÂà∞: js/calculator.js                             ‚ïë
        // ‚ïë  ÂäüËÉΩ: Ê†πÊçÆÂºÄÂ•ñÂè∑Á†ÅÂíå‰∏ãÊ≥®‰ø°ÊÅØËÆ°ÁÆó‰∏≠Â•ñÁªìÊûú                        ‚ïë
        // ‚ïë  üÜï v3.0 ËÆ°ÁÆóÈÄªËæëÂ∑≤ËøÅÁßªÂà∞ÂêéÁ´ØÔºåÂâçÁ´ØÂè™ÂÅöÂ±ïÁ§∫                      ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        /**
         * üÜï v3.4 Ëé∑ÂèñËµîÁéáÈÖçÁΩÆÔºàËΩ¨Êç¢‰∏∫ÂêéÁ´ØÊ†ºÂºèÔºâ
         * üÜï v3.11.2 Ê∑ªÂä† PT2-PT5 Âπ≥ÁâπËøûËÇñËµîÁéá
         * @returns {Object} ËµîÁéáÈÖçÁΩÆ
         */
        function getOddsConfig() {
            const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
            return {
                r1: parseFloat(savedOdds['odds-tema']) || 43,        // ÁâπÁ†ÅÂÄçÁéá
                r2: parseFloat(savedOdds['odds-shengxiao']) || 12,   // ÁîüËÇñÂÄçÁéá
                r3: parseFloat(savedOdds['odds-pingte1']) || 11,     // Âπ≥Áâπ‰∏ÄËÇñ(PT1)ÂÄçÁéá
                r_pt2: parseFloat(savedOdds['odds-pingte2x']) || 26, // Âπ≥Áâπ‰∫åËøûËÇñ(PT2)ÂÄçÁéá
                r_pt3: parseFloat(savedOdds['odds-pingte3x']) || 66, // Âπ≥Áâπ‰∏âËøûËÇñ(PT3/‰∏âÂèã)ÂÄçÁéá
                r_pt4: parseFloat(savedOdds['odds-pingte4x']) || 180,// Âπ≥ÁâπÂõõËøûËÇñ(PT4)ÂÄçÁéá
                r_pt5: parseFloat(savedOdds['odds-pingte5x']) || 500,// Âπ≥Áâπ‰∫îËøûËÇñ(PT5)ÂÄçÁéá
                r_dxds: parseFloat(savedOdds['odds-dxds']) || 1.98   // Â§ßÂ∞èÂçïÂèåÂÄçÁéá
            };
        }
        
        /**
         * üÜï v3.0 Ë∞ÉÁî®ÂêéÁ´ØËÆ°ÁÆóÊé•Âè£Ôºà‰∏ÄÁ´ôÂºèÔºöËØÜÂà´+ËÆ°ÁÆóÔºâ
         * @param {string} sanitizedInput ‰ª£Âè∑ËΩ¨Êç¢ÂêéÁöÑËæìÂÖ•ÊñáÊú¨ÔºàZ‰ª£Âè∑Ê†ºÂºèÔºâ
         * @param {Array} dataArr Êï∞ÊçÆÊï∞ÁªÑÔºà7‰∏™Êï∞Â≠óÔºâ
         * @param {Object} config ÈÖçÁΩÆÂèÇÊï∞ {r1, r2, r3}
         * @param {string} provider ÊúçÂä°ÂïÜ
         * @param {string} model Ê®°Âûã
         * @returns {Object} ËÆ°ÁÆóÁªìÊûú {success, items, s1, s2, s3, s4, error}
         */
        async function callBackendCalc(sanitizedInput, dataArr, config, provider = 'deepseek', model = null, hkDataArr = null) {
            const requestBody = {
                t: sanitizedInput,   // ‰ª£Âè∑ËΩ¨Êç¢ÂêéÁöÑÊñáÊú¨ÔºàZ‰ª£Âè∑Ê†ºÂºèÔºâ
                d: dataArr,          // Êï∞ÊçÆÊï∞ÁªÑÔºà7‰∏™Êï∞Â≠óÔºâ- Êæ≥Èó®ÂºÄÂ•ñ
                c: config,           // ÈÖçÁΩÆÂèÇÊï∞
                p: provider,         // ÊúçÂä°ÂïÜ
                m: model             // Ê®°Âûã
            };
            
            // üÜï v3.11.30 Â¶ÇÊûúÊúâÈ¶ôÊ∏ØÂºÄÂ•ñÊï∞ÊçÆÔºå‰º†ÈÄíÁªôÂêéÁ´Ø
            if (hkDataArr && hkDataArr.length === 7) {
                requestBody.hk_d = hkDataArr;
            }
            
            console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #2196f3');
            console.log('%cüì§ „ÄêÂèëÈÄÅÂà∞ÂêéÁ´Ø„Äë', 'color: #2196f3; font-weight: bold; font-size: 14px');
            console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #2196f3');
            console.log('   üìù ËæìÂÖ•ÊñáÊú¨:', sanitizedInput);
            console.log('   üé≤ Êæ≥Èó®ÂºÄÂ•ñ:', dataArr.slice(0,6).join(', '), '+ ÁâπÁ†Å', dataArr[6]);
            if (hkDataArr) console.log('   üé≤ È¶ôÊ∏ØÂºÄÂ•ñ:', hkDataArr.slice(0,6).join(', '), '+ ÁâπÁ†Å', hkDataArr[6]);
            console.log('   ‚öôÔ∏è ËµîÁéáÈÖçÁΩÆ:', config);
            console.log('   ü§ñ AIÊúçÂä°ÂïÜ:', provider);
            
            const response = await fetch(`${ALIYUN_PROXY_URL}/api/calc`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(requestBody)
            });
            
            if (!response.ok) {
                const errText = await response.text();
                throw new Error(`ÂêéÁ´ØËÆ°ÁÆóÂ§±Ë¥•: ${response.status} - ${errText}`);
            }
            
            const result = await response.json();
            
            // üÜï v3.11.3 ËØ¶ÁªÜÁöÑË∞ÉËØïÊó•ÂøóËæìÂá∫
            console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #4caf50');
            console.log('%cüì• „ÄêÂêéÁ´ØËøîÂõûÁªìÊûú„Äë', 'color: #4caf50; font-weight: bold; font-size: 14px');
            console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #4caf50');
            
            if (result.success) {
                console.log('   ‚úÖ Áä∂ÊÄÅ: ÊàêÂäü');
                console.log('   ü§ñ ‰ΩøÁî®Ê®°Âûã:', result.model_used || 'Êú™Áü•');
                console.log('   ‚è±Ô∏è ËÄóÊó∂:', result.latency_ms + 'ms');
                console.log('   üìä ËØÜÂà´Êù°Êï∞:', result.extract_count || result.items?.length || 0);
                console.log('   üìä Â±ïÂºÄÊù°Êï∞:', result.items?.length || 0);
                
                // ËæìÂá∫ÊØèÊù°ËØÜÂà´ÁªìÊûú
                if (result.items && result.items.length > 0) {
                    console.log('%c‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #ff9800');
                    console.log('%cüìã „ÄêËØÜÂà´ÁªìÊûúËØ¶ÊÉÖ„Äë', 'color: #ff9800; font-weight: bold');
                    console.log('%c‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #ff9800');
                    
                    // Á±ªÂûã‰ª£Á†ÅÊò†Â∞Ñ
                    const CODE_MAP = {
                        'T01': 'ÁâπÁ†Å', 'SXTM': 'ÁîüËÇñÁâπÁ†Å', 'SX': 'ÁîüËÇñ',
                        'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                        'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ',
                        'BS': 'Ê≥¢Ëâ≤', 'BB': 'ÂçäÊ≥¢', 'BZ': '‰∏ç‰∏≠',
                        'XS': 'Â∞èÊï∞', 'DS': 'Â§ßÊï∞', 'ODD': 'ÂçïÊï∞', 'EVEN': 'ÂèåÊï∞'
                    };
                    
                    result.items.forEach((item, idx) => {
                        const typeName = CODE_MAP[item.code] || item.code;
                        const nums = item.n ? item.n.join(',') : '-';
                        const zodiac = item.z || '-';
                        const win = item.w ? '‚úì‰∏≠' : '‚úóÊú™‰∏≠';
                        const winColor = item.w ? 'color: #4caf50; font-weight: bold' : 'color: #999';
                        
                        console.log(`   [${idx + 1}] %c${win}%c ${typeName}(${item.code}) | Âè∑Á†Å:[${nums}] | ÁîüËÇñ:${zodiac} | ÈáëÈ¢ù:${item.a}ÂÖÉ | ËµîÁéá:${item.r}ÂÄç | Ê¥æÂΩ©:${item.v}ÂÖÉ`,
                            winColor, 'color: inherit');
                        console.log(`       ÂéüÊñá: "${item.raw || '-'}"`);
                    });
                }
                
                // ËæìÂá∫Ê±áÊÄª
                console.log('%c‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #9c27b0');
                console.log('%cüí∞ „ÄêËÆ°ÁÆóÊ±áÊÄª„Äë', 'color: #9c27b0; font-weight: bold');
                console.log('%c‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #9c27b0');
                console.log('   üìä ÊÄªÊäïÊ≥®:', result.s1 + 'ÂÖÉ');
                console.log('   üéØ ‰∏≠Â•ñÊ≥®Êï∞:', result.s2 + 'Ê≥®');
                console.log('   üíµ Ê¥æÂΩ©ÈáëÈ¢ù:', result.s3 + 'ÂÖÉ');
                console.log('   üí∞ ÁªìÁÆó:', (result.s4 >= 0 ? '+' : '') + result.s4 + 'ÂÖÉ');
            } else {
                console.log('   ‚ùå Áä∂ÊÄÅ: Â§±Ë¥•');
                console.log('   ‚ö†Ô∏è ÈîôËØØ:', result.error || 'Êú™Áü•ÈîôËØØ');
            }
            
            console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #4caf50');
            
            return result;
        }
        
        // ËÆ°ÁÆóÂçïÊ≥®ÁªìÊûúÔºàüÜï v3.0 ‰ªÖ‰Ωú‰∏∫Êú¨Âú∞Ëß£ÊûêÁöÑÂ§áÁî®Ôºå‰∏ªË¶ÅÈÄªËæëÂú®ÂêéÁ´ØÔºâ
        function calculateSingleBet(bet, lotteryNumbers) {
            const tema = lotteryNumbers[6]; // ÁâπÁ†Å
            const pingma = lotteryNumbers.slice(0, 6); // Âπ≥Á†Å
            const allNumbers = lotteryNumbers; // ÊâÄÊúâÂè∑Á†Å
            
            let isWin = false;
            let odds = 1;
            let winAmount = 0;
            let detail = '';
            
            // Ëé∑ÂèñËµîÁéá
            const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
            
            if (bet.type === 'ÁâπÁ†Å') {
                odds = parseFloat(savedOdds['odds-tema']) || 43;
                // üÜï v2.4.8 ‰øÆÂ§çÔºöÂÖºÂÆπÊú¨Âú∞Ëß£Êûê(number)ÂíåAIËß£Êûê(value)‰∏§ÁßçÂ≠óÊÆµ
                const betNum = parseInt(bet.number || bet.value);
                isWin = betNum === parseInt(tema);
                // üÜï v3.3 ÁîüËÇñÁâπÁ†ÅÂêàÂπ∂Âà∞ÁâπÁ†ÅÔºåÈÄöËøázodiacÂ≠óÊÆµÂå∫ÂàÜÊòæÁ§∫
                if (bet.zodiac) {
                    detail = `ÁâπÁ†Å(${bet.zodiac}) ${String(betNum).padStart(2,'0')} vs ÂºÄÂ•ñÁâπÁ†Å ${String(tema).padStart(2,'0')}`;
                } else {
                    detail = `ÁâπÁ†Å ${String(betNum).padStart(2,'0')} vs ÂºÄÂ•ñÁâπÁ†Å ${String(tema).padStart(2,'0')}`;
                }
            } else if (bet.type === 'ÁîüËÇñÁâπÁ†Å') {
                // üÜï v3.3 ÂÖºÂÆπÊóßÁâà"ÁîüËÇñÁâπÁ†Å"Á±ªÂûãÔºàÈÄêÊ≠•Â∫üÂºÉÔºâ
                odds = parseFloat(savedOdds['odds-tema']) || 43;
                const betNum = parseInt(bet.number || bet.value);
                isWin = betNum === parseInt(tema);
                const zodiacName = bet.zodiac || '';
                detail = `ÁâπÁ†Å(${zodiacName}) ${String(betNum).padStart(2,'0')} vs ÂºÄÂ•ñÁâπÁ†Å ${String(tema).padStart(2,'0')}`;
            } else if (bet.type === 'ÁîüËÇñ' || bet.type === 'Â§öËÇñ') {
                odds = parseFloat(savedOdds['odds-shengxiao']) || 12;
                const sxNums = LHC_DATA.shengxiao[bet.value] || [];
                isWin = sxNums.includes(parseInt(tema));
                detail = `ÁîüËÇñ ${bet.value} (${sxNums.join(',')}) vs ÁâπÁ†Å ${tema}`;
            } else if (bet.type === 'Âπ≥ÁâπÁîüËÇñ') {
                // Âπ≥ÁâπÁîüËÇñÔºöÊ£ÄÊü•Âπ≥Á†Å‰∏≠ÊòØÂê¶ÊúâËØ•ÁîüËÇñ
                odds = parseFloat(savedOdds['odds-pingte']) || 12;
                const sxNums = LHC_DATA.shengxiao[bet.value] || [];
                isWin = pingma.some(num => sxNums.includes(num));
                const matchNums = pingma.filter(num => sxNums.includes(num));
                detail = `Âπ≥Áâπ ${bet.value} (${sxNums.join(',')}) vs Âπ≥Á†Å [${pingma.join(',')}]${matchNums.length > 0 ? ' ‰∏≠' + matchNums.join(',') : ''}`;
            } else if (bet.type === 'Ê≥¢Ëâ≤') {
                const colorKey = bet.value === 'Á∫¢Ê≥¢' ? 'odds-red' : bet.value === 'ËìùÊ≥¢' ? 'odds-blue' : 'odds-green';
                odds = parseFloat(savedOdds[colorKey]) || 2.8;
                const boseNums = LHC_DATA.bose[bet.value] || [];
                isWin = boseNums.includes(tema);
                detail = `${bet.value} vs ÁâπÁ†Å ${tema}`;
            } else if (bet.type === '‰∏§Èù¢') {
                odds = 2;
                if (bet.value === 'Â§ß') isWin = tema >= 25 && tema <= 49;
                else if (bet.value === 'Â∞è') isWin = tema >= 1 && tema <= 24;
                else if (bet.value === 'Âçï') isWin = tema % 2 === 1;
                else if (bet.value === 'Âèå') isWin = tema % 2 === 0;
                detail = `${bet.value} vs ÁâπÁ†Å ${tema}`;
            } else if (bet.type === 'Â∞æÊï∞') {
                // Â∞æÊï∞ÔºöÊ£ÄÊü•ÁâπÁ†ÅÂ∞æÊï∞
                odds = parseFloat(savedOdds['odds-weishu']) || 9.8;
                const temaWei = tema % 10;
                isWin = parseInt(bet.value) === temaWei;
                detail = `${bet.value}Â∞æ vs ÁâπÁ†Å ${tema} (Â∞æÊï∞${temaWei})`;
            } else if (bet.type === 'ËøûÁ†Å') {
                // ËøûÁ†ÅÔºöÊ£ÄÊü•ÊâÄÊúâÂè∑Á†ÅÊòØÂê¶ÈÉΩÂú®ÂºÄÂ•ñÂè∑Á†Å‰∏≠
                odds = parseFloat(savedOdds['odds-lianma']) || 20;
                const nums = String(bet.value).split(',').map(n => parseInt(n));
                isWin = nums.every(n => allNumbers.includes(n));
                detail = `ËøûÁ†Å [${nums.join(',')}] vs ÂºÄÂ•ñ [${allNumbers.join(',')}]`;
            } else {
                // Êú™Áü•Áé©Ê≥ïÔºåÈªòËÆ§‰∏ç‰∏≠Â•ñ
                detail = `Êú™Áü•Áé©Ê≥ï: ${bet.type} ${bet.value || bet.number}`;
            }
            
            if (isWin) {
                winAmount = bet.amount * odds;
            }
            
            return {
                ...bet,
                isWin,
                odds,
                winAmount,
                detail,
                netResult: isWin ? -(winAmount - bet.amount) : bet.amount
            };
        }
        
        async function calculateBets() {
            let input = document.getElementById('bet-input').value.trim();
            if (!input) {
                alert('ËØ∑ÂÖàÁ≤òË¥¥‰∏ãÊ≥®‰ø°ÊÅØ');
                return;
            }
            
            if (!appState.lotteryNumbers || appState.lotteryNumbers.length < 7 || appState.lotteryNumbers[0] === 0) {
                alert('ËØ∑ÂÖàËÆæÁΩÆÂºÄÂ•ñÂè∑Á†ÅÔºÅ');
                return;
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üÜï v2.4.4 „ÄêÈ¢ÑÂ§ÑÁêÜ„ÄëÂéªÈô§Ê†áÁ≠æÂâçÁºÄÔºàÂ¶Ç "ÂçéÈæô:" "123:" "XXX:"Ôºâ
            // ËßÑÂàô1ÔºöÂ¶ÇÊûúÊï¥Ë°åÂè™Êúâ "XXX:" Ê†ºÂºèÔºåÂà†Èô§Ëøô‰∏ÄË°å
            // ËßÑÂàô2ÔºöÂ¶ÇÊûúÊòØ "XXX:ÂÜÖÂÆπ" Ê†ºÂºèÔºåÂéªÊéâÂâçÁºÄ‰øùÁïôÂÜÖÂÆπ
            // ÊîπËøõÔºöÊîØÊåÅÂÜíÂè∑ÂâçÂêéÊúâÁ©∫Ê†º„ÄÅ‰∏≠Ëã±ÊñáÂÜíÂè∑„ÄÅ‰∏ãÂàíÁ∫øÁ≠â
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            console.log('üîß ‚ïê‚ïê‚ïê ÂºÄÂßãÈ¢ÑÂ§ÑÁêÜËæìÂÖ•Ôºàv2.4.4Ôºâ‚ïê‚ïê‚ïê');
            console.log('ÂéüÂßãËæìÂÖ•Ë°åÊï∞:', input.split('\n').length);
            
            input = input.split('\n').map((line, idx) => {
                const trimmed = line.trim();
                
                // Á©∫Ë°å‰øùÁïôÔºàÁî®‰∫éÂàÜÁªÑÔºâ
                if (!trimmed) {
                    return line;
                }
                
                // ËßÑÂàô1ÔºöÊï¥Ë°åÂè™Êúâ "XXX:" Ê†ºÂºèÔºàÁ∫ØÊ†áÁ≠æË°åÔºâÔºåÊ†áËÆ∞‰∏∫Âà†Èô§
                // ÊîØÊåÅ: ÂçéÈæô:„ÄÅÂçéÈæôÔºö„ÄÅÂçéÈæô :„ÄÅ123:„ÄÅABC: Á≠â
                // Ê≠£Âàô: ÂºÄÂ§¥ + (‰∏≠Êñá/Â≠óÊØç/Êï∞Â≠ó/‰∏ãÂàíÁ∫ø)+ + ÂèØÈÄâÁ©∫Ê†º + ÂÜíÂè∑ + ÂèØÈÄâÁ©∫Ê†º + ÁªìÂ∞æ
                if (/^[\u4e00-\u9fa5a-zA-Z0-9_]+\s*[:Ôºö]\s*$/.test(trimmed)) {
                    console.log(`üè∑Ô∏è [Ë°å${idx+1}] Âà†Èô§Á∫ØÊ†áÁ≠æË°å: "${trimmed}"`);
                    return '__DELETE_LINE__';  // Ê†áËÆ∞‰∏∫ÈúÄË¶ÅÂà†Èô§
                }
                
                // ËßÑÂàô2ÔºöÂ¶ÇÊûúÊòØ "XXX:ÂÜÖÂÆπ" Ê†ºÂºèÔºåÂéªÊéâÂâçÁºÄ‰øùÁïôÂÜÖÂÆπ
                // ÊîØÊåÅ: ÂçéÈæô:‰π∞Áå™ÂêÑ10„ÄÅÂçéÈæôÔºö‰π∞Áå™ÂêÑ10„ÄÅÂçéÈæô : ‰π∞Áå™ÂêÑ10 Á≠â
                const prefixMatch = trimmed.match(/^([\u4e00-\u9fa5a-zA-Z0-9_]+\s*[:Ôºö]\s*)(.+)$/);
                if (prefixMatch && prefixMatch[2]) {
                    const prefix = prefixMatch[1].trim();
                    const content = prefixMatch[2].trim();
                    console.log(`üè∑Ô∏è [Ë°å${idx+1}] ÂéªÈô§ÂâçÁºÄ: "${prefix}" ‚Üí ‰øùÁïô: "${content}"`);
                    return content;
                }
                
                return line;  // ‰øùÊåÅÂéüÊ†∑
            }).filter(line => line !== '__DELETE_LINE__').join('\n');
            
            // Ê∏ÖÁêÜËøûÁª≠Á©∫Ë°åÔºà‰øùÁïôÂçï‰∏™Á©∫Ë°åÁî®‰∫éÂàÜÁªÑÔºâ
            input = input.replace(/\n{3,}/g, '\n\n');
            
            console.log('üîß È¢ÑÂ§ÑÁêÜÂêéË°åÊï∞:', input.split('\n').length);
            console.log('üîß ‚ïê‚ïê‚ïê È¢ÑÂ§ÑÁêÜÂÆåÊàê ‚ïê‚ïê‚ïê');
            
            // üÜï Êõ¥Êñ∞ËæìÂÖ•Ê°ÜÂÜÖÂÆπÔºàËÆ©Áî®Êà∑ÁúãÂà∞Â§ÑÁêÜÂêéÁöÑÁªìÊûúÔºâ
            const originalInputValue = document.getElementById('bet-input').value;
            if (input !== originalInputValue.trim()) {
                document.getElementById('bet-input').value = input;
                console.log('üîß È¢ÑÂ§ÑÁêÜÂêéÁöÑËæìÂÖ•ÔºàÂ∑≤Êõ¥Êñ∞ËæìÂÖ•Ê°ÜÔºâ:\n', input);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üÜï v3.11.24 „ÄêÂΩ©ÁßçÊ£ÄÊµã„ÄëÊ£ÄÊü•ÊòØÂê¶ÂåÖÂê´‰∏çÊîØÊåÅÁöÑ"ÊóßÊæ≥"
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const lotteryTypes = analyzeLotteryTypes(input);
            console.log('üéØ [ÂΩ©ÁßçÊ£ÄÊµã]', lotteryTypes);
            
            if (lotteryTypes.hasOldAM) {
                alert(`‚ö†Ô∏è ÊöÇ‰∏çÊîØÊåÅ"${lotteryTypes.oldAmKeyword}"ËÆ°ÁÆó\nÁõÆÂâçÂè™ÊîØÊåÅÔºöÊñ∞Êæ≥Èó®„ÄÅÈ¶ôÊ∏Ø`);
                return;
            }
            
            // üÜï v3.11.24 ËÆ∞ÂΩïÊòØÂê¶ÈúÄË¶ÅÊòæÁ§∫ÂèåÂºÄÂ•ñÁªìÊûú
            window.showBothLotteryResults = lotteryTypes.hasHK;
            console.log('üéØ [ÂèåÂºÄÂ•ñÊòæÁ§∫]', window.showBothLotteryResults ? 'ÊòØÔºàÂåÖÂê´È¶ôÊ∏Ø‰∏ãÊ≥®Ôºâ' : 'Âê¶');
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üÜï „ÄêÂ≠§ÂÑøË°åÊ£ÄÊµã„ÄëÂú®Ê≠£ÂºèËß£ÊûêÂâçÊ£ÄÊµãÂèØËÉΩÁöÑÊñ≠Ë°å
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const orphans = detectOrphanLines(input);
            if (orphans.length > 0) {
                console.log('üîç Ê£ÄÊµãÂà∞Â≠§ÂÑøË°å:', orphans);
                // ÊòæÁ§∫Á°ÆËÆ§ÂºπÁ™óÔºåÁ≠âÂæÖÁî®Êà∑Â§ÑÁêÜ
                input = await showOrphanConfirmDialog(orphans, input);
                // Êõ¥Êñ∞ËæìÂÖ•Ê°ÜÂÜÖÂÆπÔºàÂèØËÉΩÂ∑≤Ë¢´‰øÆÊîπÔºâ
            }
            
            const settings = getFormatSettings();
            const lines = input.split('\n').filter(line => line.trim());
            
            // ÂàùÂßãÂåñ
            parsedBets = [];
            parsedGroups = [];  // üÜï ÈáçÁΩÆÂàÜÁªÑ
            
            // ÈáçÁΩÆË∞ÉËØï‰ø°ÊÅØ
            debugInfo.aiInput = input;
            debugInfo.aiOutput = '';
            debugInfo.aiParsed = null;
            debugInfo.aiBets = [];
            debugInfo.lastError = '';
            
            // üÜï v3.0 „ÄêÊñ∞Êû∂ÊûÑ„ÄëËÆ°ÁÆóÈÄªËæëÂú®ÂêéÁ´ØÔºåÂâçÁ´ØÂè™ÂÅöÂ±ïÁ§∫
            // API Key Â∑≤ÁßªËá≥ÂêéÁ´ØÔºåÂè™ÈúÄÊ£ÄÊü• aiEnabled
            if (settings.aiEnabled) {
                // „ÄêAIË∞ÉËØïÊòæÁ§∫„ÄëÂºÄÂßã
                showAutoCloseToast('ü§ñ ÂêéÁ´ØÊ≠£Âú®ËØÜÂà´Âπ∂ËÆ°ÁÆó...', 8000);
                // „ÄêAIË∞ÉËØïÊòæÁ§∫„ÄëÁªìÊùü
                
                try {
                    // üÜï v3.11.4 ÁîüËÇñ‰ª£Âè∑ËΩ¨Êç¢ÔºàÂêéÁ´ØÊ≠£ÂàôÂåπÈÖçÈúÄË¶Å Z1-Z12 Ê†ºÂºèÔºâ
                    const sanitizedInput = sanitizeText(input);
                    debugInfo.sanitizedInput = sanitizedInput;
                    console.log('üîÑ ‰ª£Âè∑ËΩ¨Êç¢Âêé:', sanitizedInput);
                    
                    // üÜï v3.0 Ë∞ÉÁî®ÂêéÁ´Ø‰∏ÄÁ´ôÂºèËÆ°ÁÆóÊé•Âè£
                    const config = getOddsConfig();
                    
                    // üÜï v3.11.30 Ëé∑ÂèñÈ¶ôÊ∏ØÂºÄÂ•ñÊï∞ÊçÆÔºàÁî®‰∫éÈ¶ôÊ∏ØÁ±ªÂûãÁöÑËÆ°ÁÆóÔºâ
                    const hkData = appState.lotteryData['hk'];
                    const hkNums = hkData?.numbers || null;
                    
                    const backendResult = await callBackendCalc(
                        sanitizedInput,
                        appState.lotteryNumbers,  // Êæ≥Èó®ÂºÄÂ•ñÊï∞ÊçÆ
                        config,
                        settings.aiProvider || 'openrouter',
                        null,
                        hkNums  // È¶ôÊ∏ØÂºÄÂ•ñÊï∞ÊçÆ
                    );
                    
                    // üÜï v3.11.29 Ê£ÄÊµãÊóßÊæ≥Èó®ÈîôËØØ
                    if (!backendResult.success && backendResult.error === 'old_mc_not_supported') {
                        alert('‚ö†Ô∏è ÊöÇ‰∏çÊîØÊåÅÊóßÊæ≥Èó®\nËØ∑‰ΩøÁî®Êñ∞Êæ≥ÊàñÈ¶ôÊ∏Ø');
                        return;
                    }
                    
                    if (backendResult.success && backendResult.items && backendResult.items.length > 0) {
                        // üÜï v3.0 ËΩ¨Êç¢ÂêéÁ´ØÁªìÊûú‰∏∫ÂâçÁ´ØÊ†ºÂºè
                        // üÜï v3.11.13 ÂÆåÂñÑÁ±ªÂûãÊò†Â∞ÑÔºàÊ∑ªÂä†ÂÖ≠ËÇñ„ÄÅÁâπËÇñÁ≠âÔºâ
                        const TYPE_NAME_MAP = {
                            'T01': 'ÁâπÁ†Å', 'SXTM': 'ÁîüËÇñÁâπÁ†Å', 'SX': 'ÁîüËÇñ',
                            'BS': 'Ê≥¢Ëâ≤', 'BB': 'ÂçäÊ≥¢', 'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ',
                            'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ', 'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ',
                            'PTW': 'Âπ≥ÁâπÂ∞æÊï∞', 'DP': 'ÂçïÂπ≥',
                            'XS': 'Â∞èÊï∞', 'DS': 'Â§ßÊï∞', 'ODD': 'ÂçïÊï∞', 'EVEN': 'ÂèåÊï∞', 'DXDS': 'Â§ßÂ∞èÂçïÂèå',
                            // üÜï v3.11.13 ÂÖ≠ËÇñÁöÑÊâÄÊúâÂèØËÉΩ‰ª£Á†Å
                            'SX6': 'ÂÖ≠ËÇñ', 'LX6': 'ÂÖ≠ËÇñ', 'LX': 'ÂÖ≠ËÇñ', '6X': 'ÂÖ≠ËÇñ', 'LIUXIAO': 'ÂÖ≠ËÇñ',
                            'TX': 'ÁâπËÇñ', 'HX': 'ÂêàËÇñ', 'ZX': 'Ê≠£ËÇñ',
                            'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â', 'BZ': '‰∏ç‰∏≠',
                            'WX': '‰∫îË°å', 'JY': 'ÂÆ∂Èáé', 'ZH': 'ÊÄªÂíå',
                            'UK': 'Êú™Áü•'
                        };
                        
                        // üÜï v3.1 ‰ªéÂéüÂßãËæìÂÖ•‰∏≠Ëß£ÊûêÂàÜÁªÑ‰ø°ÊÅØÔºàÁ©∫Ë°åÂàÜÈöîÔºâ
                        const rawInput = document.getElementById('bet-input')?.value || '';
                        const inputGroups = [];  // ÊØèÁªÑÁöÑÂéüÊñáË°åÂàóË°®
                        let currentGroup = [];
                        rawInput.split('\n').forEach(line => {
                            if (line.trim() === '') {
                                // Á©∫Ë°åÔºö‰øùÂ≠òÂΩìÂâçÁªÑÔºåÂºÄÂßãÊñ∞ÁªÑ
                                if (currentGroup.length > 0) {
                                    inputGroups.push(currentGroup);
                                    currentGroup = [];
                                }
                            } else {
                                currentGroup.push(line.trim());
                            }
                        });
                        if (currentGroup.length > 0) {
                            inputGroups.push(currentGroup);
                        }
                        
                        console.log('üì¶ ËæìÂÖ•ÂàÜÁªÑ:', inputGroups);
                        
                        // üÜï v3.8.3 ‰∏∫ÊØè‰∏™ÁâáÊÆµÂàÜÈÖçÂÖ®Â±ÄÈ°∫Â∫èÂè∑ÔºàÁî®‰∫éÊ≠£Á°ÆÊéíÂ∫èÔºâ
                        let globalFragmentOrder = 0;
                        const fragmentOrderMap = {};  // normalizedKey ‚Üí { order, originalLine, sanitizedLine }
                        
                        // ÊèêÂèñÊï∞Â≠óÂ∫èÂàó‰Ωú‰∏∫ÂåπÈÖçÈîÆÔºàÂøΩÁï•ÂàÜÈöîÁ¨¶Â∑ÆÂºÇÔºâ
                        const extractNumbers = (str) => (str.match(/\d+/g) || []).join('-');
                        
                        // üÜï v3.1 ÊûÑÂª∫Ë°å‚ÜíÂàÜÁªÑÊò†Â∞Ñ
                        const lineToGroupMap = {};  // ‰ª£Âè∑ËΩ¨Êç¢ÂêéÁöÑË°å ‚Üí {groupId, lineIndex}
                        inputGroups.forEach((group, gIdx) => {
                            group.forEach((line, lIdx) => {
                                // ÂØπÂéüÂßãË°åËøõË°å‰ª£Âè∑ËΩ¨Êç¢ÔºåÁî®‰∫éÂåπÈÖçÂêéÁ´ØËøîÂõûÁöÑ raw
                                const sanitizedLine = sanitizeText(line);
                                
                                // üÜï v3.8.3 Áî®Â§öÁßçÂàÜÈöîÁ¨¶ÊãÜÂàÜË°å‰∏∫ÁâáÊÆµ
                                const fragments = sanitizedLine.split(/\s{2,}|\t/).filter(f => f.trim());
                                
                                fragments.forEach((frag, fIdx) => {
                                    const numKey = extractNumbers(frag);
                                    if (numKey && !fragmentOrderMap[numKey]) {
                                        fragmentOrderMap[numKey] = {
                                            order: globalFragmentOrder++,
                                            originalLine: line,
                                            sanitizedLine: sanitizedLine,
                                            fragment: frag,
                                            groupId: gIdx + 1,
                                            lineIndex: lIdx
                                        };
                                    }
                                });
                                
                                // ‰πüÂ≠òÊï¥Ë°åÁöÑÊï∞Â≠óÈîÆ
                                const lineNumKey = extractNumbers(sanitizedLine);
                                if (lineNumKey && !fragmentOrderMap[lineNumKey]) {
                                    fragmentOrderMap[lineNumKey] = {
                                        order: globalFragmentOrder++,
                                        originalLine: line,
                                        sanitizedLine: sanitizedLine,
                                        fragment: sanitizedLine,
                                        groupId: gIdx + 1,
                                        lineIndex: lIdx
                                    };
                                }
                                
                                lineToGroupMap[sanitizedLine] = {
                                    groupId: gIdx + 1,
                                    lineIndex: lIdx,
                                    originalLine: line
                                };
                            });
                        });
                        
                        console.log('üìã Ë°å‚ÜíÂàÜÁªÑÊò†Â∞Ñ:', lineToGroupMap);
                        console.log('üî¢ ÁâáÊÆµÈ°∫Â∫èÊò†Â∞Ñ:', fragmentOrderMap);
                        
                        parsedBets = backendResult.items.map((item, idx) => {
                            // üÜï v3.1 Ê†πÊçÆ item.raw ÊâæÂà∞ÂØπÂ∫îÁöÑÂàÜÁªÑ
                            const itemRaw = item.raw || '';
                            let groupInfo = lineToGroupMap[itemRaw];
                            
                            // Â¶ÇÊûúÁ≤æÁ°ÆÂåπÈÖçÂ§±Ë¥•ÔºåÂ∞ùËØïÊ®°Á≥äÂåπÈÖç
                            if (!groupInfo) {
                                for (const [key, info] of Object.entries(lineToGroupMap)) {
                                    if (itemRaw.includes(key) || key.includes(itemRaw)) {
                                        groupInfo = info;
                                        break;
                                    }
                                }
                            }
                            
                            // üÜï v3.11.13 Â¶ÇÊûúËøòÊòØÊâæ‰∏çÂà∞ÔºåÂ∞ùËØïÂü∫‰∫éÁ±ªÂûãÂÖ≥ÈîÆËØç+ÁîüËÇñ‰ª£Âè∑ÁöÑÊô∫ËÉΩÂåπÈÖç
                            // Ëß£ÂÜ≥ÔºöÂêéÁ´ØÊää "Âπ≥ÁâπZ9Z10ÂêÑ200" ÊãÜÂàÜÊàê "Âπ≥ÁâπZ9ÂêÑ200" Âíå "Âπ≥ÁâπZ10ÂêÑ200"ÔºåÂØºËá¥ÂåπÈÖçÂ§±Ë¥•
                            if (!groupInfo) {
                                const typeKeywords = ['Âπ≥Áâπ', 'ÂÖ≠ËÇñ', '‰∫åÂèã', '‰∏âÂèã', '‰∏ÄÂèã', 'ÁâπËÇñ', 'Ê≠£ËÇñ', 'ÂêàËÇñ', 'Ê≥¢', '‰∏ç‰∏≠'];
                                const itemZodiacs = itemRaw.match(/Z\d{1,2}/g) || [];
                                const itemTypeKw = typeKeywords.find(kw => itemRaw.includes(kw)) || '';
                                
                                for (const [key, info] of Object.entries(lineToGroupMap)) {
                                    // Ê£ÄÊü•ÔºöÂÆåÊï¥Ë°åÂåÖÂê´ raw ‰∏≠ÁöÑÁ±ªÂûãÂÖ≥ÈîÆËØç AND Ëá≥Â∞ë‰∏Ä‰∏™ÁîüËÇñ‰ª£Âè∑
                                    const hasTypeMatch = itemTypeKw && key.includes(itemTypeKw);
                                    const hasZodiacMatch = itemZodiacs.length > 0 && itemZodiacs.some(z => key.includes(z));
                                    if (hasTypeMatch && hasZodiacMatch) {
                                        groupInfo = info;
                                        break;
                                    }
                                }
                            }
                            
                            // ÈªòËÆ§ÂàÜÁªÑ
                            if (!groupInfo) {
                                groupInfo = { groupId: 1, lineIndex: 0, originalLine: itemRaw };
                            }
                            
                            // üÜï v3.8.3 Ê†πÊçÆÊï∞Â≠óÈîÆÊü•ÊâæÁâáÊÆµÈ°∫Â∫è
                            const itemNumKey = extractNumbers(itemRaw);
                            let fragmentInfo = fragmentOrderMap[itemNumKey];
                            
                            // üÜï v3.11.16 Â¶ÇÊûúÁ≤æÁ°ÆÂåπÈÖçÂ§±Ë¥•Ôºå‰ΩøÁî®ÊúÄÈïøÂåπÈÖç‰ºòÂÖàÁ≠ñÁï•
                            // Ëß£ÂÜ≥ÔºöÊ®°Á≥äÂåπÈÖçÂèØËÉΩÈîôËØØÂú∞ÂåπÈÖçÂà∞Áü≠ÁöÑ numKeyÔºàÂ¶Ç "20" ÂåπÈÖçÂà∞ "Â∞èÊï∞ÂêÑÊï∞20"Ôºâ
                            if (!fragmentInfo) {
                                let bestMatch = null;
                                let bestMatchLength = 0;
                                
                                for (const [numKey, info] of Object.entries(fragmentOrderMap)) {
                                    // Ê£ÄÊü•ÊòØÂê¶ÂåÖÂê´ÂÖ≥Á≥ª
                                    const isMatch = itemNumKey.includes(numKey) || numKey.includes(itemNumKey);
                                    if (isMatch) {
                                        // ‰ºòÂÖàÈÄâÊã©ÂåπÈÖçÈïøÂ∫¶ÊúÄÈïøÁöÑÔºàÊõ¥Á≤æÁ°ÆÔºâ
                                        const matchLength = Math.min(numKey.length, itemNumKey.length);
                                        if (matchLength > bestMatchLength) {
                                            bestMatchLength = matchLength;
                                            bestMatch = info;
                                        }
                                    }
                                }
                                fragmentInfo = bestMatch;
                            }
                            
                            const fragmentOrder = fragmentInfo ? fragmentInfo.order : 9999;
                            
                            // üÜï v3.11.16 ‰ºòÂÖà‰ΩøÁî® fragmentInfo ÁöÑ groupIdÔºàÂü∫‰∫éÊï∞Â≠óÂ∫èÂàóÁ≤æÁ°ÆÂåπÈÖçÔºâ
                            // fragmentInfo ÊòØÂü∫‰∫éÊèêÂèñÊï∞Â≠óÂ∫èÂàóÂåπÈÖçÁöÑÔºåÊØî groupInfo ÁöÑÊñáÊú¨Ê®°Á≥äÂåπÈÖçÊõ¥Á≤æÁ°Æ
                            const finalGroupId = fragmentInfo?.groupId || groupInfo.groupId;
                            const finalLineIndex = fragmentInfo?.lineIndex !== undefined ? fragmentInfo.lineIndex : groupInfo.lineIndex;
                            
                            return {
                                type: TYPE_NAME_MAP[item.code] || item.code,
                                number: item.n && item.n.length === 1 ? item.n[0] : null,
                                numbers: item.n || [],
                                amount: item.a || 0,
                                raw: restoreText(item.raw || ''),
                                originalLine: restoreText(fragmentInfo?.originalLine || groupInfo.originalLine || item.raw || ''),
                                zodiac: item.z || null,
                                fromAI: true,
                                groupId: finalGroupId,
                                lineId: `${finalGroupId}-${finalLineIndex}`,
                                globalLineIndex: idx,
                                betIndexInLine: item.idx || 0,
                                // üÜï v3.8.3 ÁâáÊÆµÈ°∫Â∫èÔºàÁî®‰∫éÊéíÂ∫èÔºâ
                                fragmentOrder: fragmentOrder,
                                // üÜï v3.11.29 ÂΩ©ÁßçÊ†áËØÜ
                                lt: item.lt || 'mc',
                                // üÜï v3.0 ÂêéÁ´ØËÆ°ÁÆóÁöÑÁªìÊûú
                                isWin: item.w || false,
                                winAmount: item.v || 0,
                                odds: item.r || 1,
                                detail: `${TYPE_NAME_MAP[item.code] || item.code} ${item.n ? item.n.join(',') : ''} vs ÁâπÁ†Å${appState.lotteryNumbers[6]}`,
                                netResult: item.w ? -(item.v - item.a) : item.a
                            };
                        });
                        
                        // üÜï v3.0 Áõ¥Êé•‰ΩøÁî®ÂêéÁ´ØËÆ°ÁÆóÁöÑÁªìÊûú
                        calcResults = parsedBets;
                        
                        // üÜï v3.0 ‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑÁªüËÆ°Êï∞ÊçÆ
                        const totalBet = backendResult.s1 || 0;      // ÊÄªÊäïÊ≥®
                        const totalWin = backendResult.s2 || 0;      // ‰∏≠Â•ñÊ≥®Êï∞
                        const totalWinAmount = backendResult.s3 || 0; // Ê¥æÂΩ©ÈáëÈ¢ù
                        const settleAmount = backendResult.s4 || 0;   // ÁªìÁÆó
                        
                        // ËÆ∞ÂΩïË∞ÉËØï‰ø°ÊÅØ
                        debugInfo.modelUsed = backendResult.model_used || 'unknown';
                        debugInfo.latencyMs = backendResult.latency_ms || 0;
                        
                        // üÜï v3.1 ‰øùÂ≠òÂêéÁ´ØËøîÂõûÁöÑËØ¶ÁªÜË∞ÉËØï‰ø°ÊÅØÔºàÁî®‰∫éÂèçÈ¶àËøΩË∏™Ôºâ
                        debugInfo.extractItems = backendResult.extract_items || [];  // Ê≠£Âàô/AI ËØÜÂà´ÁöÑÊØèÊù°ËØ¶ÊÉÖ
                        debugInfo.calcInputCount = backendResult.input_count || 0;   // ËØÜÂà´Êù°Êï∞
                        debugInfo.calcOutputCount = backendResult.output_count || 0; // Â±ïÂºÄÂêéÊù°Êï∞
                        debugInfo.calcItems = backendResult.items || [];             // ËÆ°ÁÆóÂêéÁöÑÊØèÊù°ËØ¶ÊÉÖ
                        debugInfo.backendVersion = backendResult.backend_version || '';  // üÜï v3.2.1 ÂêéÁ´ØÁâàÊú¨
                        debugInfo.calcS1 = totalBet;
                        debugInfo.calcS2 = totalWin;
                        debugInfo.calcS3 = totalWinAmount;
                        debugInfo.calcS4 = settleAmount;
                        // üÜï v3.11.22 Â¢ûÂº∫Ë∞ÉËØï‰ø°ÊÅØÔºàÁ≤æÂáÜÂÆö‰ΩçÈóÆÈ¢òÔºâ
                        debugInfo.skipRegexReason = backendResult.skip_regex_reason || '';  // Ë∑≥ËøáÊ≠£ÂàôÁöÑÂéüÂõ†
                        debugInfo.aiItemsCount = backendResult.ai_items_count || 0;        // AIËØÜÂà´ÁöÑÂéüÂßãËÆ∞ÂΩïÊï∞
                        debugInfo.preprocessLog = backendResult.preprocess_log || [];       // È¢ÑÂ§ÑÁêÜÊó•Âøó
                        
                        console.log(`‚úÖ ÂêéÁ´ØËÆ°ÁÆóÂÆåÊàê: ËØÜÂà´${debugInfo.calcInputCount}Êù°‚ÜíÂ±ïÂºÄ${debugInfo.calcOutputCount}Êù°, ÊÄªÊäï${totalBet}, ‰∏≠${totalWin}Ê≥®, Ê¥æÂΩ©${totalWinAmount}, ÁªìÁÆó${settleAmount}`);
                        showAutoCloseToast(`‚úÖ ËÆ°ÁÆóÂÆåÊàê ${calcResults.length} Ê≥®`, 2000);
                        
                        // üÜï v3.0 Áõ¥Êé•Ë∑≥ËΩ¨Âà∞ÊòæÁ§∫ÁªìÊûúÈÉ®ÂàÜ
                        // Ëé∑ÂèñÂºÄÂ•ñ‰ø°ÊÅØ
                        const tema = appState.lotteryNumbers[6];
                        const lotteryStr = appState.lotteryNumbers.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(tema).padStart(2,'0');
                        
                        // üÜï v3.11.29 Ê†πÊçÆÂêéÁ´ØËøîÂõûÁöÑhk/mcÊ±áÊÄªÂà§Êñ≠ÂºÄÂ•ñÊòæÁ§∫
                        // ËßÑÂàôÔºöÂè™Êúâhk‚ÜíÂè™ÊòæÁ§∫È¶ôÊ∏ØÔºõÂè™Êúâmc‚ÜíÂè™ÊòæÁ§∫Êñ∞Êæ≥ÔºõÊ∑∑Âêà‚ÜíÊòæÁ§∫‰∏§‰∏™
                        const hasHK = backendResult.hk_summary && backendResult.hk_summary.s1 > 0;
                        const hasMC = backendResult.mc_summary && backendResult.mc_summary.s1 > 0;
                        const isMixed = hasHK && hasMC;
                        
                        let lotteryResultText = '';
                        const xamData = appState.lotteryData['xam'];
                        const hkData = appState.lotteryData['hk'];
                        const xamNums = xamData?.numbers || appState.lotteryNumbers;
                        const hkNums = hkData?.numbers || [];
                        
                        const xamStr = xamNums.length === 7 
                            ? xamNums.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(xamNums[6]).padStart(2,'0')
                            : 'Êú™ËÆæÁΩÆ';
                        const hkStr = hkNums.length === 7
                            ? hkNums.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(hkNums[6]).padStart(2,'0')
                            : 'Êú™ËÆæÁΩÆ';
                        
                        if (isMixed) {
                            // Ê∑∑Âêà‰∏ãÊ≥®ÔºöÊòæÁ§∫‰∏§‰∏™ÂºÄÂ•ñÁªìÊûú
                            lotteryResultText = `üé∞ Êñ∞Êæ≥ÂºÄÂ•ñ: ${xamStr}\nüé∞ È¶ôÊ∏ØÂºÄÂ•ñ: ${hkStr}\n`;
                        } else if (hasHK) {
                            // Á∫ØÈ¶ôÊ∏ØÔºöÂè™ÊòæÁ§∫È¶ôÊ∏Ø
                            lotteryResultText = `üé∞ È¶ôÊ∏ØÂºÄÂ•ñ: ${hkStr}\n`;
                        } else {
                            // Á∫ØÊæ≥Èó®ÊàñÈªòËÆ§ÔºöÂè™ÊòæÁ§∫Êñ∞Êæ≥
                            lotteryResultText = `üé∞ Êñ∞Êæ≥ÂºÄÂ•ñ: ${xamStr}\n`;
                        }
                        
                        // üÜï v3.11.29 ‰øùÂ≠òÊ∑∑ÂêàÁä∂ÊÄÅ‰æõÂêéÁª≠‰ΩøÁî®
                        window.currentCalcHasHK = hasHK;
                        window.currentCalcHasMC = hasMC;
                        window.currentCalcIsMixed = isMixed;
                        
                        // ÁîüÊàêÁªìÊûúÊñáÊú¨
                        let resultText = `üìä ËÆ°ÁÆóÁªìÊûú\n`;
                        resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                        resultText += lotteryResultText;
                        resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                        resultText += `üìã ËØÜÂà´ ${calcResults.length} Ê≥® | ÊÄªÊäï ${totalBet}ÂÖÉ\n`;
                        resultText += `‰∏≠${totalWin}Ê≥® | Ê¥æÂΩ© ${totalWinAmount}ÂÖÉ\n`;
                        resultText += `üí∞ ÁªìÁÆó: ${settleAmount >= 0 ? '+' : ''}${settleAmount}ÂÖÉ\n`;
                        resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                        
                        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                        // üÜï v3.11.10 ÂÖ®Êñ∞ÂàÜÁªÑÈÄªËæëÔºöÊåâÁî®Êà∑ËæìÂÖ•È°∫Â∫è + Áõ∏ÈÇªÂêåÁ±ªÂûãÂêåÈáëÈ¢ùÂêàÂπ∂
                        // Ê†∏ÂøÉËßÑÂàôÔºö
                        // 1. Êåâ fragmentOrder È°∫Â∫èÈÅçÂéÜÊØèÊù°ËÆ∞ÂΩï
                        // 2. Áõ∏ÈÇª + ÂêåÁ±ªÂûã + ÂêåÈáëÈ¢ù ‚Üí ÂêàÂπ∂
                        // 3. Âê¶Âàô ‚Üí Êñ∞Âª∫‰∏ÄÁªÑ
                        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                        
                        // Á¨¨1Ê≠•ÔºöÊåâ fragmentOrder ÊéíÂ∫èÊâÄÊúâÁªìÊûú
                        const sortedResults = [...calcResults].sort((a, b) => {
                            const orderA = a.fragmentOrder !== undefined ? a.fragmentOrder : 9999;
                            const orderB = b.fragmentOrder !== undefined ? b.fragmentOrder : 9999;
                            return orderA - orderB;
                        });
                        
                        // üÜï v3.11.11 Êåâ originalLine + type + amount È¢ÑÂàÜÁªÑ
                        // Á°Æ‰øùÂêå‰∏ÄÁî®Êà∑ËæìÂÖ•ÁöÑÂêåÁ±ªÂûãÂêåÈáëÈ¢ùËÉΩÂêàÂπ∂ÔºàÂ¶Ç"Âπ≥ÁâπÁå¥È∏°ÂêÑ200"Ôºâ
                        const calcPreGroupMap = {};
                        
                        sortedResults.forEach((r) => {
                            const originalLine = r.originalLine || '';
                            const itemType = r.type || 'Êú™Áü•';
                            const itemAmount = r.amount || 0;
                            const itemGroupId = r.groupId || 1;  // üÜï v3.11.15 Ëé∑ÂèñÁî®Êà∑ËæìÂÖ•Ë°åÁöÑÁªÑID
                            const groupKey = `${originalLine}|||${itemType}|||${itemAmount}`;
                            
                            if (!calcPreGroupMap[groupKey]) {
                                calcPreGroupMap[groupKey] = {
                                    originalLine: originalLine,
                                    type: itemType,
                                    amount: itemAmount,
                                    items: [],
                                    odds: r.odds || 1,
                                    minOrder: r.fragmentOrder !== undefined ? r.fragmentOrder : 9999,
                                    groupId: itemGroupId  // üÜï v3.11.15 ‰øùÂ≠òÁªÑIDÁî®‰∫éÂàÜÂâ≤Á∫ø
                                };
                            }
                            calcPreGroupMap[groupKey].items.push(r);
                            const order = r.fragmentOrder !== undefined ? r.fragmentOrder : 9999;
                            if (order < calcPreGroupMap[groupKey].minOrder) {
                                calcPreGroupMap[groupKey].minOrder = order;
                            }
                        });
                        
                        // Êåâ minOrder ÊéíÂ∫è
                        const sortedGroups = Object.values(calcPreGroupMap).sort((a, b) => a.minOrder - b.minOrder);
                        
                        // üÜï v3.11.13 ËΩ¨Êç¢Ê†ºÂºèÔºö‰ºòÂÖà‰ªéÁî®Êà∑ËæìÂÖ•Ë°åÊèêÂèñÂéüÂßãÁâáÊÆµ
                        const userInputText = document.getElementById('bet-input')?.value || '';
                        const userInputFragments = userInputText.split(/[,Ôºå\n]+/).map(s => s.trim()).filter(Boolean);
                        
                        sortedGroups.forEach((pg) => {
                            const displayTexts = [];
                            pg.items.forEach(r => {
                                const rawText = r.raw || '';
                                if (rawText && !displayTexts.includes(rawText)) {
                                    displayTexts.push(rawText);
                                }
                            });
                            pg.displayTexts = displayTexts;
                            
                            // üÜï v3.11.13 Â¶ÇÊûúÊúâÂ§ö‰∏™ raw ÊñáÊú¨ÔºåÂ∞ùËØï‰ªéÁî®Êà∑ËæìÂÖ•‰∏≠ÊèêÂèñÂéüÂßãÁâáÊÆµ
                            // Ëß£ÂÜ≥ÔºöÂêéÁ´ØÊää "Âπ≥ÁâπÁå¥È∏°ÂêÑ200" ÊãÜÂàÜÊàê "Âπ≥ÁâπÁå¥ÂêÑ200" Âíå "Âπ≥ÁâπÈ∏°ÂêÑ200"
                            let bestDisplayText = displayTexts.join(' ');
                            if (displayTexts.length > 1) {
                                // Á±ªÂûãÂÖ≥ÈîÆËØçÊò†Â∞Ñ
                                const typeKeywords = {
                                    'Âπ≥Áâπ‰∏ÄËÇñ': ['Âπ≥Áâπ'], 'PT1': ['Âπ≥Áâπ'],
                                    'Âπ≥Áâπ‰∫åËøûËÇñ': ['‰∫åÂèã'], 'PT2': ['‰∫åÂèã'],
                                    'Âπ≥Áâπ‰∏âËøûËÇñ': ['‰∏âÂèã'], 'PT3': ['‰∏âÂèã'],
                                    'ÂÖ≠ËÇñ': ['ÂÖ≠ËÇñ', '6ËÇñ'], 'SX6': ['ÂÖ≠ËÇñ', '6ËÇñ'],
                                    'ÁâπÁ†Å': ['Áâπ'], 'T01': ['Áâπ'],
                                };
                                const keywords = typeKeywords[pg.type] || [];
                                
                                // Âú®Áî®Êà∑ËæìÂÖ•ÁâáÊÆµ‰∏≠Êü•ÊâæÂåπÈÖçÁöÑÂéüÂßãÊñáÊú¨
                                for (const fragment of userInputFragments) {
                                    const hasKeyword = keywords.some(kw => fragment.includes(kw));
                                    // Ê£ÄÊü•ÁâáÊÆµ‰∏≠ÊòØÂê¶ÂåÖÂê´ÊâÄÊúâ items ÁöÑÁîüËÇñ
                                    const itemZodiacs = pg.items.map(it => it.zodiac).filter(Boolean);
                                    const allZodiacsInFragment = itemZodiacs.every(z => {
                                        const zodiacName = CODE_TO_ZODIAC[z] || z;
                                        return fragment.includes(zodiacName);
                                    });
                                    
                                    if (hasKeyword && (itemZodiacs.length === 0 || allZodiacsInFragment)) {
                                        bestDisplayText = fragment;
                                        break;
                                    }
                                }
                            }
                            
                            pg.originalLine = bestDisplayText;
                            pg.perAmount = pg.amount;
                            pg.fragmentOrder = pg.minOrder;
                        });
                        
                        // Ë∞ÉËØïÊó•Âøó
                        console.log('üìä v3.11.11 ÂàÜÁªÑÁªìÊûú:');
                        sortedGroups.forEach((g, i) => {
                            console.log(`  [${i}] type=${g.type} | amt=${g.perAmount} | items=${g.items.length} | "${g.originalLine?.substring(0,30)}..."`);
                        });
                        
                        // üÜï v3.11.9 Â§çÂêàÁ±ªÂûãÂÆö‰πâÔºàËøô‰∫õÁ±ªÂûãËôΩÁÑ∂Â±ïÂºÄÂ§öÊù°Ôºå‰ΩÜÂÆûÈôÖÊòØ1Ê≥®Ôºâ
                        const COMPOSITE_TYPES = [
                            'ÂÖ≠ËÇñ', 'LX', 'LX6', 'SX6',           // ÂÖ≠ËÇñ
                            'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT2',                   // Âπ≥Áâπ‰∫åËøûËÇñ
                            'Âπ≥Áâπ‰∏âËøûËÇñ', 'PT3',                   // Âπ≥Áâπ‰∏âËøûËÇñ
                            'Âπ≥ÁâπÂõõËøûËÇñ', 'PT4',                   // Âπ≥ÁâπÂõõËøûËÇñ
                            'Âπ≥Áâπ‰∫îËøûËÇñ', 'PT5',                   // Âπ≥Áâπ‰∫îËøûËÇñ
                            'ÂêàËÇñ', 'HX',                          // ÂêàËÇñ
                            '‰∫å‰∏≠‰∫å', 'E2',                        // ‰∫å‰∏≠‰∫å
                            '‰∏â‰∏≠‰∏â', 'S3'                         // ‰∏â‰∏≠‰∏â
                        ];
                        
                        // üÜï v3.11.15 ËÆ∞ÂΩï‰∏ä‰∏Ä‰∏™ groupIdÔºåÁî®‰∫éÂú®‰∏çÂêåÁªÑ‰πãÈó¥Ê∑ªÂä†ÂàÜÂâ≤Á∫ø
                        let lastGroupId = null;
                        
                        for (const group of sortedGroups) {
                            const items = group.items;
                            const rawType = group.type;
                            const originalLine = group.originalLine;
                            const currentGroupId = group.groupId || items[0]?.groupId || 1;
                            
                            // üÜï v3.11.15 Âú®‰∏çÂêåÁªÑ‰πãÈó¥Ê∑ªÂä†ÂàÜÂâ≤Á∫øÔºàÂêåÁªÑÂÜÖ‰∏çÂä†Ôºâ
                            if (lastGroupId !== null && currentGroupId !== lastGroupId) {
                                resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                            }
                            lastGroupId = currentGroupId;
                            
                            // üÜï v3.11.14 Á±ªÂûã‰ª£Á†Å‚Üí‰∏≠ÊñáÂêçÁß∞ËΩ¨Êç¢ + Êô∫ËÉΩËØÜÂà´
                            const CALC_TYPE_CODE_TO_NAME = {
                                'T01': 'ÁâπÁ†Å', 'SXTM': 'ÁâπÁ†Å', 'ÁâπÁ†Å': 'ÁâπÁ†Å',
                                'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                                'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ', 'PTW': 'Âπ≥ÁâπÂ∞æÊï∞',
                                'SX6': 'ÂÖ≠ËÇñ', 'LX6': 'ÂÖ≠ËÇñ', 'LX': 'ÂÖ≠ËÇñ', '6X': 'ÂÖ≠ËÇñ', 'LIUXIAO': 'ÂÖ≠ËÇñ',
                                'TX': 'ÁâπËÇñ', 'HX': 'ÂêàËÇñ', 'ZX': 'Ê≠£ËÇñ', 'SX': 'ÁîüËÇñ',
                                'BS': 'Ê≥¢Ëâ≤', 'BB': 'ÂçäÊ≥¢', 'DP': 'ÂçïÂπ≥', 'DXDS': 'Â§ßÂ∞èÂçïÂèå',
                                'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â', 'BZ': '‰∏ç‰∏≠',
                                'WX': '‰∫îË°å', 'JY': 'ÂÆ∂Èáé', 'ZH': 'ÊÄªÂíå',
                                'UK': 'Êú™Áü•', 'Êú™Áü•': 'Êú™Áü•'
                            };
                            let type = CALC_TYPE_CODE_TO_NAME[rawType] || rawType;
                            
                            // üÜï v3.11.14 Êô∫ËÉΩËØÜÂà´ÔºöÂ¶ÇÊûúÊòæÁ§∫ÊñáÊú¨ÂåÖÂê´"ÂÖ≠ËÇñ"ÂÖ≥ÈîÆËØçÔºåÂº∫Âà∂ËÆæ‰∏∫ÂÖ≠ËÇñÁ±ªÂûã
                            if ((originalLine.includes('ÂÖ≠ËÇñ') || originalLine.includes('6ËÇñ')) && (type === 'Êú™Áü•' || type === rawType)) {
                                type = 'ÂÖ≠ËÇñ';
                            }
                            
                            // üÜï v3.11.10 Â§çÂêàÁ±ªÂûãÊ≥®Êï∞Âõ∫ÂÆö‰∏∫1Ê≥®
                            const isCompositeType = COMPOSITE_TYPES.includes(type) || COMPOSITE_TYPES.includes(rawType);
                            // üÜï v3.11.10 ‰ΩøÁî®ÂàÜÁªÑÊó∂Â∑≤ËÆ°ÁÆóÂ•ΩÁöÑ perAmount
                            const perAmount = group.perAmount || items[0]?.amount || 0;
                            
                            // üÜï v3.11.12 Ê£ÄÊµã"ÂêÑ"/"ÊØè"ÂÖ≥ÈîÆËØçÔºåËÆ°ÁÆóÁîüËÇñÊï∞Èáè‰Ωú‰∏∫Ê≥®Êï∞
                            // ËßÑÂàôÔºöÂπ≥Áâπ‰∏ÄËÇñÔºàPT1Ôºâ‰∏≠Ôºå"Âπ≥ÁâπÁå¥È∏°ÂêÑ200" = 2Ê≥®ÔºàÊØè‰∏™ÁîüËÇñ=1Ê≥®Ôºâ
                            const hasEachKeyword = /ÂêÑ|ÊØè/.test(originalLine);
                            const zodiacCount = hasEachKeyword ? countZodiacsInText(originalLine) : 0;
                            
                            // üÜï v3.11.12 Ê≥®Êï∞ËÆ°ÁÆóÔºöÂ§çÂêàÁ±ªÂûã=1Ê≥®ÔºõÊúâ"ÂêÑ"ÂÖ≥ÈîÆËØçÊó∂Áî®ÁîüËÇñÊï∞ÔºõÂê¶ÂàôÁî®itemsÊï∞
                            let betCount;
                            if (isCompositeType) {
                                betCount = 1;
                            } else if (hasEachKeyword && zodiacCount > 0) {
                                betCount = Math.max(items.length, zodiacCount);
                            } else {
                                betCount = items.length;
                            }
                            // üÜï v3.11.12 ÊÄªÈáëÈ¢ùÔºöÂ§çÂêàÁ±ªÂûã=ÂçïÊ≥®ÈáëÈ¢ùÔºõÂÖ∂‰ªñ=Ê≥®Êï∞√óÂçïÊ≥®ÈáëÈ¢ù
                            const typeTotal = isCompositeType ? perAmount : (betCount * perAmount);
                            
                            // üÜï v3.11.14 ‰øÆÂ§çÂ§çÂêàÁ±ªÂûã‰∏≠Â•ñÂà§Êñ≠ÔºöPT2/PT3Á≠âËøûËÇñÁ±ªÂûãÂøÖÈ°ªÊâÄÊúâÁîüËÇñÈÉΩ‰∏≠ÊâçÁÆó‰∏≠Â•ñ
                            // Âõ†‰∏∫ÂêéÁ´ØAIÂèØËÉΩÈîôËØØÂú∞Â∞Ü"‰∫åÂèãÁå™Áãó200"ÊãÜÊàê‰∏§Êù°PT2ÔºàÁå™‰∏ÄÊù°„ÄÅÁãó‰∏ÄÊù°ÔºâÔºå
                            // Â¶ÇÊûúÂè™ÊúâÁå™‰∏≠Â•ñÔºàÂá∫Áé∞Âú®ÂºÄÂ•ñÂè∑Á†Å‰∏≠ÔºâËÄåÁãóÊ≤°‰∏≠ÔºåÂ∫îËØ•Êï¥‰Ωì‰∏ç‰∏≠Â•ñ
                            const isLianXiaoType = ['PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(type) || 
                                                   ['PT2', 'PT3', 'PT4', 'PT5'].includes(rawType);
                            const hasWin = isLianXiaoType ? items.every(r => r.isWin) : items.some(r => r.isWin);
                            // üÜï v3.11.14 Ê†πÊçÆÁ±ªÂûãËé∑ÂèñÊ≠£Á°ÆÁöÑËµîÁéá
                            const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
                            let typeOdds = items[0]?.odds || 1;
                            if (type === 'ÁâπÁ†Å' || rawType === 'T01' || rawType === 'SXTM') {
                                typeOdds = parseFloat(savedOdds['odds-tema']) || 43;
                            } else if (type === 'Âπ≥Áâπ‰∏ÄËÇñ' || rawType === 'PT1') {
                                typeOdds = parseFloat(savedOdds['odds-pingte1']) || 11;
                            } else if (type === 'Âπ≥Áâπ‰∫åËøûËÇñ' || rawType === 'PT2') {
                                typeOdds = parseFloat(savedOdds['odds-pt2']) || 26;
                            } else if (type === 'Âπ≥Áâπ‰∏âËøûËÇñ' || rawType === 'PT3') {
                                typeOdds = parseFloat(savedOdds['odds-pt3']) || 66;
                            } else if (type === 'ÂÖ≠ËÇñ' || rawType === 'SX6' || rawType === 'LX' || rawType === 'LX6') {
                                typeOdds = parseFloat(savedOdds['odds-liuxiao']) || 4.2;
                            } else if (type === 'ÁîüËÇñ' || rawType === 'SX') {
                                typeOdds = parseFloat(savedOdds['odds-shengxiao']) || 12;
                            } else if (type === 'Ê≥¢Ëâ≤' || rawType === 'BS') {
                                typeOdds = parseFloat(savedOdds['odds-bose']) || 2;
                            } else if (type === 'ÂçäÊ≥¢' || rawType === 'BB') {
                                typeOdds = parseFloat(savedOdds['odds-banbo']) || 4;
                            }
                            const winPayout = items.filter(r => r.isWin).reduce((s, r) => s + r.winAmount, 0);
                            
                            // üÜï v3.6.1 ‰ºòÂåñÂ±ïÁ§∫ÔºöËÅöÂêàÂè∑Á†ÅÂàóË°®
                            const allNums = items.map(it => it.number || (it.numbers && it.numbers[0])).filter(n => n);
                            const winNums = items.filter(r => r.isWin).map(it => it.number || (it.numbers && it.numbers[0])).filter(n => n);
                            
                            // üÜï v3.8.3 Âè™ÊúâÁîüËÇñËæìÂÖ•ÊâçÊòæÁ§∫Âè∑Á†ÅÂàóË°®ÔºàÁõ¥Êé•ËæìÂÖ•Âè∑Á†ÅÁöÑ‰∏çÊòæÁ§∫ÔºåÈÅøÂÖçÂÜó‰ΩôÔºâ
                            // üÜï v3.11.14 Âπ≥ÁâπÁ±ªÂûã‰∏çÊòæÁ§∫Âè∑Á†ÅÂàóË°®ÔºåÂè™ÊúâÁâπÁ†ÅÁ±ªÂûãÊâçÊòæÁ§∫
                            const hasZodiac = items.some(it => it.zodiac);
                            const isPingteType = ['PT1', 'PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∏ÄËÇñ', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(type);
                            
                            let numsDisplay = '';
                            if (hasZodiac && allNums.length > 0 && betCount > 1 && !isPingteType) {
                                // üÜï v3.8.4 ÊåâÁîüËÇñÂàÜÁªÑÊòæÁ§∫Âè∑Á†ÅÔºàÂ¶ÇÔºöÁå¥10,22,34,46,Èæô02,14,26,38Ôºâ
                                // Z‰ª£Âè∑ËΩ¨ÁîüËÇñÂêçÁß∞Êò†Â∞Ñ
                                const Z_TO_NAME = {
                                    'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                                    'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                                    'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                                };
                                const zodiacGroups = {};
                                items.forEach(it => {
                                    const z = it.zodiac;
                                    const num = it.number || (it.numbers && it.numbers[0]);
                                    if (z && num) {
                                        if (!zodiacGroups[z]) zodiacGroups[z] = [];
                                        if (!zodiacGroups[z].includes(num)) zodiacGroups[z].push(num);
                                    }
                                });
                                // Êåâitems‰∏≠È¶ñÊ¨°Âá∫Áé∞ÁöÑÈ°∫Â∫èÊéíÂàóÁîüËÇñ
                                const zodiacOrder = [];
                                items.forEach(it => {
                                    if (it.zodiac && !zodiacOrder.includes(it.zodiac)) {
                                        zodiacOrder.push(it.zodiac);
                                    }
                                });
                                const parts = zodiacOrder.map(z => {
                                    const nums = zodiacGroups[z] || [];
                                    // Â∞ÜZ‰ª£Âè∑ËΩ¨Êç¢‰∏∫ÁîüËÇñÂêçÁß∞ÔºàÂ¶ÇZ9‚ÜíÁå¥Ôºâ
                                    const zName = Z_TO_NAME[z] || z;
                                    return zName + nums.map(n => String(n).padStart(2,'0')).join(',');
                                });
                                numsDisplay = ` (${parts.join(',')})`;
                            }
                            
                            const icon = hasWin ? '‚úì' : '‚úó';
                            const profitStr = hasWin ? ` Áõà+${winPayout - typeTotal}ÂÖÉ` : '';
                            
                            // üÜï v3.11.29 Ê∑∑Âêà‰∏ãÊ≥®Êó∂Ê∑ªÂä†[È¶ô]/[Êæ≥]ÂâçÁºÄ
                            let ltPrefix = '';
                            if (window.currentCalcIsMixed) {
                                // Ëé∑ÂèñËØ•ÁªÑÁöÑÂΩ©ÁßçÊ†áËØÜÔºàÂèñÁ¨¨‰∏ÄÊù°ËÆ∞ÂΩïÁöÑltÔºâ
                                const groupLt = items[0]?.lt || 'mc';
                                ltPrefix = groupLt === 'hk' ? '[È¶ô] ' : '[Êæ≥] ';
                            }
                            
                            // üÜï v3.8.4 Âà†Èô§"ÂêÑ"Â≠óÔºåÊ†ºÂºèÔºöÁ±ªÂûã(ÂÄçÁéá): ÂéüÊñá (Âè∑Á†ÅÂàóË°®) ÈáëÈ¢ù*Ê≥®Êï∞=ÊÄªÈ¢ù
                            resultText += `${ltPrefix}${icon} ${type} (${typeOdds}ÂÄç): ${originalLine}${numsDisplay} ${perAmount}ÂÖÉ*${betCount}Ê≥®=${typeTotal}ÂÖÉ${profitStr}\n`;
                        }
                        
                        resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
                        resultText += `üí° ÁªìÊûúÊúâËØØÔºüÁÇπÂáª‰∏ãÊñπ"Êèê‰∫§ÂèçÈ¶à"\n`;
                        
                        // ÊòæÁ§∫ÁªìÊûú
                        document.getElementById('result-content').innerHTML = resultText.replace(/\n/g, '<br>');
                        document.getElementById('result-section').classList.add('show');
                        return; // üÜï v3.0 ÂêéÁ´ØËÆ°ÁÆóÂÆåÊàêÔºåÁõ¥Êé•ËøîÂõû
                    } else {
                        // ÂêéÁ´ØËøîÂõûÁ©∫ÁªìÊûúÊàñÂ§±Ë¥•ÔºåÂõûÈÄÄÊú¨Âú∞Ëß£Êûê
                        console.warn('‚ö†Ô∏è ÂêéÁ´ØËÆ°ÁÆóÂ§±Ë¥•ÊàñËøîÂõûÁ©∫ÁªìÊûú:', backendResult.error);
                        debugInfo.lastError = backendResult.error || 'ÂêéÁ´ØËøîÂõûÁ©∫ÁªìÊûú';
                        showAutoCloseToast('‚ö†Ô∏è ÂêéÁ´ØËÆ°ÁÆóÂ§±Ë¥•Ôºå‰ΩøÁî®Êú¨Âú∞Ëß£Êûê', 2000);
                        parsedBets = parseBetInput(input);
                    }
                } catch (e) {
                    console.error('‚ùå ÂêéÁ´ØËÆ°ÁÆóÂºÇÂ∏∏:', e);
                    debugInfo.lastError = e.message || String(e);
                    showAutoCloseToast('‚ùå ÂêéÁ´ØËÆ°ÁÆóÂºÇÂ∏∏: ' + e.message, 3000);
                    // ÂõûÈÄÄÂà∞Êú¨Âú∞Ëß£Êûê
                    parsedBets = parseBetInput(input);
                }
            } else {
                // Êú™ÂêØÁî®AIÔºå‰ΩøÁî®Êú¨Âú∞Ëß£Êûê
                parsedBets = parseBetInput(input);
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // ‰ª•‰∏ãÊòØÊú¨Âú∞Ëß£ÊûêÁöÑÂõûÈÄÄÈÄªËæëÔºàÂΩìÂêéÁ´ØËÆ°ÁÆóÂ§±Ë¥•Êó∂‰ΩøÁî®Ôºâ
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            if (parsedBets.length === 0) {
                alert('‚ùå Êú™ËØÜÂà´Âà∞ÊúâÊïàÁöÑ‰∏ãÊ≥®‰ø°ÊÅØ\n\nÂª∫ËÆÆÔºö\n1. Ê£ÄÊü•ËæìÂÖ•Ê†ºÂºè\n2. Âú®"Ëá™ÂÆö‰πâÊ†ºÂºè"‰∏≠Ê∑ªÂä†ËßÑÂàô\n3. ÂêØÁî®AIÊô∫ËÉΩËß£Êûê');
                return;
            }
            
            // Êú¨Âú∞ËÆ°ÁÆóÔºàÂõûÈÄÄÊ®°ÂºèÔºâ
            calcResults = parsedBets.map(bet => calculateSingleBet(bet, appState.lotteryNumbers));
            
            // Ê±áÊÄª
            const totalBet = calcResults.reduce((sum, r) => sum + r.amount, 0);
            const totalWin = calcResults.filter(r => r.isWin).length;
            const totalWinAmount = calcResults.filter(r => r.isWin).reduce((sum, r) => sum + r.winAmount, 0);
            const netResult = calcResults.reduce((sum, r) => sum + r.netResult, 0);
            
            // Ëé∑ÂèñÂºÄÂ•ñ‰ø°ÊÅØ
            const tema = appState.lotteryNumbers[6];
            const lotteryStr = appState.lotteryNumbers.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(tema).padStart(2,'0');
            
            // üÜï v3.11.29 ÁîüÊàêÂºÄÂ•ñÁªìÊûúÔºà‰∏éÂêéÁ´ØÊ®°Âºè‰øùÊåÅ‰∏ÄËá¥Ôºâ
            // Êú¨Âú∞ÂõûÈÄÄÊ®°ÂºèÁõÆÂâçÊ≤°Êúâhk/mc‰ø°ÊÅØÔºå‰ΩøÁî®windowÂèòÈáèÔºà‰ªéÂâçÁ´ØÊ£ÄÊµãÂæóÂà∞Ôºâ
            const hasHK2 = window.currentCalcHasHK || false;
            const hasMC2 = window.currentCalcHasMC !== false;
            const isMixed2 = window.currentCalcIsMixed || false;
            
            let lotteryResultText2 = '';
            const xamData2 = appState.lotteryData['xam'];
            const hkData2 = appState.lotteryData['hk'];
            const xamNums2 = xamData2?.numbers || appState.lotteryNumbers;
            const hkNums2 = hkData2?.numbers || [];
            
            const xamStr2 = xamNums2.length === 7 
                ? xamNums2.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(xamNums2[6]).padStart(2,'0')
                : 'Êú™ËÆæÁΩÆ';
            const hkStr2 = hkNums2.length === 7
                ? hkNums2.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') + ' + ÁâπÁ†Å' + String(hkNums2[6]).padStart(2,'0')
                : 'Êú™ËÆæÁΩÆ';
            
            if (isMixed2) {
                lotteryResultText2 = `üé∞ Êñ∞Êæ≥ÂºÄÂ•ñ: ${xamStr2}\nüé∞ È¶ôÊ∏ØÂºÄÂ•ñ: ${hkStr2}\n`;
            } else if (hasHK2 && !hasMC2) {
                lotteryResultText2 = `üé∞ È¶ôÊ∏ØÂºÄÂ•ñ: ${hkStr2}\n`;
            } else {
                lotteryResultText2 = `üé∞ Êñ∞Êæ≥ÂºÄÂ•ñ: ${xamStr2}\n`;
            }
            
            // ÁîüÊàêÁªìÊûúÊñáÊú¨ÔºàÊõ¥Ê∏ÖÊô∞ÁöÑÊ†ºÂºèÔºâ
            let resultText = `üìä ËÆ°ÁÆóÁªìÊûú\n`;
            resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            resultText += lotteryResultText2;
            resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            // üÜï v2.4.8 ÁªüËÆ°‰ø°ÊÅØÔºöËØÜÂà´Ê≥®Êï∞ | ÊÄªÊäï | ‰∏≠Â•ñÊ≥®Êï∞ | Ê¥æÂΩ©
            resultText += `üìã ËØÜÂà´ ${calcResults.length} Ê≥® | ÊÄªÊäï ${totalBet}ÂÖÉ\n`;
            resultText += `‰∏≠${totalWin}Ê≥® | Ê¥æÂΩ© ${totalWinAmount}ÂÖÉ\n`;
            // üÜï v2.4.8 ÁªìÁÆóÔºö‰ªéÁé©ÂÆ∂ËßíÂ∫¶ÔºåÊ¥æÂΩ© - ÊÄªÊäïÂÖ• = ÂáÄÁõà‰∫èÔºàÊ≠£Êï∞‰∏∫Ëµ¢Ôºâ
            const settleAmount = totalWinAmount - totalBet;
            resultText += `üí∞ ÁªìÁÆó: ${settleAmount >= 0 ? '+' : ''}${settleAmount}ÂÖÉ\n`;
            resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            
            // ÊåâÂéüÊñáÂàÜÁªÑÊòæÁ§∫ÔºàüÜï v3.7.2 ‰ºòÂÖà‰ΩøÁî® originalLine ‰Ωú‰∏∫ËÅöÂêà keyÔºâ
            const byOriginal = {};
            calcResults.forEach(r => {
                // ‰ºòÂÖà‰ΩøÁî® originalLineÔºàÁî®Êà∑ÂéüÂßãËæìÂÖ•ÔºâÔºåËÄå‰∏çÊòØ rawÔºàÂêéÁ´ØÂ±ïÂºÄÂêéÁöÑÂçïÊù°Êï∞ÊçÆÔºâ
                const key = r.originalLine || r.raw || r.type;
                if (!byOriginal[key]) {
                    byOriginal[key] = { type: r.type, originalLine: key, items: [], odds: r.odds || 1 };
                }
                byOriginal[key].items.push(r);
            });
            
            const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
            
            for (const group of Object.values(byOriginal)) {
                const items = group.items;
                const type = group.type;
                const originalLine = group.originalLine;
                const betCount = items.length;
                const typeTotal = items.reduce((s, it) => s + it.amount, 0);
                // üÜï v3.11.14 ‰øÆÂ§çÂ§çÂêàÁ±ªÂûã‰∏≠Â•ñÂà§Êñ≠ÔºöPT2/PT3Á≠âËøûËÇñÁ±ªÂûãÂøÖÈ°ªÊâÄÊúâÁîüËÇñÈÉΩ‰∏≠ÊâçÁÆó‰∏≠Â•ñ
                const isLianXiaoType = ['PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(type);
                const hasWin = isLianXiaoType ? items.every(r => r.isWin) : items.some(r => r.isWin);
                const perAmount = items[0]?.amount || 0;
                const winPayout = items.filter(r => r.isWin).reduce((s, r) => s + r.winAmount, 0);
                let typeOdds = items[0]?.odds || 1;
                // üÜï v3.3 ÁîüËÇñÁâπÁ†ÅÂ∑≤ÂêàÂπ∂Âà∞ÁâπÁ†ÅÔºå‰ΩÜ‰øùÁïôÂÖºÂÆπÊóßÁâàÊï∞ÊçÆ
                if (type === 'ÁâπÁ†Å' || type === 'ÁîüËÇñÁâπÁ†Å') {
                    typeOdds = parseFloat(savedOdds['odds-tema']) || 43;
                } else if (type === 'Âπ≥ÁâπÁîüËÇñ' || type === 'Âπ≥Áâπ‰∏ÄËÇñ') {
                    typeOdds = parseFloat(savedOdds['odds-pingte1']) || 11;
                }
                
                // üÜï v3.6.1 ‰ºòÂåñÂ±ïÁ§∫ÔºöËÅöÂêàÂè∑Á†ÅÂàóË°®
                const allNums = items.map(it => it.number || (it.numbers && it.numbers[0])).filter(n => n);
                
                // üÜï v3.8.3 Âè™ÊúâÁîüËÇñËæìÂÖ•ÊâçÊòæÁ§∫Âè∑Á†ÅÂàóË°®ÔºàÁõ¥Êé•ËæìÂÖ•Âè∑Á†ÅÁöÑ‰∏çÊòæÁ§∫ÔºåÈÅøÂÖçÂÜó‰ΩôÔºâ
                // üÜï v3.11.14 Âπ≥ÁâπÁ±ªÂûã‰∏çÊòæÁ§∫Âè∑Á†ÅÂàóË°®ÔºåÂè™ÊúâÁâπÁ†ÅÁ±ªÂûãÊâçÊòæÁ§∫
                const hasZodiac = items.some(it => it.zodiac);
                const isPingteType = ['PT1', 'PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∏ÄËÇñ', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(type);
                
                let numsDisplay = '';
                if (hasZodiac && allNums.length > 0 && betCount > 1 && !isPingteType) {
                    // üÜï v3.8.4 ÊåâÁîüËÇñÂàÜÁªÑÊòæÁ§∫Âè∑Á†ÅÔºàÂ¶ÇÔºöÁå¥10,22,34,46,Èæô02,14,26,38Ôºâ
                    // Z‰ª£Âè∑ËΩ¨ÁîüËÇñÂêçÁß∞Êò†Â∞Ñ
                    const Z_TO_NAME = {
                        'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                        'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                        'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                    };
                    const zodiacGroups = {};
                    items.forEach(it => {
                        const z = it.zodiac;
                        const num = it.number || (it.numbers && it.numbers[0]);
                        if (z && num) {
                            if (!zodiacGroups[z]) zodiacGroups[z] = [];
                            if (!zodiacGroups[z].includes(num)) zodiacGroups[z].push(num);
                        }
                    });
                    // Êåâitems‰∏≠È¶ñÊ¨°Âá∫Áé∞ÁöÑÈ°∫Â∫èÊéíÂàóÁîüËÇñ
                    const zodiacOrder = [];
                    items.forEach(it => {
                        if (it.zodiac && !zodiacOrder.includes(it.zodiac)) {
                            zodiacOrder.push(it.zodiac);
                        }
                    });
                    const parts = zodiacOrder.map(z => {
                        const nums = zodiacGroups[z] || [];
                        // Â∞ÜZ‰ª£Âè∑ËΩ¨Êç¢‰∏∫ÁîüËÇñÂêçÁß∞ÔºàÂ¶ÇZ9‚ÜíÁå¥Ôºâ
                        const zName = Z_TO_NAME[z] || z;
                        return zName + nums.map(n => String(n).padStart(2,'0')).join(',');
                    });
                    numsDisplay = ` (${parts.join(',')})`;
                }
                
                const icon = hasWin ? '‚úì' : '‚úó';
                const profitStr = hasWin ? ` Áõà+${winPayout - typeTotal}ÂÖÉ` : '';
                // üÜï v3.8.4 Âà†Èô§"ÂêÑ"Â≠ó
                resultText += `${icon} ${type} (${typeOdds}ÂÄç): ${originalLine}${numsDisplay} ${perAmount}ÂÖÉ*${betCount}Ê≥®=${typeTotal}ÂÖÉ${profitStr}\n`;
            }
            
            resultText += `‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;
            resultText += `üí° ÁªìÊûúÊúâËØØÔºüÁÇπÂáª‰∏ãÊñπ"Êèê‰∫§ÂèçÈ¶à"\n`;
            
            // ÊòæÁ§∫ÁªìÊûú
            document.getElementById('result-content').innerHTML = resultText.replace(/\n/g, '<br>');
            document.getElementById('result-section').classList.add('show');
        }
        
        // ÊòæÁ§∫Ê†∏ÂØπËØ¶ÊÉÖ
        function showCheckDetail() {
            if (calcResults.length === 0) {
                alert('ËØ∑ÂÖàÁÇπÂáª"ÂºÄÂßãËÆ°ÁÆó"');
                return;
            }
            
            // Ê±áÊÄªÊï∞ÊçÆ
            const totalBet = calcResults.reduce((sum, r) => sum + r.amount, 0);
            const totalWin = calcResults.filter(r => r.isWin).length;
            const netResult = calcResults.reduce((sum, r) => sum + r.netResult, 0);
            
            document.getElementById('check-total-bet').textContent = totalBet + 'ÂÖÉ';
            document.getElementById('check-win-count').textContent = totalWin + '/' + calcResults.length;
            
            const resultEl = document.getElementById('check-result');
            resultEl.textContent = (netResult >= 0 ? '+' : '') + netResult + 'ÂÖÉ';
            resultEl.className = 'check-summary-value ' + (netResult >= 0 ? 'lose' : 'win');
            
            // ÁîüÊàêËØ¶ÊÉÖÂàóË°®
            const listEl = document.getElementById('check-detail-list');
            listEl.innerHTML = calcResults.map(r => {
                const statusClass = r.isWin ? 'win' : 'lose';
                const badge = r.isWin ? 'üéØ ‰∏≠Â•ñ' : 'Êú™‰∏≠';
                const badgeClass = r.isWin ? '' : 'miss';
                const resultClass = r.netResult >= 0 ? 'lose' : 'win';
                const resultText = (r.netResult >= 0 ? '+' : '') + r.netResult;
                
                // ÊòæÁ§∫AI‰∏éÁ®ãÂ∫èËØÜÂà´Â∑ÆÂºÇ
                let typeConflictHtml = '';
                if (r.fromAI && r.localType) {
                    typeConflictHtml = `<div class="check-detail-info" style="color:#ffa500;font-size:11px;">‚ö†Ô∏è AIËØÜÂà´: ${r.aiType || r.type} | Á®ãÂ∫èËØÜÂà´: ${r.localType}</div>`;
                } else if (r.fromAI) {
                    typeConflictHtml = `<div class="check-detail-info" style="color:#4CAF50;font-size:11px;">ü§ñ AIËØÜÂà´</div>`;
                }
                
                return `
                    <div class="check-detail-item ${statusClass}">
                        <div class="check-detail-header">
                            <span class="check-detail-type">${r.type} ${r.number ? String(r.number).padStart(2,'0') : (r.value || '')}</span>
                            <span class="check-detail-badge ${badgeClass}">${badge}</span>
                        </div>
                        ${typeConflictHtml}
                        <div class="check-detail-info">‰∏ãÊ≥®ÈáëÈ¢ùÔºö${r.amount}ÂÖÉ</div>
                        <div class="check-detail-calc">${r.detail}</div>
                        ${r.isWin ? `<div class="check-detail-calc">‰∏≠Â•ñÔºö${r.amount} √ó ${r.odds} = ${r.winAmount}</div>` : ''}
                        <div class="check-detail-result ${resultClass}">${resultText}ÂÖÉ</div>
                    </div>
                `;
            }).join('');
            
            showPage('page-check');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // „ÄêÂàÜÁªÑÁºñËæëÂô® v2.4„ÄëÊâãÂä®ÊéßÂà∂‰∏ãÊ≥®Ë°åÁöÑÂàÜÁªÑ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        // ‰∏¥Êó∂Â≠òÂÇ®ÂàÜÁªÑÁºñËæëÁä∂ÊÄÅ
        let groupEditorLines = [];  // ÊØè‰∏™ÂÖÉÁ¥† { text: string, hasGroupBreakAfter: boolean }
        
        /**
         * ÊâìÂºÄÂàÜÁªÑÁºñËæëÂô®
         */
        function showGroupEditor() {
            const input = document.getElementById('bet-input').value;
            if (!input.trim()) {
                alert('ËØ∑ÂÖàÁ≤òË¥¥‰∏ãÊ≥®‰ø°ÊÅØ');
                return;
            }
            
            // üÜï v2.4.1 ÊîπËøõÁöÑÁ©∫Ë°åÊ£ÄÊµãÔºöÁªü‰∏ÄÊç¢Ë°åÁ¨¶ÔºåËøûÁª≠Á©∫Ë°åËßÜ‰∏∫‰∏Ä‰∏™ÂàÜÁªÑÂàÜÈöî
            const normalizedInput = input
                .replace(/\r\n/g, '\n')
                .replace(/\r/g, '\n');
            
            const rawLines = normalizedInput.split('\n');
            groupEditorLines = [];
            
            let lastWasEmpty = false;  // Ë∑üË∏™‰∏ä‰∏ÄË°åÊòØÂê¶‰∏∫Á©∫
            
            for (let i = 0; i < rawLines.length; i++) {
                const line = rawLines[i].trim();
                
                // Á©∫Ë°åÔºàÂåÖÊã¨Âè™ÊúâÁ©∫Ê†ºÁöÑË°åÔºâ
                if (!line) {
                    // ËøûÁª≠Á©∫Ë°åÂè™Ê†áËÆ∞‰∏ÄÊ¨°
                    if (!lastWasEmpty && groupEditorLines.length > 0) {
                        groupEditorLines[groupEditorLines.length - 1].hasGroupBreakAfter = true;
                    }
                    lastWasEmpty = true;
                    continue;
                }
                
                lastWasEmpty = false;
                groupEditorLines.push({
                    text: line,
                    hasGroupBreakAfter: false
                });
            }
            
            // Ë∞ÉËØïÔºöÊòæÁ§∫ËØÜÂà´Âà∞ÁöÑÂàÜÁªÑÊï∞
            const groupCount = groupEditorLines.filter(l => l.hasGroupBreakAfter).length + 1;
            console.log(`üì¶ ÂàÜÁªÑÁºñËæëÂô®ËØÜÂà´: ${groupEditorLines.length} Ë°å, ${groupCount} ÁªÑ`);
            groupEditorLines.forEach((l, i) => {
                console.log(`  ${i+1}. "${l.text.substring(0,20)}..." ${l.hasGroupBreakAfter ? '„ÄêÂàÜÁªÑÁ∫ø„Äë' : ''}`);
            });
            
            // Ê∏≤ÊüìÁºñËæëÂô®
            renderGroupEditor();
            
            // ÊòæÁ§∫ÂºπÁ™ó
            document.getElementById('group-editor-modal').style.display = 'flex';
        }
        
        /**
         * Ê∏≤ÊüìÂàÜÁªÑÁºñËæëÂô®ÁïåÈù¢
         */
        function renderGroupEditor() {
            const container = document.getElementById('group-editor-lines');
            
            if (groupEditorLines.length === 0) {
                container.innerHTML = '<div style="text-align:center;color:#666;padding:40px;">ÊöÇÊó†ÂÜÖÂÆπ</div>';
                return;
            }
            
            let html = '';
            let currentGroupId = 1;
            
            groupEditorLines.forEach((lineData, idx) => {
                // Â¶ÇÊûú‰∏ä‰∏ÄË°åÊúâÂàÜÁªÑÁ∫øÔºåÂΩìÂâçË°åÊòØÊñ∞ÁªÑÁöÑÂºÄÂßã
                if (idx > 0 && groupEditorLines[idx - 1].hasGroupBreakAfter) {
                    currentGroupId++;
                }
                
                // ÁªÑÈ¢úËâ≤
                const groupColors = ['#667eea', '#e94560', '#4ade80', '#f59e0b', '#06b6d4', '#ec4899'];
                const groupColor = groupColors[(currentGroupId - 1) % groupColors.length];
                
                html += `
                <div style="margin-bottom:4px;">
                    <!-- Ë°åÂÜÖÂÆπ -->
                    <div style="display:flex;align-items:center;gap:8px;padding:8px 12px;background:rgba(${currentGroupId % 2 === 1 ? '102,126,234' : '233,69,96'},0.1);border-radius:6px;border-left:3px solid ${groupColor};">
                        <span style="color:${groupColor};font-size:10px;font-weight:bold;min-width:24px;">ÁªÑ${currentGroupId}</span>
                        <span style="flex:1;color:#fff;font-size:13px;">${escapeHtml(lineData.text)}</span>
                        <button onclick="removeGroupLine(${idx})" style="background:none;border:none;color:#f44336;font-size:14px;cursor:pointer;opacity:0.5;" title="Âà†Èô§Ê≠§Ë°å">üóëÔ∏è</button>
                    </div>
                    
                    <!-- ÂàÜÁªÑÁ∫øÊåâÈíÆ (ÊúÄÂêé‰∏ÄË°å‰∏çÊòæÁ§∫) -->
                    ${idx < groupEditorLines.length - 1 ? `
                    <div style="display:flex;align-items:center;justify-content:center;padding:2px 0;">
                        ${lineData.hasGroupBreakAfter ? `
                            <button onclick="toggleGroupBreak(${idx})" style="padding:4px 12px;background:linear-gradient(90deg,#667eea,#764ba2);color:white;border:none;border-radius:12px;font-size:10px;cursor:pointer;display:flex;align-items:center;gap:4px;">
                                <span>‚îÅ‚îÅ‚îÅ ÂàÜÁªÑÁ∫ø ‚îÅ‚îÅ‚îÅ</span>
                                <span style="opacity:0.7;">‚úïÁßªÈô§</span>
                            </button>
                        ` : `
                            <button onclick="toggleGroupBreak(${idx})" style="padding:3px 10px;background:rgba(255,255,255,0.05);color:#888;border:1px dashed rgba(255,255,255,0.2);border-radius:10px;font-size:10px;cursor:pointer;">
                                + ÊèíÂÖ•ÂàÜÁªÑÁ∫ø
                            </button>
                        `}
                    </div>
                    ` : ''}
                </div>
                `;
            });
            
            // ÊòæÁ§∫ÂàÜÁªÑÈ¢ÑËßà
            const groupCount = groupEditorLines.filter(l => l.hasGroupBreakAfter).length + 1;
            html += `
            <div style="margin-top:12px;padding:10px;background:rgba(102,126,234,0.1);border-radius:6px;text-align:center;">
                <span style="color:#667eea;font-size:12px;">üìä ÂΩìÂâçÂÖ± <strong>${groupCount}</strong> ‰∏™ÂàÜÁªÑÔºå<strong>${groupEditorLines.length}</strong> Ë°åÊï∞ÊçÆ</span>
            </div>
            `;
            
            container.innerHTML = html;
        }
        
        /**
         * ÂàáÊç¢ÂàÜÁªÑÁ∫ø
         */
        function toggleGroupBreak(lineIdx) {
            if (lineIdx >= 0 && lineIdx < groupEditorLines.length) {
                groupEditorLines[lineIdx].hasGroupBreakAfter = !groupEditorLines[lineIdx].hasGroupBreakAfter;
                renderGroupEditor();
            }
        }
        
        /**
         * Âà†Èô§Êüê‰∏ÄË°å
         */
        function removeGroupLine(lineIdx) {
            if (lineIdx >= 0 && lineIdx < groupEditorLines.length) {
                groupEditorLines.splice(lineIdx, 1);
                renderGroupEditor();
            }
        }
        
        /**
         * ÈáçÁΩÆÂàÜÁªÑÁºñËæëÂô®
         */
        function resetGroupEditor() {
            // ÁßªÈô§ÊâÄÊúâÂàÜÁªÑÁ∫ø
            groupEditorLines.forEach(line => {
                line.hasGroupBreakAfter = false;
            });
            renderGroupEditor();
            showAutoCloseToast('‚úÖ Â∑≤ÈáçÁΩÆ‰∏∫ÂçïÁªÑ', 1500);
        }
        
        /**
         * Â∫îÁî®ÂàÜÁªÑÁºñËæë
         */
        function applyGroupEdits() {
            // Ê†πÊçÆÂàÜÁªÑÁ∫øÈáçÂª∫ÊñáÊú¨
            let result = [];
            let currentGroup = [];
            
            groupEditorLines.forEach((lineData, idx) => {
                currentGroup.push(lineData.text);
                
                if (lineData.hasGroupBreakAfter || idx === groupEditorLines.length - 1) {
                    result.push(currentGroup.join('\n'));
                    currentGroup = [];
                }
            });
            
            // Áî®ÂèåÊç¢Ë°åËøûÊé•ÂêÑÁªÑ
            const newInput = result.join('\n\n');
            
            // Êõ¥Êñ∞ËæìÂÖ•Ê°Ü
            document.getElementById('bet-input').value = newInput;
            
            // ÂÖ≥Èó≠ÂºπÁ™ó
            closeGroupEditor();
            
            // ÊèêÁ§∫
            const groupCount = result.length;
            showAutoCloseToast(`‚úÖ Â∑≤Â∫îÁî® ${groupCount} ‰∏™ÂàÜÁªÑ`, 2000);
        }
        
        /**
         * ÂÖ≥Èó≠ÂàÜÁªÑÁºñËæëÂô®
         */
        function closeGroupEditor() {
            document.getElementById('group-editor-modal').style.display = 'none';
        }
        
        /**
         * HTMLËΩ¨‰πâ
         */
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function clearInput() {
            document.getElementById('bet-input').value = '';
            document.getElementById('result-section').classList.remove('show');
            parsedBets = [];
            calcResults = [];
        }
        
        // ==================== Ëá™ÂÆö‰πâÊ†ºÂºèËÆæÁΩÆ ====================
        
        // üÜï v3.4 Ëá™ÂÆö‰πâËØÜÂà´ËßÑÂàôÂ≠òÂÇ®
        let customRules = [];
        
        // Âä†ËΩΩËá™ÂÆö‰πâËßÑÂàô
        function loadCustomRules() {
            const saved = localStorage.getItem('lhc_custom_rules');
            if (saved) {
                try {
                    customRules = JSON.parse(saved);
                } catch(e) {
                    customRules = [];
                }
            }
            renderCustomRules();
        }
        
        // üÜï v3.6 ÂÆåÊï¥Á±ªÂûãÂêçÁß∞Êò†Â∞Ñ
        const RULE_TYPE_NAMES = {
            'T01': 'ÁâπÁ†Å', 'T01_EXPAND': 'ÁâπÁ†Å(Â±ïÂºÄ)',
            'XS': 'Â∞èÊï∞', 'DS': 'Â§ßÊï∞', 'ODD': 'ÂçïÊï∞', 'EVEN': 'ÂèåÊï∞',
            'HXS': 'ÂêàÂ∞è', 'HDS': 'ÂêàÂ§ß', 'HODD': 'ÂêàÂçï', 'HEVEN': 'ÂêàÂèå',
            'C1': 'Á∫¢Ê≥¢', 'C2': 'ËìùÊ≥¢', 'C3': 'ÁªøÊ≥¢',
            'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'TX': 'ÁâπËÇñ', 'ZX': 'Ê≠£ËÇñ', 'SX': 'ÁîüËÇñ',
            'PT2': '‰∫åËøûËÇñ', 'PT3': '‰∏âËøûËÇñ', 'PTW': 'Âπ≥ÁâπÂ∞æ',
            'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â',
            'BZ5': '‰∫î‰∏ç‰∏≠', 'BZ6': 'ÂÖ≠‰∏ç‰∏≠', 'BZ7': '‰∏É‰∏ç‰∏≠', 
            'BZ8': 'ÂÖ´‰∏ç‰∏≠', 'BZ9': '‰πù‰∏ç‰∏≠', 'BZ10': 'ÂçÅ‰∏ç‰∏≠',
            'DP': 'ÂçïÂπ≥', 'TS': 'Â§¥Êï∞', 'WS': 'Â∞æÊï∞', 'WX': '‰∫îË°å',
            'JY': 'ÂÆ∂Èáé', 'ZH': 'ÊÄªÂíå', 'BB': 'ÂçäÊ≥¢', 'SX6': 'ÂÖ≠ËÇñ', 'HX': 'ÂêàËÇñ',
            'BS': 'Ê≥¢Ëâ≤'
        };
        
        // üÜï v3.6 È¢ÑËÆæÂè∑Á†ÅÊï∞ÊçÆ
        const PRESET_NUMBERS = {
            'small': [1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24],
            'big': [25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49],
            'tail0': [10,20,30,40],
            'tail1': [1,11,21,31,41],
            'tail2': [2,12,22,32,42],
            'tail3': [3,13,23,33,43],
            'tail4': [4,14,24,34,44],
            'tail5': [5,15,25,35,45],
            'tail6': [6,16,26,36,46],
            'tail7': [7,17,27,37,47],
            'tail8': [8,18,28,38,48],
            'tail9': [9,19,29,39,49],
            'red': [1,2,7,8,12,13,18,19,23,24,29,30,34,35,40,45,46],
            'blue': [3,4,9,10,14,15,20,25,26,31,36,37,41,42,47,48],
            'green': [5,6,11,16,17,21,22,27,28,32,33,38,39,43,44,49],
            'Z1': [6,18,30,42],  // 2025ËõáÂπ¥
            'Z2': [5,17,29,41],
            'Z3': [4,16,28,40],
            'Z4': [3,15,27,39],
            'Z5': [2,14,26,38],
            'Z6': [1,13,25,37,49],
            'Z7': [12,24,36,48],
            'Z8': [11,23,35,47],
            'Z9': [10,22,34,46],
            'Z10': [9,21,33,45],
            'Z11': [8,20,32,44],
            'Z12': [7,19,31,43]
        };
        
        // Ê∏≤ÊüìËßÑÂàôÂàóË°®
        function renderCustomRules() {
            const listEl = document.getElementById('custom-rules-list');
            if (!listEl) return;
            
            if (customRules.length === 0) {
                listEl.innerHTML = '<div style="text-align:center;color:#666;padding:20px;font-size:12px;">ÊöÇÊó†Ëá™ÂÆö‰πâËßÑÂàô</div>';
                return;
            }
            
            listEl.innerHTML = customRules.map((rule, idx) => {
                const typeName = RULE_TYPE_NAMES[rule.type] || rule.type;
                const expandInfo = rule.expand && rule.numbers ? ` ‚Üí ${rule.numbers.length}‰∏™Âè∑` : '';
                const amountMode = rule.amountMode === 'total' ? ' [ÊÄªÈ¢ùÂàÜ]' : '';
                return `
                <div style="display:flex;align-items:center;gap:8px;padding:10px;background:rgba(0,0,0,0.2);border-radius:6px;margin-bottom:6px;">
                    <span style="flex:1;font-size:12px;color:#fff;">
                        <b style="color:#fbbf24;">${rule.keyword}</b> ‚Üí 
                        <span style="color:#a78bfa;">${typeName}</span>
                        <span style="color:#81c784;font-size:10px;">${expandInfo}${amountMode}</span>
                    </span>
                    <button onclick="editCustomRule(${idx})" style="padding:4px 8px;background:rgba(102,126,234,0.2);color:#667eea;border:none;border-radius:4px;font-size:10px;cursor:pointer;margin-right:4px;">‰øÆÊîπ</button>
                    <button onclick="deleteCustomRule(${idx})" style="padding:4px 8px;background:rgba(244,67,54,0.2);color:#f44336;border:none;border-radius:4px;font-size:10px;cursor:pointer;">Âà†Èô§</button>
                </div>
            `}).join('');
        }
        
        // üÜï v3.6.1 ÁºñËæëËßÑÂàô
        function editCustomRule(idx) {
            const rule = customRules[idx];
            if (!rule) return;
            
            if (rule.expand && rule.numbers) {
                // Â±ïÂºÄÁ±ªÂûãÔºöÂºπÂá∫ËÆæÁΩÆÁ™óÂè£
                document.getElementById('expand-modal-keyword').textContent = rule.keyword;
                document.getElementById('expand-numbers-input').value = rule.numbers.join(',');
                updateNumbersCount();
                document.querySelector(`input[name="amount-mode"][value="${rule.amountMode || 'each'}"]`).checked = true;
                document.getElementById('expand-modal').style.display = 'block';
                // Ê†áËÆ∞‰∏∫ÁºñËæëÊ®°Âºè
                window.editingRuleIndex = idx;
            } else {
                // ÈùûÂ±ïÂºÄÁ±ªÂûãÔºöÂ°´ÂÖÖÂà∞ËæìÂÖ•Ê°Ü
                document.getElementById('new-rule-keyword').value = rule.keyword;
                document.getElementById('new-rule-type').value = rule.type;
                // Âà†Èô§ÊóßËßÑÂàô
                customRules.splice(idx, 1);
                localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
                renderCustomRules();
                showAutoCloseToast('üìù ËØ∑‰øÆÊîπÂêéÈáçÊñ∞Ê∑ªÂä†');
            }
        }
        
        // üÜï v3.6 Á±ªÂûãÈÄâÊã©ÂèòÂåñÊó∂
        function onRuleTypeChange() {
            const type = document.getElementById('new-rule-type')?.value;
            if (type === 'T01_EXPAND') {
                // ÂºπÂá∫Â±ïÂºÄËÆæÁΩÆÁ™óÂè£
                const keyword = document.getElementById('new-rule-keyword')?.value?.trim();
                if (!keyword) {
                    showAutoCloseToast('‚ö†Ô∏è ËØ∑ÂÖàËæìÂÖ•ÂÖ≥ÈîÆËØç');
                    document.getElementById('new-rule-type').value = '';
                    return;
                }
                showExpandModal(keyword);
            }
        }
        
        // üÜï v3.6 ÊòæÁ§∫Â±ïÂºÄËÆæÁΩÆÂºπÁ™ó
        function showExpandModal(keyword) {
            document.getElementById('expand-modal-keyword').textContent = keyword;
            document.getElementById('expand-numbers-input').value = '';
            document.getElementById('expand-numbers-count').textContent = 'Â∑≤ÈÄâ 0 ‰∏™Âè∑Á†Å';
            document.querySelector('input[name="amount-mode"][value="each"]').checked = true;
            document.getElementById('expand-modal').style.display = 'block';
            
            // ÁõëÂê¨Âè∑Á†ÅËæìÂÖ•ÂèòÂåñ
            document.getElementById('expand-numbers-input').addEventListener('input', updateNumbersCount);
        }
        
        // üÜï v3.6 ÂÖ≥Èó≠Â±ïÂºÄÂºπÁ™ó
        function closeExpandModal() {
            document.getElementById('expand-modal').style.display = 'none';
            document.getElementById('new-rule-type').value = '';
            window.editingRuleIndex = undefined; // Ê∏ÖÈô§ÁºñËæëÁä∂ÊÄÅ
        }
        
        // üÜï v3.7 ÊòæÁ§∫Ëá™ÂÆö‰πâËßÑÂàôÂ∏ÆÂä©ÂºπÁ™ó
        function showCustomRuleHelp() {
            document.getElementById('custom-rule-help-modal').style.display = 'block';
        }
        
        // üÜï v3.7 ÂÖ≥Èó≠Ëá™ÂÆö‰πâËßÑÂàôÂ∏ÆÂä©ÂºπÁ™ó
        function closeCustomRuleHelp() {
            document.getElementById('custom-rule-help-modal').style.display = 'none';
        }
        
        // üÜï v3.6 Â°´ÂÖÖÈ¢ÑËÆæÂè∑Á†Å
        function fillPreset(presetKey) {
            const numbers = PRESET_NUMBERS[presetKey];
            if (numbers) {
                document.getElementById('expand-numbers-input').value = numbers.join(',');
                updateNumbersCount();
            }
        }
        
        // üÜï v3.6 Êõ¥Êñ∞Âè∑Á†ÅËÆ°Êï∞
        function updateNumbersCount() {
            const input = document.getElementById('expand-numbers-input')?.value || '';
            const numbers = input.split(/[,Ôºå\s]+/).filter(n => {
                const num = parseInt(n);
                return !isNaN(num) && num >= 1 && num <= 49;
            });
            document.getElementById('expand-numbers-count').textContent = `Â∑≤ÈÄâ ${numbers.length} ‰∏™Âè∑Á†Å`;
        }
        
        // üÜï v3.6 Á°ÆËÆ§Ê∑ªÂä†Â±ïÂºÄËßÑÂàô
        function confirmExpandRule() {
            const keyword = document.getElementById('expand-modal-keyword').textContent;
            const numbersStr = document.getElementById('expand-numbers-input')?.value?.trim();
            const amountMode = document.querySelector('input[name="amount-mode"]:checked')?.value || 'each';
            
            if (!numbersStr) {
                showAutoCloseToast('‚ö†Ô∏è ËØ∑ÈÄâÊã©ÊàñËæìÂÖ•Âè∑Á†Å');
                return;
            }
            
            const numbers = numbersStr.split(/[,Ôºå\s]+/).map(n => parseInt(n)).filter(n => !isNaN(n) && n >= 1 && n <= 49);
            if (numbers.length === 0) {
                showAutoCloseToast('‚ö†Ô∏è ËØ∑ËæìÂÖ•ÊúâÊïàÂè∑Á†Å(1-49)');
                return;
            }
            
            // üÜï v3.6.1 ÁºñËæëÊ®°ÂºèÔºöÊõ¥Êñ∞Áé∞ÊúâËßÑÂàô
            const editingIdx = window.editingRuleIndex;
            if (typeof editingIdx === 'number' && editingIdx >= 0) {
                customRules[editingIdx] = {
                    keyword,
                    type: 'T01',
                    expand: true,
                    numbers: numbers,
                    amountMode: amountMode
                };
                window.editingRuleIndex = undefined;
                localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
                document.getElementById('new-rule-keyword').value = '';
                document.getElementById('new-rule-type').value = '';
                closeExpandModal();
                renderCustomRules();
                showAutoCloseToast(`‚úÖ ËßÑÂàôÂ∑≤Êõ¥Êñ∞ (${numbers.length}‰∏™Âè∑Á†Å)`);
                return;
            }
            
            // Ê£ÄÊü•ÊòØÂê¶Â∑≤Â≠òÂú®ÔºàÂÜ≤Á™ÅÊ£ÄÊµãÔºâ
            const existingIdx = customRules.findIndex(r => r.keyword === keyword);
            if (existingIdx >= 0) {
                showAutoCloseToast('‚ö†Ô∏è ÂÖ≥ÈîÆËØçÂÜ≤Á™ÅÔºÅËØ•ÂÖ≥ÈîÆËØçÂ∑≤Â≠òÂú®');
                return;
            }
            
            const rule = {
                keyword,
                type: 'T01',  // Â±ïÂºÄÁ±ªÂûãÂÆûÈôÖÊòØT01
                expand: true,
                numbers: numbers,
                amountMode: amountMode
            };
            
            customRules.push(rule);
            localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
            
            // Ê∏ÖÁ©∫ËæìÂÖ•Âπ∂ÂÖ≥Èó≠ÂºπÁ™ó
            document.getElementById('new-rule-keyword').value = '';
            document.getElementById('new-rule-type').value = '';
            closeExpandModal();
            
            renderCustomRules();
            showAutoCloseToast(`‚úÖ ËßÑÂàôÊ∑ªÂä†ÊàêÂäü (${numbers.length}‰∏™Âè∑Á†Å)`);
        }
        
        // Ê∑ªÂä†Êñ∞ËßÑÂàô
        function addCustomRule() {
            const keyword = document.getElementById('new-rule-keyword')?.value?.trim();
            const type = document.getElementById('new-rule-type')?.value;
            
            if (!keyword) {
                showAutoCloseToast('‚ö†Ô∏è ËØ∑ËæìÂÖ•ÂÖ≥ÈîÆËØç');
                return;
            }
            if (!type) {
                showAutoCloseToast('‚ö†Ô∏è ËØ∑ÈÄâÊã©Á±ªÂûã');
                return;
            }
            
            // Â±ïÂºÄÁ±ªÂûãÁî±ÂºπÁ™óÂ§ÑÁêÜ
            if (type === 'T01_EXPAND') {
                showExpandModal(keyword);
                return;
            }
            
            // üÜï v3.6.1 ÂÜ≤Á™ÅÊ£ÄÊµã
            if (customRules.some(r => r.keyword === keyword)) {
                showAutoCloseToast('‚ö†Ô∏è ÂÖ≥ÈîÆËØçÂÜ≤Á™ÅÔºÅËØ•ÂÖ≥ÈîÆËØçÂ∑≤Â≠òÂú®ÔºåËØ∑ÂÖàÂà†Èô§Êàñ‰øÆÊîπ');
                return;
            }
            
            const rule = { keyword, type, expand: false };
            
            customRules.push(rule);
            localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
            
            // Ê∏ÖÁ©∫ËæìÂÖ•
            document.getElementById('new-rule-keyword').value = '';
            document.getElementById('new-rule-type').value = '';
            
            renderCustomRules();
            showAutoCloseToast('‚úÖ ËßÑÂàôÊ∑ªÂä†ÊàêÂäü');
        }
        
        // Âà†Èô§ËßÑÂàô
        function deleteCustomRule(idx) {
            customRules.splice(idx, 1);
            localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
            renderCustomRules();
            showAutoCloseToast('‚úÖ ËßÑÂàôÂ∑≤Âà†Èô§');
        }
        
        // ÂØºÂá∫ÊâÄÊúâÈÖçÁΩÆ
        function exportAllSettings() {
            const config = {
                version: '3.4',
                exportTime: new Date().toISOString(),
                customRules: customRules,
                odds: JSON.parse(localStorage.getItem('lhc_odds') || '{}'),
                formatSettings: JSON.parse(localStorage.getItem('lhc_format_settings') || '{}')
            };
            
            const blob = new Blob([JSON.stringify(config, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `lhc_config_${new Date().toISOString().slice(0,10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            showAutoCloseToast('‚úÖ ÈÖçÁΩÆÂ∑≤ÂØºÂá∫');
        }
        
        // ÂØºÂÖ•ÈÖçÁΩÆ
        function importAllSettings(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const config = JSON.parse(e.target.result);
                    
                    if (config.customRules) {
                        customRules = config.customRules;
                        localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
                    }
                    if (config.odds) {
                        localStorage.setItem('lhc_odds', JSON.stringify(config.odds));
                    }
                    if (config.formatSettings) {
                        localStorage.setItem('lhc_format_settings', JSON.stringify(config.formatSettings));
                    }
                    
                    renderCustomRules();
                    showAutoCloseToast('‚úÖ ÈÖçÁΩÆÂØºÂÖ•ÊàêÂäüÔºåÂà∑Êñ∞È°µÈù¢ÁîüÊïà');
                    setTimeout(() => location.reload(), 1500);
                } catch(err) {
                    showAutoCloseToast('‚ùå ÂØºÂÖ•Â§±Ë¥•ÔºöÊñá‰ª∂Ê†ºÂºèÈîôËØØ');
                }
            };
            reader.readAsText(file);
            event.target.value = ''; // Ê∏ÖÁ©∫ÔºåÂÖÅËÆ∏ÈáçÂ§çÂØºÂÖ•
        }
        
        // Ëé∑ÂèñËá™ÂÆö‰πâËßÑÂàôÔºà‰æõËØÜÂà´Êó∂‰ΩøÁî®Ôºâ
        function getCustomRules() {
            return customRules;
        }
        
        function saveFormatSettings() {
            // üÜï v3.6 ‰øùÂ≠òÂâçËá™Âä®Ê∑ªÂä†Â°´ÂÜô‰∏≠ÁöÑËßÑÂàô
            const pendingKeyword = document.getElementById('new-rule-keyword')?.value?.trim();
            const pendingType = document.getElementById('new-rule-type')?.value;
            if (pendingKeyword && pendingType && pendingType !== 'T01_EXPAND') {
                // üÜï v3.6.1 ÂÜ≤Á™ÅÊ£ÄÊµã
                if (customRules.some(r => r.keyword === pendingKeyword)) {
                    showAutoCloseToast('‚ö†Ô∏è ÂÖ≥ÈîÆËØçÂÜ≤Á™ÅÔºÅËØ•ÂÖ≥ÈîÆËØçÂ∑≤Â≠òÂú®');
                    return;
                }
                customRules.push({ keyword: pendingKeyword, type: pendingType, expand: false });
                localStorage.setItem('lhc_custom_rules', JSON.stringify(customRules));
                document.getElementById('new-rule-keyword').value = '';
                document.getElementById('new-rule-type').value = '';
                renderCustomRules();
            }
            
            const settings = {
                // AIËÆæÁΩÆÔºàÈªòËÆ§ÂêØÁî®ÔºåAPI KeyÂú®ÂêéÁ´ØÁéØÂ¢ÉÂèòÈáèÔºâ
                aiEnabled: document.getElementById('ai-parse-enabled')?.checked !== false,
                aiProvider: localStorage.getItem('ai_provider') || 'openrouter'
            };
            localStorage.setItem('lhc_format_settings', JSON.stringify(settings));
            showAutoCloseToast('‚úÖ ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
            
            // üÜï v3.6.1 ‰øùÂ≠òÂêéËøîÂõûÈ¶ñÈ°µ
            setTimeout(() => {
                showPage('page-main');
            }, 800);
        }
        
        function loadFormatSettings() {
            const saved = localStorage.getItem('lhc_format_settings');
            if (saved) {
                try {
                    const s = JSON.parse(saved);
                    
                    // AIËÆæÁΩÆÔºàÈªòËÆ§ÂêØÁî®Ôºâ
                    const aiCheckbox = document.getElementById('ai-parse-enabled');
                    if (aiCheckbox) {
                        aiCheckbox.checked = s.aiEnabled !== false;
                    }
                } catch(e) {
                    console.error('Âä†ËΩΩÊ†ºÂºèËÆæÁΩÆÂ§±Ë¥•:', e);
                    loadDefaultAIConfig();
                }
            } else {
                loadDefaultAIConfig();
            }
            
            // üÜï v3.4 Âä†ËΩΩËá™ÂÆö‰πâËßÑÂàô
            loadCustomRules();
        }
        
        // Âä†ËΩΩÈªòËÆ§AIÈÖçÁΩÆÔºàÈªòËÆ§ÂêØÁî®AIËß£ÊûêÔºâ
        function loadDefaultAIConfig() {
            const aiCheckbox = document.getElementById('ai-parse-enabled');
            if (aiCheckbox) {
                aiCheckbox.checked = true; // ÈªòËÆ§ÂêØÁî®
            }
        }
        
        function resetFormatSettings() {
            if (confirm('Á°ÆÂÆöË¶ÅÊÅ¢Â§çÈªòËÆ§ËÆæÁΩÆÂêóÔºü')) {
                localStorage.removeItem('lhc_format_settings');
                location.reload();
            }
        }
        
        // ==================== AIÊô∫ËÉΩËß£ÊûêÊ®°Âùó ====================
        
        // AIÊúçÂä°ÂïÜÈÖçÁΩÆ
        // region: 'cn' = ÂõΩÂÜÖÊ®°ÂûãÔºàËµ∞ÈòøÈáå‰∫ë‰ª£ÁêÜÔºâÔºå'overseas' = Êµ∑Â§ñÊ®°ÂûãÔºàËµ∞Cloudflare‰ª£ÁêÜÔºâÔºå'direct' = Áõ¥ËøûÔºàÁ¨¨‰∏âÊñπ‰∏≠ËΩ¨APIÔºâ
        const AI_PROVIDERS = {
            // ‚ö†Ô∏è API Key Â∑≤ÁßªËá≥ÈòøÈáå‰∫ëÂáΩÊï∞ÁéØÂ¢ÉÂèòÈáèÔºå‰∏çÂÜçÂú®ÂâçÁ´ØÂ≠òÂÇ®
            // üåê OpenRouter - ÈªòËÆ§Êé®ËçêÔºåËÅöÂêàÂ§öÂÆ∂AIÊ®°Âûã
            openrouter: {
                name: 'Gemini 3 Flash',
                shortName: 'Gemini',
                url: 'https://openrouter.ai/api/v1/chat/completions',
                model: 'google/gemini-3-flash-preview',  // OpenRouter - Gemini 3 Flash PreviewÔºàÊúÄÊñ∞ÁâàÔºâ
                region: 'foreign'  // ÂõΩÂ§ñÊúçÂä°ÔºåËµ∞È¶ôÊ∏ØÊúçÂä°Âô®
            },
            deepseek: {
                name: 'DeepSeek',
                shortName: 'DS',
                url: 'https://api.deepseek.com/v1/chat/completions',
                model: 'deepseek-chat',  // DeepSeek ÂÆòÊñπÂØπËØùÊ®°ÂûãÔºàÁ®≥ÂÆöÔºâ
                region: 'cn'
            },
            tuzi: {
                name: 'Gemini-Flash',
                shortName: 'Gemini',
                url: 'https://api.tu-zi.com/v1/chat/completions',  // ‰ºöË¢´Â§öÁ´ôÁÇπÂàáÊç¢Ë¶ÜÁõñ
                model: 'gemini-2.0-flash',  // ÂÖîÂ≠êAPI - Gemini 2.0 FlashÔºàÂø´ÈÄüÁâàÔºâ
                region: 'cn',  // Ëµ∞ÈòøÈáå‰∫ë‰ª£ÁêÜÔºåÊâãÊú∫Êó†ÈúÄVPN
                useTuziMultiSite: true  // Ê†áËÆ∞‰ΩøÁî®ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπ
            },
            qwen: {
                name: 'ÈÄö‰πâÂçÉÈóÆ',
                shortName: 'ÂçÉÈóÆ',
                url: 'https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions',
                model: 'qwen-turbo',
                region: 'cn'
            },
            // Êô∫Ë∞±GLM - ÊîØÊåÅFunction Calling
            zhipu: {
                name: 'Êô∫Ë∞±GLM-4',
                shortName: 'Êô∫Ë∞±',
                url: 'https://open.bigmodel.cn/api/paas/v4/chat/completions',
                model: 'glm-4-plus',  // Êô∫Ë∞±GLM-4 PlusÔºàÊõ¥Âº∫Ê®°ÂûãÔºâ
                region: 'cn'
            },
            // Ë±ÜÂåÖ - Â≠óËäÇË∑≥Âä®ÔºåÊîØÊåÅFunction Calling
            doubao: {
                name: 'Ë±ÜÂåÖ',
                shortName: 'Ë±ÜÂåÖ',
                url: 'https://ark.cn-beijing.volces.com/api/v3/chat/completions',
                model: 'doubao-lite-32k',  // Ë±ÜÂåÖËΩªÈáèÁâàÔºàÊÄß‰ª∑ÊØîÈ´òÔºâ
                region: 'cn'
            },
            claude: {
                name: 'Claude-Sonnet',
                shortName: 'Claude',
                url: 'https://api.tu-zi.com/v1/chat/completions',  // ‰ºöË¢´Â§öÁ´ôÁÇπÂàáÊç¢Ë¶ÜÁõñ
                model: 'claude-sonnet-4-0',  // ÂÖîÂ≠êAPI - Claude Sonnet 4.0
                region: 'cn',  // Ëµ∞ÈòøÈáå‰∫ë‰ª£ÁêÜ
                useTuziMultiSite: true  // Ê†áËÆ∞‰ΩøÁî®ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπ
            },
            gpt: {
                name: 'GPT-4o-Mini',
                shortName: 'GPT4o',
                url: 'https://api.tu-zi.com/v1/chat/completions',  // ‰ºöË¢´Â§öÁ´ôÁÇπÂàáÊç¢Ë¶ÜÁõñ
                model: 'gpt-4o-mini',  // ÂÖîÂ≠êAPI - GPT-4o MiniÔºàÊÄß‰ª∑ÊØîÊúÄÈ´òÔºâ
                region: 'cn',  // Ëµ∞ÈòøÈáå‰∫ë‰ª£ÁêÜ
                useTuziMultiSite: true  // Ê†áËÆ∞‰ΩøÁî®ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπ
            }
        };
        
        // ==================== ÂÖîÂ≠êAPI Â§öÁ´ôÁÇπÊô∫ËÉΩÂàáÊç¢ ====================
        // Á´ôÁÇπÂàóË°®ÔºàÊåâ‰ºòÂÖàÁ∫ßÊéíÂ∫èÔºöÂπøÂ∑û > Ê∑±Âú≥ > ‰∏ªÁ´ô > Â§áÁî®Ôºâ
        const TUZI_SITES = [
            { name: 'ÂπøÂ∑û', url: 'https://api.ourzhishi.top/v1/chat/completions' },
            { name: 'Ê∑±Âú≥', url: 'https://apisz.ourzhishi.top/v1/chat/completions' },
            { name: '‰∏ªÁ´ô', url: 'https://api.tu-zi.com/v1/chat/completions' },
            { name: 'Â§áÁî®1-cdn', url: 'https://apius.tu-zi.com/v1/chat/completions' },
            { name: 'Â§áÁî®2-cdn', url: 'https://apicdn.tu-zi.com/v1/chat/completions' }
        ];
        
        // Â§öÁ´ôÁÇπÁä∂ÊÄÅÁÆ°ÁêÜ
        const tuziSiteManager = {
            currentIndex: 0,           // ÂΩìÂâç‰ΩøÁî®ÁöÑÁ´ôÁÇπÁ¥¢Âºï
            successCount: 0,           // ËøûÁª≠ÊàêÂäüÊ¨°Êï∞
            ÂõûÂΩíÊ£ÄÊü•ÈòàÂÄº: 10,          // ÊØèÊàêÂäüNÊ¨°Â∞ùËØïÂõûÂà∞Êõ¥È´ò‰ºòÂÖàÁ∫ßÁ´ôÁÇπ
            
            // Ëé∑ÂèñÂΩìÂâçÁ´ôÁÇπURL
            getCurrentUrl() {
                return TUZI_SITES[this.currentIndex].url;
            },
            
            // Ëé∑ÂèñÂΩìÂâçÁ´ôÁÇπÂêçÁß∞
            getCurrentName() {
                return TUZI_SITES[this.currentIndex].name;
            },
            
            // ËØ∑Ê±ÇÊàêÂäüÊó∂Ë∞ÉÁî®
            onSuccess() {
                this.successCount++;
                console.log(`‚úÖ ÂÖîÂ≠êAPI [${this.getCurrentName()}] ËØ∑Ê±ÇÊàêÂäüÔºåËøûÁª≠ÊàêÂäü: ${this.successCount}Ê¨°`);
                
                // Â¶ÇÊûú‰∏çÊòØÊúÄÈ´ò‰ºòÂÖàÁ∫ßÁ´ôÁÇπÔºå‰∏îËøûÁª≠ÊàêÂäüËææÂà∞ÈòàÂÄºÔºåÂ∞ùËØïÂõûÂà∞Êõ¥È´ò‰ºòÂÖàÁ∫ß
                if (this.currentIndex > 0 && this.successCount >= this.ÂõûÂΩíÊ£ÄÊü•ÈòàÂÄº) {
                    console.log(`üîÑ Â∞ùËØïÂõûÂΩíÂà∞Êõ¥È´ò‰ºòÂÖàÁ∫ßÁ´ôÁÇπ...`);
                    this.currentIndex = 0;  // ÂõûÂà∞ÊúÄÈ´ò‰ºòÂÖàÁ∫ßÔºàÂπøÂ∑ûÔºâ
                    this.successCount = 0;
                }
            },
            
            // ËØ∑Ê±ÇÂ§±Ë¥•Êó∂Ë∞ÉÁî®ÔºåËøîÂõûÊòØÂê¶ËøòÊúâ‰∏ã‰∏Ä‰∏™Á´ôÁÇπÂèØÂ∞ùËØï
            onFailure() {
                const failedSite = this.getCurrentName();
                this.successCount = 0;  // ÈáçÁΩÆÊàêÂäüËÆ°Êï∞
                
                if (this.currentIndex < TUZI_SITES.length - 1) {
                    this.currentIndex++;
                    console.log(`‚ö†Ô∏è ÂÖîÂ≠êAPI [${failedSite}] Â§±Ë¥•ÔºåÂàáÊç¢Âà∞ [${this.getCurrentName()}]`);
                    return true;  // ËøòÊúâ‰∏ã‰∏Ä‰∏™Á´ôÁÇπ
                } else {
                    console.log(`‚ùå ÂÖîÂ≠êAPI ÊâÄÊúâÁ´ôÁÇπÈÉΩÂ§±Ë¥•‰∫Ü`);
                    this.currentIndex = 0;  // ÈáçÁΩÆÔºå‰∏ãÊ¨°‰ªéÂ§¥ÂºÄÂßã
                    return false;  // Ê≤°ÊúâÊõ¥Â§öÁ´ôÁÇπ‰∫Ü
                }
            },
            
            // ÈáçÁΩÆÁä∂ÊÄÅÔºàÁî®‰∫éË∞ÉËØïÔºâ
            reset() {
                this.currentIndex = 0;
                this.successCount = 0;
                console.log('üîÑ ÂÖîÂ≠êAPIÁ´ôÁÇπÁÆ°ÁêÜÂô®Â∑≤ÈáçÁΩÆ');
            }
        };
        
        // ÂàáÊç¢AIÊ®°ÂûãÔºàÊåâÈíÆÁÇπÂáªÔºâ
        function switchAIModel(provider) {
            const config = AI_PROVIDERS[provider];
            if (!config) return;
            
            // Êõ¥Êñ∞ÈöêËóèÁöÑ selectÔºàAPI Key Âú®ÂêéÁ´ØÔºå‰∏çÈúÄË¶ÅËÆæÁΩÆÔºâ
            document.getElementById('ai-provider').value = provider;
            
            // Êõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            document.querySelectorAll('.ai-model-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.dataset.provider === provider) {
                    btn.classList.add('active');
                }
            });
            
            // Êõ¥Êñ∞Áä∂ÊÄÅÊòæÁ§∫ÔºàAPI Key Â∑≤Âú®ÂêéÁ´ØÈÖçÁΩÆÔºâ
            const statusEl = document.getElementById('ai-model-status');
            if (statusEl) {
                let regionText, bgColor, textColor;
                if (config.region === 'overseas') {
                    regionText = 'Êµ∑Â§ñCloudflare‰ª£ÁêÜ';
                    bgColor = 'rgba(255,152,0,0.1)';
                    textColor = '#ffa726';
                } else if (config.region === 'direct') {
                    regionText = 'Á¨¨‰∏âÊñπ‰∏≠ËΩ¨Áõ¥Ëøû';
                    bgColor = 'rgba(33,150,243,0.1)';
                    textColor = '#64b5f6';
                } else if (config.region === 'foreign') {
                    regionText = 'OpenRouter ¬∑ È¶ôÊ∏ØÊúçÂä°Âô®';
                    bgColor = 'rgba(139,92,246,0.1)';
                    textColor = '#a78bfa';
                } else {
                    regionText = 'È¶ôÊ∏ØÊúçÂä°Âô®';
                    bgColor = 'rgba(76,175,80,0.1)';
                    textColor = '#81c784';
                }
                statusEl.innerHTML = '‚úÖ ÂΩìÂâçÔºö' + config.name + 'Ôºà' + regionText + 'Ôºâ';
                statusEl.style.background = bgColor;
                statusEl.style.color = textColor;
            }
            
            // ‰øùÂ≠òÈÄâÊã©
            localStorage.setItem('ai_provider', provider);
            console.log('ü§ñ AIÊ®°ÂûãÂàáÊç¢‰∏∫:', provider, config.name);
        }
        
        // ==================== AI È¢ÑÂ§ÑÁêÜÂáΩÊï∞ ====================
        // Ê†áÂáÜÂåñÁî®Êà∑ËæìÂÖ•ÔºåËÆ© AI Êõ¥ÂÆπÊòìÁêÜËß£ÔºàÁ°ÆÂÆöÊÄßËßÑÂàôÔºå‰∏ç‰æùËµñ AIÔºâ
        function normalizeForAI(text) {
            if (!text) return text;
            
            let result = text;
            
            // 1. ÂàÜÈöîÁ¨¶Áªü‰∏Ä‰∏∫Á©∫Ê†ºÔºàÁÇπ„ÄÅÈÄóÂè∑„ÄÅÈ°øÂè∑„ÄÅÊñúÊù†„ÄÅÁü≠Ê®™Á∫øÔºâ
            result = result.replace(/[\.„ÄÇ,Ôºå„ÄÅ\/\-]/g, ' ');
            
            // 2. ÈáëÈ¢ùÁ¨¶Âè∑Áªü‰∏Ä‰∏∫"ÂêÑ"
            // Áªü‰∏Ä ‚Üí ÂêÑÔºåÁªü ‚Üí ÂêÑÔºå√ó ‚Üí ÂêÑÔºåX ‚Üí ÂêÑÔºåx ‚Üí ÂêÑÔºå* ‚Üí ÂêÑÔºå@ ‚Üí ÂêÑ
            result = result.replace(/Áªü‰∏Ä/g, 'ÂêÑ');
            result = result.replace(/Áªü(?!\d)/g, 'ÂêÑ');  // "Áªü"ÂêéÈù¢‰∏çÊòØÊï∞Â≠óÊó∂ÊâçÊõøÊç¢
            result = result.replace(/[√ó\*@]/g, 'ÂêÑ');
            // x/X Âú®Êï∞Â≠óÂêéÈù¢Êó∂ÊõøÊç¢‰∏∫"ÂêÑ"ÔºàÂ¶Ç 10x20 ‚Üí 10ÂêÑ20Ôºâ
            result = result.replace(/(\d)\s*[xX]\s*(\d)/g, '$1ÂêÑ$2');
            
            // 3. ÂéªÊéâÈáëÈ¢ùÂçï‰Ωç
            result = result.replace(/ÂÖÉ|Âùó|ÂúÜ/g, '');
            
            // 4. Ê∏ÖÁêÜÂ§ö‰ΩôÁ©∫Ê†º
            result = result.replace(/\s+/g, ' ').trim();
            
            console.log('üîÑ AIÈ¢ÑÂ§ÑÁêÜ:', text, '‚Üí', result);
            return result;
        }
        
        // ==================== „ÄêÂΩ©ÁßçËØÜÂà´Á≥ªÁªü v3.11.24„Äë ====================
        // üéØ ËØÜÂà´Áî®Êà∑ËæìÂÖ•‰∏≠ÁöÑÂΩ©ÁßçÊ†áËØÜÔºàÈ¶ôÊ∏Ø/Êñ∞Êæ≥/ÊóßÊæ≥Ôºâ
        // üìù ËßÑÂàôÔºö
        //   - È¶ôÊ∏Ø/È¶ô/Ê∏Ø ‚Üí È¶ôÊ∏Ø
        //   - Êñ∞Â••/Êæ≥/Â••/Êñ∞Êæ≥/Êæ≥Èó® ‚Üí Êñ∞Êæ≥Èó®
        //   - Êó†Ê†áËØÜ ‚Üí ÈªòËÆ§Êñ∞Êæ≥Èó®
        //   - ÊóßÊæ≥/ÊóßÊæ≥Èó®/ÊóßÂ•• ‚Üí ‰∏çÊîØÊåÅÔºåÂºπÁ™óÊèêÈÜí
        
        /**
         * üÜï v3.11.26 Ê£ÄÊµãËæìÂÖ•ÊñáÊú¨‰∏≠ÁöÑÂΩ©ÁßçÁ±ªÂûã
         * ‚ö†Ô∏è Ê≥®ÊÑèÔºö‰∏ç‰ΩøÁî®ÂêéË°åÊñ≠Ë®Ä(?<=)ÔºåÂÖºÂÆπ iOS Safari
         * @param {string} line ÂçïË°åÊñáÊú¨
         * @returns {object} { type: 'hk'|'xam'|'old_am'|'default', keyword: ÂåπÈÖçÂà∞ÁöÑÂÖ≥ÈîÆÂ≠ó }
         */
        function detectLotteryType(line) {
            if (!line) return { type: 'default', keyword: null };
            
            // üö´ ‰ºòÂÖàÊ£ÄÊµã‰∏çÊîØÊåÅÁöÑ"ÊóßÊæ≥"Á±ªÂûãÔºàÂøÖÈ°ªÊúÄÂÖàÊ£ÄÊµãÔºâ
            if (line.indexOf('ÊóßÊæ≥Èó®') !== -1) return { type: 'old_am', keyword: 'ÊóßÊæ≥Èó®' };
            if (line.indexOf('ÊóßÊæ≥') !== -1) return { type: 'old_am', keyword: 'ÊóßÊæ≥' };
            if (line.indexOf('ÊóßÂ••') !== -1) return { type: 'old_am', keyword: 'ÊóßÂ••' };
            
            // üá≠üá∞ Ê£ÄÊµãÈ¶ôÊ∏ØÔºàÁÆÄÂåñÈÄªËæëÔºåÈÅøÂÖçÂ§çÊùÇÊ≠£ÂàôÔºâ
            // ÊéíÈô§ÂåÖÂê´"Êñ∞Êæ≥|Êæ≥Èó®"ÁöÑÊÉÖÂÜµ
            if (line.indexOf('Êñ∞Êæ≥') === -1 && line.indexOf('Êæ≥Èó®') === -1) {
                if (line.indexOf('È¶ôÊ∏Ø') !== -1) return { type: 'hk', keyword: 'È¶ôÊ∏Ø' };
                if (line.indexOf('È¶ô') === 0) return { type: 'hk', keyword: 'È¶ô' };  // Ë°åÈ¶ñÁöÑ"È¶ô"
                if (line.indexOf('Ê∏Ø') === 0) return { type: 'hk', keyword: 'Ê∏Ø' };  // Ë°åÈ¶ñÁöÑ"Ê∏Ø"
                // Ë°åÂ∞æÁöÑ"Ê∏Ø"Ôºà‰ΩÜÂâçÈù¢‰∏çÊòØ"È¶ô"Âíå"Êæ≥"Ôºâ
                if (line.length > 0 && line.charAt(line.length - 1) === 'Ê∏Ø') {
                    var prevChar = line.length > 1 ? line.charAt(line.length - 2) : '';
                    if (prevChar !== 'È¶ô' && prevChar !== 'Êæ≥') {
                        return { type: 'hk', keyword: 'Ê∏Ø' };
                    }
                }
            }
            
            // üá≤üá¥ Ê£ÄÊµãÊñ∞Êæ≥Èó®
            if (line.indexOf('Êñ∞Êæ≥Èó®') !== -1) return { type: 'xam', keyword: 'Êñ∞Êæ≥Èó®' };
            if (line.indexOf('Êñ∞Êæ≥') !== -1) return { type: 'xam', keyword: 'Êñ∞Êæ≥' };
            if (line.indexOf('Êñ∞Â••') !== -1) return { type: 'xam', keyword: 'Êñ∞Â••' };
            if (line.indexOf('Êæ≥Èó®') !== -1) return { type: 'xam', keyword: 'Êæ≥Èó®' };
            if (line.indexOf('Êæ≥') === 0) return { type: 'xam', keyword: 'Êæ≥' };  // Ë°åÈ¶ñÁöÑ"Êæ≥"
            if (line.indexOf('Â••') === 0) return { type: 'xam', keyword: 'Â••' };  // Ë°åÈ¶ñÁöÑ"Â••"
            // Ë°åÂ∞æÁöÑ"Êæ≥"Êàñ"Â••"
            if (line.length > 0) {
                var lastChar = line.charAt(line.length - 1);
                if (lastChar === 'Êæ≥') return { type: 'xam', keyword: 'Êæ≥' };
                if (lastChar === 'Â••') return { type: 'xam', keyword: 'Â••' };
            }
            
            // ÈªòËÆ§ÔºöÊñ∞Êæ≥Èó®
            return { type: 'default', keyword: null };
        }
        
        /**
         * ÂàÜÊûêÊï¥‰∏™ËæìÂÖ•ÊñáÊú¨ÔºåËøîÂõûÂåÖÂê´ÁöÑÂΩ©Áßç
         * @param {string} input ÂÆåÊï¥ËæìÂÖ•ÊñáÊú¨
         * @returns {object} { hasHK: bool, hasXAM: bool, hasOldAM: bool, oldAmKeyword: string }
         */
        function analyzeLotteryTypes(input) {
            const lines = input.split('\n');
            let hasHK = false;
            let hasXAM = false;
            let hasOldAM = false;
            let oldAmKeyword = null;
            
            for (const line of lines) {
                const trimmed = line.trim();
                if (!trimmed) continue;
                
                const result = detectLotteryType(trimmed);
                if (result.type === 'hk') hasHK = true;
                if (result.type === 'xam') hasXAM = true;
                if (result.type === 'old_am') {
                    hasOldAM = true;
                    oldAmKeyword = result.keyword;
                }
                // default Á±ªÂûãËÆ°ÂÖ•Êñ∞Êæ≥Èó®
                if (result.type === 'default') hasXAM = true;
            }
            
            return { hasHK, hasXAM, hasOldAM, oldAmKeyword };
        }
        
        // ==================== „ÄêËæìÂÖ•Ê†áÂáÜÂåñÁ≥ªÁªü v3.11.6„Äë ====================
        // üéØ ÁõÆÁöÑ1ÔºöÂ∞ÜÂêå‰πâËØç/Âèò‰ΩìÁªü‰∏Ä‰∏∫Ê†áÂáÜÊ†ºÂºèÔºàÊèêÈ´òAIËØÜÂà´ÁéáÔºâ
        // üéØ ÁõÆÁöÑ2ÔºöÂ∞Ü‰∏≠ÊñáÁîüËÇñËΩ¨Êç¢‰∏∫ Z ‰ª£Âè∑ÔºàÂêéÁ´ØÊ≠£ÂàôÂåπÈÖç‰æùËµñÊ≠§Ê†ºÂºèÔºâ
        // üìù Â§ÑÁêÜÈ°∫Â∫èÔºöÂêå‰πâËØçÊ†áÂáÜÂåñ ‚Üí ÁîüËÇñ‰ª£Âè∑ËΩ¨Êç¢
        
        // ========== Âêå‰πâËØçÊò†Â∞ÑË°®ÔºàÁî®Êà∑Âèò‰Ωì ‚Üí Ê†áÂáÜÊ†ºÂºèÔºâ==========
        // üÜï v3.11.6 Êñ∞Â¢ûÔºöÂ§ÑÁêÜÁî®Êà∑ËæìÂÖ•ÁöÑÂêÑÁßçÂèò‰ΩìÂÜôÊ≥ï
        const SYNONYM_MAP = {
            // ===== ÂÖ≠ËÇñÂèò‰Ωì =====
            '6ËÇñ': 'ÂÖ≠ËÇñ',
            'ÈôÜËÇñ': 'ÂÖ≠ËÇñ',
            'ÂÖ≠‰∏™ÁîüËÇñ': 'ÂÖ≠ËÇñ',
            '6‰∏™ÁîüËÇñ': 'ÂÖ≠ËÇñ',
            
            // ===== Âπ≥ÁâπÂèò‰Ωì =====
            'Âπ≥Á†Å': 'Âπ≥Áâπ',
            'PT1': 'Âπ≥Áâπ',
            'pt1': 'Âπ≥Áâπ',
            'PT': 'Âπ≥Áâπ',
            'pt': 'Âπ≥Áâπ',
            
            // ===== ‰∏ÄÂèãÂèò‰ΩìÔºàÂπ≥Áâπ‰∏ÄËÇñÔºâ=====
            '1Âèã': '‰∏ÄÂèã',  // ‰∏ÄÂèã=Âπ≥Áâπ‰∏ÄËÇñÔºàÈÄâ1‰∏™ÁîüËÇñÔºâ
            
            // ===== ‰∫åÂèã/‰∫åËøûËÇñÂèò‰ΩìÔºàÂπ≥Áâπ‰∫åËøûËÇñÔºâ=====
            '2Âèã': '‰∫åÂèã',  // ‰∫åÂèã=Âπ≥Áâπ‰∫åËøûËÇñÔºàÈÄâ2‰∏™ÁîüËÇñÔºâ
            '‰∏§Âèã': '‰∫åÂèã',
            'ÂèåÂèã': '‰∫åÂèã',
            '‰∫åËøûËÇñ': '‰∫åÂèã',
            '2ËøûËÇñ': '‰∫åÂèã',
            
            // ===== ‰∏âÂèã/‰∏âËøûËÇñÂèò‰Ωì =====
            '3Âèã': '‰∏âÂèã',
            '‰∏âËøûËÇñ': '‰∏âÂèã',
            '3ËøûËÇñ': '‰∏âÂèã',
            
            // ===== ÂõõÂèã/‰∫îÂèãÂèò‰Ωì =====
            '4Âèã': 'ÂõõÂèã',
            'ÂõõËøûËÇñ': 'ÂõõÂèã',
            '5Âèã': '‰∫îÂèã',
            '‰∫îËøûËÇñ': '‰∫îÂèã',
            
            // ===== Ê≥¢Ëâ≤Âèò‰Ωì =====
            'Á∫¢Ê≥¢': 'Á∫¢',
            'ËìùÊ≥¢': 'Ëìù',
            'ÁªøÊ≥¢': 'Áªø',
            
            // ===== ÈáëÈ¢ùÂçï‰ΩçÁªü‰∏Ä =====
            'Âùó': 'ÂÖÉ',
            'ÂúÜ': 'ÂÖÉ',
            'ÂùóÈí±': 'ÂÖÉ',
            
            // ===== ‰πòÂè∑Áªü‰∏Ä =====
            '√ó': 'x',
            'X': 'x',
            'Ôºä': '*',
            
            // ===== ÁâπÊÆäÂ≠óÁ¨¶ÂÖ®ËßíËΩ¨ÂçäËßí =====
            'Ôºå': ',',
            '„ÄÇ': '.',
            'Ôºõ': ';',
            'Ôºö': ':',
        };
        
        // Âêå‰πâËØçÊò†Â∞ÑÈîÆÔºàÊåâÈïøÂ∫¶ÈôçÂ∫èÊéíÂàóÔºåÈÅøÂÖçÁü≠ËØçÂÖàÂåπÈÖçÔºâ
        const SYNONYM_KEYS_SORTED = Object.keys(SYNONYM_MAP).sort((a, b) => b.length - a.length);
        
        // ========== ÁîüËÇñ‰ª£Âè∑Êò†Â∞ÑË°®Ôºà‰∏≠ÊñáÁîüËÇñ ‚Üí Z‰ª£Âè∑Ôºâ==========
        const ZODIAC_TO_CODE = {
            'Èº†': 'Z1', 'Áâõ': 'Z2', 'Ëôé': 'Z3', 'ÂÖî': 'Z4',
            'Èæô': 'Z5', 'Ëõá': 'Z6', 'È©¨': 'Z7', 'Áæä': 'Z8',
            'Áå¥': 'Z9', 'È∏°': 'Z10', 'Áãó': 'Z11', 'Áå™': 'Z12'
        };
        
        // üîÑ ÂÖºÂÆπÊóß‰ª£Á†ÅÔºà‰øùÁïô SANITIZE_MAP ÂèòÈáèÂêçÔºåÈÅøÂÖçÁ†¥ÂùèÂÖ∂‰ªñÂºïÁî®Ôºâ
        const SANITIZE_MAP = ZODIAC_TO_CODE;
        
        // ËøòÂéüÊò†Â∞ÑË°®ÔºàZ‰ª£Âè∑ ‚Üí ‰∏≠ÊñáÁîüËÇñÔºâ
        const CODE_TO_ZODIAC = {};
        for (const [zodiac, code] of Object.entries(ZODIAC_TO_CODE)) {
            CODE_TO_ZODIAC[code] = zodiac;
        }
        
        // ÂÖºÂÆπÊóß‰ª£Á†Å
        const RESTORE_MAP = CODE_TO_ZODIAC;
        
        // Ëé∑ÂèñÊåâÈïøÂ∫¶ÈôçÂ∫èÊéíÂàóÁöÑÈîÆÔºàÈÅøÂÖç Z1 ÂÖà‰∫é Z10 ÂåπÈÖçÔºâ
        const ZODIAC_KEYS_SORTED = Object.keys(ZODIAC_TO_CODE).sort((a, b) => b.length - a.length);
        const CODE_KEYS_SORTED = Object.keys(CODE_TO_ZODIAC).sort((a, b) => b.length - a.length);
        
        // ÂÖºÂÆπÊóß‰ª£Á†Å
        const SANITIZE_KEYS_SORTED = ZODIAC_KEYS_SORTED;
        const RESTORE_KEYS_SORTED = CODE_KEYS_SORTED;
        
        /**
         * ËΩ¨‰πâÊ≠£ÂàôÁâπÊÆäÂ≠óÁ¨¶
         */
        function escapeRegex(str) {
            return str.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }
        
        /**
         * üÜï v3.11.12 ËÆ°ÁÆóÊñáÊú¨‰∏≠ÁöÑÁîüËÇñÊï∞Èáè
         * Áî®‰∫é "Âπ≥ÁâπÁå¥È∏°ÂêÑ200" ËøôÁ±ªËæìÂÖ•ÔºåÊ≠£Á°ÆËØÜÂà´Ê≥®Êï∞ÔºàÊØè‰∏™ÁîüËÇñ=1Ê≥®Ôºâ
         * @param {string} text ÊòæÁ§∫ÊñáÊú¨
         * @returns {number} ÁîüËÇñÊï∞Èáè
         */
        function countZodiacsInText(text) {
            if (!text) return 0;
            const zodiacs = ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'];
            let count = 0;
            for (const z of zodiacs) {
                if (text.includes(z)) count++;
            }
            return count;
        }
        
        /**
         * ËæìÂÖ•Ê†áÂáÜÂåñÂáΩÊï∞
         * üÜï v3.11.6 Â§ÑÁêÜÈ°∫Â∫èÔºöÂêå‰πâËØçÊ†áÂáÜÂåñ ‚Üí Ëá™ÂÆö‰πâËßÑÂàô ‚Üí ÁîüËÇñ‰ª£Âè∑ËΩ¨Êç¢
         * @param {string} text ÂéüÂßãÊñáÊú¨
         * @returns {string} Ê†áÂáÜÂåñÂêéÁöÑÊñáÊú¨
         */
        function sanitizeText(text) {
            if (!text) return text;
            let result = text;
            
            // üÜï v3.11.6 Á¨¨1Ê≠•ÔºöÂêå‰πâËØçÊ†áÂáÜÂåñÔºà6ËÇñ‚ÜíÂÖ≠ËÇñ„ÄÅ2Âèã‚Üí‰∫åÂèã Á≠âÔºâ
            for (const key of SYNONYM_KEYS_SORTED) {
                if (result.includes(key)) {
                    result = result.split(key).join(SYNONYM_MAP[key]);
                }
            }
            
            // üÜï v3.4 Á¨¨2Ê≠•ÔºöÂ∫îÁî®Ëá™ÂÆö‰πâËßÑÂàôÔºàÂÖ≥ÈîÆËØç‚Üí‰ª£Âè∑Êò†Â∞ÑÔºâ
            const rules = getCustomRules();
            if (rules && rules.length > 0) {
                const sortedRules = [...rules].sort((a, b) => b.keyword.length - a.keyword.length);
                for (const rule of sortedRules) {
                    if (result.includes(rule.keyword)) {
                        if (rule.expand && rule.numbers && rule.numbers.length > 0) {
                            const expandRegex = new RegExp(
                                escapeRegex(rule.keyword) + '\\s*[ÂêÑÊØèÁªü]?\\s*(\\d+)',
                                'gi'
                            );
                            result = result.replace(expandRegex, (match, amountStr) => {
                                let amount = parseInt(amountStr);
                                if (rule.amountMode === 'total') {
                                    amount = Math.floor(amount / rule.numbers.length);
                                }
                                console.log(`üéØ Ëá™ÂÆö‰πâËßÑÂàôÂ±ïÂºÄ: "${rule.keyword}" ‚Üí ${rule.numbers.length}Êù°`);
                                return rule.numbers.map(num => `${rule.type} ${num} ${amount}`).join('\n');
                            });
                        } else {
                            result = result.split(rule.keyword).join(rule.type);
                            console.log(`üéØ Ëá™ÂÆö‰πâËßÑÂàô: "${rule.keyword}" ‚Üí "${rule.type}"`);
                        }
                    }
                }
            }
            
            // üÜï v3.11.4 Á¨¨3Ê≠•ÔºöÁîüËÇñ‚ÜíZ‰ª£Âè∑ËΩ¨Êç¢ÔºàÂêéÁ´ØÊ≠£ÂàôÂåπÈÖç‰æùËµñ Z\d{1,2} Ê†ºÂºèÔºâ
            for (const zodiac of ZODIAC_KEYS_SORTED) {
                result = result.split(zodiac).join(ZODIAC_TO_CODE[zodiac]);
            }
            
            if (text !== result) {
                console.log('üîÑ ËæìÂÖ•Ê†áÂáÜÂåñ:', text.substring(0, 30), '‚Üí', result.substring(0, 30));
            }
            return result;
        }
        
        /**
         * ‰ª£Âè∑ËøòÂéüÂáΩÊï∞
         * Â∞Ü Z ‰ª£Âè∑ËøòÂéü‰∏∫‰∏≠ÊñáÁîüËÇñÔºàÁî®‰∫éÊòæÁ§∫Ôºâ
         * @param {string} text Z‰ª£Âè∑Ê†ºÂºèÁöÑÊñáÊú¨
         * @returns {string} ËøòÂéüÂêéÁöÑ‰∏≠ÊñáÊñáÊú¨
         */
        function restoreText(text) {
            if (!text) return text;
            let result = text;
            
            for (const code of CODE_KEYS_SORTED) {
                result = result.split(code).join(CODE_TO_ZODIAC[code]);
            }
            
            return result;
        }
        
        /**
         * ËøòÂéüAIËøîÂõûÁöÑÁªìÊûúÊï∞ÁªÑ
         * @param {Array} aiResult AIËøîÂõûÁöÑÊï∞ÁªÑÔºåÊîØÊåÅ‰∏§ÁßçÊ†ºÂºèÔºö
         *   - ÊóßÁâà: [["Á±ªÂûã","ÂéüÊñá"], ...]
         *   - Êñ∞Áâà(Function Calling): [{code, original, numbers, amount}, ...]
         * @returns {Array} Áªü‰∏ÄÊ†ºÂºèÁöÑÊï∞ÁªÑ [[code, original, numbers?, amount?, zodiac_code?], ...]
         */
        function restoreAIResult(aiResult) {
            if (!Array.isArray(aiResult)) return aiResult;
            
            return aiResult.map(item => {
                // üÜï Êñ∞Áâà Function Calling Ê†ºÂºèÔºàÂØπË±°Ôºâ
                if (item && typeof item === 'object' && !Array.isArray(item)) {
                    const code = item.code || 'UK';
                    const original = restoreText(item.original || '');
                    const numbers = item.numbers || null;
                    const amount = item.amount || null;
                    const zodiacCode = item.zodiac_code || null;
                    // ËøîÂõûÊâ©Â±ïÊï∞ÁªÑÊ†ºÂºè: [code, original, numbers, amount, zodiac_code]
                    return [code, original, numbers, amount, zodiacCode];
                }
                // ÊóßÁâàÊ†ºÂºèÔºàÊï∞ÁªÑÔºâ
                if (Array.isArray(item) && item.length >= 2) {
                    return [item[0], restoreText(item[1])];
                }
                return item;
            });
        }
        
        /**
         * JSON‰øÆÂ§çÂáΩÊï∞Ôºö‰øÆÂ§çAIËæìÂá∫ÁöÑÂ∏∏ËßÅÊ†ºÂºèÈîôËØØ
         * @param {string} str AIËøîÂõûÁöÑÂéüÂßãÂ≠óÁ¨¶‰∏≤
         * @returns {string} ‰øÆÂ§çÂêéÁöÑJSONÂ≠óÁ¨¶‰∏≤
         */
        function repairJSON(str) {
            if (!str) return str;
            let result = str.trim();
            
            // 1. ÁßªÈô§markdown‰ª£Á†ÅÂùó
            result = result.replace(/```json?\n?/g, '').replace(/```/g, '');
            
            // 2. ÊèêÂèñJSONÊï∞ÁªÑÔºàÁßªÈô§ÂâçÂêéÁöÑËß£ÈáäÊñáÂ≠óÔºâ
            const jsonMatch = result.match(/\[[\s\S]*\]/);
            if (jsonMatch) {
                result = jsonMatch[0];
            }
            
            // 3. ‰øÆÂ§çÂ∞æÈÉ®ÈÄóÂè∑ [["a","b"],] ‚Üí [["a","b"]]
            result = result.replace(/,(\s*[\]\}])/g, '$1');
            
            // 4. ‰øÆÂ§çÁº∫Â§±ÂºïÂè∑ÁöÑÁ±ªÂûã [[TM,"xxx"]] ‚Üí [["TM","xxx"]]
            result = result.replace(/\[([A-Z][A-Z0-9]*),/g, '["$1",');
            
            // 5. ‰øÆÂ§çÂçïÂºïÂè∑ [['TM','xxx']] ‚Üí [["TM","xxx"]]
            result = result.replace(/'/g, '"');
            
            return result;
        }
        
        /**
         * Ê†°È™åAIËøîÂõûÁªìÊûúÁöÑÊ†ºÂºè
         * @param {Array} data Ëß£ÊûêÂêéÁöÑÊï∞ÊçÆÔºåÊîØÊåÅ‰∏§ÁßçÊ†ºÂºèÔºö
         *   - ÊóßÁâà: [["Á±ªÂûã","ÂéüÊñá"], ...]
         *   - Êñ∞Áâà(Function Calling): [{code, original, numbers, amount}, ...]
         * @returns {{valid: boolean, error?: string}}
         */
        function validateAIResult(data) {
            const validTypes = [
                'T01', 'TM', 'T', 'SXTM', 'SX', 'BS', 'BB',
                'PT', 'PT1', 'PT2', 'PT3', 'PT4', 'PT5', 'PTW',
                'LX6', 'HX', 'ZX', 'DP', 'DXDS',
                'E2', 'S3', 'BZ5', 'BZ6', 'BZ7', 'BZ8', 'BZ9', 'BZ10', 'BZ11', 'BZ12',
                'LM2Q', 'LM3Q', 'LM2Z', 'LM3Z', 'LMTC',
                'C1', 'C2', 'C3', 'C1S', 'C1D', 'C1B', 'C1X', 'C2S', 'C2D', 'C2B', 'C2X', 'C3S', 'C3D', 'C3B', 'C3X',
                'ZH', 'ZHB', 'ZHX', 'ZHS', 'ZHD',
                'WXJ', 'WXM', 'WXS', 'WXH', 'WXT',
                'JYJ', 'JYY', 'XS', 'DS', 'ODD', 'EVEN',
                // ÂÖºÂÆπÊóß‰ª£Âè∑
                'LX', 'BZ', 'LM', 'WX', 'JY', 'UK'
            ];
            
            if (!Array.isArray(data)) {
                return { valid: false, error: 'ËøîÂõûÂÄº‰∏çÊòØÊï∞ÁªÑ' };
            }
            
            for (let i = 0; i < data.length; i++) {
                const item = data[i];
                let typeCode;
                
                // üÜï ÊîØÊåÅÊñ∞Áâà Function Calling Ê†ºÂºèÔºàÂØπË±°Ôºâ
                if (item && typeof item === 'object' && !Array.isArray(item)) {
                    if (!item.code || !item.original) {
                        return { valid: false, error: `Á¨¨${i+1}È°πÁº∫Â∞ëcodeÊàñoriginalÂ≠óÊÆµ` };
                    }
                    typeCode = item.code;
                }
                // ÊóßÁâàÊ†ºÂºèÔºàÊï∞ÁªÑÔºâ
                else if (Array.isArray(item) && item.length >= 2) {
                    typeCode = item[0];
                }
                else {
                    return { valid: false, error: `Á¨¨${i+1}È°πÊ†ºÂºèÈîôËØØ` };
                }
                
                // Á±ªÂûãÂèØ‰ª•ÊòØÊñ∞‰ª£Âè∑ÊàñÊóß‰ª£Âè∑
                if (!validTypes.includes(typeCode)) {
                    // ‰∏çÊòØ‰∏•Ê†ºÈîôËØØÔºåÂè™ÊòØË≠¶Âëä
                    console.warn(`‚ö†Ô∏è Êú™Áü•Á±ªÂûã‰ª£Âè∑: ${typeCode}ÔºåÂ∞ÜÂ∞ùËØïÂ§ÑÁêÜ`);
                }
            }
            
            return { valid: true };
        }
        
        // ==================== „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊµãËØïÊï∞ÊçÆÂ≠òÂÇ® ====================
        // Â≠òÂÇ®Â§öËΩÆÊµãËØïÁªìÊûú
        let multiRoundTestData = {
            inputContent: '',           // ËæìÂÖ•ÂÜÖÂÆπ
            standardAnswer: '',         // Ê†áÂáÜÁ≠îÊ°à
            totalRounds: 5,             // ÊÄªËΩÆÊï∞
            currentRound: 0,            // ÂΩìÂâçËΩÆÊ¨°
            isRunning: false,           // ÊòØÂê¶Ê≠£Âú®ËøêË°å
            results: []                 // ÊØèËΩÆÁªìÊûú [{ round: 1, models: { deepseek: {...}, ... } }]
        };
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËæπÁºòÊµãËØïÈÖçÁΩÆ
        // ‚ö†Ô∏è ÊØèÊ¨°ÊµãËØïÊñ∞Á±ªÂûãÊó∂‰øÆÊîπËøô‰∏§‰∏™ÂèòÈáèÔºÅ
        const EDGE_TEST_TYPE = 'ÁâπÁ†Å';        // ÂΩìÂâçÊµãËØïÁöÑÁé©Ê≥ïÁ±ªÂûã
        const EDGE_TEST_VERSION = 'V2';       // ÂΩìÂâçÊµãËØïÁâàÊú¨ÔºàV1, V2, V3...Ôºâ
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËæπÁºòÊµãËØïÁî®‰æãÂ∫ì
        // Áî®‰æãÁâàÊú¨: v1.1 | Êõ¥Êñ∞Êó•Êúü: 2025-12-17 | Áî®‰æãÊï∞: 35
        // Êõ¥Êñ∞ÊñπÊ≥ï: Áî®Êà∑ÂèëÊ°à‰æãÁªôAIÔºåAIÁîüÊàêËæπÁºòÂåñÁî®‰æãÊõ¥Êñ∞Ê≠§Êï∞ÁªÑ
        // v1.1Êõ¥Êñ∞: Êñ∞Â¢û3‰∏™Â§öÁîüËÇñËæπÁºòÁî®‰æãÔºà‰π∞ÈæôËôéÂÖîÂêÑ30Á≠âÔºâ
        const EDGE_TEST_CASES_VERSION = 'v1.1';
        const EDGE_TEST_CASES = [
            // Á¨¨‰∏ÄÁªÑÔºöÂàÜÈöîÁ¨¶Âèò‰ΩìÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁâπÁ†ÅÔºâ
            { input: '10,12,20,22ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'ÂàÜÈöîÁ¨¶' },
            { input: '10„ÄÅ12„ÄÅ20„ÄÅ22ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'ÂàÜÈöîÁ¨¶' },
            { input: '10/12/20/22ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'ÂàÜÈöîÁ¨¶' },
            { input: '10-12-20-22ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'ÂàÜÈöîÁ¨¶' },
            { input: '10.12.20.22ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'ÂàÜÈöîÁ¨¶' },
            
            // Á¨¨‰∫åÁªÑÔºöÈáëÈ¢ùÂÖ≥ÈîÆËØçÂèò‰ΩìÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁâπÁ†ÅÔºâ
            { input: '25 36 47ÂêÑ50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47ÊØè‰∏™50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47Áªü‰∏Ä50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47√ó50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47X50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47x50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            { input: '25 36 47*50', answer: 'ÁâπÁ†Å', group: 'ÈáëÈ¢ùÂÖ≥ÈîÆËØç' },
            
            // Á¨¨‰∏âÁªÑÔºö‰∏≠ÊñáÈáëÈ¢ùÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁâπÁ†ÅÔºâ
            { input: '08 18 28ÂêÑ‰∫åÂçÅ', answer: 'ÁâπÁ†Å', group: '‰∏≠ÊñáÈáëÈ¢ù' },
            { input: '31.34ÂêÑ‰∫åÂçÅ', answer: 'ÁâπÁ†Å', group: '‰∏≠ÊñáÈáëÈ¢ù' },
            { input: '08 18 28ÂêÑ20ÂÖÉ', answer: 'ÁâπÁ†Å', group: '‰∏≠ÊñáÈáëÈ¢ù' },
            { input: 'Áâπ43 20ÂÖÉ', answer: 'ÁâπÁ†Å', group: 'ÁâπÂ≠ó' },
            
            // Á¨¨ÂõõÁªÑÔºöÊï∞Â≠óËåÉÂõ¥ÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁâπÁ†ÅÔºâ
            { input: 'Â∞èÊï∞ÂêÑ20', answer: 'ÁâπÁ†Å', group: 'Êï∞Â≠óËåÉÂõ¥' },
            { input: 'Â§ßÊï∞ÂêÑ30', answer: 'ÁâπÁ†Å', group: 'Êï∞Â≠óËåÉÂõ¥' },
            { input: 'ÂçïÊï∞ÂêÑ10', answer: 'ÁâπÁ†Å', group: 'Êï∞Â≠óËåÉÂõ¥' },
            { input: 'ÂèåÊï∞ÂêÑ15', answer: 'ÁâπÁ†Å', group: 'Êï∞Â≠óËåÉÂõ¥' },
            
            // Á¨¨‰∫îÁªÑÔºöÁîüËÇñÁâπÁ†ÅÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁîüËÇñÁâπÁ†ÅÔºâ
            { input: 'Èæôx10', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: 'ÁãóX80', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: '‰π∞Áå™ÂêÑ20', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: '‰π∞ÈæôËôéÂêÑ20', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: 'Áå¥È∏°x50', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: 'Áãóx80ÔºåÁå¥È∏°x50', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            { input: '‰π∞È©¨X50ÂÖÉ', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'ÁîüËÇñÁâπÁ†Å' },
            // V2Êñ∞Â¢ûÔºöÂ§öÁîüËÇñ+‰π∞+ÂêÑ ËæπÁºòÁî®‰æã
            { input: '‰π∞ÈæôËôéÂÖîÂêÑ30', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'Â§öÁîüËÇñ' },
            { input: '‰π∞Èº†ÁâõËôéÂÖîÂêÑ50', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'Â§öÁîüËÇñ' },
            { input: '‰π∞Áå™ÁãóÈ∏°Áå¥ÂêÑ100', answer: 'ÁîüËÇñÁâπÁ†Å', group: 'Â§öÁîüËÇñ' },
            
            // Á¨¨ÂÖ≠ÁªÑÔºöÁîüËÇñÔºàÊ†áÂáÜÁ≠îÊ°àÔºöÁîüËÇñÔºâ
            { input: 'Áå™10', answer: 'ÁîüËÇñ', group: 'ÁîüËÇñ' },
            
            // Á¨¨‰∏ÉÁªÑÔºöÊ∑∑ÂêàÊûÅÁ´ØÂèò‰Ωì
            { input: '01 02 03ÂêÑ‰∫åÂçÅÂÖÉ', answer: 'ÁâπÁ†Å', group: 'Ê∑∑ÂêàÊûÅÁ´Ø' },
            { input: '10 12 20 22 23 25 33 40 43 44 30ÂêÑ20', answer: 'ÁâπÁ†Å', group: 'Ê∑∑ÂêàÊûÅÁ´Ø' },
            { input: '06.18.42ÂêÑ20', answer: 'ÁâπÁ†Å', group: 'Ê∑∑ÂêàÊûÅÁ´Ø' },
            { input: '39X200', answer: 'ÁâπÁ†Å', group: 'Ê∑∑ÂêàÊûÅÁ´Ø' }
        ];
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËæπÁºòÊµãËØïÁªìÊûúÂ≠òÂÇ®
        let edgeTestResults = {
            isRunning: false,
            currentCase: 0,
            totalCases: 0,
            results: []  // [{ input, answer, models: { deepseek: {...}, ... } }]
        };
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËøêË°åËæπÁºòÊµãËØï
        async function runEdgeCaseTest() {
            if (edgeTestResults.isRunning) {
                alert('ÊµãËØïÊ≠£Âú®ËøõË°å‰∏≠ÔºåËØ∑Á≠âÂæÖ...');
                return;
            }
            
            const confirmed = confirm(`Âç≥Â∞ÜËøêË°å ${EDGE_TEST_CASES.length} ‰∏™ËæπÁºòÊµãËØïÁî®‰æãÔºåÊØè‰∏™Áî®‰æãÊµãËØï5‰∏™Ê®°Âûã„ÄÇ\nÈ¢ÑËÆ°ËÄóÊó∂Á∫¶ ${Math.ceil(EDGE_TEST_CASES.length * 5 / 60)} ÂàÜÈíü„ÄÇ\n\nÊòØÂê¶ÁªßÁª≠Ôºü`);
            if (!confirmed) return;
            
            // ÂàùÂßãÂåñ
            edgeTestResults = {
                isRunning: true,
                currentCase: 0,
                totalCases: EDGE_TEST_CASES.length,
                results: []
            };
            
            // ÊòæÁ§∫ÂºπÁ™ó
            document.getElementById('multi-model-modal').style.display = 'flex';
            document.getElementById('test-progress').style.display = 'inline';
            document.getElementById('export-btn').style.display = 'none';
            document.getElementById('edge-test-btn').disabled = true;
            document.getElementById('edge-test-btn').textContent = 'üß™ ÊµãËØï‰∏≠...';
            
            // Êõ¥Êñ∞Á´ôÁÇπ‰ø°ÊÅØ
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl) {
                siteInfoEl.textContent = 'ËæπÁºòÊµãËØïËøõË°å‰∏≠...';
            }
            
            // ÈÄê‰∏™ÊµãËØïÁî®‰æã
            for (let i = 0; i < EDGE_TEST_CASES.length; i++) {
                const testCase = EDGE_TEST_CASES[i];
                edgeTestResults.currentCase = i + 1;
                
                // Êõ¥Êñ∞ËøõÂ∫¶
                document.getElementById('test-progress').textContent = `Áî®‰æã ${i + 1}/${EDGE_TEST_CASES.length}: ${testCase.group}`;
                
                // ËÆæÁΩÆËæìÂÖ•Ê°ÜÂÜÖÂÆπÔºàËß¶ÂèëÊµãËØïÔºâ
                document.getElementById('bet-input').value = testCase.input;
                
                // ËøêË°åÂ§öÊ®°ÂûãÊµãËØï
                await runMultiModelTest();
                
                // ‰øùÂ≠òÁªìÊûú
                const caseResult = {
                    input: testCase.input,
                    answer: testCase.answer,
                    group: testCase.group,
                    models: {}
                };
                
                for (const [modelKey, result] of Object.entries(multiModelResults)) {
                    const aiItems = result.aiItems || [];
                    const firstItem = aiItems[0] || {};
                    const typeOutput = firstItem.type || '(Ëß£ÊûêÂ§±Ë¥•)';
                    caseResult.models[modelKey] = {
                        ËÄóÊó∂: result.time,
                        Ê†ºÂºèÊ≠£Á°Æ: result.status === 'success' || result.status === 'warning',
                        Á±ªÂûãËæìÂá∫: typeOutput,
                        ÁêÜÁî±‰ª£Á†Å: firstItem.r || '',
                        ÂáÜÁ°Æ: typeOutput === testCase.answer
                    };
                }
                
                edgeTestResults.results.push(caseResult);
                
                // Áü≠ÊöÇÂª∂ËøüÔºåÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                if (i < EDGE_TEST_CASES.length - 1) {
                    await new Promise(r => setTimeout(r, 800));
                }
            }
            
            // ÊµãËØïÂÆåÊàê
            edgeTestResults.isRunning = false;
            document.getElementById('edge-test-btn').disabled = false;
            document.getElementById('edge-test-btn').textContent = 'üß™ ËæπÁºòÊµãËØï';
            document.getElementById('test-progress').textContent = `‚úÖ ÂÆåÊàê ${EDGE_TEST_CASES.length} Áî®‰æã`;
            document.getElementById('export-btn').style.display = 'inline';
            document.getElementById('export-btn').onclick = exportEdgeTestReport;
            
            // ÊòæÁ§∫Ê±áÊÄª
            showEdgeTestSummary();
            console.log('üìä ËæπÁºòÊµãËØïÂÆåÊàê:', edgeTestResults);
            
            // Ëá™Âä®‰∏ãËΩΩJSONÂéÜÂè≤ËÆ∞ÂΩï
            autoExportEdgeTestJSON();
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËá™Âä®ÂØºÂá∫ËæπÁºòÊµãËØïJSONÔºàÂéÜÂè≤ËÆ∞ÂΩïÔºâ
        function autoExportEdgeTestJSON() {
            const jsonData = {
                ÊµãËØïÁ±ªÂûã: 'ËæπÁºòÊµãËØï',
                ÁâàÊú¨‰ø°ÊÅØ: {
                    Á®ãÂ∫èÁâàÊú¨: 'v1.9.0',
                    ÊèêÁ§∫ËØçÁâàÊú¨: 'v2.0',
                    ÊµãËØïÁî®‰æãÁâàÊú¨: 'v1.0'
                },
                ÊµãËØïÊó∂Èó¥: new Date().toISOString(),
                Á´ôÁÇπ: tuziSiteManager.getCurrentName(),
                Áî®‰æãÊÄªÊï∞: EDGE_TEST_CASES.length,
                ÊµãËØïÁî®‰æã: EDGE_TEST_CASES,
                ÊµãËØïÁªìÊûú: edgeTestResults.results,
                Ê®°ÂûãÊ±áÊÄª: calculateEdgeTestStats()
            };
            
            const blob = new Blob([JSON.stringify(jsonData, null, 2)], { type: 'application/json' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊñá‰ª∂ÂêçÊ†ºÂºèÔºöÁ±ªÂûã_ÁâàÊú¨_ËæπÁºòÊµãËØïÂéÜÂè≤_Êó•Êúü.json
            link.download = `${EDGE_TEST_TYPE}_${EDGE_TEST_VERSION}_ËæπÁºòÊµãËØïÂéÜÂè≤_${new Date().toISOString().slice(0, 10)}.json`;
            link.click();
            
            console.log(`üìÅ Â∑≤Ëá™Âä®ÂØºÂá∫JSON: ${EDGE_TEST_TYPE}_${EDGE_TEST_VERSION}`);
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËÆ°ÁÆóËæπÁºòÊµãËØïÁªüËÆ°
        function calculateEdgeTestStats() {
            const models = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            const modelNames = { deepseek: 'DeepSeek', qwen: 'ÈÄö‰πâÂçÉÈóÆ', tuzi: 'Gemini', claude: 'Claude', gpt: 'GPT4o' };
            
            const stats = {};
            models.forEach(m => {
                let Ê≠£Á°Æ = 0, ÊÄªËÄóÊó∂ = 0;
                edgeTestResults.results.forEach(r => {
                    if (r.models[m]?.ÂáÜÁ°Æ) Ê≠£Á°Æ++;
                    ÊÄªËÄóÊó∂ += r.models[m]?.ËÄóÊó∂ || 0;
                });
                stats[m] = {
                    Ê®°ÂûãÂêçÁß∞: modelNames[m],
                    Ê≠£Á°ÆÊï∞: Ê≠£Á°Æ,
                    ÊÄªÊï∞: edgeTestResults.results.length,
                    ÂáÜÁ°ÆÁéá: Math.round(Ê≠£Á°Æ / edgeTestResults.results.length * 100) + '%',
                    Âπ≥ÂùáËÄóÊó∂: Math.round(ÊÄªËÄóÊó∂ / edgeTestResults.results.length) + 'ms'
                };
            });
            
            return stats;
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊòæÁ§∫ËæπÁºòÊµãËØïÊ±áÊÄª
        function showEdgeTestSummary() {
            const models = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            const modelNames = { deepseek: 'DS', qwen: 'ÂçÉÈóÆ', tuzi: 'Gem', claude: 'Cld', gpt: 'GPT' };
            
            // ÁªüËÆ°ÊØè‰∏™Ê®°ÂûãÁöÑÂáÜÁ°ÆÁéá
            const stats = {};
            models.forEach(m => {
                stats[m] = { Ê≠£Á°Æ: 0, ÊÄªÊï∞: edgeTestResults.results.length };
            });
            
            edgeTestResults.results.forEach(result => {
                models.forEach(m => {
                    if (result.models[m]?.ÂáÜÁ°Æ) {
                        stats[m].Ê≠£Á°Æ++;
                    }
                });
            });
            
            // ÊéíÂ∫è
            const ranking = models.map(m => ({
                key: m,
                name: modelNames[m],
                Ê≠£Á°Æ: stats[m].Ê≠£Á°Æ,
                ÊÄªÊï∞: stats[m].ÊÄªÊï∞,
                ÂáÜÁ°ÆÁéá: Math.round(stats[m].Ê≠£Á°Æ / stats[m].ÊÄªÊï∞ * 100) + '%'
            })).sort((a, b) => b.Ê≠£Á°Æ - a.Ê≠£Á°Æ);
            
            // ÊòæÁ§∫Âú®Á´ôÁÇπ‰ø°ÊÅØÂå∫
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl) {
                const best = ranking[0];
                siteInfoEl.innerHTML = `
                    <span style="color:#4ade80;">üèÜ ${best.name} ${best.ÂáÜÁ°ÆÁéá}(${best.Ê≠£Á°Æ}/${best.ÊÄªÊï∞})</span>
                    <span style="margin-left:6px;color:#888;">ÂÖ±${edgeTestResults.results.length}Áî®‰æã</span>
                `;
            }
            
            // Âú®Ê†áÈ¢ò‰∏≠ÊòæÁ§∫ËØ¶ÁªÜÁªìÊûú
            const modalTitle = document.querySelector('#multi-model-modal .modal-title');
            if (modalTitle) {
                modalTitle.innerHTML = `
                    ËæπÁºòÊµãËØïÂÆåÊàê | 
                    ${ranking.map(r => `<span style="color:${r.Ê≠£Á°Æ === r.ÊÄªÊï∞ ? '#4ade80' : '#f87171'}">${r.name}:${r.ÂáÜÁ°ÆÁéá}</span>`).join(' ')}
                `;
            }
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÂØºÂá∫ËæπÁºòÊµãËØïÊä•Âëä
        function exportEdgeTestReport() {
            if (edgeTestResults.results.length === 0) {
                alert('Ê≤°ÊúâÊµãËØïÁªìÊûúÂèØÂØºÂá∫');
                return;
            }
            
            const models = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            const modelFullNames = { deepseek: 'DeepSeek', qwen: 'ÈÄö‰πâÂçÉÈóÆ', tuzi: 'Gemini', claude: 'Claude', gpt: 'GPT4o' };
            const modelShortNames = { deepseek: 'DS', qwen: 'ÂçÉÈóÆ', tuzi: 'Gem', claude: 'Cld', gpt: 'GPT' };
            
            let csv = '';
            
            // ÊµãËØï‰ø°ÊÅØ
            csv += '===== ËæπÁºòÊµãËØïÊä•Âëä =====\n';
            csv += `ÊµãËØïÊó∂Èó¥,${new Date().toLocaleString()}\n`;
            csv += `ÊµãËØïÁî®‰æãÊï∞,${edgeTestResults.results.length}\n`;
            csv += `Á´ôÁÇπ,${tuziSiteManager.getCurrentName()}\n\n`;
            
            // Ê®°ÂûãËØÑÂàÜÊ±áÊÄª
            csv += '===== Ê®°ÂûãËØÑÂàÜÊ±áÊÄª =====\n';
            csv += 'ÊéíÂêç,Ê®°Âûã,Ê≠£Á°ÆÊï∞,ÊÄªÊï∞,ÂáÜÁ°ÆÁéá\n';
            
            const stats = {};
            models.forEach(m => {
                stats[m] = { Ê≠£Á°Æ: 0, ÊÄªÊï∞: edgeTestResults.results.length };
            });
            edgeTestResults.results.forEach(result => {
                models.forEach(m => {
                    if (result.models[m]?.ÂáÜÁ°Æ) {
                        stats[m].Ê≠£Á°Æ++;
                    }
                });
            });
            
            const ranking = models.map(m => ({
                key: m,
                name: modelShortNames[m],
                Ê≠£Á°Æ: stats[m].Ê≠£Á°Æ,
                ÊÄªÊï∞: stats[m].ÊÄªÊï∞,
                ÂáÜÁ°ÆÁéá: Math.round(stats[m].Ê≠£Á°Æ / stats[m].ÊÄªÊï∞ * 100) + '%'
            })).sort((a, b) => b.Ê≠£Á°Æ - a.Ê≠£Á°Æ);
            
            ranking.forEach((r, i) => {
                csv += `${i + 1},${r.name},${r.Ê≠£Á°Æ},${r.ÊÄªÊï∞},${r.ÂáÜÁ°ÆÁéá}\n`;
            });
            csv += '\n';
            
            // ÂàÜÁªÑÁªüËÆ°
            csv += '===== ÂàÜÁªÑÁªüËÆ° =====\n';
            csv += 'ÂàÜÁªÑ,Áî®‰æãÊï∞,' + models.map(m => modelShortNames[m] + 'Ê≠£Á°Æ').join(',') + '\n';
            
            const groups = [...new Set(EDGE_TEST_CASES.map(c => c.group))];
            groups.forEach(group => {
                const groupResults = edgeTestResults.results.filter(r => r.group === group);
                const groupStats = models.map(m => groupResults.filter(r => r.models[m]?.ÂáÜÁ°Æ).length);
                csv += `${group},${groupResults.length},${groupStats.join(',')}\n`;
            });
            csv += '\n';
            
            // ËØ¶ÁªÜÁªìÊûú
            csv += '===== ËØ¶ÁªÜÁªìÊûú =====\n';
            csv += 'Â∫èÂè∑,ÂàÜÁªÑ,ËæìÂÖ•ÂÜÖÂÆπ,Ê†áÂáÜÁ≠îÊ°à,' + models.map(m => `${modelShortNames[m]}ËæìÂá∫`).join(',') + ',' + models.map(m => `${modelShortNames[m]}Ê≠£Á°Æ`).join(',') + '\n';
            
            edgeTestResults.results.forEach((result, i) => {
                const outputs = models.map(m => result.models[m]?.Á±ªÂûãËæìÂá∫ || '');
                const corrects = models.map(m => result.models[m]?.ÂáÜÁ°Æ ? '‚úì' : '‚úó');
                csv += `${i + 1},"${result.group}","${result.input.replace(/"/g, '""')}",${result.answer},${outputs.join(',')},${corrects.join(',')}\n`;
            });
            csv += '\n';
            
            // ÈîôËØØÁî®‰æãËØ¶ÊÉÖ
            csv += '===== ÈîôËØØÁî®‰æãËØ¶ÊÉÖ =====\n';
            csv += 'Â∫èÂè∑,ËæìÂÖ•ÂÜÖÂÆπ,Ê†áÂáÜÁ≠îÊ°à,ÈîôËØØÊ®°Âûã,Ê®°ÂûãËæìÂá∫,ÁêÜÁî±‰ª£Á†Å\n';
            
            let errorIndex = 0;
            edgeTestResults.results.forEach(result => {
                models.forEach(m => {
                    if (!result.models[m]?.ÂáÜÁ°Æ) {
                        errorIndex++;
                        csv += `${errorIndex},"${result.input.replace(/"/g, '""')}",${result.answer},${modelShortNames[m]},${result.models[m]?.Á±ªÂûãËæìÂá∫ || ''},${result.models[m]?.ÁêÜÁî±‰ª£Á†Å || ''}\n`;
                    }
                });
            });
            
            // ‰∏ãËΩΩ
            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊñá‰ª∂ÂêçÊ†ºÂºèÔºöÁ±ªÂûã_ÁâàÊú¨_ËæπÁºòÊµãËØïÊä•Âëä_Êó•Êúü.csv
            link.download = `${EDGE_TEST_TYPE}_${EDGE_TEST_VERSION}_ËæπÁºòÊµãËØïÊä•Âëä_${new Date().toISOString().slice(0, 10)}.csv`;
            link.click();
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËøêË°åÂ§öËΩÆÊµãËØï
        async function runMultiRoundTest(rounds = 5) {
            const input = document.getElementById('bet-input').value.trim();
            const standardAnswer = document.getElementById('standard-answer').value;
            
            if (!input) {
                alert('ËØ∑ÂÖàËæìÂÖ•‰∏ãÊ≥®ÂÜÖÂÆπ');
                return;
            }
            if (!standardAnswer) {
                alert('ËØ∑ÈÄâÊã©Ê†áÂáÜÁ≠îÊ°àÔºåÁî®‰∫éËØÑ‰º∞Ê®°ÂûãÂáÜÁ°ÆÁéá');
                return;
            }
            
            // ÂàùÂßãÂåñÊµãËØïÊï∞ÊçÆ
            multiRoundTestData = {
                inputContent: input,
                standardAnswer: standardAnswer,
                totalRounds: rounds,
                currentRound: 0,
                isRunning: true,
                results: []
            };
            
            // ÊòæÁ§∫ËøõÂ∫¶
            document.getElementById('test-progress').style.display = 'inline';
            document.getElementById('export-btn').style.display = 'none';
            
            // ËøêË°åÂ§öËΩÆÊµãËØï
            for (let i = 1; i <= rounds; i++) {
                multiRoundTestData.currentRound = i;
                document.getElementById('test-progress').textContent = `ËøõÂ∫¶: ${i}/${rounds}`;
                
                // ËøêË°åÂçïËΩÆÊµãËØï
                await runMultiModelTest();
                
                // ‰øùÂ≠òÊú¨ËΩÆÁªìÊûú
                const roundResult = {
                    round: i,
                    timestamp: new Date().toISOString(),
                    models: {}
                };
                
                for (const [modelKey, result] of Object.entries(multiModelResults)) {
                    const aiItems = result.aiItems || [];
                    const firstItem = aiItems[0] || {};
                    roundResult.models[modelKey] = {
                        ËÄóÊó∂: result.time,
                        Ê†ºÂºèÊ≠£Á°Æ: result.status === 'success' || result.status === 'warning',
                        Á±ªÂûãËæìÂá∫: firstItem.type || '(Ëß£ÊûêÂ§±Ë¥•)',
                        ÁêÜÁî±‰ª£Á†Å: firstItem.r || '',
                        ÂáÜÁ°Æ: firstItem.type === standardAnswer,
                        ÂéüÂßãËæìÂá∫: result.raw?.substring(0, 200) || ''
                    };
                }
                
                multiRoundTestData.results.push(roundResult);
                
                // Á≠âÂæÖ‰∏ÄÂ∞èÊÆµÊó∂Èó¥ÔºåÈÅøÂÖçËØ∑Ê±ÇËøáÂø´
                if (i < rounds) {
                    await new Promise(r => setTimeout(r, 1000));
                }
            }
            
            multiRoundTestData.isRunning = false;
            document.getElementById('test-progress').textContent = `‚úÖ ÂÆåÊàê ${rounds}ËΩÆ`;
            document.getElementById('export-btn').style.display = 'inline';
            
            // ÊòæÁ§∫Ê±áÊÄª
            showTestSummary();
            console.log('üìä Â§öËΩÆÊµãËØïÂÆåÊàê:', multiRoundTestData);
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊòæÁ§∫ÊµãËØïÊ±áÊÄª
        function showTestSummary() {
            const summary = calculateTestSummary();
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl) {
                const bestModel = summary.ranking[0];
                siteInfoEl.innerHTML = `
                    <span style="color:#4ade80;">üèÜ ${bestModel.name} ÂáÜÁ°ÆÁéá${bestModel.ÂáÜÁ°ÆÁéá}</span>
                    <span style="margin-left:6px;color:#888;">Á´ôÁÇπ:${tuziSiteManager.getCurrentName()}</span>
                `;
            }
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëËÆ°ÁÆóÊµãËØïÊ±áÊÄª
        function calculateTestSummary() {
            const models = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            const modelNames = { deepseek: 'DS', qwen: 'ÂçÉÈóÆ', tuzi: 'Gem', claude: 'Cld', gpt: 'GPT' };
            
            const stats = {};
            models.forEach(m => {
                stats[m] = { name: modelNames[m], ÊÄªËÄóÊó∂: 0, Ê†ºÂºèÊ≠£Á°Æ: 0, Á±ªÂûãÊ≠£Á°Æ: 0, ÂáÜÁ°Æ: 0, ËΩÆÊï∞: 0 };
            });
            
            // ÁªüËÆ°ÊØè‰∏™Ê®°ÂûãÁöÑË°®Áé∞
            for (const round of multiRoundTestData.results) {
                for (const [modelKey, result] of Object.entries(round.models)) {
                    if (stats[modelKey]) {
                        stats[modelKey].ËΩÆÊï∞++;
                        stats[modelKey].ÊÄªËÄóÊó∂ += result.ËÄóÊó∂ || 0;
                        if (result.Ê†ºÂºèÊ≠£Á°Æ) stats[modelKey].Ê†ºÂºèÊ≠£Á°Æ++;
                        if (result.Á±ªÂûãËæìÂá∫ && result.Á±ªÂûãËæìÂá∫ !== '(Ëß£ÊûêÂ§±Ë¥•)' && result.Á±ªÂûãËæìÂá∫ !== 'Áé©Ê≥ï') {
                            stats[modelKey].Á±ªÂûãÊ≠£Á°Æ++;
                        }
                        if (result.ÂáÜÁ°Æ) stats[modelKey].ÂáÜÁ°Æ++;
                    }
                }
            }
            
            // ËÆ°ÁÆóÁôæÂàÜÊØîÂíåÊéíÂêç
            const ranking = models.map(m => {
                const s = stats[m];
                const rounds = s.ËΩÆÊï∞ || 1;
                return {
                    key: m,
                    name: s.name,
                    Âπ≥ÂùáËÄóÊó∂: (s.ÊÄªËÄóÊó∂ / rounds / 1000).toFixed(1) + 's',
                    Ê†ºÂºèÊ≠£Á°ÆÁéá: Math.round(s.Ê†ºÂºèÊ≠£Á°Æ / rounds * 100) + '%',
                    Á±ªÂûãÊ≠£Á°ÆÁéá: Math.round(s.Á±ªÂûãÊ≠£Á°Æ / rounds * 100) + '%',
                    ÂáÜÁ°ÆÁéá: Math.round(s.ÂáÜÁ°Æ / rounds * 100) + '%',
                    ÂáÜÁ°ÆÊï∞: s.ÂáÜÁ°Æ,
                    ÁªºÂêàÂàÜ: s.ÂáÜÁ°Æ * 3 + s.Á±ªÂûãÊ≠£Á°Æ * 2 + s.Ê†ºÂºèÊ≠£Á°Æ - (s.ÊÄªËÄóÊó∂ / rounds / 1000)
                };
            }).sort((a, b) => b.ÁªºÂêàÂàÜ - a.ÁªºÂêàÂàÜ);
            
            return { stats, ranking };
        }
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÂØºÂá∫CSVÊä•Âëä
        function exportTestReport() {
            if (multiRoundTestData.results.length === 0) {
                alert('Ê≤°ÊúâÊµãËØïÊï∞ÊçÆÂèØÂØºÂá∫');
                return;
            }
            
            const summary = calculateTestSummary();
            
            // ÁîüÊàêCSVÂÜÖÂÆπ
            let csv = '\ufeff';  // BOM for Excel
            
            // ÊµãËØï‰ø°ÊÅØ
            csv += '===== ÊµãËØï‰ø°ÊÅØ =====\n';
            csv += `ÊµãËØïÊó∂Èó¥,${new Date().toLocaleString()}\n`;
            csv += `ËæìÂÖ•ÂÜÖÂÆπ,"${multiRoundTestData.inputContent.replace(/"/g, '""')}"\n`;
            csv += `Ê†áÂáÜÁ≠îÊ°à,${multiRoundTestData.standardAnswer}\n`;
            csv += `ÊµãËØïËΩÆÊï∞,${multiRoundTestData.totalRounds}\n`;
            csv += `Á´ôÁÇπ,${tuziSiteManager.getCurrentName()}\n\n`;
            
            // Ê±áÊÄªË°®
            csv += '===== Ê®°ÂûãËØÑÂàÜÊ±áÊÄª =====\n';
            csv += 'ÊéíÂêç,Ê®°Âûã,Âπ≥ÂùáËÄóÊó∂,Ê†ºÂºèÊ≠£Á°ÆÁéá,Á±ªÂûãÊ≠£Á°ÆÁéá,ÂáÜÁ°ÆÁéá,ÁªºÂêàËØÑÂàÜ\n';
            summary.ranking.forEach((m, i) => {
                const stars = m.ÂáÜÁ°ÆÁéá === '100%' ? '‚≠ê‚≠ê‚≠ê‚≠ê‚≠ê' : 
                            m.ÂáÜÁ°ÆÁéá >= '80%' ? '‚≠ê‚≠ê‚≠ê‚≠ê' :
                            m.ÂáÜÁ°ÆÁéá >= '60%' ? '‚≠ê‚≠ê‚≠ê' :
                            m.ÂáÜÁ°ÆÁéá >= '40%' ? '‚≠ê‚≠ê' : '‚≠ê';
                csv += `${i+1},${m.name},${m.Âπ≥ÂùáËÄóÊó∂},${m.Ê†ºÂºèÊ≠£Á°ÆÁéá},${m.Á±ªÂûãÊ≠£Á°ÆÁéá},${m.ÂáÜÁ°ÆÁéá},${stars}\n`;
            });
            csv += '\n';
            
            // ÊòéÁªÜË°®
            csv += '===== ËØ¶ÁªÜÁªìÊûú =====\n';
            csv += 'ËΩÆÊ¨°,Ê®°Âûã,ËÄóÊó∂(ms),Ê†ºÂºèÊ≠£Á°Æ,Á±ªÂûãËæìÂá∫,ÁêÜÁî±‰ª£Á†Å,ÂáÜÁ°Æ\n';
            for (const round of multiRoundTestData.results) {
                for (const [modelKey, result] of Object.entries(round.models)) {
                    const modelName = { deepseek: 'DeepSeek', qwen: 'ÈÄö‰πâÂçÉÈóÆ', tuzi: 'Gemini', claude: 'Claude', gpt: 'GPT4o' }[modelKey];
                    csv += `${round.round},${modelName},${result.ËÄóÊó∂},${result.Ê†ºÂºèÊ≠£Á°Æ ? '‚úì' : '‚úó'},${result.Á±ªÂûãËæìÂá∫},${result.ÁêÜÁî±‰ª£Á†Å},${result.ÂáÜÁ°Æ ? '‚úì' : '‚úó'}\n`;
                }
            }
            
            // ‰∏ãËΩΩÊñá‰ª∂
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊñá‰ª∂ÂêçÊ†ºÂºèÔºöÁ±ªÂûã_ÁâàÊú¨_Ê®°ÂûãÊµãËØïÊä•Âëä_Êó•Êúü.csv
            a.download = `${EDGE_TEST_TYPE}_${EDGE_TEST_VERSION}_Ê®°ÂûãÊµãËØïÊä•Âëä_${new Date().toISOString().slice(0, 10)}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            alert('‚úÖ CSVÊä•ÂëäÂ∑≤ÂØºÂá∫ÔºÅ\n\n‰Ω†ÂèØ‰ª•ÂèëÁªôAIÂàÜÊûêÔºåËé∑Âèñ‰ºòÂåñÂª∫ËÆÆ„ÄÇ');
        }
        
        // ==================== ÁêÜÁî±‰ª£Á†ÅÊò†Â∞ÑË°® ====================
        const REASON_CODES = {
            'R1': 'Á∫ØÊï∞Â≠ó+ÂêÑ+ÈáëÈ¢ù',
            'R2': 'ÁîüËÇñ+x/ÂêÑ+ÈáëÈ¢ù',
            'R3': 'Âê´"Áâπ"Â≠ó',
            'R4': 'ÁîüËÇñ+ÈáëÈ¢ù(Êó†xÊó†ÂêÑ)',
            'R5': 'Á∫¢/Ëìù/Áªø+Ê≥¢',
            'R6': 'Ê≥¢Ëâ≤+Â§ßÂ∞èÂçïÂèå',
            'R7': 'Âê´Âπ≥ÁâπÊàñ‰∏ÄÂèã',
            'R8': 'Âê´‰∫åËøûËÇñÊàñ‰∫åÂèã',
            'R9': 'Âê´‰∏âËøûËÇñÊàñ‰∏âÂèã',
            'R10': 'Âê´ÂõõËøûËÇñ',
            'R11': 'Âê´‰∫îËøûËÇñ',
            'R12': 'Âπ≥ÁâπÂ∞æ',
            'R13': 'Âê´ÂÖ≠ËÇñ',
            'R31': 'Âê´ÁâπËÇñ',
            'R14': 'Âê´ÂêàËÇñ',
            'R15': 'Âê´Ê≠£ËÇñ',
            'R16': 'ÂçïÂπ≥ÊàñÂπ≥Á†Å',
            'R17': '‰∫å‰∏≠‰∫å',
            'R18': '‰∏â‰∏≠‰∏â',
            'R19': '‰∫åÂÖ®‰∏≠',
            'R20': '‰∏âÂÖ®‰∏≠',
            'R21': '‰∫å‰∏≠Áâπ',
            'R22': '‰∏â‰∏≠Áâπ',
            'R23': 'Áâπ‰∏≤',
            'R24': 'N‰∏ç‰∏≠',
            'R25': 'ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå',
            'R26': '‰∫îË°å',
            'R27': 'ÂÆ∂Á¶ΩÈáéÂÖΩ',
            'R28': 'Â§¥Â∞æÊï∞',
            'R29': 'Â∞èÊï∞/Â§ßÊï∞+ÂêÑ+ÈáëÈ¢ù',
            'R30': 'ÂçïÊï∞/ÂèåÊï∞+ÂêÑ+ÈáëÈ¢ù'
        };
        
        // Ëé∑ÂèñÁêÜÁî±‰ª£Á†ÅÁöÑÂèØËØªÊñáÂ≠ó
        function getReasonText(code) {
            if (!code) return '';
            // ÊîØÊåÅÂ§ö‰∏™‰ª£Á†ÅÔºåÂ¶Ç "R1,R3"
            const codes = code.split(',').map(c => c.trim().toUpperCase());
            return codes.map(c => REASON_CODES[c] || c).join('+');
        }
        
        // ==================== Â§öÊ®°ÂûãÂØπÊØîÊµãËØï ====================
        
        // Â≠òÂÇ®ÂêÑÊ®°ÂûãÁöÑÊµãËØïÁªìÊûúÔºà4‰∏™Ê®°ÂûãÔºâ
        let multiModelResults = {
            deepseek: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
            qwen: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
            tuzi: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
            claude: { status: 'pending', time: 0, raw: '', parsed: [], error: '' },
            gpt: { status: 'pending', time: 0, raw: '', parsed: [], error: '' }
        };
        let currentViewingModel = 'deepseek';
        
        // „Äê‰∏¥Êó∂-Ê®°ÂûãÊØîÊãº„ÄëÊâìÂºÄÂ§öÊ®°ÂûãÊµãËØïÂºπÁ™óÔºà‰∏çÈúÄË¶ÅËæìÂÖ•ÂÜÖÂÆπÔºâ
        function openMultiModelModal() {
            // Áõ¥Êé•ÊòæÁ§∫ÂºπÁ™ó
            document.getElementById('multi-model-modal').style.display = 'flex';
            
            // Êõ¥Êñ∞Á´ôÁÇπ‰ø°ÊÅØÊòæÁ§∫
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl) {
                siteInfoEl.textContent = 'ÂΩìÂâçÁ´ôÁÇπ: ' + tuziSiteManager.getCurrentName();
            }
            
            // ÂàáÊç¢Âà∞Á¨¨‰∏Ä‰∏™Ê†áÁ≠æ
            switchModelTab('deepseek');
            
            // ÈáçÁΩÆÁä∂ÊÄÅÊòæÁ§∫
            const models = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            models.forEach(m => {
                updateModelTabStatus(m, 'pending', 'Á≠âÂæÖ‰∏≠...');
            });
            
            // Ê∏ÖÁ©∫ÁªìÊûúÊòæÁ§∫
            document.getElementById('model-result-content').innerHTML = `
                <div style="text-align:center;color:#888;padding:40px;">
                    <div style="font-size:24px;margin-bottom:10px;">üß™</div>
                    <div>ËØ∑ÈÄâÊã©ÊµãËØïÊñπÂºèÔºö</div>
                    <div style="margin-top:10px;font-size:12px;">
                        ‚Ä¢ <b>ËæπÁºòÊµãËØï</b> - ËøêË°å32‰∏™È¢ÑÁΩÆÁî®‰æã<br>
                        ‚Ä¢ <b>5ËΩÆÊµãËØï</b> - ÂØπËæìÂÖ•Ê°ÜÂÜÖÂÆπÊµãËØï5ËΩÆÔºàÈúÄÂÖàËæìÂÖ•Ôºâ<br>
                        ‚Ä¢ <b>ÈáçÊñ∞ÊµãËØï</b> - ÂØπËæìÂÖ•Ê°ÜÂÜÖÂÆπÊµãËØï1ËΩÆÔºàÈúÄÂÖàËæìÂÖ•Ôºâ
                    </div>
                </div>
            `;
            
            console.log('üìä Â§öÊ®°ÂûãÊµãËØïÂºπÁ™óÂ∑≤ÊâìÂºÄ');
        }
        
        // ËøêË°åÂ§öÊ®°ÂûãÂØπÊØîÊµãËØï
        async function runMultiModelTest() {
            const input = document.getElementById('bet-input').value.trim();
            if (!input) {
                alert('ËØ∑ÂÖàËæìÂÖ•‰∏ãÊ≥®ÂÜÖÂÆπ');
                return;
            }
            
            // ÊòæÁ§∫ÂºπÁ™ó
            document.getElementById('multi-model-modal').style.display = 'flex';
            
            // Êõ¥Êñ∞Á´ôÁÇπ‰ø°ÊÅØÊòæÁ§∫
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl) {
                siteInfoEl.textContent = 'ÂΩìÂâçÁ´ôÁÇπ: ' + tuziSiteManager.getCurrentName();
            }
            
            // ÈáçÁΩÆÁªìÊûúÔºà4‰∏™Ê®°ÂûãÔºâ
            multiModelResults = {
                deepseek: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
                qwen: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
                tuzi: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
                claude: { status: 'running', time: 0, raw: '', parsed: [], error: '' },
                gpt: { status: 'running', time: 0, raw: '', parsed: [], error: '' }
            };
            
            // Êõ¥Êñ∞UIÊòæÁ§∫"ËøêË°å‰∏≠"
            ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'].forEach(model => {
                updateModelTabStatus(model, 'running', 'ËøêË°å‰∏≠...');
            });
            
            // ÂàáÊç¢Âà∞Á¨¨‰∏Ä‰∏™Ê†áÁ≠æ
            switchModelTab('deepseek');
            
            // ÊûÑÂª∫ÊèêÁ§∫ËØçÔºàÂ§çÁî®Áé∞ÊúâÈÄªËæëÔºâ
            let userInput = input;
            
            // „ÄêÈ¢ÑÂ§ÑÁêÜ„ÄëÊ†áÂáÜÂåñÂàÜÈöîÁ¨¶ÂíåÈáëÈ¢ùÁ¨¶Âè∑ÔºàÁ°ÆÂÆöÊÄßËßÑÂàôÔºå‰∏ç‰æùËµñAIÔºâ
            userInput = normalizeForAI(userInput);
            
            const prompt = `„ÄêÂº∫Âà∂ËßÑÂàô„ÄëÂè™ËæìÂá∫JSONÔºåÁ¶ÅÊ≠¢‰ªª‰ΩïËß£ÈáäÔºÅ

    „ÄêtypeÂøÖÈ°ªÊòØ‰ª•‰∏ã‰πã‰∏Ä„ÄëÔºàÁ¶ÅÊ≠¢ËæìÂá∫ÂÖ∂‰ªñÂÄºÔºÅÔºâ
    ÁâπÁ†Å/ÁîüËÇñÁâπÁ†Å/ÁîüËÇñ/Ê≥¢Ëâ≤/ÂçäÊ≥¢/Âπ≥Áâπ‰∏ÄËÇñ/Âπ≥Áâπ‰∫åËøûËÇñ/Âπ≥Áâπ‰∏âËøûËÇñ/Âπ≥ÁâπÂõõËøûËÇñ/Âπ≥Áâπ‰∫îËøûËÇñ/Âπ≥ÁâπÂ∞æÊï∞/ÂÖ≠ËÇñ/ÁâπËÇñ/ÂêàËÇñ/Ê≠£ËÇñ/ÂçïÂπ≥/‰∫å‰∏≠‰∫å/‰∏â‰∏≠‰∏â/‰∫åÂÖ®‰∏≠/‰∏âÂÖ®‰∏≠/‰∫å‰∏≠Áâπ/‰∏â‰∏≠Áâπ/Áâπ‰∏≤/‰∫î‰∏ç‰∏≠/ÂÖ≠‰∏ç‰∏≠/‰∏É‰∏ç‰∏≠/ÂÖ´‰∏ç‰∏≠/‰πù‰∏ç‰∏≠/ÂçÅ‰∏ç‰∏≠/ÂçÅ‰∏Ä‰∏ç‰∏≠/ÂçÅ‰∫å‰∏ç‰∏≠/ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå/‰∫îË°å/ÂÆ∂Á¶ΩÈáéÂÖΩ/Â§¥Â∞æÊï∞

    „ÄêÁêÜÁî±‰ª£Á†År„ÄëÂøÖÈ°ªÊòØR1-R30‰πã‰∏ÄÔºö
    R1=Á∫ØÊï∞Â≠ó+ÂêÑ+ÈáëÈ¢ù‚ÜíÁâπÁ†Å R2=ÁîüËÇñ+x/X/ÂêÑ+ÈáëÈ¢ù‚ÜíÁîüËÇñÁâπÁ†Å R3=Âê´ÁâπÂ≠ó‚ÜíÁâπÁ†Å R4=ÁîüËÇñ+ÈáëÈ¢ù(Êó†xÊó†ÂêÑ)‚ÜíÁîüËÇñ
    R5=Á∫¢ËìùÁªø+Ê≥¢‚ÜíÊ≥¢Ëâ≤ R6=Ê≥¢Ëâ≤+Â§ßÂ∞èÂçïÂèå‚ÜíÂçäÊ≥¢ R7=Âπ≥ÁâπÊàñ‰∏ÄÂèã‚ÜíÂπ≥Áâπ‰∏ÄËÇñ R8=‰∫åËøûËÇñÊàñ‰∫åÂèã‚ÜíÂπ≥Áâπ‰∫åËøûËÇñ
    R9=‰∏âËøûËÇñÊàñ‰∏âÂèã‚ÜíÂπ≥Áâπ‰∏âËøûËÇñ R10=ÂõõËøûËÇñ‚ÜíÂπ≥ÁâπÂõõËøûËÇñ R11=‰∫îËøûËÇñ‚ÜíÂπ≥Áâπ‰∫îËøûËÇñ R12=Âπ≥ÁâπÂ∞æ‚ÜíÂπ≥ÁâπÂ∞æÊï∞
    R13=ÂÖ≠ËÇñ R31=ÁâπËÇñ R14=ÂêàËÇñ R15=Ê≠£ËÇñ R16=ÂçïÂπ≥ÊàñÂπ≥Á†Å‚ÜíÂçïÂπ≥ R17=‰∫å‰∏≠‰∫å R18=‰∏â‰∏≠‰∏â R19=‰∫åÂÖ®‰∏≠ R20=‰∏âÂÖ®‰∏≠
    R21=‰∫å‰∏≠Áâπ R22=‰∏â‰∏≠Áâπ R23=Áâπ‰∏≤ R24=N‰∏ç‰∏≠ R25=ÊÄªÂíåÂ§ßÂ∞èÂçïÂèå R26=‰∫îË°å R27=ÂÆ∂Á¶ΩÈáéÂÖΩ R28=Â§¥Â∞æÊï∞
    R29=Â∞èÊï∞/Â§ßÊï∞+ÂêÑ+ÈáëÈ¢ù‚ÜíÁâπÁ†Å R30=ÂçïÊï∞/ÂèåÊï∞+ÂêÑ+ÈáëÈ¢ù‚ÜíÁâπÁ†Å

    „ÄêÁîüËÇñËØç„ÄëÈº†„ÄÅÁâõ„ÄÅËôé„ÄÅÂÖî„ÄÅÈæô„ÄÅËõá„ÄÅÈ©¨„ÄÅÁæä„ÄÅÁå¥„ÄÅÈ∏°„ÄÅÁãó„ÄÅÁå™

    „ÄêÊ†∏ÂøÉËßÑÂàô-Êåâ‰ºòÂÖàÁ∫ßÂà§Êñ≠„Äë
    1. Á∫ØÊï∞Â≠ó+ÂêÑ/ÊØè‰∏™+ÈáëÈ¢ù ‚Üí type="ÁâπÁ†Å", r="R1"ÔºàÂ¶ÇÔºö10 12 20ÂêÑ30Ôºâ
    2. ‰π∞+ÁîüËÇñ(‰∏Ä‰∏™ÊàñÂ§ö‰∏™)+ÂêÑ+ÈáëÈ¢ù ‚Üí type="ÁîüËÇñÁâπÁ†Å", r="R2"ÔºàÂ¶ÇÔºö‰π∞Áå™ÂêÑ20„ÄÅ‰π∞ÈæôËôéÂêÑ20„ÄÅ‰π∞Èº†ÁâõËôéÂêÑ30Ôºâ
    3. ÁîüËÇñ+x/X/√ó/*/@+ÈáëÈ¢ù ‚Üí type="ÁîüËÇñÁâπÁ†Å", r="R2"ÔºàÂ¶ÇÔºöÈæôx10„ÄÅÁãóX80„ÄÅÁå¥È∏°x50Ôºâ
    4. Áâπ+Âè∑Á†Å+ÈáëÈ¢ù ‚Üí type="ÁâπÁ†Å", r="R3"ÔºàÂ¶ÇÔºöÁâπ43 20ÂÖÉÔºâ
    5. Â∞èÊï∞/Â§ßÊï∞+ÂêÑ+ÈáëÈ¢ù ‚Üí type="ÁâπÁ†Å", r="R29"ÔºàÂ∞èÊï∞=1-24ÔºåÂ§ßÊï∞=25-49Ôºâ
    6. ÂçïÊï∞/ÂèåÊï∞+ÂêÑ+ÈáëÈ¢ù ‚Üí type="ÁâπÁ†Å", r="R30"ÔºàÂçïÊï∞=1,3,5...49ÔºåÂèåÊï∞=2,4,6...48Ôºâ
    7. ÁîüËÇñ+ÈáëÈ¢ù(Êó†‰π∞Êó†xÊó†ÂêÑ) ‚Üí type="ÁîüËÇñ", r="R4"ÔºàÂ¶ÇÔºöÁå™10Ôºâ

    „ÄêÈáçË¶Å„ÄëÊúâ"‰π∞"Â≠ó+Êúâ"ÂêÑ"Â≠ó = ‰∏ÄÂÆöÊòØÁîüËÇñÁâπÁ†Å(R2)Ôºå‰∏çÁÆ°ÊúâÂá†‰∏™ÁîüËÇñÔºÅ

    „ÄêÈáëÈ¢ùÊ†ºÂºè„ÄëÊîØÊåÅÊï∞Â≠ó(20)Âíå‰∏≠Êñá(‰∫åÂçÅ/‰∏ÄÁôæ)ÔºåÂèØÂ∏¶Âçï‰Ωç(ÂÖÉ/Âùó)
    „ÄêÂàÜÈöîÁ¨¶„ÄëÂè∑Á†ÅÈó¥ÂèØÁî®ÔºöÁ©∫Ê†º„ÄÅÁÇπ(.)„ÄÅÈÄóÂè∑(,)„ÄÅÈ°øÂè∑(„ÄÅ)„ÄÅÊñúÊù†(/)„ÄÅÊ®™Êù†(-)

    „ÄêÁî®Êà∑ËæìÂÖ•„Äë
    ${userInput}

    „ÄêËæìÂá∫Ê†ºÂºè„Äë‰∏•Ê†ºÊåâÊ≠§Ê†ºÂºèÔºåtypeÂøÖÈ°ªÊòØ‰∏äÈù¢ÂàóÂá∫ÁöÑÁé©Ê≥ïÂêçÔºÅ
    {"items":[{"type":"ÁâπÁ†Å","raw":"ÂéüÊñá","r":"R1"}]}`;
            
            // Âπ∂Ë°åË∞ÉÁî®ÊâÄÊúâÊ®°ÂûãÔºà5‰∏™Ôºâ
            const modelsToTest = ['deepseek', 'qwen', 'tuzi', 'claude', 'gpt'];
            
            const promises = modelsToTest.map(async (modelKey) => {
                const config = AI_PROVIDERS[modelKey];
                if (!config) {
                    multiModelResults[modelKey] = {
                        status: 'error',
                        time: 0,
                        raw: '',
                        parsed: [],
                        error: 'Ê®°ÂûãÊú™ÈÖçÁΩÆ'
                    };
                    updateModelTabStatus(modelKey, 'error', 'Êú™ÈÖçÁΩÆ');
                    return;
                }
                
                const startTime = Date.now();
                try {
                    // API Key Âú®ÂêéÁ´ØÔºå‰∏çÈúÄË¶Å‰º†ÈÄí
                    const result = await callAIAPI(prompt, modelKey);
                    const elapsed = Date.now() - startTime;
                    
                    if (result) {
                        // Ëß£ÊûêÁªìÊûú
                        let parsed = [];
                        let aiItems = [];  // ‰øùÂ≠òAIÂéüÂßãËæìÂá∫ÁöÑitemsÔºàÁî®‰∫éÊäïÁ•®Ôºâ
                        try {
                            let jsonStr = result.trim();
                            if (jsonStr.startsWith('```')) {
                                jsonStr = jsonStr.replace(/```json?\n?/g, '').replace(/```/g, '').trim();
                            }
                            const aiResult = JSON.parse(jsonStr);
                            if (aiResult.items && Array.isArray(aiResult.items)) {
                                aiItems = aiResult.items;  // ‰øùÂ≠òÂéüÂßãitems
                                for (const item of aiResult.items) {
                                    // „ÄêÂ∑≤‰ºòÂåñ„ÄëÁõ¥Êé•‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑÊï∞ÊçÆÔºå‰∏çÂÜçË∞ÉÁî®Êú¨Âú∞Ê≠£Âàô
                                        const reasonCode = item.r || item.reason || '';
                                        const reasonText = getReasonText(reasonCode);
                                    parsed.push({
                                        type: item.type || 'Êú™Áü•',
                                        target: item.raw,
                                        amount: item.amount || 0,
                                        numbers: item.numbers || [],
                                        raw: item.raw,
                                        reason: reasonText,
                                        reasonCode: reasonCode
                                    });
                                }
                            }
                        } catch (e) {
                            console.warn('Ëß£ÊûêJSONÂ§±Ë¥•:', e, 'ÂéüÂßãÂÜÖÂÆπ:', result.substring(0, 200));
                        }
                        
                        multiModelResults[modelKey] = {
                            status: parsed.length > 0 ? 'success' : 'warning',
                            time: elapsed,
                            raw: result,
                            parsed: parsed,
                            aiItems: aiItems,  // ‰øùÂ≠òÁî®‰∫éÊäïÁ•®
                            error: ''
                        };
                        
                        updateModelTabStatus(modelKey, parsed.length > 0 ? 'success' : 'warning', `ËÄóÊó∂: ${(elapsed/1000).toFixed(1)}s`);
                    } else {
                        throw new Error('ËøîÂõûÁªìÊûú‰∏∫Á©∫');
                    }
                } catch (e) {
                    const elapsed = Date.now() - startTime;
                    multiModelResults[modelKey] = {
                        status: 'error',
                        time: elapsed,
                        raw: '',
                        parsed: [],
                        error: e.message
                    };
                    updateModelTabStatus(modelKey, 'error', 'ËØ∑Ê±ÇÂ§±Ë¥•');
                }
                
                // Â¶ÇÊûúÂΩìÂâçÊ≠£Âú®Êü•ÁúãËøô‰∏™Ê®°ÂûãÔºåÊõ¥Êñ∞ÊòæÁ§∫
                if (currentViewingModel === modelKey) {
                    displayModelResult(modelKey);
                }
            });
            
            await Promise.all(promises);
            console.log('üî¨ Â§öÊ®°ÂûãÊµãËØïÂÆåÊàê:', multiModelResults);
            
            // ÊäïÁ•®ÁªüËÆ°
            const voteResult = calculateVoteResult();
            displayVoteResult(voteResult);
        }
        
        // ÊäïÁ•®ÁªüËÆ°ÈÄªËæë
        function calculateVoteResult() {
            const votes = {};  // { "Á±ªÂûãÁªÑÂêà": { count: N, models: [], items: [] } }
            const validModels = [];
            
            // Êî∂ÈõÜÂêÑÊ®°ÂûãÁöÑÁªìÊûú
            for (const [modelKey, result] of Object.entries(multiModelResults)) {
                if (result.status === 'success' && result.aiItems && result.aiItems.length > 0) {
                    validModels.push(modelKey);
                    
                    // ÁîüÊàêÊäïÁ•® keyÔºàÊåâÁ±ªÂûãÊéíÂ∫èÁöÑÁªÑÂêàÔºâ
                    const types = result.aiItems.map(item => item.type).sort().join('|');
                    
                    if (!votes[types]) {
                        votes[types] = { count: 0, models: [], items: result.aiItems };
                    }
                    votes[types].count++;
                    votes[types].models.push(modelKey);
                }
            }
            
            // ÊâæÂá∫ÊúÄÈ´òÁ•®
            let maxVote = null;
            let maxCount = 0;
            for (const [types, vote] of Object.entries(votes)) {
                if (vote.count > maxCount) {
                    maxCount = vote.count;
                    maxVote = vote;
                }
            }
            
            // ËÆ°ÁÆóÂèØ‰ø°Â∫¶
            let confidence = 'low';
            let confidenceText = '‚ö†Ô∏è ÈúÄ‰∫∫Â∑•ÂÆ°Ê†∏';
            let confidenceColor = '#ffa726';
            
            if (maxCount >= 4) {
                confidence = 'high';
                confidenceText = '‚úÖ È´òÂèØ‰ø°Ôºà' + maxCount + '/5Á•®‰∏ÄËá¥Ôºâ';
                confidenceColor = '#4ade80';
            } else if (maxCount === 3) {
                confidence = 'medium';
                confidenceText = '‚ö° ‰∏≠ÂèØ‰ø°Ôºà3/5Á•®‰∏ÄËá¥Ôºâ';
                confidenceColor = '#60a5fa';
            } else {
                confidence = 'low';
                confidenceText = '‚ö†Ô∏è ÈúÄ‰∫∫Â∑•ÂÆ°Ê†∏ÔºàÂàÜÊ≠ßËæÉÂ§ßÔºâ';
                confidenceColor = '#ffa726';
            }
            
            return {
                votes: votes,
                winner: maxVote,
                winnerCount: maxCount,
                totalModels: validModels.length,
                confidence: confidence,
                confidenceText: confidenceText,
                confidenceColor: confidenceColor
            };
        }
        
        // ÊòæÁ§∫ÊäïÁ•®ÁªìÊûú
        function displayVoteResult(voteResult) {
            const siteInfoEl = document.getElementById('tuzi-site-info');
            if (siteInfoEl && voteResult.winner) {
                siteInfoEl.innerHTML = `
                    <span style="color:${voteResult.confidenceColor}">${voteResult.confidenceText}</span>
                    <span style="margin-left:8px;color:#888;">Á´ôÁÇπ: ${tuziSiteManager.getCurrentName()}</span>
                `;
                siteInfoEl.style.background = 'rgba(0,0,0,0.2)';
            }
            
            console.log('üó≥Ô∏è ÊäïÁ•®ÁªìÊûú:', voteResult);
        }
        
        // Êõ¥Êñ∞Ê®°ÂûãÊ†áÁ≠æÁä∂ÊÄÅ
        function updateModelTabStatus(model, status, timeText) {
            const tab = document.querySelector(`.model-tab[data-model="${model}"]`);
            if (tab) {
                tab.classList.remove('success', 'error', 'warning');
                if (status !== 'running') {
                    tab.classList.add(status);
                }
            }
            const timeEl = document.getElementById(`tab-time-${model}`);
            if (timeEl) {
                timeEl.textContent = timeText;
            }
        }
        
        // ÂàáÊç¢Ê®°ÂûãÊ†áÁ≠æ
        function switchModelTab(model) {
            currentViewingModel = model;
            
            // Êõ¥Êñ∞Ê†áÁ≠æÊøÄÊ¥ªÁä∂ÊÄÅ
            document.querySelectorAll('.model-tab').forEach(tab => {
                tab.classList.remove('active');
                if (tab.dataset.model === model) {
                    tab.classList.add('active');
                }
            });
            
            // ÊòæÁ§∫ËØ•Ê®°ÂûãÁöÑÁªìÊûú
            displayModelResult(model);
        }
        
        // ÊòæÁ§∫Ê®°ÂûãÁªìÊûú
        function displayModelResult(model) {
            const result = multiModelResults[model];
            const config = AI_PROVIDERS[model];
            
            // ÂéüÂßãËæìÂá∫
            const rawEl = document.getElementById('model-raw-output');
            if (result.status === 'running') {
                rawEl.textContent = '‚è≥ Ê≠£Âú®ËØ∑Ê±Ç ' + (config?.name || model) + '...';
            } else if (result.status === 'error') {
                rawEl.textContent = '‚ùå ÈîôËØØ: ' + result.error;
            } else {
                rawEl.textContent = result.raw || '(Êó†ËæìÂá∫)';
            }
            
            // Ëß£ÊûêÁªìÊûú
            const parsedEl = document.getElementById('model-parsed-result');
            if (result.status === 'running') {
                parsedEl.innerHTML = '‚è≥ Á≠âÂæÖÁªìÊûú...';
            } else if (result.status === 'error') {
                parsedEl.innerHTML = '<span style="color:#ef5350;">ËØ∑Ê±ÇÂ§±Ë¥•</span>';
            } else if (result.parsed && result.parsed.length > 0) {
                parsedEl.innerHTML = result.parsed.map(bet => {
                    const target = bet.numbers?.join(',') || bet.target || '';
                    const reason = bet.reason ? `<span style="color:#888;font-size:10px;"> (${bet.reason})</span>` : '';
                    return `${bet.type} ‚Üí ${target} √ó ${bet.amount}ÂÖÉ${reason}`;
                }).join('<br>');
            } else {
                parsedEl.innerHTML = '<span style="color:#ffa726;">Êó†Ê≥ïËß£ÊûêÊàñÁªìÊûú‰∏∫Á©∫</span>';
            }
            
            // Áä∂ÊÄÅÂå∫Âüü
            const statusEl = document.getElementById('model-status');
            const useBtnEl = document.getElementById('model-use-btn');
            
            if (result.status === 'running') {
                statusEl.innerHTML = '‚è≥ ËøêË°å‰∏≠...';
                useBtnEl.style.display = 'none';
            } else if (result.status === 'success') {
                statusEl.innerHTML = `‚úÖ Ëß£ÊûêÊàêÂäü (${result.parsed.length}Êù°‰∏ãÊ≥®)`;
                useBtnEl.style.display = 'block';
            } else if (result.status === 'warning') {
                statusEl.innerHTML = '‚ö†Ô∏è ÈÉ®ÂàÜÈîôËØØ';
                useBtnEl.style.display = 'block';
            } else {
                statusEl.innerHTML = '‚ùå ËØ∑Ê±ÇÂ§±Ë¥•';
                useBtnEl.style.display = 'none';
            }
        }
        
        // ‰ΩøÁî®ÂΩìÂâçÊ®°ÂûãÁöÑÁªìÊûú
        function useModelResult() {
            const result = multiModelResults[currentViewingModel];
            if (result && result.parsed && result.parsed.length > 0) {
                // Â∞ÜËß£ÊûêÁªìÊûúÂ∫îÁî®Âà∞‰∏ªÁïåÈù¢
                parsedBets = result.parsed;
                
                // ÂàáÊç¢Âà∞ËØ•Ê®°Âûã
                switchAIModel(currentViewingModel);
                
                // ÂÖ≥Èó≠ÂºπÁ™ó
                closeMultiModelModal();
                
                // ÊâßË°åËÆ°ÁÆó
                calculateBets();
                
                showAutoCloseToast('‚úÖ Â∑≤ÈÄâÁî® ' + AI_PROVIDERS[currentViewingModel].name + ' ÁöÑÁªìÊûú');
            }
        }
        
        // ÂÖ≥Èó≠Â§öÊ®°ÂûãÂºπÁ™ó
        function closeMultiModelModal() {
            document.getElementById('multi-model-modal').style.display = 'none';
        }
        
        // ==================== ÁªìÊùüÂ§öÊ®°ÂûãÂØπÊØîÊµãËØï ====================
        
        // ÂàáÊç¢AIÊ®°Âûã
        function changeAIModel(provider) {
            // ÂêåÊ≠•Âà∞ÈöêËóèÁöÑ select
            document.getElementById('ai-provider').value = provider;
            
            // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
            localStorage.setItem('ai_provider', provider);
            
            // Êõ¥Êñ∞ÊèêÁ§∫‰ø°ÊÅØ
            const config = AI_PROVIDERS[provider];
            const tipEl = document.getElementById('ai-model-tip');
            if (tipEl && config) {
                if (config.region === 'overseas') {
                    tipEl.innerHTML = '‚ö†Ô∏è ÂΩìÂâçÔºö' + config.name + '<br><span style="color:#ffa726;">Êµ∑Â§ñÊ®°ÂûãÈúÄÂÖàÈÉ®ÁΩ≤Cloudflare Worker</span>';
                    tipEl.style.background = 'rgba(255,152,0,0.1)';
                    tipEl.style.color = '#ffa726';
                } else if (config.region === 'direct') {
                    tipEl.innerHTML = '‚úÖ ÂΩìÂâçÔºö' + config.name + 'ÔºàÁ¨¨‰∏âÊñπ‰∏≠ËΩ¨ÔºåÁ®≥ÂÆöÁõ¥ËøûÔºâ';
                    tipEl.style.background = 'rgba(33,150,243,0.1)';
                    tipEl.style.color = '#64b5f6';
                } else {
                    tipEl.innerHTML = '‚úÖ ÂΩìÂâçÔºö' + config.name + 'ÔºàÂõΩÂÜÖÁõ¥ËøûÔºåÈÄüÂ∫¶Âø´Ôºâ';
                    tipEl.style.background = 'rgba(76,175,80,0.1)';
                    tipEl.style.color = '#81c784';
                }
            }
            
            console.log('AIÊ®°ÂûãÂ∑≤ÂàáÊç¢‰∏∫:', provider, config);
        }
        
        // ÊµãËØïÂΩìÂâçAIÊ®°ÂûãÔºàAPI Key Â∑≤Âú®ÂêéÁ´ØÈÖçÁΩÆÔºâ
        async function testCurrentAI() {
            const provider = document.getElementById('ai-provider').value;
            const config = AI_PROVIDERS[provider];
            
            showAutoCloseToast('üîÑ Ê≠£Âú®ÊµãËØï ' + config.name + '...', 10000);
            
            try {
                const startTime = Date.now();
                // API Key Âú®ÂêéÁ´ØÔºå‰∏çÈúÄË¶Å‰º†ÈÄí
                const result = await callAIAPI('ËØ∑ÂõûÂ§ç"ËøûÊé•ÊàêÂäü"Âõõ‰∏™Â≠ó', provider);
                const elapsed = Date.now() - startTime;
                
                if (result) {
                    showAutoCloseToast('‚úÖ ' + config.name + ' ËøûÊé•ÊàêÂäüÔºÅ\nÂìçÂ∫îÊó∂Èó¥: ' + elapsed + 'ms');
                } else {
                    alert('‚ùå ' + config.name + ' ËøûÊé•Â§±Ë¥•\nËØ∑Ê£ÄÊü•ÈòøÈáå‰∫ëÂáΩÊï∞ÊòØÂê¶Ê≠£Á°ÆÈÖçÁΩÆ‰∫ÜAPI Key');
                }
            } catch (e) {
                alert('‚ùå ' + config.name + ' ËøûÊé•Â§±Ë¥•\n\nÈîôËØØ: ' + e.message + '\n\n' + getErrorGuide(provider, e.message));
            }
        }
        
        // Ëé∑ÂèñAPI KeyÈÖçÁΩÆÊåáÂçó
        function getAPIKeyGuide(provider) {
            const guides = {
                deepseek: 'Ëé∑ÂèñÊñπÂºèÔºö\n1. ËÆøÈóÆ platform.deepseek.com\n2. Ê≥®ÂÜåÁôªÂΩïÂêéÂàõÂª∫API Key',
                qwen: 'Ëé∑ÂèñÊñπÂºèÔºö\n1. ËÆøÈóÆ dashscope.console.aliyun.com\n2. ÂºÄÈÄöÊ®°ÂûãÊúçÂä°Âπ∂ÂàõÂª∫API Key',
                tuzi: 'Ëé∑ÂèñÊñπÂºèÔºö\n1. ËÆøÈóÆ ÂÖîÂ≠êAPIÂÆòÁΩë\n2. Ê≥®ÂÜåÂêéÂÖÖÂÄºËé∑ÂèñAPI Key',
                claude: '‰ΩøÁî®ÂÖîÂ≠êAPI‰∏≠ËΩ¨ÔºåÊó†ÈúÄÂçïÁã¨Ëé∑Âèñ',
                gpt: '‰ΩøÁî®ÂÖîÂ≠êAPI‰∏≠ËΩ¨ÔºåÊó†ÈúÄÂçïÁã¨Ëé∑Âèñ',
                openai: 'Ëé∑ÂèñÊñπÂºèÔºö\n1. ËÆøÈóÆ platform.openai.com\n2. ÂàõÂª∫API Key\n\n‚ö†Ô∏è Ê≥®ÊÑèÔºöÈúÄÂÖàÈÉ®ÁΩ≤Cloudflare WorkerÊâçËÉΩÂú®ÂõΩÂÜÖ‰ΩøÁî®'
            };
            return guides[provider] || 'ËØ∑Âà∞ÂØπÂ∫îÂπ≥Âè∞Ëé∑ÂèñAPI Key';
        }
        
        // Ëé∑ÂèñÈîôËØØËØäÊñ≠ÊåáÂçó
        function getErrorGuide(provider, errorMsg) {
            const config = AI_PROVIDERS[provider];
            if (config.region === 'overseas') {
                if (errorMsg.includes('Failed to fetch') || errorMsg.includes('NetworkError')) {
                    return 'ÂèØËÉΩÂéüÂõ†Ôºö\n1. Cloudflare WorkerÊú™Ê≠£Á°ÆÈÉ®ÁΩ≤\n2. ÁΩëÁªúËøûÊé•ÈóÆÈ¢ò\n\nËØ∑ÂÖàÊåâÁÖßÈÉ®ÁΩ≤ÊïôÁ®ãÈÖçÁΩÆCloudflare Worker';
                }
            }
            if (errorMsg.includes('401') || errorMsg.includes('Unauthorized')) {
                return 'ÂèØËÉΩÂéüÂõ†ÔºöAPI KeyÊó†ÊïàÊàñÂ∑≤ËøáÊúüÔºåËØ∑ÈáçÊñ∞Ëé∑Âèñ';
            }
            if (errorMsg.includes('429')) {
                return 'ÂèØËÉΩÂéüÂõ†ÔºöAPIË∞ÉÁî®È¢ëÁéáË∂ÖÈôêÊàñ‰ΩôÈ¢ù‰∏çË∂≥';
            }
            return 'ËØ∑Ê£ÄÊü•ÁΩëÁªúËøûÊé•ÂíåAPI KeyÈÖçÁΩÆ';
        }
        
        // ÊµãËØïAIËøûÊé•ÔºàAPI Key Â∑≤Âú®ÂêéÁ´ØÈÖçÁΩÆÔºâ
        async function testAIConnection() {
            const provider = document.getElementById('ai-provider').value;
            
            showAutoCloseToast('üîÑ Ê≠£Âú®ÊµãËØïËøûÊé•...', 5000);
            
            try {
                // API Key Âú®ÂêéÁ´ØÔºå‰∏çÈúÄË¶Å‰º†ÈÄí
                const result = await callAIAPI('ÊµãËØïËøûÊé•ÔºåËØ∑ÂõûÂ§ç"ËøûÊé•ÊàêÂäü"', provider);
                if (result) {
                    showAutoCloseToast('‚úÖ AIËøûÊé•ÊàêÂäüÔºÅ');
                } else {
                    alert('‚ùå ËøûÊé•Â§±Ë¥•ÔºåËØ∑Ê£ÄÊü•ÈòøÈáå‰∫ëÂáΩÊï∞ÁéØÂ¢ÉÂèòÈáèÈÖçÁΩÆ');
                }
            } catch (e) {
                alert('‚ùå ËøûÊé•Â§±Ë¥•: ' + e.message);
            }
        }
        
        // ==================== AI ‰ª£ÁêÜÈÖçÁΩÆ ====================
        // È¶ôÊ∏ØÊúçÂä°Âô®ÔºàPythonÂêéÁ´ØÔºåÊîØÊåÅFunction CallingÔºâ
        const ALIYUN_PROXY_URL = 'https://rocket-calc.site';
        // Cloudflare WorkerÔºàÊµ∑Â§ñÊ®°Âûã‰ΩøÁî®ÔºåÂèØËÆøÈóÆGoogle/OpenAIÔºâ
        const CLOUDFLARE_PROXY_URL = 'https://ai-proxy.huzhirong6.workers.dev';
        
        // Âà§Êñ≠ÊòØÂê¶ÈúÄË¶Å‰ΩøÁî®‰ª£ÁêÜÔºàÁ∫ø‰∏äÁéØÂ¢ÉÈúÄË¶ÅÔºåÊú¨Âú∞‰∏çÈúÄË¶ÅÔºâ
        function shouldUseProxy() {
            const host = window.location.hostname;
            // Êú¨Âú∞ÂºÄÂèëÁéØÂ¢É‰∏ç‰ΩøÁî®‰ª£ÁêÜ
            return host !== 'localhost' && host !== '127.0.0.1' && !host.startsWith('192.168.');
        }
        
        // Ê†πÊçÆÊ®°ÂûãÂå∫ÂüüËé∑Âèñ‰ª£ÁêÜURL
        // ÂõΩÂÜÖÊ®°Âûã ‚Üí ÈòøÈáå‰∫ëÔºàÈÄüÂ∫¶Âø´Ôºâ
        // Êµ∑Â§ñÊ®°Âûã ‚Üí CloudflareÔºàËÉΩËÆøÈóÆGoogle/OpenAIÔºâ
        // Áõ¥ËøûÊ®°Âûã ‚Üí ËøîÂõû nullÔºàÁ¨¨‰∏âÊñπ‰∏≠ËΩ¨APIÔºåÁõ¥Êé•Ë∞ÉÁî®Ôºâ
        function getProxyUrl(provider) {
            const config = AI_PROVIDERS[provider];
            if (config && config.region === 'direct') {
                console.log('üì° Á¨¨‰∏âÊñπ‰∏≠ËΩ¨APIÔºåÁõ¥Êé•Ë∞ÉÁî®Êó†ÈúÄ‰ª£ÁêÜ');
                return null;  // Áõ¥ËøûÊ®°ÂºèÔºå‰∏ç‰ΩøÁî®‰ª£ÁêÜ
            }
            if (config && config.region === 'overseas') {
                console.log('üì° Êµ∑Â§ñÊ®°ÂûãÔºå‰ΩøÁî® Cloudflare ‰ª£ÁêÜ');
                return CLOUDFLARE_PROXY_URL;
            }
            console.log('üì° ÂõΩÂÜÖÊ®°ÂûãÔºå‰ΩøÁî®ÈòøÈáå‰∫ë‰ª£ÁêÜ');
            return ALIYUN_PROXY_URL;
        }
        
        // Ë∞ÉÁî®AI APIÔºàÂ¢ûÂº∫ÁâàÔºöËØ¶ÁªÜÈîôËØØËØäÊñ≠ + ÈáçËØïÊú∫Âà∂ + Â§öÁ´ôÁÇπÂàáÊç¢Ôºâ
        // ‚ö†Ô∏è API Key Â∑≤ÁßªËá≥ÈòøÈáå‰∫ëÂáΩÊï∞ÁéØÂ¢ÉÂèòÈáèÔºåÂâçÁ´Ø‰∏çÂÜç‰º†ÈÄí
        async function callAIAPI(prompt, provider, apiKey = null, retryCount = 0) {
            const config = AI_PROVIDERS[provider];
            if (!config) throw new Error('Êú™Áü•ÁöÑAIÊúçÂä°ÂïÜ');
            
            // Ê∑ªÂä†Ë∂ÖÊó∂ÊéßÂà∂ÔºàÂ¢ûÂä†Ë∂ÖÊó∂Êó∂Èó¥ÔºåGeminiÁ≠âÊ®°ÂûãÂìçÂ∫îËæÉÊÖ¢Ôºâ
            const controller = new AbortController();
            // Áõ¥ËøûAPIÔºö60ÁßíÔºåÈòøÈáå‰∫ë‰ª£ÁêÜÔºö45ÁßíÔºàGeminiÁ≠âÈúÄË¶ÅÊõ¥ÈïøÊó∂Èó¥Ôºâ
            const timeoutMs = config.region === 'direct' ? 60000 : 45000;
            const timeoutId = setTimeout(() => controller.abort(), timeoutMs);
            
            // ËÆ∞ÂΩïËØ∑Ê±ÇÊ®°ÂºèÔºàÁî®‰∫éËØäÊñ≠Ôºâ
            // Ê†πÊçÆÊ®°ÂûãÂå∫ÂüüÈÄâÊã©‰ª£ÁêÜÔºöÂõΩÂÜÖ‚ÜíÈòøÈáå‰∫ëÔºåÊµ∑Â§ñ‚ÜíCloudflareÔºåÁõ¥Ëøû‚ÜíÊó†‰ª£ÁêÜ
            const proxyUrl = getProxyUrl(provider);
            const useProxy = shouldUseProxy() && proxyUrl;
            let proxyName, requestMode;
            if (config.region === 'direct') {
                requestMode = 'Áõ¥ËøûÊ®°Âºè(Á¨¨‰∏âÊñπ‰∏≠ËΩ¨)';
            } else if (useProxy) {
                proxyName = config.region === 'overseas' ? 'Cloudflare' : 'ÈòøÈáå‰∫ë';
                requestMode = `‰ª£ÁêÜÊ®°Âºè(${proxyName})`;
            } else {
                requestMode = 'Áõ¥ËøûÊ®°Âºè';
            }
            
            // ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπÊîØÊåÅ
            let tuziUrl = null;
            if (config.useTuziMultiSite) {
                tuziUrl = tuziSiteManager.getCurrentUrl();
                console.log(`üê∞ ÂÖîÂ≠êAPIÁ´ôÁÇπ: ${tuziSiteManager.getCurrentName()} - ${tuziUrl}`);
            }
            
            const targetUrl = useProxy ? proxyUrl : (tuziUrl || config.url);
            
            // ‰øùÂ≠òËØäÊñ≠‰ø°ÊÅØ
            debugInfo.requestMode = requestMode;
            debugInfo.targetUrl = targetUrl;
            debugInfo.networkError = '';
            
            console.log(`üåê AIËØ∑Ê±ÇÊ®°Âºè: ${requestMode}`);
            console.log(`üåê ÁõÆÊ†áURL: ${targetUrl}`);
            console.log(`üåê ÂΩìÂâçÂüüÂêç: ${window.location.hostname}`);
            
            try {
                let response;
                const startTime = Date.now();
                
                // Âà§Êñ≠ÊòØÂê¶‰ΩøÁî®‰ª£ÁêÜÔºàÂøÖÈ°ª‰ΩøÁî®‰ª£ÁêÜÔºåAPI Key Âú®ÂêéÁ´ØÔºâ
                if (useProxy) {
                    // Á∫ø‰∏äÁéØÂ¢ÉÔºöÈÄöËøáÈòøÈáå‰∫ëÂáΩÊï∞‰ª£ÁêÜÔºàAPI Key Âú®ÂêéÁ´ØÁéØÂ¢ÉÂèòÈáèÔºâ
                    // üÜï ‰ΩøÁî®Êñ∞Áâà /api/analyze Êé•Âè£ÔºåÊîØÊåÅ Function Calling
                    const isAliyunProxy = proxyUrl === ALIYUN_PROXY_URL;
                    
                    if (isAliyunProxy) {
                        // ÈòøÈáå‰∫ë‰ª£ÁêÜÔºö‰ΩøÁî®Êñ∞Áâà /api/analyze Êé•Âè£ (Function Calling)
                        console.log('üì° ‰ΩøÁî®ÈòøÈáå‰∫ë‰ª£ÁêÜ /api/analyze Êé•Âè£ÔºàFunction CallingÔºâ');
                        
                        // ‰ªé prompt ‰∏≠ÊèêÂèñÂÆûÈôÖÊñáÊú¨ÂÜÖÂÆπ
                        let text = prompt;
                        if (prompt.includes('„ÄêËæìÂÖ•„Äë')) {
                            text = prompt.split('„ÄêËæìÂÖ•„Äë').pop().trim();
                        }
                        
                        // üÜï v3.0 ‰ΩøÁî®‰∏≠ÊÄßÂ≠óÊÆµÂêçÔºàÈÅøÂÖçÊïèÊÑüËØçÔºâ
                        const requestBody = {
                            p: provider,    // ÊúçÂä°ÂïÜ
                            t: text,        // ËæìÂÖ•ÊñáÊú¨
                            m: config.model,// Ê®°Âûã
                            e: true         // ÊòØÂê¶ÊèêÂèñÊï∞ÂÄº
                        };
                        
                        response = await fetch(`${proxyUrl}/api/analyze`, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestBody),
                            signal: controller.signal
                        });
                    } else {
                        // Cloudflare/ÂÖ∂‰ªñ‰ª£ÁêÜÔºö‰ΩøÁî®ÊóßÁâàÊé•Âè£
                        // üÜï v3.0 ‰ΩøÁî®‰∏≠ÊÄßÂ≠óÊÆµÂêç
                        console.log('‰ΩøÁî®‰ª£ÁêÜÊ®°ÂºèË∞ÉÁî®AI APIÔºàKeyÂú®ÂêéÁ´ØÔºâ');
                        const requestBody = {
                            p: provider,    // ÊúçÂä°ÂïÜ
                            prompt: prompt, // ÊóßÁâàÊé•Âè£‰ªçÈúÄ promptÔºàÂÖºÂÆπÔºâ
                            m: config.model // Ê®°Âûã
                        };
                        if (tuziUrl) {
                            requestBody.tuziUrl = tuziUrl;
                        }
                        response = await fetch(proxyUrl, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(requestBody),
                            signal: controller.signal
                        });
                    }
                } else {
                    // Êú¨Âú∞Ë∞ÉËØïÔºö‰ªçÈúÄÈÄöËøá‰ª£ÁêÜÔºàÂõ†‰∏∫KeyÂú®ÂêéÁ´ØÔºâ
                    console.log('‚ö†Ô∏è Áõ¥ËøûÊ®°ÂºèÂ∑≤Á¶ÅÁî®ÔºåËØ∑‰ΩøÁî®‰ª£ÁêÜÊ®°Âºè');
                    throw new Error('ËØ∑ÈÉ®ÁΩ≤ÈòøÈáå‰∫ëÂáΩÊï∞‰ª£ÁêÜÔºåAPI Key Â∑≤ÁßªËá≥ÂêéÁ´Ø');
                }
                
                clearTimeout(timeoutId);
                const elapsed = Date.now() - startTime;
                console.log(`üåê ËØ∑Ê±ÇËÄóÊó∂: ${elapsed}ms, Áä∂ÊÄÅÁ†Å: ${response.status}`);
                
                if (!response.ok) {
                    const err = await response.text();
                    debugInfo.networkError = `HTTP ${response.status}: ${err.substring(0, 200)}`;
                    throw new Error(`APIÈîôËØØ: ${response.status} - ${err}`);
                }
                
                const responseText = await response.text();
                console.log('AI APIÂéüÂßãÂìçÂ∫îÊñáÊú¨:', responseText);
                
                // ËÆ∞ÂΩïÂéüÂßãÂìçÂ∫îÔºàÁî®‰∫éËØäÊñ≠Ôºâ
                debugInfo.rawResponse = responseText.substring(0, 500);
                
                // Â∞ùËØïËß£Êûê JSON
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (parseErr) {
                    debugInfo.networkError = `JSONËß£ÊûêÂ§±Ë¥•: ${responseText.substring(0, 100)}`;
                    throw new Error('‰ª£ÁêÜËøîÂõûÈùûJSONÊï∞ÊçÆ: ' + responseText.substring(0, 100));
                }
                
                console.log('AI APIËß£ÊûêÂêé:', data);
                
                // Ê£ÄÊü•ÊòØÂê¶ÊúâÈîôËØØ‰ø°ÊÅØ
                if (data.error) {
                    debugInfo.networkError = `APIËøîÂõûÈîôËØØ: ${JSON.stringify(data.error).substring(0, 200)}`;
                    throw new Error(data.error.message || JSON.stringify(data.error));
                }
                
                // Ê£ÄÊü•ÂìçÂ∫îÁªìÊûÑ
                // üÜï Êñ∞ÁâàÈòøÈáå‰∫ë /api/analyze Ê†ºÂºè: { success: true, data: [...], model_used: "...", latency_ms: 123 }
                // ÂÖîÂ≠êAPIÊ†ºÂºè: { code: 0, data: { choices: [...] } }
                // Ê†áÂáÜOpenAIÊ†ºÂºè: { choices: [...] }
                
                let content = null;
                
                // Ê£ÄÊü•ÊòØÂê¶ÊòØÊñ∞Áâà /api/analyze ÂìçÂ∫î
                if (data.success !== undefined && data.data !== undefined) {
                    // üÜï Êñ∞Áâà Function Calling ÂìçÂ∫î
                    console.log('üì¶ Êî∂Âà∞ Function Calling ÂìçÂ∫î:', data);
                    if (data.success) {
                        // data.data ÊòØÊï∞ÁªÑÊ†ºÂºè: [{code, original, numbers, amount}, ...]
                        content = JSON.stringify(data.data);
                        console.log(`‚úÖ Function Calling ÊàêÂäü: Ê®°Âûã=${data.model_used}, ËÄóÊó∂=${data.latency_ms}ms`);
                        
                        // üìå ‰øùÂ≠òË∞ÉËØï‰ø°ÊÅØÔºàÁî®‰∫éÂèçÈ¶àÔºâ
                        debugInfo.modelUsed = data.model_used || 'unknown';
                        debugInfo.latencyMs = data.latency_ms || 0;
                        
                        // üîç „ÄêË∞ÉËØï‰ø°ÊÅØ„ÄëÊ∏ÖÊô∞Â±ïÁ§∫ AI ÊòØÂ¶Ç‰ΩïÁêÜËß£ËæìÂÖ•ÁöÑÔºàÊú¨Âú∞ÊòæÁ§∫ÔºåÂèØÁî®‰∏≠ÊñáÔºâ
                        // Á±ªÂûã‰ª£Âè∑‚Üí‰∏≠ÊñáÂêçÁß∞Êò†Â∞ÑÔºà‰ªÖÁî®‰∫éÊú¨Âú∞Êó•ÂøóÊòæÁ§∫Ôºâ
                        const CODE_NAME_MAP = {
                            'T01': 'ÁâπÁ†Å', 'TM': 'ÁâπÁ†Å', 'T': 'ÁâπÁ†Å',
                            'SXTM': 'ÁîüËÇñÁâπÁ†Å', 'SX': 'ÁîüËÇñ',
                            'BS': 'Ê≥¢Ëâ≤', 'BB': 'ÂçäÊ≥¢',
                            'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                            'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ', 'PTW': 'Âπ≥ÁâπÂ∞æÊï∞',
                            'LX': 'ÂÖ≠ËÇñ', 'TX': 'ÁâπËÇñ', 'HX': 'ÂêàËÇñ', 'ZX': 'Ê≠£ËÇñ',
                            'DP': 'ÂçïÂπ≥', 'DXDS': 'Â§ßÂ∞èÂçïÂèå',
                            'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â',
                            'BZ': '‰∏ç‰∏≠', 'LM': 'ËøûÁ†Å', 'ZH': 'ÊÄªÂíå',
                            'WX': '‰∫îË°å', 'JY': 'ÂÆ∂Èáé', 'UK': 'Êú™Áü•'
                        };
                        const ZODIAC_NAME_MAP = {
                            'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                            'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                            'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                        };
                        
                        console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #00bcd4');
                        console.log('%cüìä „ÄêAIÁêÜËß£ÁªìÊûúÂàÜÊûê„Äë‰ª•‰∏ãÊòØAIÂ¶Ç‰ΩïÊãÜÂàÜ‰Ω†ÁöÑËæìÂÖ•Ôºö', 'color: #00bcd4; font-weight: bold; font-size: 14px');
                        console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #00bcd4');
                        
                        let aiTotalAmount = 0;  // AIÁêÜËß£ÁöÑÊÄªÈáëÈ¢ù
                        
                        if (Array.isArray(data.data)) {
                            data.data.forEach((item, index) => {
                                const typeName = CODE_NAME_MAP[item.code] || item.code;
                                const numCount = item.numbers ? item.numbers.length : 0;
                                const itemTotal = numCount * (item.amount || 0);
                                aiTotalAmount += itemTotal;
                                
                                console.log(`%cÁ¨¨${index + 1}Êù°ËÆ∞ÂΩï:`, 'color: #ff9800; font-weight: bold');
                                console.log(`   üìù ÂéüÊñá: "${item.original}"`);
                                console.log(`   üè∑Ô∏è AIËØÜÂà´Á±ªÂûã: ${typeName}`);
                                console.log(`   üî¢ AIÊèêÂèñÁöÑ‰∏ãÊ≥®Âè∑Á†Å: ${item.numbers ? JSON.stringify(item.numbers) : 'Êó†'} (${numCount}‰∏™)`);
                                console.log(`   üí∞ AIÊèêÂèñÁöÑÊØèÊ≥®ÈáëÈ¢ù: ${item.amount || 'Êó†'}ÂÖÉ`);
                                if (item.zodiac_code) {
                                    const zodiacName = ZODIAC_NAME_MAP[item.zodiac_code] || item.zodiac_code;
                                    console.log(`   üêæ AIËØÜÂà´ÁöÑÁîüËÇñ: ${zodiacName}`);
                                }
                                console.log(`   üìä Êú¨Êù°Â∞èËÆ°: ${numCount}Ê≥® √ó ${item.amount || 0}ÂÖÉ = ${itemTotal}ÂÖÉ`);
                                console.log('   ---');
                            });
                            
                            console.log(`%cüí∞ AIÁêÜËß£ÁöÑÊÄª‰∏ãÊ≥®ÈáëÈ¢ù: ${aiTotalAmount}ÂÖÉ`, 'color: #ff5722; font-weight: bold; font-size: 13px');
                            
                            // üîç ËØäÊñ≠ÊèêÁ§∫
                            console.log('%cüí° „ÄêÂ¶Ç‰ΩïÂà§Êñ≠ÈóÆÈ¢ò„Äë:', 'color: #4caf50; font-weight: bold');
                            console.log('   - Â¶ÇÊûú‰∏äÈù¢"AIÊèêÂèñÁöÑÂè∑Á†Å/ÈáëÈ¢ù"Â∞±Â∑≤ÁªèÈîô‰∫Ü ‚Üí ÈóÆÈ¢òÂú®„ÄêÂêéÁ´ØÊèêÁ§∫ËØç„Äë');
                            console.log('   - Â¶ÇÊûú‰∏äÈù¢Ê≠£Á°ÆÔºå‰ΩÜÊúÄÁªàËÆ°ÁÆóÁªìÊûúÈîô‰∫Ü ‚Üí ÈóÆÈ¢òÂú®„ÄêÂâçÁ´ØËß£Êûê„Äë');
                        }
                        console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #00bcd4');
                    } else {
                        debugInfo.networkError = `APIËøîÂõûÈîôËØØ: ${data.error || 'Êú™Áü•ÈîôËØØ'}`;
                        throw new Error(data.error || 'AIÂàÜÊûêÂ§±Ë¥•');
                    }
                } else {
                    // ÊóßÁâàÂìçÂ∫îÊ†ºÂºè
                    const responseData = data.data || data;  // ÂÖîÂ≠êAPIÁöÑÊï∞ÊçÆÂú®data.dataÈáå
                    content = responseData.choices?.[0]?.message?.content;
                    if (!content && responseData.choices) {
                        debugInfo.networkError = `ÂìçÂ∫îÁªìÊûÑÂºÇÂ∏∏: choicesÂ≠òÂú®‰ΩÜcontent‰∏∫Á©∫`;
                    } else if (!content) {
                        debugInfo.networkError = `ÂìçÂ∫îÊó†choicesÂ≠óÊÆµ: ${JSON.stringify(data).substring(0, 200)}`;
                    }
                }
                
                // üê∞ ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπÔºöËØ∑Ê±ÇÊàêÂäü
                if (config.useTuziMultiSite && content) {
                    tuziSiteManager.onSuccess();
                }
                
                return content || null;
            } catch (e) {
                clearTimeout(timeoutId);
                console.error('üåê ÁΩëÁªúËØ∑Ê±ÇÂ§±Ë¥•:', e);
                
                const timeoutSec = timeoutMs / 1000;
                
                // üê∞ ÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπÔºöËØ∑Ê±ÇÂ§±Ë¥•ÔºåÂ∞ùËØïÂàáÊç¢Á´ôÁÇπ
                if (config.useTuziMultiSite && retryCount < TUZI_SITES.length) {
                    const hasNextSite = tuziSiteManager.onFailure();
                    if (hasNextSite) {
                        console.log(`üîÑ ÂàáÊç¢ÂÖîÂ≠êAPIÁ´ôÁÇπÂêéÈáçËØï...`);
                        await new Promise(r => setTimeout(r, 500));  // Á≠âÂæÖ0.5ÁßíÂêéÈáçËØï
                        return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                    }
                }
                
                if (e.name === 'AbortError') {
                    // Ë∂ÖÊó∂Êó∂Â∞ùËØïÈáçËØï‰∏ÄÊ¨°Ôºà‰ªÖÂØπÁõ¥ËøûÊ®°ÂºèÔºâ
                    if (config.region === 'direct' && retryCount < 1) {
                        console.log(`‚è±Ô∏è Á¨¨${retryCount + 1}Ê¨°Ë∂ÖÊó∂ÔºåÊ≠£Âú®ÈáçËØï...`);
                        return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                    }
                    debugInfo.networkError = `ËØ∑Ê±ÇË∂ÖÊó∂(${timeoutSec}Áßí)ÔºåAIÂìçÂ∫îÂ§™ÊÖ¢`;
                    throw new Error(`AIËØ∑Ê±ÇË∂ÖÊó∂(${timeoutSec}Áßí)`);
                }
                
                // ËØ¶ÁªÜËÆ∞ÂΩïÁΩëÁªúÈîôËØØ
                if (e.message.includes('Failed to fetch') || e.message.includes('NetworkError')) {
                    debugInfo.networkError = `ÁΩëÁªúÈîôËØØ: ${requestMode}ËØ∑Ê±ÇÂ§±Ë¥•ÔºåÂèØËÉΩÊòØCORS/ÁΩëÁªúÈóÆÈ¢ò`;
                    // ÁΩëÁªúÈîôËØØÊó∂‰πüÂ∞ùËØïÈáçËØïÔºàÈùûÂÖîÂ≠êAPIÂ§öÁ´ôÁÇπÊÉÖÂÜµÔºâ
                    if (!config.useTuziMultiSite && retryCount < 1) {
                        console.log(`üîÑ ÁΩëÁªúÈîôËØØÔºåÊ≠£Âú®ÈáçËØï...`);
                        await new Promise(r => setTimeout(r, 1000));  // Á≠âÂæÖ1ÁßíÂêéÈáçËØï
                        return callAIAPI(prompt, provider, apiKey, retryCount + 1);
                    }
                } else if (!debugInfo.networkError) {
                    debugInfo.networkError = e.message;
                }
                
                throw e;
            }
        }
        
        // „Äê‰øÆÂ§çÊâãÊú∫ËæìÂÖ•ÈóÆÈ¢ò„ÄëÂÖ®ËßíËΩ¨ÂçäËßí + Ê∏ÖÁêÜ‰∏çÂèØËßÅÂ≠óÁ¨¶ÔºàÂ¢ûÂº∫ÁâàÔºâ
        function normalizeFullWidth(str) {
            if (!str) return str;
            let result = str;
            
            // ========== 1. ÁßªÈô§iOS/ÊâãÊú∫ËæìÂÖ•Ê≥ï‰∫ßÁîüÁöÑ‰∏çÂèØËßÅÂ≠óÁ¨¶ ==========
            // Èõ∂ÂÆΩÂ≠óÁ¨¶ (Zero-width characters)
            result = result.replace(/[\u200B-\u200D\uFEFF]/g, '');
            // Èõ∂ÂÆΩÁ©∫Ê†º„ÄÅÈõ∂ÂÆΩËøûÊé•Á¨¶„ÄÅÈõ∂ÂÆΩÈùûËøûÊé•Á¨¶„ÄÅBOM
            
            // Âèò‰ΩìÈÄâÊã©Âô® (Variation Selectors) - iOSÂ∏∏ËßÅÈóÆÈ¢ò
            result = result.replace(/[\uFE00-\uFE0F]/g, '');
            
            // ËΩØËøûÂ≠óÁ¨¶
            result = result.replace(/\u00AD/g, '');
            
            // ÂÖ∂‰ªñ‰∏çÂèØËßÅÊéßÂà∂Â≠óÁ¨¶Ôºà‰øùÁïôÊç¢Ë°åÁ¨¶ \n \rÔºâ
            result = result.replace(/[\u0000-\u0009\u000B\u000C\u000E-\u001F\u007F-\u009F]/g, '');
            // Ê≥®Ôºö\u000A=\n, \u000D=\r Ë¢´‰øùÁïô
            
            // ÁªÑÂêàÁî®Ê†áËÆ∞ÔºàCombining MarksÔºâ- ÂèØËÉΩÂØºËá¥Â≠óÁ¨¶ÊòæÁ§∫ÂºÇÂ∏∏
            result = result.replace(/[\u0300-\u036F]/g, '');
            
            // ========== 2. ÂÖ®ËßíËΩ¨ÂçäËßí ==========
            // ÂÖ®ËßíÊï∞Â≠óËΩ¨ÂçäËßí (Ôºê-Ôºô ‚Üí 0-9)
            result = result.replace(/[Ôºê-Ôºô]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));
            
            // ÂÖ®ËßíÂ≠óÊØçËΩ¨ÂçäËßí (Ôº°-Ôº∫, ÔΩÅ-ÔΩö ‚Üí A-Z, a-z)
            result = result.replace(/[Ôº°-Ôº∫ÔΩÅ-ÔΩö]/g, c => String.fromCharCode(c.charCodeAt(0) - 0xFEE0));
            
            // ÂÖ®ËßíÁ©∫Ê†ºËΩ¨ÂçäËßí
            result = result.replace(/\u3000/g, ' ');
            
            // ‰∏çÈó¥Êñ≠Á©∫Ê†ºËΩ¨ÊôÆÈÄöÁ©∫Ê†º
            result = result.replace(/\u00A0/g, ' ');
            
            // ========== 3. ÁâπÊÆäÊï∞Â≠óÂ≠óÁ¨¶ËΩ¨Êç¢ ==========
            // ÂúàÊï∞Â≠ó ‚ë†-‚ë® ‚Üí 1-9
            const circledNums = {'\u2460':'1','\u2461':'2','\u2462':'3','\u2463':'4','\u2464':'5',
                                '\u2465':'6','\u2466':'7','\u2467':'8','\u2468':'9','\u2469':'10'};
            for (const [special, normal] of Object.entries(circledNums)) {
                result = result.split(special).join(normal);
            }
            
            // ‰∏äÊ†áÊï∞Â≠ó ‚Å∞-‚Åπ
            const superNums = {'\u2070':'0','\u00B9':'1','\u00B2':'2','\u00B3':'3','\u2074':'4',
                            '\u2075':'5','\u2076':'6','\u2077':'7','\u2078':'8','\u2079':'9'};
            for (const [special, normal] of Object.entries(superNums)) {
                result = result.split(special).join(normal);
            }
            
            // ========== 4. ÂÖ®ËßíÊ†áÁÇπËΩ¨ÂçäËßí ==========
            const punctMap = {
                '\uff0e': '.', '\uff0c': ',', '\u3001': ',', '\uff1a': ':', '\uff1b': ';',
                '\uff01': '!', '\uff1f': '?', '\u201c': '"', '\u201d': '"', '\u2018': "'", '\u2019': "'",
                '\uff08': '(', '\uff09': ')', '\u3010': '[', '\u3011': ']', '\uff5b': '{', '\uff5d': '}',
                '\uff0b': '+', '\uff0d': '-', '\uff1d': '=', '\uff0a': '*', '\uff0f': '/', '\uff05': '%',
                '\uff03': '#', '\uff06': '&', '\uff20': '@', '\uff04': '$', '\uff3e': '^', '\uff5c': '|',
                '\uff3c': '\\', '\uff5e': '~', '\uff40': '`', '\uff1c': '<', '\uff1e': '>',
                '\u2014': '-', '\u2013': '-', '\u2012': '-', '\u2010': '-', // ÂêÑÁßçÊ®™Á∫øËΩ¨ÂáèÂè∑
                '\u00D7': 'x', '\u2715': 'x', '\u2716': 'x', '\u2717': 'x', // ‰πòÂè∑ËΩ¨x
                '\u00F7': '/'  // Èô§Âè∑ËΩ¨ÊñúÊù†
            };
            for (const [full, half] of Object.entries(punctMap)) {
                result = result.split(full).join(half);
            }
            
            // ========== 5. ËßÑËåÉÂåñÊç¢Ë°åÂíåÁ©∫Ê†º ==========
            // Áªü‰∏ÄÊç¢Ë°åÁ¨¶‰∏∫ \n
            result = result.replace(/\r\n/g, '\n').replace(/\r/g, '\n');
            // Ê∏ÖÁêÜÊØèË°åÈ¶ñÂ∞æÁ©∫Ê†ºÔºå‰ΩÜ‰øùÁïôÊç¢Ë°å
            result = result.split('\n').map(line => line.replace(/[ \t]+/g, ' ').trim()).join('\n');
            // Ê∏ÖÁêÜÂ§ö‰∏™ËøûÁª≠Á©∫Ë°å‰∏∫Âçï‰∏™
            result = result.replace(/\n{3,}/g, '\n\n');
            
            // ========== 6. Ë∞ÉËØïÊó•Âøó ==========
            if (str !== result) {
                console.log('üì± Â≠óÁ¨¶ËßÑËåÉÂåñ:', {
                    ÂéüÂßã: str,
                    ÂéüÂßãÈïøÂ∫¶: str.length,
                    Â§ÑÁêÜÂêé: result,
                    Â§ÑÁêÜÂêéÈïøÂ∫¶: result.length,
                    ÂéüÂßãÂ≠óÁ¨¶Á†Å: [...str].map(c => c.charCodeAt(0).toString(16)).join(' ')
                });
            }
            
            return result;
        }
        
        // AIËß£Êûê‰∏ãÊ≥®‰ø°ÊÅØÔºà‰ºòÂåñÁâàÔºöZ‰ª£Âè∑Ê†ºÂºè + JSON‰øÆÂ§ç + ÈáçËØïÊú∫Âà∂Ôºâ
        async function parseWithAI(userInput) {
            // ‰ΩøÁî® getFormatSettings() Ëé∑ÂèñÂ∏¶ÈªòËÆ§ÂÄºÁöÑËÆæÁΩÆÔºàAPI Key Â∑≤Âú®ÂêéÁ´ØÔºâ
            const settings = getFormatSettings();
            if (!settings.aiEnabled) {
                return null;
            }
            
            // „ÄêÊ≠•È™§1„ÄëÈ¢ÑÂ§ÑÁêÜÔºöÂÖ®ËßíËΩ¨ÂçäËßíÔºåËß£ÂÜ≥ÊâãÊú∫ËæìÂÖ•ÈóÆÈ¢ò
            const originalInput = userInput;
            userInput = normalizeFullWidth(userInput);
            
            // ËÆ∞ÂΩïËßÑËåÉÂåñ‰ø°ÊÅØ
            if (originalInput !== userInput) {
                console.log('üì± Ê£ÄÊµãÂà∞ÁâπÊÆäÂ≠óÁ¨¶ÔºåÂ∑≤ËßÑËåÉÂåñ:', {
                    ÂéüÂßãËæìÂÖ•: originalInput,
                    ËßÑËåÉÂåñÂêé: userInput
                });
                debugInfo.normalizeInfo = `ÂéüÂßã(${originalInput.length}Â≠óÁ¨¶) ‚Üí ËßÑËåÉÂåñ(${userInput.length}Â≠óÁ¨¶)`;
            } else {
                debugInfo.normalizeInfo = '';
            }
            
            // „ÄêÊ≠•È™§2„ÄëüîÑ ÁîüËÇñ‰ª£Âè∑ËΩ¨Êç¢ÔºàÂêéÁ´ØÊ≠£ÂàôÂåπÈÖçÈúÄË¶Å Z ‰ª£Âè∑Ê†ºÂºèÔºâ
            const sanitizedInput = sanitizeText(userInput);
            console.log('üîÑ ‰ª£Âè∑ËΩ¨Êç¢:', userInput.substring(0, 30), '‚Üí', sanitizedInput.substring(0, 30));
            
            // ‰øùÂ≠òËΩ¨Êç¢ÂâçÂêéÁöÑÂØπÂ∫îÂÖ≥Á≥ªÔºàÁî®‰∫éË∞ÉËØïÔºâ
            debugInfo.originalInput = userInput;
            debugInfo.sanitizedInput = sanitizedInput;
            
            // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
            // ‚ïë     „ÄêAIÊèêÁ§∫ËØç v3.0„ÄëZ‰ª£Âè∑Ê†ºÂºè - ÂêéÁ´ØÊ≠£ÂàôÂåπÈÖçÈúÄË¶Å              ‚ïë
            // ‚ïë  ‰∏≠ÊñáÁîüËÇñÂ∑≤ËΩ¨Êç¢‰∏∫Z‰ª£Âè∑ÔºàÂ¶Ç Áæä‚ÜíZ8ÔºâÔºå‰æø‰∫éÊ≠£ÂàôÂåπÈÖç               ‚ïë
            // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
            const prompt = `‰Ω†ÊòØÊï∞ÊçÆÂàÜÁ±ªÂô®„ÄÇÂà§Êñ≠ÊØèÊù°Êï∞ÊçÆÁöÑÁ±ªÂûã‰ª£Âè∑„ÄÇ

    „ÄêÁ±ªÂûã‰ª£Âè∑„Äë
    TM/T=TÁ±ª SXTM=ZÈÄâÁ±ª SX=ZÁ±ª 
    C1/C2/C3=CÁ±ª C1S/C1D/C2B/C2X=CÂçäÁ±ª
    PT/PT1=PTÁ±ª1 PT2=PTÁ±ª2 PT3=PTÁ±ª3 PT4=PTÁ±ª4 PT5=PTÁ±ª5 PTW=PTÂ∞æÁ±ª
    LX6=LXÁ±ª HX=HXÁ±ª ZX=ZXÁ±ª DP=DPÁ±ª DXDS=Â§ßÂ∞èÂçïÂèåÁ±ª
    E2=E2Á±ª S3=S3Á±ª BZ5-BZ12=BZÁ±ª
    LM2Q/LM3Q/LM2Z/LM3Z/LMTC=LMÁ±ª
    ZH/ZHB/ZHX/ZHS/ZHD=ZHÁ±ª
    WXJ/WXM/WXS/WXH/WXT=WXÁ±ª
    JYJ/JYY=JYÁ±ª XS=XSÁ±ª DS=DSÁ±ª ODD/EVEN=Â•áÂÅ∂Á±ª

    „ÄêZ‰ª£Âè∑„ÄëZ1-Z12‰ª£Ë°®12ÁßçÂ±ûÊÄßÂàÜÁ±ª

    „ÄêËØÜÂà´ËßÑÂàô„ÄëÊåâ‰ºòÂÖàÁ∫ßÔºö
    1. Z‰ª£Âè∑+x/X/ÂêÑ+Êï∞ÂÄº ‚Üí SXTMÔºàÂ¶ÇÔºöZ5x10„ÄÅÈÄâZ12ÂêÑ20Ôºâ
    2. Âê´"T"Â≠ó ‚Üí TMÔºàÂ¶ÇÔºöT43 20Ôºâ
    3. Âê´PT/PT1 ‚Üí PT1 | PT2‚ÜíPT2 | PT3‚ÜíPT3 | PT4‚ÜíPT4 | PT5‚ÜíPT5
    4. Âê´PTW ‚Üí PTW
    5. Âê´LX6 ‚Üí LX6
    6. Âê´BZ+Êï∞Â≠ó ‚Üí BZÁ±ªÔºàBZ5/BZ6/.../BZ12Ôºâ
    7. Âê´E2 ‚Üí E2 | S3 ‚Üí S3
    8. Âê´HX ‚Üí HX | ZX ‚Üí ZX | DP ‚Üí DP
    9. Âê´C1/C2/C3 ‚Üí CÁ±ª | C1S/C2DÁ≠â ‚Üí CÂçäÁ±ª
    10. Âê´ZH ‚Üí ZHÁ±ª | WX‰ª£Âè∑ ‚Üí WXÁ±ª | JY‰ª£Âè∑ ‚Üí JYÁ±ª
    11. Âê´XS ‚Üí XS | DS ‚Üí DS | ODD ‚Üí ODD | EVEN ‚Üí EVEN
    12. "Â§ß/Â∞è/Âçï/Âèå"+Êï∞ÂÄº ‚Üí DXDS
    13. Z‰ª£Âè∑+Á∫ØÊï∞ÂÄº(Êó†xÊó†ÂêÑ) ‚Üí SX
    14. Á∫ØÊï∞Â≠ó+ÂêÑ+Êï∞ÂÄº ‚Üí TM

    „ÄêÁ§∫‰æã„Äë
    ËæìÂÖ•: ÈÄâZ12ÂêÑ10
    ËæìÂá∫: [["SXTM","ÈÄâZ12ÂêÑ10"]]

    ËæìÂÖ•: Z5x10
    ËæìÂá∫: [["SXTM","Z5x10"]]

    ËæìÂÖ•: Z11x80ÔºåZ9Z10x50
    ËæìÂá∫: [["SXTM","Z11x80"],["SXTM","Z9Z10x50"]]

    ËæìÂÖ•: Z12 10
    ËæìÂá∫: [["SX","Z12 10"]]

    ËæìÂÖ•: 10 12 20ÂêÑ30
    ËæìÂá∫: [["TM","10 12 20ÂêÑ30"]]

    ËæìÂÖ•: XSÂêÑ20
    ËæìÂá∫: [["XS","XSÂêÑ20"]]

    ËæìÂÖ•: DSÂêÑ30
    ËæìÂá∫: [["DS","DSÂêÑ30"]]

    ËæìÂÖ•: PT Z8 300ÔºåPT3 Z8Z10Z9 100Ôºå35Ôºå47ÔºåX10
    ËæìÂá∫: [["PT1","PT Z8 300"],["PT3","PT3 Z8Z10Z9 100"],["TM","35Ôºå47ÔºåX10"]]

    ËæìÂÖ•: BZ5 01,02,03,04,05ÂêÑ100
    ËæìÂá∫: [["BZ5","BZ5 01,02,03,04,05ÂêÑ100"]]

    ËæìÂÖ•: C1 100
    ËæìÂá∫: [["C1","C1 100"]]

    ËæìÂÖ•: 31.34ÂêÑ‰∫åÂçÅ
    ËæìÂá∫: [["TM","31.34ÂêÑ‰∫åÂçÅ"]]

    „ÄêËæìÂÖ•„Äë
    ${sanitizedInput}

    „ÄêËæìÂá∫„ÄëÂè™ËæìÂá∫JSONÊï∞ÁªÑÔºö`;

            // ‰øùÂ≠òËæìÂÖ•Âà∞Ë∞ÉËØï‰ø°ÊÅØ
            debugInfo.aiInput = sanitizedInput;  // ËÆ∞ÂΩï‰ª£Âè∑ËΩ¨Êç¢ÂêéÁöÑËæìÂÖ•
            debugInfo.lastError = '';
            
            try {
                console.log('ü§ñ ÂºÄÂßãË∞ÉÁî®AI APIÔºàZ‰ª£Âè∑Ê†ºÂºèÔºâ...');
                console.log('üîÑ ÂèëÈÄÅÁªôAIÁöÑÂÜÖÂÆπ:', sanitizedInput);
                
                const result = await callAIAPI(prompt, settings.aiProvider);
                console.log('ü§ñ AIËøîÂõûÂéüÂßãÁªìÊûú:', result);
                
                // ‰øùÂ≠òAIÂéüÂßãËæìÂá∫
                debugInfo.aiOutput = result || '(Á©∫)';
                
                if (result) {
                    // „ÄêÊ≠•È™§3„ÄëJSON‰øÆÂ§çÔºöÂ§ÑÁêÜAIÂèØËÉΩÁöÑÊ†ºÂºèÈîôËØØ
                    let jsonStr = repairJSON(result);
                    console.log('üîß JSON‰øÆÂ§çÂêé:', jsonStr);
                    
                    // Ëß£ÊûêJSON
                    let aiResult;
                    try {
                        aiResult = JSON.parse(jsonStr);
                    } catch (parseError) {
                        console.error('‚ùå JSONËß£ÊûêÂ§±Ë¥•:', parseError.message);
                        debugInfo.lastError = 'JSONËß£ÊûêÂ§±Ë¥•: ' + parseError.message;
                        return null;
                    }
                    
                    // „ÄêÊ≠•È™§4„ÄëÊ†°È™åÁªìÊûúÊ†ºÂºè
                    const validation = validateAIResult(aiResult);
                    if (!validation.valid) {
                        console.warn('‚ö†Ô∏è AIÁªìÊûúÊ†°È™åË≠¶Âëä:', validation.error);
                    }
                    
                    console.log('ü§ñ AIËØÜÂà´ÁªìÊûúÔºàZ‰ª£Âè∑Ôºâ:', aiResult);
                    
                    // „ÄêÊ≠•È™§5„ÄëËøòÂéü‰ª£Âè∑ÔºöZ‰ª£Âè∑‚Üí‰∏≠ÊñáÁîüËÇñ
                    const restoredResult = restoreAIResult(aiResult);
                    // v3.11.3 ÁßªÈô§ÂÜó‰ΩôÁöÑËøòÂéüÊó•Âøó
                    
                    // ‰øùÂ≠òËß£ÊûêÂêéÁöÑJSONÔºàËøòÂéüÂêéÁöÑÔºâ
                    debugInfo.aiParsed = restoredResult;
                    
                    // „Äê‰ª£Âè∑‚ÜíÁ±ªÂûãÂêçÊò†Â∞Ñ„ÄëÔºàÊâ©Â±ïÁâàÔºåÊîØÊåÅÊñ∞Êóß‰ª£Âè∑Ôºâ
                const CODE_TO_TYPE = {
                    // Âü∫Á°ÄÁ±ªÂûã
                    'T01': 'ÁâπÁ†Å', 'TM': 'ÁâπÁ†Å', 'T': 'ÁâπÁ†Å', 'SXTM': 'ÁîüËÇñÁâπÁ†Å', 'SX': 'ÁîüËÇñ',
                        // Ê≥¢Ëâ≤
                        'BS': 'Ê≥¢Ëâ≤', 'C1': 'Ê≥¢Ëâ≤', 'C2': 'Ê≥¢Ëâ≤', 'C3': 'Ê≥¢Ëâ≤',
                        'BB': 'ÂçäÊ≥¢', 'C1S': 'ÂçäÊ≥¢', 'C1D': 'ÂçäÊ≥¢', 'C1B': 'ÂçäÊ≥¢', 'C1X': 'ÂçäÊ≥¢',
                        'C2S': 'ÂçäÊ≥¢', 'C2D': 'ÂçäÊ≥¢', 'C2B': 'ÂçäÊ≥¢', 'C2X': 'ÂçäÊ≥¢',
                        'C3S': 'ÂçäÊ≥¢', 'C3D': 'ÂçäÊ≥¢', 'C3B': 'ÂçäÊ≥¢', 'C3X': 'ÂçäÊ≥¢',
                        // Âπ≥ÁâπÁ±ª
                        'PT': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                        'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ', 'PTW': 'Âπ≥ÁâπÂ∞æÊï∞',
                        // ÁîüËÇñÁªÑÂêà
                        'LX': 'ÂÖ≠ËÇñ', 'LX6': 'ÂÖ≠ËÇñ', 'TX': 'ÁâπËÇñ', 'HX': 'ÂêàËÇñ', 'ZX': 'Ê≠£ËÇñ',
                        // Âπ≥Á†Å
                        'DP': 'ÂçïÂπ≥', 'DXDS': 'Â§ßÂ∞èÂçïÂèå',
                        // ËøûÁ†Å
                        'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â',
                        'LM': 'ËøûÁ†Å', 'LM2Q': '‰∫åÂÖ®‰∏≠', 'LM3Q': '‰∏âÂÖ®‰∏≠', 
                        'LM2Z': '‰∫å‰∏≠Áâπ', 'LM3Z': '‰∏â‰∏≠Áâπ', 'LMTC': 'Áâπ‰∏≤',
                        // ‰∏ç‰∏≠
                        'BZ': '‰∏ç‰∏≠', 'BZ5': '‰∫î‰∏ç‰∏≠', 'BZ6': 'ÂÖ≠‰∏ç‰∏≠', 'BZ7': '‰∏É‰∏ç‰∏≠',
                        'BZ8': 'ÂÖ´‰∏ç‰∏≠', 'BZ9': '‰πù‰∏ç‰∏≠', 'BZ10': 'ÂçÅ‰∏ç‰∏≠',
                        'BZ11': 'ÂçÅ‰∏Ä‰∏ç‰∏≠', 'BZ12': 'ÂçÅ‰∫å‰∏ç‰∏≠',
                        // ÂÖ∂‰ªñ
                        'ZH': 'ÊÄªÂíå', 'ZHB': 'ÊÄªÂíåÂ§ß', 'ZHX': 'ÊÄªÂíåÂ∞è', 'ZHS': 'ÊÄªÂíåÂçï', 'ZHD': 'ÊÄªÂíåÂèå',
                        'WX': '‰∫îË°å', 'WXJ': '‰∫îË°å', 'WXM': '‰∫îË°å', 'WXS': '‰∫îË°å', 'WXH': '‰∫îË°å', 'WXT': '‰∫îË°å',
                        'JY': 'ÂÆ∂Èáé', 'JYJ': 'ÂÆ∂Èáé', 'JYY': 'ÂÆ∂Èáé',
                        'XS': 'Â∞èÊï∞', 'DS': 'Â§ßÊï∞', 'ODD': 'ÂçïÊï∞', 'EVEN': 'ÂèåÊï∞',
                        'UK': 'Êú™Áü•'
                    };
                    
                    // „ÄêÊ†∏ÂøÉ„ÄëÂ§ÑÁêÜËøòÂéüÂêéÁöÑÁªìÊûúÔºåÊèêÂèñÂÖ∑‰ΩìÊï∞ÂÄº
                    const bets = [];
                    
                    // üîç „ÄêÂâçÁ´ØËß£ÊûêËøáÁ®ã„ÄëÊó•Âøó
                    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #9c27b0');
                    console.log('%cüîÑ „ÄêÂâçÁ´ØËß£ÊûêËøáÁ®ã„ÄëÂ∞ÜAIËøîÂõûÁöÑÊï∞ÊçÆËΩ¨Êç¢‰∏∫‰∏ãÊ≥®ËÆ∞ÂΩïÔºö', 'color: #9c27b0; font-weight: bold; font-size: 14px');
                    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #9c27b0');
                    
                    if (Array.isArray(restoredResult)) {
                        for (const item of restoredResult) {
                            if (Array.isArray(item) && item.length >= 2) {
                                const code = item[0];
                                const raw = item[1];  // ËøôÈáåÊòØËøòÂéüÂêéÁöÑÂéüÊñá
                                const numbers = item[2];  // üÜï Function Calling ÊèêÂèñÁöÑÂè∑Á†Å
                                const amount = item[3];   // üÜï Function Calling ÊèêÂèñÁöÑÈáëÈ¢ù
                                const zodiacCode = item[4]; // üÜï ÁîüËÇñ‰ª£Âè∑ (SXTMÁî®)
                                const type = CODE_TO_TYPE[code] || code;
                                
                                const itemIndex = restoredResult.indexOf(item) + 1;
                                console.log(`%cÁ¨¨${itemIndex}Êù° ‚Üí ÂâçÁ´ØÂ§ÑÁêÜ:`, 'color: #9c27b0; font-weight: bold');
                                console.log(`   üì• ËæìÂÖ•: ‰ª£Âè∑=${code}, ÂéüÊñá="${raw}"`);
                                console.log(`   üîÑ ËΩ¨Êç¢: ${code} ‚Üí ${type}`);
                                
                                let extracted = [];
                                
                                // üÜï v3.3 T01 + zodiacCodeÔºöÁîüËÇñÊ†ºÂºèÁöÑÁâπÁ†ÅÔºàÈÄöËøáZ‰ª£Âè∑ÈÄâÂè∑Ôºâ
                                // ÁîüËÇñÁâπÁ†ÅÊú¨Ë¥®‰∏äÊòØÁâπÁ†ÅÁöÑ‰∏ÄÁßç‰∏ãÊ≥®Ê†ºÂºèÔºåÁªü‰∏ÄÊòæÁ§∫‰∏∫"ÁâπÁ†Å"
                                if (code === 'T01' && zodiacCode && amount) {
                                    console.log('‚ú® T01(ÁîüËÇñÊ†ºÂºè): ‰ΩøÁî® zodiacCode Â±ïÂºÄÂè∑Á†Å', { zodiacCode, amount });
                                    // Â∞Ü Z1-Z12 ËΩ¨Êç¢‰∏∫ÁîüËÇñÂêçÁß∞
                                    const ZODIAC_MAP = {
                                        'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                                        'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                                        'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                                    };
                                    const zodiacName = ZODIAC_MAP[zodiacCode] || zodiacCode;
                                    // Ëé∑ÂèñËØ•ÁîüËÇñÂØπÂ∫îÁöÑÂè∑Á†ÅÔºà‰ΩøÁî® LHC_DATA.shengxiaoÔºâ
                                    const zodiacNumbers = LHC_DATA.shengxiao[zodiacName] || [];
                                    for (const num of zodiacNumbers) {
                                        extracted.push({
                                            type: 'ÁâπÁ†Å',  // üÜï v3.3 Áªü‰∏ÄÊòæÁ§∫‰∏∫"ÁâπÁ†Å"
                                            value: String(num).padStart(2, '0'),
                                            zodiac: zodiacName,  // ‰øùÁïôÁîüËÇñ‰ø°ÊÅØÁî®‰∫éÊòæÁ§∫
                                            amount: amount,
                                            raw: raw
                                        });
                                    }
                                }
                                // üÜï Â¶ÇÊûú Function Calling Â∑≤ÁªèÊèêÂèñ‰∫Ü numbers Âíå amountÔºåÁõ¥Êé•‰ΩøÁî®
                                else if (numbers && Array.isArray(numbers) && numbers.length > 0 && amount) {
                                    console.log(`   ‚úÖ Êï∞ÊçÆÊù•Ê∫ê: AIÂ∑≤ÊèêÂèñ (Êó†ÈúÄÊ≠£Âàô)`);
                                    console.log(`   üî¢ Âè∑Á†Å: ${JSON.stringify(numbers)}`);
                                    console.log(`   üí∞ ÈáëÈ¢ù: ${amount}ÂÖÉ/Ê≥®`);
                                    // Ê†πÊçÆÁ±ªÂûãÁîüÊàê‰∏ãÊ≥®Êï∞ÊçÆ
                                    if (type === 'ÁâπÁ†Å') {
                                        for (const num of numbers) {
                                            extracted.push({
                                                type: 'ÁâπÁ†Å',
                                                value: String(num).padStart(2, '0'),
                                                amount: amount,
                                                raw: raw
                                            });
                                        }
                                    } else {
                                        // ÂÖ∂‰ªñÁ±ªÂûãÔºöÊØè‰∏™Âè∑Á†Å‰∏ÄÊ≥®
                                        for (const num of numbers) {
                                            extracted.push({
                                                type: type,
                                                value: String(num).padStart(2, '0'),
                                                amount: amount,
                                                raw: raw
                                            });
                                        }
                                    }
                                }
                                // üÜï v3.3 ÂÖºÂÆπÊóßÁâàSXTM‰ª£Âè∑ÔºàÈÄêÊ≠•Â∫üÂºÉÔºâ
                                else if (code === 'SXTM' && zodiacCode && amount) {
                                    console.log('‚ö†Ô∏è Êî∂Âà∞ÊóßÁâàSXTM‰ª£Âè∑ÔºåÂ∞ÜËΩ¨Êç¢‰∏∫T01Â§ÑÁêÜ:', { zodiacCode, amount });
                                    // Â∞Ü Z1-Z12 ËΩ¨Êç¢‰∏∫ÁîüËÇñÂêçÁß∞
                                    const ZODIAC_MAP = {
                                        'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                                        'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                                        'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                                    };
                                    const zodiacName = ZODIAC_MAP[zodiacCode] || zodiacCode;
                                    // Ëé∑ÂèñËØ•ÁîüËÇñÂØπÂ∫îÁöÑÂè∑Á†Å
                                    const zodiacNumbers = LHC_DATA.shengxiao[zodiacName] || [];
                                    for (const num of zodiacNumbers) {
                                        extracted.push({
                                            type: 'ÁâπÁ†Å',  // üÜï v3.3 Áªü‰∏ÄÊòæÁ§∫‰∏∫"ÁâπÁ†Å"
                                            value: String(num).padStart(2, '0'),
                                            zodiac: zodiacName,
                                            amount: amount,
                                            raw: raw
                                        });
                                    }
                                }
                                // „ÄêÂ∑≤‰ºòÂåñ„ÄëÂêéÁ´ØÊú™ËøîÂõûÊï∞ÊçÆÊó∂ÔºåËÆ∞ÂΩïË≠¶Âëä
                                else {
                                    console.log(`   ‚ö†Ô∏è ÂêéÁ´ØÊú™ËøîÂõûnumbers/amountÔºåÂéüÊñá: "${raw}"`);
                                    // ‰∏çÂÜç‰ΩøÁî®Êú¨Âú∞Ê≠£ÂàôÊèêÂèñÔºåÁ≠âÂæÖÂêéÁ´ØÂÆåÂñÑ
                                    extracted = [{
                                        type: type,
                                        value: raw,
                                        amount: 0,
                                        raw: raw,  // üÜï ‰øùÁïôÂéüÊñá
                                        parseError: 'ÂêéÁ´ØÊú™ÊèêÂèñÊï∞ÂÄº'
                                    }];
                                }
                                
                                // ÊòæÁ§∫Êú¨Êù°Â§ÑÁêÜÁªìÊûú
                                if (extracted && extracted.length > 0) {
                                    const itemTotal = extracted.reduce((sum, b) => sum + (b.amount || 0), 0);
                                    console.log(`   üì§ ËæìÂá∫: ${extracted.length}Ê≥®, Â∞èËÆ°${itemTotal}ÂÖÉ`);
                                    extracted.forEach((bet, i) => {
                                        console.log(`      ${i+1}. ${bet.type} ${bet.value} ${bet.amount}ÂÖÉ`);
                                    });
                                    bets.push(...extracted);
                                } else {
                                    console.log(`   ‚ùå ËæìÂá∫: 0Ê≥® (Ëß£ÊûêÂ§±Ë¥•)`);
                                }
                                console.log('   ---');
                            }
                        }
                    } else if (restoredResult.items && Array.isArray(restoredResult.items)) {
                        // „ÄêÂ∑≤‰ºòÂåñ„ÄëÂÖºÂÆπÊóßÊ†ºÂºè - Áõ¥Êé•‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑÊï∞ÊçÆ
                        console.log('‚ö†Ô∏è Êî∂Âà∞ÊóßÊ†ºÂºèÊï∞ÊçÆÔºåÁõ¥Êé•‰ΩøÁî®ÂêéÁ´ØËøîÂõûÂÜÖÂÆπ');
                        for (const item of restoredResult.items) {
                            bets.push({
                                type: item.type || 'Êú™Áü•',
                                value: item.raw || '',
                                amount: item.amount || 0,
                                numbers: item.numbers || []
                            });
                        }
                    }
                    
                    // üîç „ÄêË∞ÉËØï‰ø°ÊÅØ„ÄëÂâçÁ´ØÂ§ÑÁêÜÁªìÊûúÊ±áÊÄª
                    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #e91e63');
                    console.log('%cüìã „ÄêÂâçÁ´ØÂ§ÑÁêÜÁªìÊûúÊ±áÊÄª„Äë', 'color: #e91e63; font-weight: bold; font-size: 14px');
                    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #e91e63');
                    
                    // üì∫ ÊòæÁ§∫ÂΩìÂ§©ÂºÄÂ•ñ‰ø°ÊÅØ
                    const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø', am: 'Êæ≥Èó®' };
                    const currentType = appState.currentLotteryType || 'xam';
                    const currentData = appState.lotteryData[currentType];
                    const lotteryNumbers = currentData?.numbers || [];
                    const tema = lotteryNumbers[6]; // ÁâπÁ†Å
                    
                    if (currentData && lotteryNumbers.length === 7) {
                        const numsStr = lotteryNumbers.slice(0, 6).map(n => String(n).padStart(2, '0')).join(' ');
                        const temaStr = String(tema).padStart(2, '0');
                        console.log(`   üé∞ ÂΩìÊúüÂºÄÂ•ñ: ${typeNames[currentType]} Á¨¨${currentData.issue}Êúü`);
                        console.log(`   üî¢ ÂºÄÂ•ñÂè∑Á†Å: ${numsStr} + ÁâπÁ†Å ${temaStr}`);
                    } else {
                        console.log(`   üé∞ ÂΩìÊúüÂºÄÂ•ñ: Êú™ËÆæÁΩÆ`);
                    }
                    console.log('   ---');
                    
                    // Ëé∑ÂèñËµîÁéáËÆæÁΩÆ
                    const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
                    const temaOdds = parseFloat(savedOdds['odds-tema']) || 43;
                    
                    // ËÆ°ÁÆó‰∏≠Â•ñÊÉÖÂÜµ - üÜï v3.3 Áªü‰∏Ä‰ΩøÁî®"ÁâπÁ†Å"Á±ªÂûã
                    let winBets = [];
                    let totalWinAmount = 0;
                    
                    if (tema) {
                        bets.forEach(bet => {
                            const betNum = parseInt(bet.value) || parseInt(bet.number);
                            // üÜï v3.3 ÁâπÁ†ÅÁ±ªÂûãÁªü‰∏ÄÂà§Êñ≠ÔºàÂåÖÊã¨ÁîüËÇñÊ†ºÂºèÔºâ
                            if (bet.type === 'ÁâπÁ†Å' && betNum === tema) {
                                const winAmount = bet.amount * temaOdds;
                                winBets.push({ ...bet, winAmount, odds: temaOdds });
                                totalWinAmount += winAmount;
                            }
                        });
                    }
                    
                    console.log(`   ÂÖ±ÁîüÊàê ${bets.length} Ê≥®‰∏ãÊ≥®:`);
                    
                    // üéØ ÊòæÁ§∫‰∏≠Â•ñ‰ø°ÊÅØ
                    if (winBets.length > 0) {
                        console.log('%c   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #4CAF50');
                        console.log('%c   üéØ ‰∏≠Â•ñÂè∑Á†Å:', 'color: #4CAF50; font-weight: bold');
                        winBets.forEach(wb => {
                            console.log(`%c      ${wb.type} ${wb.value} ‚Üí ${wb.amount}ÂÖÉ √ó ËµîÁéá${wb.odds} = ${wb.winAmount}ÂÖÉ`, 'color: #4CAF50');
                        });
                        console.log('%c   ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ', 'color: #4CAF50');
                    }
                    
                    // ÊåâÁ±ªÂûãÂàÜÁªÑÊòæÁ§∫
                    const betsByType = {};
                    let totalAmount = 0;
                    bets.forEach(bet => {
                        const key = bet.type;
                        if (!betsByType[key]) betsByType[key] = [];
                        betsByType[key].push(bet);
                        totalAmount += bet.amount || 0;
                    });
                    
                    for (const [type, typeBets] of Object.entries(betsByType)) {
                        const nums = typeBets.map(b => b.value).join(', ');
                        const amt = typeBets[0]?.amount || 0;
                        const typeTotal = typeBets.reduce((sum, b) => sum + (b.amount || 0), 0);
                        console.log(`   üìå ${type}: ${nums} (ÂêÑ${amt}ÂÖÉ, ÂÖ±${typeBets.length}Ê≥®) ${amt}√ó${typeBets.length}=${typeTotal}ÂÖÉ`);
                    }
                    
                    console.log('   ---');
                    console.log(`   üí∞ ‰∏ãÊ≥®ÈáëÈ¢ù: ${totalAmount}ÂÖÉ`);
                    
                    // ÊòæÁ§∫‰∏≠Â•ñÈáëÈ¢ùÂíåÁõà‰∫è
                    if (tema) {
                        console.log(`   üéÅ ‰∏≠Â•ñÈáëÈ¢ù: ${totalWinAmount}ÂÖÉ`);
                        const profit = totalWinAmount - totalAmount;
                        if (profit > 0) {
                            console.log(`%c   üìà ÊÄªËÆ°: ${totalWinAmount} - ${totalAmount} = +${profit}ÂÖÉ (ÁõàÂà©)`, 'color: #4CAF50; font-weight: bold');
                        } else if (profit < 0) {
                            console.log(`%c   üìâ ÊÄªËÆ°: ${totalWinAmount} - ${totalAmount} = ${profit}ÂÖÉ (‰∫èÊçü)`, 'color: #e91e63; font-weight: bold');
                        } else {
                            console.log(`   üìä ÊÄªËÆ°: ${totalWinAmount} - ${totalAmount} = 0ÂÖÉ (ÊåÅÂπ≥)`);
                        }
                    } else {
                        console.log('   ‚ö†Ô∏è Êú™ËÆæÁΩÆÂºÄÂ•ñÂè∑Á†ÅÔºåÊó†Ê≥ïËÆ°ÁÆó‰∏≠Â•ñ');
                    }
                    
                    console.log('%c‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'color: #e91e63');
                    
                    console.log('ü§ñ ÊúÄÁªàbets:', bets);
                    debugInfo.aiBets = bets;
                    return { bets, unparsed: [] };
                } else {
                    console.log('ü§ñ AIËøîÂõûÁ©∫ÁªìÊûú');
                    debugInfo.lastError = 'AIËøîÂõûÁ©∫ÁªìÊûú';
                }
            } catch (e) {
                console.error('ü§ñ AIËß£ÊûêÂ§±Ë¥•:', e);
                debugInfo.lastError = e.message || String(e);
            }
            return null;
        }
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë    „ÄêÂ∑≤ÁßªÈô§„ÄëÊú¨Âú∞Ê≠£ÂàôÊèêÂèñÊ®°Âùó - Â∑≤ËøÅÁßªÂà∞ÂêéÁ´Ø                    ‚ïë
        // ‚ïë    ÂêéÁ´Ø‰ΩøÁî® Function Calling ÂÆåÊàêÊï∞ÂÄºÊèêÂèñÔºåÂâçÁ´ØÁõ¥Êé•‰ΩøÁî®ÁªìÊûú    ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ==================== ÂèÇÊï∞ËÆæÁΩÆ ====================
        // v3.7 ÂèÇÊï∞ËÆæÁΩÆÈ°µÈù¢Áé∞Âú®ÂåÖÂê´AIÊô∫ËÉΩËß£ÊûêÂíåÂØºÂÖ•/ÂØºÂá∫ÈÖçÁΩÆ
        function saveParamSettings() {
            const settings = {
                // AIËÆæÁΩÆ
                aiEnabled: document.getElementById('ai-parse-enabled')?.checked !== false,
                aiProvider: localStorage.getItem('ai_provider') || 'openrouter'
            };
            localStorage.setItem('lhc_format_settings', JSON.stringify(settings));
            showAutoCloseToast('‚úÖ ÂèÇÊï∞ËÆæÁΩÆÂ∑≤‰øùÂ≠òÔºÅ');
            
            // ‰øùÂ≠òÂêéËøîÂõûÈ¶ñÈ°µ
            setTimeout(() => {
                showPage('page-main');
            }, 800);
        }
        
        function loadParamSettings() {
            // v3.7 Âä†ËΩΩAIËÆæÁΩÆÂà∞ÂèÇÊï∞ËÆæÁΩÆÈ°µÈù¢
            const saved = localStorage.getItem('lhc_format_settings');
            if (saved) {
                try {
                    const s = JSON.parse(saved);
                    const aiCheckbox = document.getElementById('ai-parse-enabled');
                    if (aiCheckbox) {
                        aiCheckbox.checked = s.aiEnabled !== false;
                    }
                } catch(e) {
                    console.error('Âä†ËΩΩÂèÇÊï∞ËÆæÁΩÆÂ§±Ë¥•:', e);
                }
            }
            
            // Âä†ËΩΩ‰øùÂ≠òÁöÑAIÊ®°ÂûãÈÄâÊã©
            const savedProvider = localStorage.getItem('ai_provider');
            if (savedProvider) {
                switchAIModel(savedProvider);
            }
        }
        
        function copyResult() {
            const result = document.getElementById('result-content').textContent;
            copyToClipboard(result);
        }
        
        // ÂÖºÂÆπiOSÁöÑÂ§çÂà∂ÂáΩÊï∞
        function copyToClipboard(text) {
            // ÊñπÊ≥ï1: Áé∞‰ª£API
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showAutoCloseToast('‚úÖ ÁªìÊûúÂ∑≤Â§çÂà∂ÔºÅ');
                }).catch(() => {
                    fallbackCopy(text);
                });
            } else {
                fallbackCopy(text);
            }
        }
        
        // Â§áÁî®Â§çÂà∂ÊñπÊ≥ïÔºàÂÖºÂÆπiOSÔºâ
        function fallbackCopy(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:200px;z-index:9999;font-size:16px;';
            document.body.appendChild(textarea);
            
            // iOSÁâπÊÆäÂ§ÑÁêÜ
            const range = document.createRange();
            range.selectNodeContents(textarea);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            textarea.setSelectionRange(0, text.length);
            
            try {
                document.execCommand('copy');
                showAutoCloseToast('‚úÖ ÁªìÊûúÂ∑≤Â§çÂà∂ÔºÅ');
            } catch (e) {
                showAutoCloseToast('‚ùå Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®Â§çÂà∂', 3000);
            }
            
            document.body.removeChild(textarea);
        }
        
        // Ëá™Âä®ÂÖ≥Èó≠ÁöÑÊèêÁ§∫ÔºàÁ∫¶2ÁßíÔºâ
        function showAutoCloseToast(msg, duration = 2000) {
            const toast = document.createElement('div');
            toast.innerHTML = msg;
            toast.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(0,0,0,0.85);color:#4CAF50;padding:15px 25px;border-radius:10px;font-size:14px;z-index:9999;';
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), duration);
        }
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë                    „ÄêÊ®°Âùó3„ÄëËµîÁéáËÆæÁΩÆÊ®°Âùó                        ‚ïë
        // ‚ïë  Êñá‰ª∂ÂàÜÁ¶ªÊó∂ÊèêÂèñÂà∞: js/odds.js                                   ‚ïë
        // ‚ïë  ÂäüËÉΩ: ËµîÁéáÁöÑËØªÂèñ„ÄÅ‰øùÂ≠ò„ÄÅÂØºÂÖ•ÂØºÂá∫                               ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ÁîüÊàêÂØºÂá∫Êï∞ÊçÆ
        function getExportData() {
            const allOdds = collectAllOdds();
            return {
                version: '1.0',
                type: 'odds_only',
                exportTime: new Date().toLocaleString('zh-CN'),
                odds: allOdds
            };
        }
        
        // ÁîüÊàêÊñá‰ª∂Âêç
        function getExportFileName() {
            const date = new Date();
            const dateStr = `${date.getFullYear()}${(date.getMonth()+1).toString().padStart(2,'0')}${date.getDate().toString().padStart(2,'0')}`;
            return `ËµîÁéáÈÖçÁΩÆ_${dateStr}.txt`;
        }
        
        // ÊòæÁ§∫ÂØºÂá∫ÈÄâÈ°π
        function showExportOptions() {
            document.getElementById('export-modal').classList.add('show');
        }
        
        function hideExportModal() {
            document.getElementById('export-modal').classList.remove('show');
        }
        
        // Â§çÂà∂ÈÖçÁΩÆÊñáÊú¨
        function exportCopy() {
            hideExportModal();
            const jsonStr = JSON.stringify(getExportData());
            copyToClipboard(jsonStr);
        }
        
        // ÊñπÂºè3Ôºö‰∏ãËΩΩÊñá‰ª∂
        function exportDownload() {
            hideExportModal();
            const jsonStr = JSON.stringify(getExportData());
            const fileName = getExportFileName();
            downloadFile(fileName, jsonStr);
        }
        
        // ‰∏ãËΩΩÊñá‰ª∂ÂáΩÊï∞
        function downloadFile(fileName, content) {
            const blob = new Blob([content], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = fileName;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            
            setTimeout(() => {
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }, 100);
            
            // ÊèêÁ§∫‰∏ãËΩΩ‰ΩçÁΩÆ
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let tip = '‚úÖ ÈÖçÁΩÆÊñá‰ª∂Â∑≤‰∏ãËΩΩÔºÅ\n\nÊñá‰ª∂ÂêçÔºö' + fileName;
            
            if (isIOS) {
                tip += '\n\nüìç Êü•ÊâæÊñá‰ª∂ÊñπÊ≥ïÔºö\n';
                tip += '1. ÊâìÂºÄ„ÄåÊñá‰ª∂„ÄçAppÔºàËìùËâ≤Êñá‰ª∂Â§πÂõæÊ†áÔºâ\n';
                tip += '2. ÁÇπÂáª„ÄåÊµèËßà„Äç\n';
                tip += '3. ÈÄâÊã©„Äå‰∏ãËΩΩÈ°π„ÄçÊàñ„ÄåiCloud‰∫ëÁõò„Äç';
            } else if (isAndroid) {
                tip += '\n\nüìç Êü•ÊâæÊñá‰ª∂ÊñπÊ≥ïÔºö\n';
                tip += '1. ÊâìÂºÄ„ÄåÊñá‰ª∂ÁÆ°ÁêÜ„ÄçÊàñ„ÄåÊàëÁöÑÊñá‰ª∂„Äç\n';
                tip += '2. ÊâæÂà∞„Äå‰∏ãËΩΩ„ÄçÊàñ„ÄåDownload„ÄçÊñá‰ª∂Â§π';
            } else {
                tip += '\n\nüìç Êü•ÊâæÊñá‰ª∂ÊñπÊ≥ïÔºö\n';
                tip += 'Êåâ Ctrl+J ÊâìÂºÄÊµèËßàÂô®‰∏ãËΩΩËÆ∞ÂΩï';
            }
            
            alert(tip);
        }
        
        function showExportFallback(jsonStr) {
            // ÂºπÁ™óÊòæÁ§∫ÈÖçÁΩÆ‰æõÊâãÂä®Â§çÂà∂
            const textarea = document.createElement('textarea');
            textarea.value = jsonStr;
            textarea.style.cssText = 'position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);width:80%;height:200px;z-index:9999;font-size:12px;';
            document.body.appendChild(textarea);
            textarea.select();
            
            alert('ËØ∑ÊâãÂä®Â§çÂà∂‰∏ãÈù¢ÁöÑÈÖçÁΩÆÊñáÊú¨Ôºö');
            
            setTimeout(() => {
                document.body.removeChild(textarea);
            }, 30000);
        }
        
        function showImportModal() {
            document.getElementById('import-modal').classList.add('show');
            document.getElementById('import-textarea').value = '';
            document.getElementById('import-file').value = '';
        }
        
        function hideImportModal() {
            document.getElementById('import-modal').classList.remove('show');
        }
        
        // Â§ÑÁêÜÊñá‰ª∂ÈÄâÊã©
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                document.getElementById('import-textarea').value = content;
                // Ëá™Âä®ÂØºÂÖ•
                importConfig();
            };
            reader.onerror = function() {
                alert('‚ùå Êñá‰ª∂ËØªÂèñÂ§±Ë¥•');
            };
            reader.readAsText(file);
        }
        
        function importConfig() {
            const jsonStr = document.getElementById('import-textarea').value.trim();
            
            if (!jsonStr) {
                alert('‚ùå ËØ∑Á≤òË¥¥ËµîÁéáÈÖçÁΩÆÊï∞ÊçÆÔºÅ');
                return;
            }
            
            try {
                const importData = JSON.parse(jsonStr);
                
                // È™åËØÅÊï∞ÊçÆÊ†ºÂºè
                if (!importData.version || !importData.odds) {
                    throw new Error('Êó†ÊïàÁöÑÈÖçÁΩÆÊ†ºÂºè');
                }
                
                // ÂØºÂÖ•ËµîÁéáËÆæÁΩÆ
                applyAllOdds(importData.odds);
                
                // ‰øùÂ≠òÂà∞Êú¨Âú∞Â≠òÂÇ®
                saveOddsToStorage();
                
                hideImportModal();
                alert('‚úÖ ËµîÁéáÈÖçÁΩÆÂØºÂÖ•ÊàêÂäüÔºÅ\n\nÂØºÂÖ•Êó∂Èó¥Ôºö' + (importData.exportTime || 'Êú™Áü•'));
                
            } catch (e) {
                alert('‚ùå ÂØºÂÖ•Â§±Ë¥•ÔºöÈÖçÁΩÆÊ†ºÂºèÈîôËØØ\n\nËØ∑Á°Æ‰øùÁ≤òË¥¥ÁöÑÊòØÂÆåÊï¥ÁöÑËµîÁéáÈÖçÁΩÆÊï∞ÊçÆ„ÄÇ');
            }
        }
        
        // Êî∂ÈõÜÊâÄÊúâËµîÁéáËæìÂÖ•Ê°ÜÁöÑÂÄº
        function collectAllOdds() {
            const odds = {};
            const inputs = document.querySelectorAll('.odds-item-input');
            inputs.forEach(input => {
                odds[input.id] = parseFloat(input.value) || 0;
            });
            return odds;
        }
        
        // Â∫îÁî®ÊâÄÊúâËµîÁéáÂà∞ËæìÂÖ•Ê°Ü
        function applyAllOdds(odds) {
            for (const [id, value] of Object.entries(odds)) {
                const input = document.getElementById(id);
                if (input) {
                    input.value = value;
                }
            }
        }
        
        // ‰øùÂ≠òËµîÁéáÂà∞Êú¨Âú∞Â≠òÂÇ®
        function saveOddsToStorage() {
            const odds = collectAllOdds();
            localStorage.setItem('lhc_odds', JSON.stringify(odds));
        }
        
        // Âä†ËΩΩËµîÁéá‰ªéÊú¨Âú∞Â≠òÂÇ®
        function loadOddsFromStorage() {
            const saved = localStorage.getItem('lhc_odds');
            if (saved) {
                try {
                    const odds = JSON.parse(saved);
                    applyAllOdds(odds);
                } catch(e) {}
            }
        }
        
        // ==================== ÁâàÊú¨Êõ¥Êñ∞Ê£ÄÊµã ====================
        const APP_VERSION = 'v3.2.0';  // ÂΩìÂâçÁâàÊú¨Âè∑Ôºå‰∏é sw.js ‰øùÊåÅ‰∏ÄËá¥ÔºàÁºìÂ≠ò‰ºòÂÖàÁ≠ñÁï•Ôºâ
        
        // Ê≥®ÂÜå Service Worker Âπ∂Ê£ÄÊµãÊõ¥Êñ∞
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js').then(registration => {
                console.log('‚úÖ Service Worker Ê≥®ÂÜåÊàêÂäü');
                
                // Ê£ÄÊµãÊõ¥Êñ∞
                registration.addEventListener('updatefound', () => {
                    const newWorker = registration.installing;
                    newWorker.addEventListener('statechange', () => {
                        if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
                            // ÊúâÊñ∞ÁâàÊú¨ÂèØÁî®ÔºåÊòæÁ§∫Êõ¥Êñ∞ÊèêÁ§∫
                            showUpdateNotification();
                        }
                    });
                });
            }).catch(err => {
                console.log('Service Worker Ê≥®ÂÜåÂ§±Ë¥•:', err);
            });
            
            // ÁõëÂê¨Êù•Ëá™ Service Worker ÁöÑÊ∂àÊÅØ
            navigator.serviceWorker.addEventListener('message', event => {
                if (event.data && event.data.type === 'SW_UPDATED') {
                    console.log('üì¶ Ê£ÄÊµãÂà∞Êñ∞ÁâàÊú¨:', event.data.version);
                    showUpdateNotification();
                }
            });
        }
        
        // ÊòæÁ§∫Êõ¥Êñ∞ÊèêÁ§∫
        function showUpdateNotification() {
            // Â¶ÇÊûúÂ∑≤ÁªèÊòæÁ§∫ËøáÔºå‰∏çÈáçÂ§çÊòæÁ§∫
            if (document.getElementById('update-notification')) return;
            
            const notification = document.createElement('div');
            notification.id = 'update-notification';
            notification.innerHTML = `
                <div style="position:fixed;bottom:20px;left:50%;transform:translateX(-50%);
                    background:linear-gradient(135deg,#667eea 0%,#764ba2 100%);
                    color:white;padding:15px 20px;border-radius:12px;
                    box-shadow:0 4px 20px rgba(0,0,0,0.3);z-index:99999;
                    display:flex;align-items:center;gap:15px;max-width:90%;
                    animation:slideUp 0.3s ease-out;">
                    <div style="flex:1;">
                        <div style="font-weight:bold;margin-bottom:3px;">üéâ ÂèëÁé∞Êñ∞ÁâàÊú¨</div>
                        <div style="font-size:12px;opacity:0.9;">ÁÇπÂáªÂà∑Êñ∞Ëé∑ÂèñÊúÄÊñ∞ÂäüËÉΩ</div>
                    </div>
                    <button onclick="location.reload()" 
                        style="background:white;color:#764ba2;border:none;
                        padding:8px 16px;border-radius:6px;font-weight:bold;
                        cursor:pointer;white-space:nowrap;">
                        Á´ãÂç≥Âà∑Êñ∞
                    </button>
                    <button onclick="this.parentElement.parentElement.remove()" 
                        style="background:transparent;color:white;border:none;
                        font-size:18px;cursor:pointer;padding:0 5px;">
                        ‚úï
                    </button>
                </div>
            `;
            document.body.appendChild(notification);
            
            // Ê∑ªÂä†Âä®ÁîªÊ†∑Âºè
            if (!document.getElementById('update-animation-style')) {
                const style = document.createElement('style');
                style.id = 'update-animation-style';
                style.textContent = `
                    @keyframes slideUp {
                        from { transform: translateX(-50%) translateY(100px); opacity: 0; }
                        to { transform: translateX(-50%) translateY(0); opacity: 1; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        // ÊòæÁ§∫ÂΩìÂâçÁâàÊú¨ÔºàÂèØÈÄâÔºåË∞ÉËØïÁî®Ôºâ
        console.log('üì± ÂÖ≠ÂèîÁÅ´ÁÆ≠ËÆ°ÁÆóÂô® ' + APP_VERSION);
        
        // ==================== ÂèçÈ¶àÁ≥ªÁªü ====================
        // Supabase ÈÖçÁΩÆ
        const SUPABASE_URL = 'https://cdvoeabekfuujaehxocl.supabase.co';
        const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNkdm9lYWJla2Z1dWphZWh4b2NsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjYxNjM3MDQsImV4cCI6MjA4MTczOTcwNH0.VrT3fJfKKXwwOF_dx1v_vMkNm1bXIEhhL_4iui0RKB8';
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë              ÂÖ®Â±èÂèçÈ¶àËØÑ‰ª∑Á≥ªÁªüÔºàÊñ∞ÁâàÔºâ                           ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
        // ‚ïë          Á≤æÂáÜÁ∫†ÈîôÁâà - ÂèçÈ¶àÁ≥ªÁªü JS ‰ª£Á†Å                          ‚ïë
        // ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù
        
        // ÂèçÈ¶àÊï∞ÊçÆÂ≠òÂÇ®
        let feedbackData = {
            items: [],      // ÊØèÈ°πÁöÑÈîôËØØÊ†áËÆ∞Êï∞ÊçÆ
            errorCount: 0   // Ê†áËÆ∞‰∏∫ÈîôËØØÁöÑÊù°ÁõÆÊï∞
        };
        
        // üÜï v3.4 Z‰ª£Âè∑Âà∞ÁîüËÇñÂêçÁß∞ÁöÑÊò†Â∞Ñ
        const Z_CODE_NAMES = {
            'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
            'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
            'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
        };
        
        // üÜï v3.4 ÂÆåÊï¥Áé©Ê≥ïÁ±ªÂûãÈÖçÁΩÆÔºàÊ†πÊçÆ„ÄäÁé©Ê≥ïËßÑÂàôÂ§ßÂÖ®„ÄãÔºâ
        const PLAY_TYPE_CONFIG = {
            // ========== T01 ÁâπÁ†ÅÁ±ª ==========
            'T01': {
                name: 'ÁâπÁ†Å',
                subTypes: null,  // Êó†Â≠êÁ±ªÂûãÔºåÂè™ÈúÄË¶ÅÂè∑Á†Å+ÈáëÈ¢ù
                winRule: 'ÊäïÊ≥®ÁöÑÂè∑Á†Å‰∏éÂºÄÂ•ñÁâπÁ†ÅÁõ∏ÂêåÂç≥‰∏≠Â•ñ',
                needFields: ['numbers', 'amount'],
                defaultOdds: 46
            },
            
            // ========== DXDS Â§ßÂ∞èÂçïÂèåÁ±ª ==========
            'DXDS': {
                name: 'Â§ßÂ∞èÂçïÂèå',
                subTypes: ['Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå'],
                winRule: {
                    'Â∞èÊï∞': 'ÁâπÁ†Å 1-24',
                    'Â§ßÊï∞': 'ÁâπÁ†Å 25-48',
                    'ÂçïÊï∞': 'ÁâπÁ†Å‰∏∫Â•áÊï∞',
                    'ÂèåÊï∞': 'ÁâπÁ†Å‰∏∫ÂÅ∂Êï∞',
                    'ÂêàÂ§ß': 'ÂêàÊï∞(ÂçÅ‰Ωç+‰∏™‰Ωç) 7-13',
                    'ÂêàÂ∞è': 'ÂêàÊï∞(ÂçÅ‰Ωç+‰∏™‰Ωç) 0-6',
                    'ÂêàÂçï': 'ÂêàÊï∞‰∏∫Â•áÊï∞',
                    'ÂêàÂèå': 'ÂêàÊï∞‰∏∫ÂÅ∂Êï∞'
                },
                special49: 'ÁâπÁ†Å49‰∏∫"Âíå"ÔºåÈÄÄÂõûÊú¨Èáë',
                needFields: ['subType', 'amount'],
                defaultOdds: 1.98
            },
            
            // ========== BS Ê≥¢Ëâ≤Á±ª ==========
            'BS': {
                name: 'Ê≥¢Ëâ≤',
                subTypes: ['Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢'],
                winRule: 'ÂºÄÂ•ñÁâπÁ†ÅÁöÑÈ¢úËâ≤‰∏éÊâÄÈÄâÈ¢úËâ≤Áõ∏ÂêåÂç≥‰∏≠Â•ñ',
                colorNums: {
                    'Á∫¢Ê≥¢': [1,2,7,8,12,13,18,19,23,24,29,30,34,35,40,45,46],
                    'ËìùÊ≥¢': [3,4,9,10,14,15,20,25,26,31,36,37,41,42,47,48],
                    'ÁªøÊ≥¢': [5,6,11,16,17,21,22,27,28,32,33,38,39,43,44,49]
                },
                needFields: ['subType', 'amount'],
                defaultOdds: 2.8
            },
            
            // ========== BB ÂçäÊ≥¢Á±ª ==========
            'BB': {
                name: 'ÂçäÊ≥¢',
                subTypes: ['Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è'],
                winRule: 'ÂºÄÂ•ñÁâπÁ†ÅÂêåÊó∂Êª°Ë∂≥È¢úËâ≤ÂíåÂ§ßÂ∞è/ÂçïÂèåÊù°‰ª∂Âç≥‰∏≠Â•ñ',
                needFields: ['subType', 'amount'],
                defaultOdds: 3.2
            },
            
            // ========== PT1 Âπ≥Áâπ‰∏ÄËÇñ ==========
            'PT1': {
                name: 'Âπ≥Áâπ‰∏ÄËÇñ',
                subTypes: ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'],
                winRule: '7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠ÊúâËØ•ÁîüËÇñÁöÑÂè∑Á†Å',
                needFields: ['zodiac', 'amount'],
                defaultOdds: 11
            },
            
            // ========== TX ÁâπËÇñ ==========
            'TX': {
                name: 'ÁâπËÇñ',
                subTypes: ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'],
                winRule: 'ÂºÄÂ•ñÁâπÁ†ÅÁöÑÁîüËÇñ‰∏éÊâÄÈÄâÁîüËÇñÁõ∏ÂêåÂç≥‰∏≠Â•ñ',
                needFields: ['zodiac', 'amount'],
                defaultOdds: 12
            },
            
            // ========== SX ÁîüËÇñ ==========
            'SX': {
                name: 'ÁîüËÇñ',
                subTypes: ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'],
                winRule: 'ÂºÄÂ•ñÁâπÁ†ÅÁöÑÁîüËÇñ‰∏éÊâÄÈÄâÁîüËÇñÁõ∏ÂêåÂç≥‰∏≠Â•ñ',
                needFields: ['zodiac', 'amount'],
                defaultOdds: 12
            },
            
            // ========== SX6 ÂÖ≠ËÇñ ==========
            'SX6': {
                name: 'ÂÖ≠ËÇñ',
                subTypes: null,
                winRule: 'ÁâπÁ†ÅÂ±û‰∫éÊâÄÈÄâ6‰∏™ÁîüËÇñ‰πã‰∏Ä',
                needFields: ['zodiacs', 'amount'],
                defaultOdds: 4.2
            },
            
            // ========== HX ÂêàËÇñ ==========
            'HX': {
                name: 'ÂêàËÇñ',
                subTypes: ['‰∫åÂêàËÇñ', '‰∏âÂêàËÇñ', 'ÂõõÂêàËÇñ'],
                winRule: 'ÁâπÁ†ÅÂ±û‰∫éÊâÄÈÄâÁîüËÇñ‰πã‰∏Ä',
                needFields: ['zodiacs', 'amount'],
                defaultOdds: { '‰∫åÂêàËÇñ': 6, '‰∏âÂêàËÇñ': 4, 'ÂõõÂêàËÇñ': 3 }
            },
            
            // ========== DP ÂçïÂπ≥/Âπ≥Á†Å ==========
            'DP': {
                name: 'ÂçïÂπ≥',
                subTypes: null,
                winRule: 'ÊäïÊ≥®Âè∑Á†ÅÂú®Ââç6‰∏™Ê≠£Á†Å‰∏≠Ôºà‰∏çÂê´ÁâπÁ†ÅÔºâ',
                needFields: ['numbers', 'amount'],
                defaultOdds: 9.8
            },
            
            // ========== E2 ‰∫å‰∏≠‰∫å ==========
            'E2': {
                name: '‰∫å‰∏≠‰∫å',
                subTypes: null,
                winRule: 'ÈÄâ2‰∏™Âè∑Á†ÅÔºåÂú®6‰∏™Ê≠£Á†ÅÔºà‰∏çÂê´ÁâπÁ†ÅÔºâ‰∏≠Ëá≥Â∞ëÂá∫Áé∞2‰∏™',
                needFields: ['numbers', 'amount'],
                defaultOdds: 38
            },
            
            // ========== S3 ‰∏â‰∏≠‰∏â ==========
            'S3': {
                name: '‰∏â‰∏≠‰∏â',
                subTypes: null,
                winRule: 'ÈÄâ3‰∏™Âè∑Á†ÅÔºåÂú®6‰∏™Ê≠£Á†ÅÔºà‰∏çÂê´ÁâπÁ†ÅÔºâ‰∏≠Ëá≥Â∞ëÂá∫Áé∞3‰∏™',
                needFields: ['numbers', 'amount'],
                defaultOdds: 180
            },
            
            // ========== BZ ‰∏ç‰∏≠Á±ª ==========
            'BZ5': { name: '‰∫î‰∏ç‰∏≠', subTypes: null, winRule: '5‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 2.8 },
            'BZ6': { name: 'ÂÖ≠‰∏ç‰∏≠', subTypes: null, winRule: '6‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 4.2 },
            'BZ7': { name: '‰∏É‰∏ç‰∏≠', subTypes: null, winRule: '7‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 7 },
            'BZ8': { name: 'ÂÖ´‰∏ç‰∏≠', subTypes: null, winRule: '8‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 12 },
            'BZ9': { name: '‰πù‰∏ç‰∏≠', subTypes: null, winRule: '9‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 20 },
            'BZ10': { name: 'ÂçÅ‰∏ç‰∏≠', subTypes: null, winRule: '10‰∏™Âè∑Á†ÅÂÖ®‰∏çÂá∫Áé∞Âú®7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠', needFields: ['numbers', 'amount'], defaultOdds: 35 },
            
            // ========== PTW Âπ≥ÁâπÂ∞æÊï∞ ==========
            'PTW': {
                name: 'Âπ≥ÁâπÂ∞æÊï∞',
                subTypes: ['0Â∞æ', '1Â∞æ', '2Â∞æ', '3Â∞æ', '4Â∞æ', '5Â∞æ', '6Â∞æ', '7Â∞æ', '8Â∞æ', '9Â∞æ'],
                winRule: '7‰∏™ÂºÄÂ•ñÂè∑Á†Å‰∏≠ÊúâËØ•Â∞æÊï∞ÁöÑÂè∑Á†Å',
                needFields: ['tail', 'amount'],
                defaultOdds: 2.8
            },
            
            // ========== ZX Ê≠£ËÇñ ==========
            'ZX': {
                name: 'Ê≠£ËÇñ',
                subTypes: ['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'],
                winRule: 'Ââç6‰∏™Ê≠£Á†Å‰∏≠ÊúâËØ•ÁîüËÇñÁöÑÂè∑Á†ÅÔºà‰∏çÂê´ÁâπÁ†ÅÔºâ',
                needFields: ['zodiac', 'amount'],
                defaultOdds: 2
            },
            
            // ========== ZH ÊÄªÂíå ==========
            'ZH': {
                name: 'ÊÄªÂíå',
                subTypes: ['ÊÄªÂíåÂ§ß', 'ÊÄªÂíåÂ∞è', 'ÊÄªÂíåÂçï', 'ÊÄªÂíåÂèå'],
                winRule: {
                    'ÊÄªÂíåÂ§ß': '7‰∏™Âè∑Á†Å‰πãÂíå >= 175',
                    'ÊÄªÂíåÂ∞è': '7‰∏™Âè∑Á†Å‰πãÂíå <= 174',
                    'ÊÄªÂíåÂçï': '7‰∏™Âè∑Á†Å‰πãÂíå‰∏∫Â•áÊï∞',
                    'ÊÄªÂíåÂèå': '7‰∏™Âè∑Á†Å‰πãÂíå‰∏∫ÂÅ∂Êï∞'
                },
                needFields: ['subType', 'amount'],
                defaultOdds: 1.98
            },
            
            // ========== JY ÂÆ∂Á¶ΩÈáéÂÖΩ ==========
            'JY': {
                name: 'ÂÆ∂Á¶ΩÈáéÂÖΩ',
                subTypes: ['ÂÆ∂Á¶Ω', 'ÈáéÂÖΩ'],
                winRule: {
                    'ÂÆ∂Á¶Ω': 'ÁâπÁ†ÅÁîüËÇñÂ±û‰∫éÁâõÈ©¨ÁæäÈ∏°ÁãóÁå™',
                    'ÈáéÂÖΩ': 'ÁâπÁ†ÅÁîüËÇñÂ±û‰∫éÈº†ËôéÂÖîÈæôËõáÁå¥'
                },
                needFields: ['subType', 'amount'],
                defaultOdds: 1.98
            },
            
            // ========== TS Â§¥Êï∞ ==========
            'TS': {
                name: 'Â§¥Êï∞',
                subTypes: ['0Â§¥', '1Â§¥', '2Â§¥', '3Â§¥', '4Â§¥'],
                winRule: 'ÁâπÁ†ÅÁöÑÂçÅ‰ΩçÊï∞ = ÊäïÊ≥®Â§¥Êï∞',
                needFields: ['subType', 'amount'],
                defaultOdds: 4
            },
            
            // ========== WS Â∞æÊï∞ ==========
            'WS': {
                name: 'Â∞æÊï∞',
                subTypes: ['0Â∞æ', '1Â∞æ', '2Â∞æ', '3Â∞æ', '4Â∞æ', '5Â∞æ', '6Â∞æ', '7Â∞æ', '8Â∞æ', '9Â∞æ'],
                winRule: 'ÁâπÁ†ÅÁöÑ‰∏™‰ΩçÊï∞ = ÊäïÊ≥®Â∞æÊï∞',
                needFields: ['subType', 'amount'],
                defaultOdds: 9
            },
            
            // ========== WX ‰∫îË°å ==========
            'WX': {
                name: '‰∫îË°å',
                subTypes: ['Èáë', 'Êú®', 'Ê∞¥', 'ÁÅ´', 'Âúü'],
                winRule: 'ÁâπÁ†ÅÂ±û‰∫éÊâÄÈÄâ‰∫îË°åÁöÑÂè∑Á†Å',
                needFields: ['subType', 'amount'],
                defaultOdds: 4.8
            }
        };
        
        // ÁÆÄÂåñÁöÑÁé©Ê≥ïÁ±ªÂûãÂàóË°®ÔºàÁî®‰∫é‰∏ãÊãâÊ°ÜÔºâ
        const PLAY_TYPES = [
            // Â§ßÁ±ª
            'ÁâπÁ†Å', 'Â§ßÂ∞èÂçïÂèå', 'Ê≥¢Ëâ≤', 'ÂçäÊ≥¢', 'Âπ≥Áâπ‰∏ÄËÇñ', 'ÁâπËÇñ', 'ÁîüËÇñ', 'ÂÖ≠ËÇñ', 'ÂêàËÇñ',
            'ÂçïÂπ≥', '‰∫å‰∏≠‰∫å', '‰∏â‰∏≠‰∏â', '‰∫î‰∏ç‰∏≠', 'ÂÖ≠‰∏ç‰∏≠', '‰∏É‰∏ç‰∏≠', 'ÂÖ´‰∏ç‰∏≠', '‰πù‰∏ç‰∏≠', 'ÂçÅ‰∏ç‰∏≠',
            'Âπ≥ÁâπÂ∞æÊï∞', 'Ê≠£ËÇñ', 'ÊÄªÂíå', 'ÂÆ∂Á¶ΩÈáéÂÖΩ', 'Â§¥Êï∞', 'Â∞æÊï∞', '‰∫îË°å',
            // DXDSÂ≠êÁ±ªÂûã
            'Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå',
            // BSÂ≠êÁ±ªÂûã
            'Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢',
            // BBÂ≠êÁ±ªÂûã
            'Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è',
            // ZHÂ≠êÁ±ªÂûã
            'ÊÄªÂíåÂ§ß', 'ÊÄªÂíåÂ∞è', 'ÊÄªÂíåÂçï', 'ÊÄªÂíåÂèå',
            // JYÂ≠êÁ±ªÂûã
            'ÂÆ∂Á¶Ω', 'ÈáéÂÖΩ',
            // TSÂ≠êÁ±ªÂûã
            '0Â§¥', '1Â§¥', '2Â§¥', '3Â§¥', '4Â§¥',
            // WS/PTWÂ≠êÁ±ªÂûã
            '0Â∞æ', '1Â∞æ', '2Â∞æ', '3Â∞æ', '4Â∞æ', '5Â∞æ', '6Â∞æ', '7Â∞æ', '8Â∞æ', '9Â∞æ',
            // WXÂ≠êÁ±ªÂûã
            'Èáë', 'Êú®', 'Ê∞¥', 'ÁÅ´', 'Âúü'
        ];
        
        // Ê†πÊçÆÁ±ªÂûã‰ª£Âè∑Ëé∑ÂèñÈÖçÁΩÆ
        function getTypeConfig(code) {
            return PLAY_TYPE_CONFIG[code] || PLAY_TYPE_CONFIG['T01'];
        }
        
        // Ê†πÊçÆÊòæÁ§∫ÂêçÁß∞Ëé∑Âèñ‰ª£Âè∑
        function getTypeCode(displayName) {
            for (const [code, config] of Object.entries(PLAY_TYPE_CONFIG)) {
                if (config.name === displayName) return code;
                if (config.subTypes && config.subTypes.includes(displayName)) return code;
            }
            return 'T01';
        }
        
        // ÊòæÁ§∫Á≤æÂáÜÁ∫†ÈîôÈ°µÈù¢
        function showFeedbackModal() {
            // ÂàùÂßãÂåñÂèçÈ¶àÊï∞ÊçÆ
            feedbackData = { items: [], errorCount: 0 };
            
            // Ëé∑ÂèñÂºÄÂ•ñ‰ø°ÊÅØ
            const currentType = appState.currentLotteryType || 'xam';
            const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø', am: 'Êæ≥Èó®' };
            const lotteryNums = appState.lotteryNumbers || [];
            const tema = lotteryNums[6];
            const issue = appState.lotteryData[currentType]?.issue || 'Êú™Áü•';
            const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
            const temaOdds = parseFloat(savedOdds['odds-tema']) || 43;
            
            // ËÆ°ÁÆóÊ±áÊÄª
            const totalBet = calcResults?.reduce((sum, r) => sum + r.amount, 0) || 0;
            const winCount = calcResults?.filter(r => r.isWin).length || 0;
            const winAmount = calcResults?.filter(r => r.isWin).reduce((sum, r) => sum + r.winAmount, 0) || 0;
            // üÜï v2.4.8 ‰ªéÁé©ÂÆ∂ËßíÂ∫¶ÔºöÁõà‰∫è = Ê¥æÂΩ© - ÊäïÂÖ•ÔºàÊ≠£Êï∞‰∏∫Ëµ¢Ôºâ
            const profit = winAmount - totalBet;
            
            // Êõ¥Êñ∞È°∂ÈÉ®Âõ∫ÂÆöÊ†è
            document.getElementById('fb-total-bet').textContent = totalBet;
            document.getElementById('fb-win-count').textContent = winCount;
            document.getElementById('fb-win-amount').textContent = winAmount;
            document.getElementById('fb-total-result').textContent = (profit >= 0 ? '+' : '') + profit;
            document.getElementById('fb-total-result').style.color = profit >= 0 ? '#4caf50' : '#f44336';
            
            // üÜï v3.11.24 Ê∏≤ÊüìÂºÄÂ•ñÂè∑Á†ÅÂå∫ÂüüÔºàÊîØÊåÅÂèåÂºÄÂ•ñÔºâ
            renderFeedbackLotterySection();
            
            // Ê∏≤ÊüìÂç°ÁâáÂàóË°®
            renderFeedbackCards();
            
            // Êõ¥Êñ∞Êèê‰∫§ÊåâÈíÆ
            updateErrorCount();
            
            // ÂàáÊç¢Âà∞ÂèçÈ¶àÈ°µÈù¢
            showPage('page-feedback');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üÜï v3.11.24 Ê∏≤ÊüìÂèçÈ¶àÈ°µÁöÑÂºÄÂ•ñÂå∫ÂüüÔºàÊúüÂè∑Âú®Â∑¶ÔºåÂè∑Á†ÅÁêÉÂú®Âè≥ÔºåÊîØÊåÅÂèåÂºÄÂ•ñÔºâ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        function renderFeedbackLotterySection() {
            const container = document.getElementById('fb-lottery-section');
            if (!container) return;
            
            const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø', am: 'Êæ≥Èó®' };
            const currentType = appState.currentLotteryType || 'xam';
            
            // üÜï v3.11.29 ‰ΩøÁî®Êõ¥ÂáÜÁ°ÆÁöÑÂΩ©ÁßçÂà§Êñ≠ÂèòÈáè
            const hasHK = window.currentCalcHasHK || false;
            const hasMC = window.currentCalcHasMC !== false;  // ÈªòËÆ§true
            const isMixed = window.currentCalcIsMixed || false;
            
            let html = '';
            
            if (isMixed) {
                // Ê∑∑Âêà‰∏ãÊ≥®ÔºöÊòæÁ§∫‰∏§‰∏™ÂºÄÂ•ñÁªìÊûú
                const xamData = appState.lotteryData['xam'];
                const hkData = appState.lotteryData['hk'];
                
                // Êñ∞Êæ≥Èó®ÂºÄÂ•ñ
                html += renderSingleLotteryRow('Êñ∞Êæ≥', xamData?.issue || 'Êú™Áü•', xamData?.numbers || []);
                // È¶ôÊ∏ØÂºÄÂ•ñ
                html += renderSingleLotteryRow('È¶ôÊ∏Ø', hkData?.issue || 'Êú™Áü•', hkData?.numbers || []);
            } else if (hasHK && !hasMC) {
                // Á∫ØÈ¶ôÊ∏ØÔºöÂè™ÊòæÁ§∫È¶ôÊ∏Ø
                const hkData = appState.lotteryData['hk'];
                html += renderSingleLotteryRow('È¶ôÊ∏Ø', hkData?.issue || 'Êú™Áü•', hkData?.numbers || []);
            } else {
                // Á∫ØÊæ≥Èó®ÊàñÈªòËÆ§ÔºöÂè™ÊòæÁ§∫Êñ∞Êæ≥
                const xamData = appState.lotteryData['xam'];
                const issue = xamData?.issue || 'Êú™Áü•';
                const nums = xamData?.numbers || appState.lotteryNumbers || [];
                html += renderSingleLotteryRow('Êñ∞Êæ≥', issue, nums);
            }
            
            container.innerHTML = html;
        }
        
        // Ê∏≤ÊüìÂçïË°åÂºÄÂ•ñÁªìÊûúÔºàÊúüÂè∑Âú®Â∑¶ÔºåÂè∑Á†ÅÁêÉÂú®Âè≥Ôºâ
        function renderSingleLotteryRow(typeName, issue, lotteryNums) {
            let ballsHtml = '';
            
            if (!lotteryNums || lotteryNums.length < 7) {
                ballsHtml = '<span style="color:#666;font-size:12px;">Êú™ËÆæÁΩÆ</span>';
            } else {
                // Ââç6‰∏™Âπ≥Á†Å
                for (let i = 0; i < 6; i++) {
                    const num = lotteryNums[i];
                    const color = getNumberColor(num);
                    const shengxiao = getNumberShengxiao(num);
                    ballsHtml += `
                        <div class="ball-wrapper" style="transform:scale(0.75);">
                            <div class="ball ${color} no-anim">${String(num).padStart(2, '0')}</div>
                            <div class="ball-info">${shengxiao}</div>
                        </div>
                    `;
                }
                
                ballsHtml += '<span class="ball-plus" style="font-size:12px;">+</span>';
                
                // ÁâπÁ†Å
                const special = lotteryNums[6];
                const specialColor = getNumberColor(special);
                const specialShengxiao = getNumberShengxiao(special);
                ballsHtml += `
                    <div class="ball-wrapper" style="transform:scale(0.75);">
                        <div class="ball ${specialColor} no-anim">${String(special).padStart(2, '0')}</div>
                        <div class="ball-info">${specialShengxiao}</div>
                    </div>
                `;
            }
            
            // ÊúüÂè∑È¢úËâ≤ÔºöÊñ∞Êæ≥Áî®Á∫¢Ëâ≤ÔºåÈ¶ôÊ∏ØÁî®ÁªøËâ≤
            const typeColor = typeName === 'È¶ôÊ∏Ø' ? '#4CAF50' : '#e94560';
            
            return `
                <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px;">
                    <span style="font-size:11px;color:${typeColor};font-weight:bold;white-space:nowrap;min-width:80px;">${typeName} Á¨¨${issue}Êúü</span>
                    <div class="lottery-balls" style="gap:2px;justify-content:flex-start;flex:1;flex-wrap:nowrap;">
                        ${ballsHtml}
                    </div>
                </div>
            `;
        }
        
        // ÂÖºÂÆπÊóß‰ª£Á†ÅÔºö‰øùÁïôÂéüÂáΩÊï∞‰ΩÜÂÜÖÈÉ®Ë∞ÉÁî®Êñ∞ÂáΩÊï∞
        function renderFeedbackLotteryBalls(lotteryNums) {
            renderFeedbackLotterySection();
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // üÜï v3.4 Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÂä®ÊÄÅÁîüÊàêÈîôËØØÊåâÈíÆ
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function generateErrorButtons(index, typeName, typeCode) {
            // ÈÄöÁî®ÈîôËØØÁ±ªÂûãÔºàÊâÄÊúâÁé©Ê≥ïÈÉΩÊúâÔºâ
            const commonErrors = [
                { err: 'type', label: 'Á±ªÂûãÈîô' },
                { err: 'amount', label: 'ÈáëÈ¢ùÈîô' }
            ];
            
            // Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫"Âè∑Á†ÅÈîô"ÊåâÈíÆ
            const needNumError = ['ÁâπÁ†Å', '‰∫å‰∏≠‰∫å', '‰∏â‰∏≠‰∏â', '‰∫î‰∏ç‰∏≠', 'ÂÖ≠‰∏ç‰∏≠', '‰∏É‰∏ç‰∏≠', 'ÂÖ´‰∏ç‰∏≠', '‰πù‰∏ç‰∏≠', 'ÂçÅ‰∏ç‰∏≠', 'ÂçïÂπ≥', 'Âπ≥Á†Å'];
            
            // Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫"Â≠êÁ±ªÂûãÈîô"ÊåâÈíÆ
            const needSubtypeError = ['Â§ßÂ∞èÂçïÂèå', 'Ê≥¢Ëâ≤', 'ÂçäÊ≥¢', 'Âπ≥Áâπ‰∏ÄËÇñ', 'ÁâπËÇñ', 'ÁîüËÇñ', 'ÂÖ≠ËÇñ', 'ÂêàËÇñ', 'ÊÄªÂíå', 'ÂÆ∂Á¶ΩÈáéÂÖΩ', 'Â§¥Êï∞', 'Â∞æÊï∞', '‰∫îË°å', 'Âπ≥ÁâπÂ∞æÊï∞', 'Ê≠£ËÇñ',
                                       'Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå',
                                       'Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢',
                                       'Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è'];
            
            let buttons = [];
            
            // 1. Á±ªÂûãÈîôÊåâÈíÆ
            buttons.push({ err: 'type', label: 'Á±ªÂûãÈîô' });
            
            // 2. ÈáëÈ¢ùÈîôÊåâÈíÆ
            buttons.push({ err: 'amount', label: 'ÈáëÈ¢ùÈîô' });
            
            // 3. Ê†πÊçÆÁ±ªÂûãÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫"Âè∑Á†ÅÈîô"
            if (needNumError.includes(typeName)) {
                buttons.push({ err: 'num', label: 'Âè∑Á†ÅÈîô' });
            }
            
            // 4. Ê†πÊçÆÁ±ªÂûãÂÜ≥ÂÆöÊòØÂê¶ÊòæÁ§∫"Â≠êÁ±ªÂûãÈîô"
            if (needSubtypeError.includes(typeName)) {
                buttons.push({ err: 'subtype', label: 'ÈÄâÈ°πÈîô' });
            }
            
            // 5. Ê≥®Êï∞ÈîôÔºàÊâÄÊúâÁé©Ê≥ïÔºâ
            buttons.push({ err: 'count', label: 'Ê≥®Êï∞Èîô' });
            
            // 6. ÂëΩ‰∏≠Âà§Êñ≠ÈîôÔºàÊâÄÊúâÁé©Ê≥ïÔºâ
            buttons.push({ err: 'win', label: 'ÂëΩ‰∏≠Èîô' });
            
            // ÁîüÊàêHTML
            return buttons.map(btn => `
                <span class="fb-err-tag" data-idx="${index}" data-err="${btn.err}" onclick="selectErrorType(${index},'${btn.err}',this)" 
                    style="flex:1;min-width:50px;padding:4px 2px;border-radius:3px;font-size:10px;cursor:pointer;background:rgba(255,255,255,0.1);color:#ccc;border:1px solid rgba(255,255,255,0.15);text-align:center;">
                    ${btn.label}
                </span>
            `).join('');
        }
        
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        // „ÄêÁÆÄÊ¥ÅÂèçÈ¶àÁ≥ªÁªü v4.0„Äë‰∏ÄÁõÆ‰∫ÜÁÑ∂ÁöÑÊñáÂ≠óÂàóË°®
        // Ê†ºÂºèÔºöÂéüÊñáÔºàÂè∑Á†ÅÂàóË°®ÔºâÊ≥®Êï∞√óÈáëÈ¢ù=ÊÄªÈ¢ù  Áõà‰∫è
        // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        
        function renderFeedbackCards() {
            const listEl = document.getElementById('feedback-list');
            
            if (!calcResults || calcResults.length === 0) {
                listEl.innerHTML = '<div style="text-align:center;color:#666;padding:40px;">ÊöÇÊó†ËÆ°ÁÆóÁªìÊûú</div>';
                return;
            }
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // „ÄêÊ≠•È™§1„ÄëÂàùÂßãÂåñÂèçÈ¶àÊï∞ÊçÆ
            // üÜï v2.4.5 ‰øÆÂ§çÔºö‰ΩøÁî® AI ËøîÂõûÁöÑÂéüÊñá (raw) ‰Ωú‰∏∫ÂàÜÁªÑ‰æùÊçÆÔºåÈÅøÂÖçË°åÂåπÈÖçÈîôËØØ
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // v3.2 ÂàùÂßãÂåñÂèçÈ¶àÊï∞ÊçÆÔºåÂåÖÂê´ÂÆåÊï¥Á≥ªÁªüËØÜÂà´ÂÄº
            // üÜï v3.11.7 ‰øÆÂ§ç‰∏ÄË°åÂ§öÁ±ªÂûãÊòæÁ§∫Ôºö‰ΩøÁî® raw ‰Ωú‰∏∫ÊòæÁ§∫ÊñáÊú¨Ôºå‰øùÁïôÂéüÂßãÂ≠óÊÆµ
            feedbackData.items = calcResults.map((r, index) => {
                // üÜï v3.11.7 ÂßãÁªà‰ΩøÁî®ÂêéÁ´ØËøîÂõûÁöÑ raw Â≠óÊÆµ‰Ωú‰∏∫ËØ•Êù°ÁõÆÁöÑÊòæÁ§∫ÊñáÊú¨
                // raw ÊòØÂêéÁ´ØÊãÜÂàÜÂêéÁöÑÂéüÊñáÔºåÁ≤æÁ°ÆÂØπÂ∫îËØ•Êù°ÁõÆÁöÑÂÜÖÂÆπ
                // originalLine ÊòØÁî®Êà∑ËæìÂÖ•ÁöÑÊï¥Ë°åÔºà‰∏ÄË°åÂ§öÁ±ªÂûãÊó∂‰ºöÂåÖÂê´ÂÖ∂‰ªñÁ±ªÂûãÂÜÖÂÆπÔºâ
                const rawText = r.raw || '';
                const originalText = r.originalLine || '';
                
                return {
                index: index,
                groupId: r.groupId || 1,
                lineId: r.lineId || `1-0`,
                // üÜï v3.11.7 ‰øùÁïôÂéüÂßãÁöÑ raw Â≠óÊÆµÔºàÁî®‰∫éÊòæÁ§∫ËØ•Êù°ÁõÆÂØπÂ∫îÁöÑÂÜÖÂÆπÔºâ
                raw: rawText,
                // üÜï v3.11.7 originalLine ‰øùÁïôÁî®Êà∑ËæìÂÖ•ÁöÑÊï¥Ë°åÔºàÁî®‰∫éÂàÜÁªÑÔºâ
                originalLine: originalText || rawText,
                // üÜï v3.8.3 ÁâáÊÆµÈ°∫Â∫èÔºàÁî®‰∫éÊéíÂ∫èÔºâ
                fragmentOrder: r.fragmentOrder !== undefined ? r.fragmentOrder : 9999,
                type: r.type || 'Êú™ËØÜÂà´',
                value: r.value || '',
                number: r.number || r.value || '',  // ÂçïÁã¨‰øùÂ≠òÂè∑Á†Å
                numbers: r.number || r.value || '',  // Êîπ‰∏∫Âè™‰øùÂ≠òÂçï‰∏™Âè∑Á†ÅÔºåËÅöÂêàÊó∂ÂÜçÂêàÂπ∂
                amount: r.amount || 0,
                isWin: r.isWin || false,
                winAmount: r.winAmount || 0,
                odds: r.odds || 43,
                zodiac: r.zodiac || null,  // üÜï ÁîüËÇñ‰ª£Âè∑
                isError: r.isError || false,
                hasError: false,
                errorType: '',        // type/amount/num/count/win
                correction: '',       // Áî®Êà∑Â°´ÂÜôÁöÑ‰øÆÊ≠£ÂÄº
                errorBlame: '',       // regex_service/calc_service
                systemValue: null,    // üÜï v3.2 Á≥ªÁªüËØÜÂà´ÂÄºÔºàÈÄâÊã©ÈîôËØØÁ±ªÂûãÊó∂Â°´ÂÖÖÔºâ
                note: '',             // üÜï v3.2 Â§áÊ≥®
                // üÜï v3.11.17 ÊåâÈîôËØØÁ±ªÂûãÁã¨Á´ãÂ≠òÂÇ®‰øÆÊ≠£ÂÄºÂíåÂ§áÊ≥®
                correctionsByType: {},  // { type: '', amount: '', num: '', count: '', win: '' }
                notesByType: {}         // { type: '', amount: '', num: '', count: '', win: '' }
            };});
            
            // üÜï Ë∞ÉËØïÊó•ÂøóÔºöÊòæÁ§∫Ëß£ÊûêÁªìÊûúËØ¶ÊÉÖ
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            console.log('üìä ÂèçÈ¶àÊï∞ÊçÆÂàùÂßãÂåñ:', feedbackData.items.length, 'Êù°');
            feedbackData.items.forEach((item, i) => {
                console.log(`  ${i+1}. [${item.lineId}] ${item.type} ${item.number} ${item.amount}ÂÖÉ | ÂéüÊñá: ${item.originalLine?.substring(0,20)}...`);
            });
            console.log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê');
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // „ÄêÊ≠•È™§2„ÄëÊåâÁ±ªÂûã+Áî®Êà∑ËæìÂÖ•Ë°åËÅöÂêàÊï∞ÊçÆ
            // üÜï v3.11.8 ‰øÆÂ§çÔºö‰ªéÁî®Êà∑ËæìÂÖ•Ë°å‰∏≠ÊèêÂèñËØ•Á±ªÂûãÂØπÂ∫îÁöÑÁâáÊÆµ‰Ωú‰∏∫ÊòæÁ§∫ÊñáÊú¨
            // ËÅöÂêàËßÑÂàôÔºöÂêå‰∏ÄÁ±ªÂûã + Âêå‰∏ÄÁî®Êà∑ËæìÂÖ•Ë°å ‚Üí ÂêàÂπ∂ÊòæÁ§∫
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üÜï v3.11.10 ÂÖ®Êñ∞ÂàÜÁªÑÈÄªËæëÔºöÊåâÁî®Êà∑ËæìÂÖ•È°∫Â∫è + Áõ∏ÈÇªÂêåÁ±ªÂûãÂêåÈáëÈ¢ùÂêàÂπ∂
            // Ê†∏ÂøÉËßÑÂàôÔºöÁõ∏ÈÇª + ÂêåÁ±ªÂûã + ÂêåÈáëÈ¢ù ‚Üí ÂêàÂπ∂ÔºõÂê¶Âàô ‚Üí Êñ∞Âª∫‰∏ÄÁªÑ
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            
            // Á¨¨1Ê≠•ÔºöÊåâ fragmentOrder ÊéíÂ∫èÊâÄÊúâ items
            const sortedItems = [...feedbackData.items].sort((a, b) => {
                const orderA = a.fragmentOrder !== undefined ? a.fragmentOrder : 9999;
                const orderB = b.fragmentOrder !== undefined ? b.fragmentOrder : 9999;
                return orderA - orderB;
            });
            
            // Á¨¨2Ê≠•ÔºöÊåâ"Áõ∏ÈÇª+ÂêåÁ±ªÂûã+ÂêåÈáëÈ¢ù"ËßÑÂàôÂàÜÁªÑ
            const sortedLines = [];
            let fbCurrentLine = null;
            
            // üÜï v3.11.11 ÂÖàÊåâ originalLine + type + amount È¢ÑÂàÜÁªÑÔºàÁ°Æ‰øùÂêå‰∏ÄÁî®Êà∑ËæìÂÖ•ÁöÑÂêåÁ±ªÂûãÂêåÈáëÈ¢ùËÉΩÂêàÂπ∂Ôºâ
            const preGroupMap = {};  // key: originalLine|||type|||amount ‚Üí items[]
            
            sortedItems.forEach((item) => {
                const originalLine = item.originalLine || '';
                const itemType = item.type || 'Êú™Áü•';
                const itemAmount = item.amount || 0;
                const groupKey = `${originalLine}|||${itemType}|||${itemAmount}`;
                
                if (!preGroupMap[groupKey]) {
                    preGroupMap[groupKey] = {
                        originalLine: originalLine,
                        type: itemType,
                        amount: itemAmount,
                        items: [],
                        groupId: item.groupId,
                        minOrder: item.fragmentOrder !== undefined ? item.fragmentOrder : 9999
                    };
                }
                preGroupMap[groupKey].items.push(item);
                // ËÆ∞ÂΩïÊúÄÂ∞èÁöÑ fragmentOrder Áî®‰∫éÊéíÂ∫è
                const order = item.fragmentOrder !== undefined ? item.fragmentOrder : 9999;
                if (order < preGroupMap[groupKey].minOrder) {
                    preGroupMap[groupKey].minOrder = order;
                }
            });
            
            // Êåâ minOrder ÊéíÂ∫èÈ¢ÑÂàÜÁªÑ
            const preGroups = Object.values(preGroupMap).sort((a, b) => a.minOrder - b.minOrder);
            
            // ËΩ¨Êç¢‰∏∫ sortedLines Ê†ºÂºè
            preGroups.forEach((pg) => {
                // Êî∂ÈõÜÊâÄÊúâ raw ÊñáÊú¨ÔºàÂéªÈáçÔºâ
                const displayTexts = [];
                pg.items.forEach(item => {
                    const rawText = item.raw || '';
                    if (rawText && !displayTexts.includes(rawText)) {
                        displayTexts.push(rawText);
                    }
                });
                
                sortedLines.push({
                    lineId: pg.items[0]?.lineId,
                    groupId: pg.groupId,
                    type: pg.type,
                    displayTexts: displayTexts,
                    items: pg.items,
                    perAmount: pg.amount,
                    fragmentOrder: pg.minOrder,
                    lastFragmentOrder: pg.items[pg.items.length - 1]?.fragmentOrder || pg.minOrder
                });
            });
            
            // üÜï v3.11.13 Á¨¨3Ê≠•ÔºöÁîüÊàêÊØèÁªÑÁöÑÊòæÁ§∫ÊñáÊú¨Ôºà‰ºòÂÖà‰ªéÁî®Êà∑ËæìÂÖ•ÊèêÂèñÂéüÂßãÁâáÊÆµÔºâ
            const fbUserInputText = document.getElementById('bet-input')?.value || '';
            const fbUserInputFragments = fbUserInputText.split(/[,Ôºå\n]+/).map(s => s.trim()).filter(Boolean);
            
            sortedLines.forEach(line => {
                let bestDisplayText = line.displayTexts.join(' ');
                
                // Â¶ÇÊûúÊúâÂ§ö‰∏™ raw ÊñáÊú¨ÔºåÂ∞ùËØï‰ªéÁî®Êà∑ËæìÂÖ•‰∏≠ÊèêÂèñÂéüÂßãÁâáÊÆµ
                if (line.displayTexts.length > 1) {
                    const typeKeywords = {
                        'Âπ≥Áâπ‰∏ÄËÇñ': ['Âπ≥Áâπ'], 'PT1': ['Âπ≥Áâπ'],
                        'Âπ≥Áâπ‰∫åËøûËÇñ': ['‰∫åÂèã'], 'PT2': ['‰∫åÂèã'],
                        'Âπ≥Áâπ‰∏âËøûËÇñ': ['‰∏âÂèã'], 'PT3': ['‰∏âÂèã'],
                        'ÂÖ≠ËÇñ': ['ÂÖ≠ËÇñ', '6ËÇñ'], 'SX6': ['ÂÖ≠ËÇñ', '6ËÇñ'],
                        'ÁâπÁ†Å': ['Áâπ'], 'T01': ['Áâπ'],
                    };
                    const keywords = typeKeywords[line.type] || [];
                    
                    // Âú®Áî®Êà∑ËæìÂÖ•ÁâáÊÆµ‰∏≠Êü•ÊâæÂåπÈÖçÁöÑÂéüÂßãÊñáÊú¨
                    for (const fragment of fbUserInputFragments) {
                        const hasKeyword = keywords.some(kw => fragment.includes(kw));
                        // Ê£ÄÊü•ÁâáÊÆµ‰∏≠ÊòØÂê¶ÂåÖÂê´ÊâÄÊúâ items ÁöÑÁîüËÇñ
                        const itemZodiacs = line.items.map(it => it.zodiac).filter(Boolean);
                        const allZodiacsInFragment = itemZodiacs.every(z => {
                            const zodiacName = CODE_TO_ZODIAC[z] || z;
                            return fragment.includes(zodiacName);
                        });
                        
                        if (hasKeyword && (itemZodiacs.length === 0 || allZodiacsInFragment)) {
                            bestDisplayText = fragment;
                            break;
                        }
                    }
                }
                
                line.displayText = bestDisplayText;
            });
            
            // Ë∞ÉËØïÊó•Âøó
            console.log('üìã v3.11.10 ÂèçÈ¶àÂàÜÁªÑÁªìÊûú:');
            sortedLines.forEach((line, i) => {
                console.log(`  [${i}] type=${line.type} | amt=${line.perAmount} | items=${line.items.length} | "${line.displayText?.substring(0,30)}..."`);
            });
            
            // Êåâ groupId ÂàÜÁªÑ
            const groupMap = {};
            sortedLines.forEach(line => {
                const gid = line.groupId;
                if (!groupMap[gid]) {
                    groupMap[gid] = [];
                }
                groupMap[gid].push(line);
            });
            
            // üÜï v3.11.15 Á°Æ‰øùÊØè‰∏™ÁªÑÂÜÖÁöÑË°åÊåâ fragmentOrder Ê≠£Á°ÆÊéíÂ∫èÔºàÁî®Êà∑ËæìÂÖ•È°∫Â∫èÔºâ
            Object.keys(groupMap).forEach(gid => {
                groupMap[gid].sort((a, b) => {
                    const orderA = a.fragmentOrder !== undefined ? a.fragmentOrder : 9999;
                    const orderB = b.fragmentOrder !== undefined ? b.fragmentOrder : 9999;
                    return orderA - orderB;
                });
            });
            
            const groupIds = Object.keys(groupMap).map(Number).sort((a, b) => a - b);
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // „ÄêÊ≠•È™§3„ÄëÁîüÊàêÁÆÄÊ¥ÅÊñáÂ≠óÊ†ºÂºè
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            let html = '';
            
            groupIds.forEach((gid) => {
                const lines = groupMap[gid];
                
                // ËÆ°ÁÆóÁªÑÁõà‰∫è
                const groupProfit = lines.reduce((sum, line) => {
                    return sum + line.items.reduce((s, it) => {
                        if (it.isError) return s;
                        return s + (it.isWin ? it.winAmount - it.amount : -it.amount);
                    }, 0);
                }, 0);
                
                // ÁªÑÊ†áÈ¢ò
                html += `
                <div class="fb-group" style="margin-bottom:12px;background:rgba(30,30,45,0.9);border-radius:8px;overflow:hidden;border:1px solid rgba(102,126,234,0.3);">
                    <div style="display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:rgba(102,126,234,0.2);border-bottom:1px solid rgba(102,126,234,0.3);">
                        <span style="color:#a78bfa;font-weight:bold;font-size:13px;">Á¨¨${gid}ÁªÑ</span>
                        <span style="font-size:13px;font-weight:bold;color:${groupProfit >= 0 ? '#4caf50' : '#f44336'};">${groupProfit >= 0 ? '+' : ''}${groupProfit}ÂÖÉ</span>
                    </div>
                    <div style="padding:8px 12px;">
                `;
                
                // ÊØèË°åÊï∞ÊçÆ
                lines.forEach((line, lineIdx) => {
                    const items = line.items.filter(it => !it.isError);
                    const errorItems = line.items.filter(it => it.isError);
                    
                    if (items.length === 0 && errorItems.length > 0) {
                        // üÜï v3.5 Ëß£ÊûêÂ§±Ë¥•ÁöÑË°å‰πüË¶ÅÊòæÁ§∫ÂèçÈ¶àÊåâÈíÆ
                        const errIndex = errorItems[0]?.index ?? feedbackData.items.findIndex(it => it.raw === line.displayText);
                        html += `
                        <div class="fb-line" data-index="${errIndex}" style="
                            display:flex;
                            align-items:center;
                            padding:8px 0;
                            border-bottom:${lineIdx < lines.length - 1 ? '1px dashed rgba(255,255,255,0.1)' : 'none'};
                            border-left:3px solid #f44336;
                            padding-left:8px;
                            margin-left:-8px;
                        ">
                            <div style="flex:1;font-size:12px;line-height:1.5;">
                                <span style="color:#f44336;font-weight:bold;font-size:14px;">‚úó</span>
                                <span style="color:#f44336;margin-left:4px;">Êú™ËØÜÂà´:</span>
                                <span style="color:#fbbf24;font-weight:bold;margin-left:4px;">${line.displayText || 'Êó†Ê≥ïËØÜÂà´'}</span>
                            </div>
                            <div style="display:flex;align-items:center;gap:8px;">
                                <span style="font-size:10px;color:#888;">ÁÇπÂáªÂèçÈ¶à‚Üí</span>
                                <span id="fb-err-btn-${errIndex}" onclick="toggleErrorPanel(${errIndex})" style="cursor:pointer;font-size:14px;opacity:0.7;">‚ùå</span>
                            </div>
                        </div>
                        
                        <!-- üÜï v3.5 Êú™ËØÜÂà´È°πÁõÆÁöÑÈîôËØØÈù¢Êùø -->
                        <div id="fb-err-panel-${errIndex}" data-type="Êú™ËØÜÂà´" data-code="UK" style="display:none;background:rgba(244,67,54,0.1);padding:8px;margin:4px 0 8px 0;border-radius:6px;border:1px solid rgba(244,67,54,0.2);">
                            <div style="font-size:10px;color:#f44336;margin-bottom:6px;font-weight:bold;">‚ö†Ô∏è ËØ∑ÈÄâÊã©Ê≠£Á°ÆÁöÑÁ±ªÂûã</div>
                            <div style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px;">
                                <span class="fb-err-tag" data-idx="${errIndex}" data-type="type" onclick="selectErrorType(${errIndex},'type','regex_service')" style="padding:4px 8px;background:rgba(255,255,255,0.1);border:1px solid rgba(255,255,255,0.15);border-radius:3px;font-size:10px;color:#ccc;cursor:pointer;">Á±ªÂûãÈîô</span>
                            </div>
                            <div id="fb-hint-${errIndex}" style="display:none;font-size:10px;color:#ffc107;margin-bottom:4px;padding:4px 6px;background:rgba(255,193,7,0.1);border-radius:3px;"></div>
                            <div id="fb-input-wrapper-${errIndex}" style="display:none;margin-bottom:6px;">
                                <div id="fb-type-select-${errIndex}">
                                    <select onchange="setCorrection(${errIndex}, this.value)" style="width:100%;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:11px;">
                                        <option value="">ÈÄâÊã©Ê≠£Á°ÆÁ±ªÂûã</option>
                                        ${PLAY_TYPES.map(t => `<option value="${t}">${t}</option>`).join('')}
                                    </select>
                                </div>
                            </div>
                            <textarea id="fb-note-${errIndex}" placeholder="Ë°•ÂÖÖËØ¥ÊòéÔºàÂèØÈÄâÔºâ" style="width:100%;height:40px;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:10px;resize:none;"></textarea>
                        </div>
                        `;
                        return;
                    }
                    
                    if (items.length === 0) {
                        // Ê≤°Êúâ‰ªª‰ΩïÈ°πÁõÆÔºåË∑≥Ëøá
                        return;
                    }
                    
                    // üÜï v3.11.11 Ëé∑ÂèñÁ±ªÂûãÂêçÁß∞Ôºà‰ª£Á†Å‚Üí‰∏≠ÊñáËΩ¨Êç¢Ôºâ
                    const rawTypeName = items[0]?.type || 'Êú™Áü•';
                    const FB_TYPE_CODE_TO_NAME = {
                        'T01': 'ÁâπÁ†Å', 'SXTM': 'ÁâπÁ†Å', 'ÁâπÁ†Å': 'ÁâπÁ†Å', 'ÁîüËÇñÁâπÁ†Å': 'ÁâπÁ†Å',
                        'XS': 'Â∞èÊï∞', 'DS': 'Â§ßÊï∞', 'ODD': 'ÂçïÊï∞', 'EVEN': 'ÂèåÊï∞',
                        'PT1': 'Âπ≥Áâπ‰∏ÄËÇñ', 'PT2': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT3': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                        'PT4': 'Âπ≥ÁâπÂõõËøûËÇñ', 'PT5': 'Âπ≥Áâπ‰∫îËøûËÇñ', 'PTW': 'Âπ≥ÁâπÂ∞æÊï∞',
                        // üÜï v3.11.11 ÂÖ≠ËÇñÁöÑÊâÄÊúâÂèØËÉΩ‰ª£Á†Å
                        'LX': 'ÂÖ≠ËÇñ', 'LX6': 'ÂÖ≠ËÇñ', 'SX6': 'ÂÖ≠ËÇñ', '6X': 'ÂÖ≠ËÇñ', 'LIUXIAO': 'ÂÖ≠ËÇñ',
                        'TX': 'ÁâπËÇñ', 'HX': 'ÂêàËÇñ', 'ZX': 'Ê≠£ËÇñ', 'SX': 'ÁîüËÇñ',
                        'BS': 'Ê≥¢Ëâ≤', 'BB': 'ÂçäÊ≥¢', 'DP': 'ÂçïÂπ≥', 'DXDS': 'Â§ßÂ∞èÂçïÂèå',
                        'E2': '‰∫å‰∏≠‰∫å', 'S3': '‰∏â‰∏≠‰∏â', 'BZ': '‰∏ç‰∏≠',
                        'LM': 'ËøûÁ†Å', 'ZH': 'ÊÄªÂíå', 'WX': '‰∫îË°å', 'JY': 'ÂÆ∂Èáé',
                        'Âπ≥Áâπ‰∏ÄËÇñ': 'Âπ≥Áâπ‰∏ÄËÇñ', 'Âπ≥Áâπ‰∫åËøûËÇñ': 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ': 'Âπ≥Áâπ‰∏âËøûËÇñ',
                        'ÂÖ≠ËÇñ': 'ÂÖ≠ËÇñ', 'Ê≥¢Ëâ≤': 'Ê≥¢Ëâ≤', 'ÂçäÊ≥¢': 'ÂçäÊ≥¢', 'Êú™Áü•': 'Êú™Áü•'
                    };
                    // üÜï v3.11.11 Êô∫ËÉΩËØÜÂà´ÔºöÂ¶ÇÊûúÊòæÁ§∫ÊñáÊú¨ÂåÖÂê´"ÂÖ≠ËÇñ"ÂÖ≥ÈîÆËØçÔºåÂº∫Âà∂ËÆæ‰∏∫ÂÖ≠ËÇñÁ±ªÂûã
                    let typeName = FB_TYPE_CODE_TO_NAME[rawTypeName] || rawTypeName;
                    const displayText = line.displayText || '';
                    if ((displayText.includes('ÂÖ≠ËÇñ') || displayText.includes('6ËÇñ')) && typeName === 'Êú™Áü•') {
                        typeName = 'ÂÖ≠ËÇñ';
                    }
                    
                    // üÜï v3.11.7 ‰øÆÂ§çÊ≥®Êï∞ËÆ°ÁÆóÔºöÂ§çÂêàÁ±ªÂûãÔºàÂÖ≠ËÇñ„ÄÅÂπ≥ÁâπËøûËÇñÁ≠âÔºâÂßãÁªàÊòØ1Ê≥®
                    // Ëøô‰∫õÁ±ªÂûãËôΩÁÑ∂Â±ïÂºÄ‰∫ÜÂ§öÊù°ËÆ∞ÂΩïÔºàÊØè‰∏™ÁîüËÇñ‰∏ÄÊù°ÔºâÔºå‰ΩÜÂÆûÈôÖÊòØ1Ê≥®ÈÄâÂ§ö‰∏™ÁîüËÇñ
                    const COMPOSITE_TYPES = ['ÂÖ≠ËÇñ', 'LX', 'LX6', 'SX6', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'PT2', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'PT3', 
                        'Âπ≥ÁâπÂõõËøûËÇñ', 'PT4', 'Âπ≥Áâπ‰∫îËøûËÇñ', 'PT5', 'ÂêàËÇñ', 'HX', '‰∫å‰∏≠‰∫å', 'E2', '‰∏â‰∏≠‰∏â', 'S3'];
                    const isCompositeType = COMPOSITE_TYPES.includes(rawTypeName) || COMPOSITE_TYPES.includes(typeName);
                    
                    // üÜï v3.11.10 ‰ΩøÁî®ÂàÜÁªÑÊó∂Â∑≤ËÆ°ÁÆóÂ•ΩÁöÑ perAmount
                    const unitAmount = line.perAmount || items[0]?.amount || 0;
                    
                    // üÜï v3.11.12 Ê£ÄÊµã"ÂêÑ"/"ÊØè"ÂÖ≥ÈîÆËØçÔºåËÆ°ÁÆóÁîüËÇñÊï∞Èáè‰Ωú‰∏∫Ê≥®Êï∞
                    // ËßÑÂàôÔºöÂπ≥Áâπ‰∏ÄËÇñÔºàPT1Ôºâ‰∏≠Ôºå"Âπ≥ÁâπÁå¥È∏°ÂêÑ200" = 2Ê≥®ÔºàÊØè‰∏™ÁîüËÇñ=1Ê≥®Ôºâ
                    const fbHasEachKeyword = /ÂêÑ|ÊØè/.test(displayText);
                    const fbZodiacCount = fbHasEachKeyword ? countZodiacsInText(displayText) : 0;
                    
                    // üÜï v3.11.12 Ê≥®Êï∞ËÆ°ÁÆóÔºöÂ§çÂêàÁ±ªÂûã=1Ê≥®ÔºõÊúâ"ÂêÑ"ÂÖ≥ÈîÆËØçÊó∂Áî®ÁîüËÇñÊï∞ÔºõÂê¶ÂàôÁî®itemsÊï∞
                    let betCount;
                    if (isCompositeType) {
                        betCount = 1;
                    } else if (fbHasEachKeyword && fbZodiacCount > 0) {
                        betCount = Math.max(items.length, fbZodiacCount);
                    } else {
                        betCount = items.length;
                    }
                    // üÜï v3.11.12 ÊÄªÈáëÈ¢ùÔºöÂ§çÂêàÁ±ªÂûã=ÂçïÊ≥®ÈáëÈ¢ùÔºõÂÖ∂‰ªñ=Ê≥®Êï∞√óÂçïÊ≥®ÈáëÈ¢ù
                    const totalAmount = isCompositeType ? unitAmount : (betCount * unitAmount);
                    const lineProfit = items.reduce((s, it) => {
                        return s + (it.isWin ? it.winAmount - it.amount : -it.amount);
                    }, 0);
                    // üÜï v3.11.14 ‰øÆÂ§çÂ§çÂêàÁ±ªÂûã‰∏≠Â•ñÂà§Êñ≠ÔºöPT2/PT3Á≠âËøûËÇñÁ±ªÂûãÂøÖÈ°ªÊâÄÊúâÁîüËÇñÈÉΩ‰∏≠ÊâçÁÆó‰∏≠Â•ñ
                    const isLianXiaoType = ['PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(rawTypeName) ||
                                           ['PT2', 'PT3', 'PT4', 'PT5', 'Âπ≥Áâπ‰∫åËøûËÇñ', 'Âπ≥Áâπ‰∏âËøûËÇñ', 'Âπ≥ÁâπÂõõËøûËÇñ', 'Âπ≥Áâπ‰∫îËøûËÇñ'].includes(typeName);
                    const hasWin = isLianXiaoType ? items.every(it => it.isWin) : items.some(it => it.isWin);
                    const firstIndex = items[0]?.index || 0;
                    
                    // üÜï v3.11.6 Ëé∑ÂèñÂØπÂ∫îÁ±ªÂûãÁöÑËµîÁéáÔºà‰ªéËµîÁéáËÆæÁΩÆËé∑ÂèñÔºâ
                    const savedOdds = JSON.parse(localStorage.getItem('lhc_odds') || '{}');
                    let typeOdds = items[0]?.odds || 1;
                    // Ê†πÊçÆÁ±ªÂûãËé∑ÂèñÊ≠£Á°ÆÁöÑËµîÁéá
                    if (typeName === 'ÁâπÁ†Å' || rawTypeName === 'T01' || rawTypeName === 'SXTM') {
                        typeOdds = parseFloat(savedOdds['odds-tema']) || 43;
                    } else if (typeName === 'Âπ≥Áâπ‰∏ÄËÇñ' || rawTypeName === 'PT1') {
                        typeOdds = parseFloat(savedOdds['odds-pingte1']) || 11;
                    } else if (typeName === 'Âπ≥Áâπ‰∫åËøûËÇñ' || rawTypeName === 'PT2') {
                        typeOdds = parseFloat(savedOdds['odds-pt2']) || 26;
                    } else if (typeName === 'Âπ≥Áâπ‰∏âËøûËÇñ' || rawTypeName === 'PT3') {
                        typeOdds = parseFloat(savedOdds['odds-pt3']) || 66;
                    } else if (typeName === 'ÂÖ≠ËÇñ' || rawTypeName === 'LX' || rawTypeName === 'LX6' || rawTypeName === 'SX6') {
                        typeOdds = parseFloat(savedOdds['odds-liuxiao']) || 4.2;
                    } else if (typeName === 'ÁîüËÇñ' || rawTypeName === 'SX') {
                        typeOdds = parseFloat(savedOdds['odds-shengxiao']) || 12;
                    } else if (typeName === 'Ê≥¢Ëâ≤' || rawTypeName === 'BS') {
                        typeOdds = parseFloat(savedOdds['odds-bose']) || 2;
                    } else if (typeName === 'ÂçäÊ≥¢' || rawTypeName === 'BB') {
                        typeOdds = parseFloat(savedOdds['odds-banbo']) || 4;
                    }
                    
                    // üÜï ‰∏≠Â•ñÁä∂ÊÄÅÊ†áËÆ∞
                    const statusIcon = hasWin 
                        ? '<span style="color:#4caf50;font-weight:bold;font-size:14px;">‚úì</span>' 
                        : '<span style="color:#f44336;font-weight:bold;font-size:14px;">‚úó</span>';
                    
                    // üÜï v2.4.8 È´ò‰∫Æ‰∏≠Â•ñÂè∑Á†ÅÁöÑÂáΩÊï∞
                    const fbTema = appState.lotteryNumbers?.[6];
                    function fbHighlightWinNum(text, winNum) {
                        if (!winNum) return text;
                        return String(text).replace(/(\d{1,2})/g, (match) => {
                            if (parseInt(match) === parseInt(winNum)) {
                                return `<span style="color:#ff4d4f;font-weight:bold;">${match}</span>`;
                            }
                            return match;
                        });
                    }
                    
                    // üÜï v3.6.1 ÊèêÂèñÊâÄÊúâÂè∑Á†ÅÂàóË°®ÔºàÂ±ïÂºÄÁ±ªÂûãÊòæÁ§∫Ôºâ
                    const allNumbers = items.map(it => {
                        const num = it.numbers || it.number || it.value || '';
                        return parseInt(num);
                    }).filter(n => n && !isNaN(n));
                    const uniqueNumbers = [...new Set(allNumbers)].sort((a,b) => a-b);
                    
                    // üÜï v3.3 Ê£ÄÊü•ÊòØÂê¶ÊòØÁîüËÇñÊ†ºÂºèÔºàÈÄöËøázodiacÂ≠óÊÆµÂà§Êñ≠Ôºâ
                    const hasZodiac = items.some(it => it.zodiac);
                    
                    // üÜï v3.11.7 ‰ΩøÁî® displayTextÔºàÁ≤æÁ°ÆÂØπÂ∫îËØ•Á±ªÂûãÁöÑÂÜÖÂÆπÔºâ
                    let displayOriginalLine = line.displayText || line.originalLine;
                    let numbersStr = '';
                    if (typeName === 'ÁâπÁ†Å' || typeName === 'ÁîüËÇñÁâπÁ†Å') {
                        displayOriginalLine = fbHighlightWinNum(line.displayText || line.originalLine, fbTema);
                        // üÜï v3.8.4 ÊåâÁîüËÇñÂàÜÁªÑÊòæÁ§∫Âè∑Á†ÅÔºàÂ¶ÇÔºöÁå¥10,22,34,46,Èæô02,14,26,38Ôºâ
                        if (hasZodiac && uniqueNumbers.length > 0) {
                            // Z‰ª£Âè∑ËΩ¨ÁîüËÇñÂêçÁß∞Êò†Â∞Ñ
                            const Z_TO_NAME = {
                                'Z1': 'Èº†', 'Z2': 'Áâõ', 'Z3': 'Ëôé', 'Z4': 'ÂÖî',
                                'Z5': 'Èæô', 'Z6': 'Ëõá', 'Z7': 'È©¨', 'Z8': 'Áæä',
                                'Z9': 'Áå¥', 'Z10': 'È∏°', 'Z11': 'Áãó', 'Z12': 'Áå™'
                            };
                            // ÊåâÁîüËÇñÂàÜÁªÑ
                            const zodiacGroups = {};
                            items.forEach(it => {
                                const z = it.zodiac;
                                const num = parseInt(it.numbers || it.number || it.value || '');
                                if (z && num && !isNaN(num)) {
                                    if (!zodiacGroups[z]) zodiacGroups[z] = [];
                                    if (!zodiacGroups[z].includes(num)) zodiacGroups[z].push(num);
                                }
                            });
                            // Êåâitems‰∏≠È¶ñÊ¨°Âá∫Áé∞ÁöÑÈ°∫Â∫èÊéíÂàóÁîüËÇñ
                            const zodiacOrder = [];
                            items.forEach(it => {
                                if (it.zodiac && !zodiacOrder.includes(it.zodiac)) {
                                    zodiacOrder.push(it.zodiac);
                                }
                            });
                            const parts = zodiacOrder.map(z => {
                                const nums = zodiacGroups[z] || [];
                                // Â∞ÜZ‰ª£Âè∑ËΩ¨Êç¢‰∏∫ÁîüËÇñÂêçÁß∞ÔºàÂ¶ÇZ9‚ÜíÁå¥Ôºâ
                                const zName = Z_TO_NAME[z] || z;
                                return zName + nums.map(n => String(n).padStart(2,'0')).join(',');
                            });
                            numbersStr = `Ôºà${fbHighlightWinNum(parts.join(','), fbTema)}Ôºâ`;
                        }
                    }
                    
                    // üÜï v3.8.4 Ê†ºÂºèÔºö‚úì/‚úó Á±ªÂûã(ËµîÁéáÂÄç): ÂéüÊñáÔºàÂè∑Á†ÅÂàóË°®ÔºâÈáëÈ¢ùÂÖÉ*Ê≥®Êï∞=ÊÄªÈ¢ùÂÖÉ  Áõà‰∫èÔºàÂà†Èô§"ÂêÑ"Â≠óÔºâ
                    html += `
                    <div class="fb-line" data-index="${firstIndex}" style="
                        display:flex;
                        align-items:center;
                        padding:8px 0;
                        border-bottom:${lineIdx < lines.length - 1 ? '1px dashed rgba(255,255,255,0.1)' : 'none'};
                        border-left:3px solid ${hasWin ? '#4caf50' : 'transparent'};
                        padding-left:${hasWin ? '8px' : '0'};
                        margin-left:${hasWin ? '-8px' : '0'};
                    ">
                        <div style="flex:1;font-size:12px;line-height:1.5;">
                            ${statusIcon}
                            <span style="color:#64b5f6;margin-left:4px;">${typeName}(${typeOdds}ÂÄç):</span>
                            <span style="color:#fbbf24;font-weight:bold;margin-left:4px;">${displayOriginalLine}</span>
                            ${numbersStr ? `<span style="color:#888;font-size:11px;">${numbersStr}</span>` : ''}
                            <span style="color:#aaa;margin-left:6px;">${unitAmount}ÂÖÉ*${betCount}Ê≥®=</span>
                            <span style="color:#fff;">${totalAmount}ÂÖÉ</span>
                        </div>
                        <div style="display:flex;align-items:center;gap:8px;">
                            <span style="font-size:13px;font-weight:bold;color:${lineProfit >= 0 ? '#4caf50' : '#f44336'};">${lineProfit >= 0 ? '+' : ''}${lineProfit}</span>
                            <span id="fb-err-btn-${firstIndex}" onclick="toggleErrorPanel(${firstIndex})" style="cursor:pointer;font-size:14px;opacity:0.5;">‚ùå</span>
                        </div>
                    </div>
                    
                    <!-- üÜï v3.4 ÈöêËóèÁöÑÈîôËØØÈù¢Êùø - Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÂä®ÊÄÅÊòæÁ§∫ÈÄâÈ°π -->
                    <div id="fb-err-panel-${firstIndex}" data-type="${typeName}" data-code="${items[0]?.code || 'T01'}" style="display:none;background:rgba(244,67,54,0.1);padding:8px;margin:4px 0 8px 0;border-radius:6px;border:1px solid rgba(244,67,54,0.2);">
                        <div style="font-size:10px;color:#f44336;margin-bottom:6px;font-weight:bold;">‚ö†Ô∏è Ê†áËÆ∞ÈîôËØØÁ±ªÂûã <span style="color:#888;font-weight:normal;">(${typeName})</span></div>
                        <!-- üÜï v3.4 Ê†πÊçÆÁ±ªÂûãÂä®ÊÄÅÊòæÁ§∫ÊåâÈíÆ -->
                        <div id="fb-err-btns-${firstIndex}" style="display:flex;flex-wrap:wrap;gap:4px;margin-bottom:6px;">
                            ${generateErrorButtons(firstIndex, typeName, items[0]?.code)}
                        </div>
                        <!-- Âä®ÊÄÅÊèêÁ§∫Âå∫Âüü -->
                        <div id="fb-hint-${firstIndex}" style="display:none;font-size:10px;color:#ffc107;margin-bottom:4px;padding:4px 6px;background:rgba(255,193,7,0.1);border-radius:3px;"></div>
                        <!-- üÜï v3.4 ËßÑÂàôËØ¥ÊòéÂå∫Âüü -->
                        <div id="fb-rule-${firstIndex}" style="display:none;font-size:10px;color:#888;margin-bottom:4px;padding:4px 6px;background:rgba(0,0,0,0.2);border-radius:3px;"></div>
                        <!-- Áªü‰∏ÄËæìÂÖ•Âå∫Âüü -->
                        <div id="fb-input-wrapper-${firstIndex}" style="display:none;margin-bottom:6px;">
                            <!-- Á±ªÂûãÈÄâÊã©‰∏ãÊãâÊ°Ü -->
                            <div id="fb-type-select-${firstIndex}" style="display:none;">
                                <select onchange="setCorrection(${firstIndex}, this.value)" style="width:100%;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:11px;">
                                    <option value="">ÈÄâÊã©Ê≠£Á°ÆÁ±ªÂûã</option>
                                    ${PLAY_TYPES.map(t => `<option value="${t}">${t}</option>`).join('')}
                                </select>
                            </div>
                            <!-- üÜï v3.4 Â≠êÁ±ªÂûãÈÄâÊã©‰∏ãÊãâÊ°ÜÔºàÊ†πÊçÆÂΩìÂâçÁ±ªÂûãÂä®ÊÄÅÁîüÊàêÔºâ -->
                            <div id="fb-subtype-select-${firstIndex}" style="display:none;">
                                <select id="fb-subtype-dropdown-${firstIndex}" onchange="setSubtypeCorrection(${firstIndex}, this.value)" style="width:100%;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:11px;">
                                    <!-- Âä®ÊÄÅÁîüÊàê -->
                                </select>
                            </div>
                            <!-- üÜï v3.4 ‰∏≠Â•ñÂà§Êñ≠ÈÄâÊã© -->
                            <div id="fb-win-select-${firstIndex}" style="display:none;">
                                <select onchange="setWinCorrection(${firstIndex}, this.value)" style="width:100%;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:11px;">
                                    <option value="">ÈÄâÊã©Ê≠£Á°ÆÁªìÊûú</option>
                                    <option value="should_win">Â∫îËØ•ÂëΩ‰∏≠ÔºàÁ≥ªÁªüËØØÂà§Êú™‰∏≠Ôºâ</option>
                                    <option value="should_not_win">‰∏çÂ∫îÂëΩ‰∏≠ÔºàÁ≥ªÁªüËØØÂà§‰∏≠Â•ñÔºâ</option>
                                    <option value="wrong_amount">ÂëΩ‰∏≠‰ΩÜÈáëÈ¢ùÈîôËØØ</option>
                                </select>
                            </div>
                            <!-- ÊñáÊú¨ËæìÂÖ•Ê°Ü -->
                            <input type="text" id="fb-correction-${firstIndex}" style="display:none;width:100%;padding:6px;background:#2a2a3e;color:#fff;border:1px solid rgba(255,255,255,0.15);border-radius:4px;font-size:11px;box-sizing:border-box;" oninput="setCorrection(${firstIndex}, this.value)">
                        </div>
                        <input type="text" id="fb-note-${firstIndex}" placeholder="ÂÖ∂‰ªñÂ§áÊ≥®ËØ¥ÊòéÔºàÈÄâÂ°´Ôºâ" oninput="setItemNote(${firstIndex}, this.value)" style="width:100%;padding:6px;background:rgba(0,0,0,0.2);color:#fff;border:1px solid rgba(255,255,255,0.08);border-radius:4px;font-size:10px;box-sizing:border-box;">
                    </div>
                    `;
                });
                
                html += `
                    </div>
                </div>
                `;
            });
            
            listEl.innerHTML = html;
        }
        
        // ÂàáÊç¢ÈîôËØØËØäÊñ≠Èù¢Êùø
        function toggleErrorPanel(index) {
            const panel = document.getElementById(`fb-err-panel-${index}`);
            const btn = document.getElementById(`fb-err-btn-${index}`);
            const line = document.querySelector(`.fb-line[data-index="${index}"]`);
            const item = feedbackData.items[index];
            
            if (!panel) return;
            
            if (panel.style.display === 'none') {
                // Â±ïÂºÄÈù¢Êùø
                panel.style.display = 'block';
                if (btn) btn.style.opacity = '1';
                if (line) line.style.background = 'rgba(244,67,54,0.1)';
                if (item) item.hasError = true;
            } else {
                // Êî∂Ëµ∑Èù¢Êùø - ÈáçÁΩÆÁä∂ÊÄÅ
                panel.style.display = 'none';
                if (btn) btn.style.opacity = '0.5';
                if (line) line.style.background = 'transparent';
                if (item) {
                    item.hasError = false;
                    item.errorType = '';
                    item.correction = '';
                    item.errorBlame = '';
                }
                
                // ÈáçÁΩÆÊâÄÊúâÊ†áÁ≠æÊ†∑Âºè
                document.querySelectorAll(`.fb-err-tag[data-idx="${index}"]`).forEach(tag => {
                    tag.style.background = 'rgba(255,255,255,0.1)';
                    tag.style.color = '#ccc';
                    tag.style.borderColor = 'rgba(255,255,255,0.15)';
                });
                
                // ÈöêËóèÂ≠êÈù¢Êùø v3.2
                const hintEl = document.getElementById(`fb-hint-${index}`);
                const inputWrapper = document.getElementById(`fb-input-wrapper-${index}`);
                const typeSelect = document.getElementById(`fb-type-select-${index}`);
                const correctionInput = document.getElementById(`fb-correction-${index}`);
                if (hintEl) hintEl.style.display = 'none';
                if (inputWrapper) inputWrapper.style.display = 'none';
                if (typeSelect) typeSelect.style.display = 'none';
                if (correctionInput) { correctionInput.style.display = 'none'; correctionInput.value = ''; }
            }
            
            updateErrorCount();
        }
        
        // üÜï v3.4 ÈÄâÊã©ÈîôËØØÁ±ªÂûã - Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÂä®ÊÄÅÊòæÁ§∫ÈÄâÈ°π
        function selectErrorType(index, errType, btnEl) {
            const item = feedbackData.items[index];
            const panel = document.getElementById(`fb-err-panel-${index}`);
            const currentType = panel?.dataset?.type || item.type;
            const currentCode = panel?.dataset?.code || item.code || 'T01';
            
            // üÜï v3.11.17 ‰øùÂ≠òÂΩìÂâçÔºàÊóßÔºâÈîôËØØÁ±ªÂûãÁöÑ‰øÆÊ≠£ÂÄºÂíåÂ§áÊ≥®
            const oldErrType = item.errorType;
            const oldCorrectionInput = document.getElementById(`fb-correction-${index}`);
            const oldNoteInput = document.getElementById(`fb-note-${index}`);
            
            if (oldErrType && oldCorrectionInput) {
                item.correctionsByType = item.correctionsByType || {};
                item.correctionsByType[oldErrType] = oldCorrectionInput.value || '';
            }
            if (oldErrType && oldNoteInput) {
                item.notesByType = item.notesByType || {};
                item.notesByType[oldErrType] = oldNoteInput.value || '';
            }
            
            item.errorType = errType;
            
            // üÜï v3.4 Êõ¥Êñ∞ÂΩíÂõ†Êò†Â∞Ñ
            const blameMap = {
                'type': 'regex_service',      // Á±ªÂûãËØÜÂà´ ‚Üí Ê≠£ÂàôÊúçÂä°
                'amount': 'regex_service',    // ÈáëÈ¢ùÊèêÂèñ ‚Üí Ê≠£ÂàôÊúçÂä°
                'num': 'regex_service',       // Âè∑Á†ÅÊèêÂèñ ‚Üí Ê≠£ÂàôÊúçÂä°
                'subtype': 'regex_service',   // Â≠êÁ±ªÂûãËØÜÂà´ ‚Üí Ê≠£ÂàôÊúçÂä°
                'count': 'calc_service',      // Ê≥®Êï∞Â±ïÂºÄ ‚Üí ËÆ°ÁÆóÊúçÂä°
                'win': 'calc_service'         // ÂëΩ‰∏≠Âà§Êñ≠ ‚Üí ËÆ°ÁÆóÊúçÂä°
            };
            item.errorBlame = blameMap[errType] || 'unknown';
            
            // üÜï v3.4 ‰øùÂ≠òÊõ¥ÂÆåÊï¥ÁöÑÁ≥ªÁªüÂΩìÂâçÂÄº
            item.systemValue = {
                type: item.type,
                code: item.code,
                subType: item.subType,
                zodiac: item.zodiac,
                numbers: item.numbers || item.number,
                amount: item.amount,
                count: 1,
                isWin: item.isWin,
                winAmount: item.winAmount,
                odds: item.odds
            };
            
            // Êõ¥Êñ∞Ê†áÁ≠æÊ†∑Âºè
            document.querySelectorAll(`.fb-err-tag[data-idx="${index}"]`).forEach(tag => {
                const isSelected = tag.dataset.err === errType;
                tag.style.background = isSelected ? 'rgba(244,67,54,0.3)' : 'rgba(255,255,255,0.1)';
                tag.style.color = isSelected ? '#f44336' : '#ccc';
                tag.style.borderColor = isSelected ? '#f44336' : 'rgba(255,255,255,0.2)';
            });
            
            // Ëé∑ÂèñÂÖÉÁ¥†
            const hintEl = document.getElementById(`fb-hint-${index}`);
            const ruleEl = document.getElementById(`fb-rule-${index}`);
            const inputWrapper = document.getElementById(`fb-input-wrapper-${index}`);
            const typeSelect = document.getElementById(`fb-type-select-${index}`);
            const subtypeSelect = document.getElementById(`fb-subtype-select-${index}`);
            const winSelect = document.getElementById(`fb-win-select-${index}`);
            const correctionInput = document.getElementById(`fb-correction-${index}`);
            
            // ÈöêËóèÊâÄÊúâËæìÂÖ•Âå∫ÂüüÔºà‰∏çÊ∏ÖÁ©∫ÂÄºÔºåÂêéÈù¢‰ºöÊ†πÊçÆÈîôËØØÁ±ªÂûãÊÅ¢Â§çÔºâ
            if (typeSelect) typeSelect.style.display = 'none';
            if (subtypeSelect) subtypeSelect.style.display = 'none';
            if (winSelect) winSelect.style.display = 'none';
            if (correctionInput) correctionInput.style.display = 'none';
            if (ruleEl) ruleEl.style.display = 'none';
            
            // üÜï v3.4 Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãËé∑ÂèñÈÖçÁΩÆ
            const typeConfig = PLAY_TYPE_CONFIG[currentCode] || {};
            const winRuleText = typeof typeConfig.winRule === 'string' 
                ? typeConfig.winRule 
                : (typeConfig.winRule?.[item.subType] || typeConfig.winRule?.[currentType] || '');
            
            // üÜï v3.4 Ê†πÊçÆÈîôËØØÁ±ªÂûãÂíåÁé©Ê≥ïÁ±ªÂûãÁîüÊàêÊèêÁ§∫
            let hint = '';
            let showRule = false;
            
            switch(errType) {
                case 'type':
                    hint = `üí° ÂΩìÂâçËØÜÂà´: <b>${currentType}</b>ÔºåÊ≠£Á°ÆÁ±ªÂûãÊòØÔºü`;
                    if (typeSelect) typeSelect.style.display = 'block';
                    break;
                    
                case 'amount':
                    hint = `üí° ÂΩìÂâçËØÜÂà´: <b>${item.amount}ÂÖÉ/Ê≥®</b>ÔºåÊ≠£Á°ÆÈáëÈ¢ùÊòØÔºü`;
                    if (correctionInput) {
                        correctionInput.style.display = 'block';
                        correctionInput.placeholder = 'ËæìÂÖ•Ê≠£Á°ÆÈáëÈ¢ùÔºàÊï∞Â≠óÔºâ';
                    }
                    break;
                    
                case 'num':
                    hint = `üí° ÂΩìÂâçËØÜÂà´: <b>${item.numbers || item.number || 'Êó†'}</b>ÔºåÊ≠£Á°ÆÂè∑Á†ÅÊòØÔºü`;
                    if (correctionInput) {
                        correctionInput.style.display = 'block';
                        correctionInput.placeholder = 'ËæìÂÖ•Ê≠£Á°ÆÂè∑Á†ÅÔºàÂ¶Ç: 35,47Ôºâ';
                    }
                    break;
                    
                case 'subtype':
                    // üÜï v3.4 Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÊòæÁ§∫ÂØπÂ∫îÁöÑÂ≠êÁ±ªÂûãÈÄâÈ°π
                    hint = generateSubtypeHint(currentType, currentCode, item);
                    if (subtypeSelect) {
                        populateSubtypeDropdown(index, currentType, currentCode);
                        subtypeSelect.style.display = 'block';
                    }
                    showRule = true;
                    break;
                    
                case 'count':
                    hint = `üí° ÂΩìÂâçËÆ°ÁÆó: <b>1Ê≥®</b>ÔºåÊ≠£Á°ÆÊ≥®Êï∞ÊòØÔºü`;
                    if (correctionInput) {
                        correctionInput.style.display = 'block';
                        correctionInput.placeholder = 'ËæìÂÖ•Ê≠£Á°ÆÊ≥®Êï∞ÔºàÊï∞Â≠óÔºâ';
                    }
                    break;
                    
                case 'win':
                    // üÜï v3.4 ÂëΩ‰∏≠Âà§Êñ≠‰ΩøÁî®‰∏ãÊãâÈÄâÊã©
                    hint = `üí° ÂΩìÂâçÂà§Êñ≠: <b>${item.isWin ? 'ÂëΩ‰∏≠ +' + item.winAmount + 'ÂÖÉ' : 'Êú™ÂëΩ‰∏≠'}</b>`;
                    if (winSelect) winSelect.style.display = 'block';
                    showRule = true;
                    break;
            }
            
            // ÊòæÁ§∫ÊèêÁ§∫
            if (hintEl) {
                hintEl.innerHTML = hint;
                hintEl.style.display = 'block';
            }
            
            // üÜï v3.4 ÊòæÁ§∫ÂëΩ‰∏≠ËßÑÂàôËØ¥ÊòéÔºàÊõ¥ÈÄö‰øóÊòìÊáÇÁöÑÊñáÂ≠óÔºâ
            if (showRule && ruleEl && winRuleText) {
                ruleEl.innerHTML = `üìã Âà§Êñ≠ËßÑÂàô: ${winRuleText}`;
                ruleEl.style.display = 'block';
            }
            
            // üÜï v3.11.17 ÊÅ¢Â§çÊñ∞ÈîôËØØÁ±ªÂûã‰πãÂâç‰øùÂ≠òÁöÑ‰øÆÊ≠£ÂÄºÂíåÂ§áÊ≥®
            item.correctionsByType = item.correctionsByType || {};
            item.notesByType = item.notesByType || {};
            
            const savedCorrection = item.correctionsByType[errType] || '';
            const savedNote = item.notesByType[errType] || '';
            
            // ÊÅ¢Â§ç‰øÆÊ≠£ÂÄºËæìÂÖ•Ê°Ü
            const correctionEl = document.getElementById(`fb-correction-${index}`);
            if (correctionEl) {
                correctionEl.value = savedCorrection;
            }
            
            // ÊÅ¢Â§çÂ§áÊ≥®ËæìÂÖ•Ê°Ü
            const noteEl = document.getElementById(`fb-note-${index}`);
            if (noteEl) {
                noteEl.value = savedNote;
            }
            
            // ÂêåÊ≠•Âà∞ item ÂØπË±°
            item.correction = savedCorrection;
            item.note = savedNote;
            
            if (inputWrapper) inputWrapper.style.display = 'block';
        }
        
        // üÜï v3.4 Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÁîüÊàêÂ≠êÁ±ªÂûãÊèêÁ§∫
        function generateSubtypeHint(typeName, typeCode, item) {
            const config = PLAY_TYPE_CONFIG[typeCode];
            if (!config) return `üí° ÂΩìÂâçËØÜÂà´: <b>${typeName}</b>ÔºåÊ≠£Á°ÆÈÄâÈ°πÊòØÔºü`;
            
            // Ê†πÊçÆ‰∏çÂêåÁ±ªÂûãÊòæÁ§∫ÂΩìÂâçËØÜÂà´ÁöÑÂ≠êÁ±ªÂûã
            let currentSubtype = item.subType || item.zodiac || typeName;
            
            if (['DXDS', 'XS', 'DS', 'ODD', 'EVEN'].includes(typeCode) || 
                ['Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÂ§ßÂ∞èÂçïÂèåÊòØÔºü`;
            }
            
            if (['BS', 'C1', 'C2', 'C3'].includes(typeCode) || 
                ['Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢', 'Ê≥¢Ëâ≤'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÈ¢úËâ≤ÊòØÔºü`;
            }
            
            if (['BB'].includes(typeCode) || 
                ['Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è', 'ÂçäÊ≥¢'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÂçäÊ≥¢ÊòØÔºü`;
            }
            
            if (['PT1', 'TX', 'SX', 'ZX'].includes(typeCode) || 
                ['Âπ≥Áâπ‰∏ÄËÇñ', 'ÁâπËÇñ', 'ÁîüËÇñ', 'Ê≠£ËÇñ'].includes(typeName)) {
                const zodiacName = item.zodiac ? Z_CODE_NAMES[item.zodiac] || item.zodiac : currentSubtype;
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${zodiacName}</b>ÔºåÊ≠£Á°ÆÁöÑÁîüËÇñÊòØÔºü`;
            }
            
            if (['ZH'].includes(typeCode) || ['ÊÄªÂíå', 'ÊÄªÂíåÂ§ß', 'ÊÄªÂíåÂ∞è', 'ÊÄªÂíåÂçï', 'ÊÄªÂíåÂèå'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÊÄªÂíåÁ±ªÂûãÊòØÔºü`;
            }
            
            if (['JY'].includes(typeCode) || ['ÂÆ∂Á¶ΩÈáéÂÖΩ', 'ÂÆ∂Á¶Ω', 'ÈáéÂÖΩ'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÊòØÂÆ∂Á¶ΩËøòÊòØÈáéÂÖΩÔºü`;
            }
            
            if (['TS'].includes(typeCode) || ['Â§¥Êï∞', '0Â§¥', '1Â§¥', '2Â§¥', '3Â§¥', '4Â§¥'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÂ§¥Êï∞ÊòØÔºü`;
            }
            
            if (['WS', 'PTW'].includes(typeCode) || typeName.includes('Â∞æ')) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑÂ∞æÊï∞ÊòØÔºü`;
            }
            
            if (['WX'].includes(typeCode) || ['‰∫îË°å', 'Èáë', 'Êú®', 'Ê∞¥', 'ÁÅ´', 'Âúü'].includes(typeName)) {
                return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÁöÑ‰∫îË°åÊòØÔºü`;
            }
            
            return `üí° ÂΩìÂâçËØÜÂà´: <b>${currentSubtype}</b>ÔºåÊ≠£Á°ÆÈÄâÈ°πÊòØÔºü`;
        }
        
        // üÜï v3.4 Â°´ÂÖÖÂ≠êÁ±ªÂûã‰∏ãÊãâÊ°Ü
        function populateSubtypeDropdown(index, typeName, typeCode) {
            const dropdown = document.getElementById(`fb-subtype-dropdown-${index}`);
            if (!dropdown) return;
            
            let options = ['<option value="">ÈÄâÊã©Ê≠£Á°ÆÈÄâÈ°π</option>'];
            
            // Ê†πÊçÆÁ±ªÂûãÁ°ÆÂÆöÂ≠êÁ±ªÂûãÈÄâÈ°π
            if (['Â§ßÂ∞èÂçïÂèå', 'Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå'].includes(typeName) ||
                ['DXDS', 'XS', 'DS', 'ODD', 'EVEN'].includes(typeCode)) {
                options.push(...['Â∞èÊï∞', 'Â§ßÊï∞', 'ÂçïÊï∞', 'ÂèåÊï∞', 'ÂêàÂ§ß', 'ÂêàÂ∞è', 'ÂêàÂçï', 'ÂêàÂèå'].map(t => 
                    `<option value="${t}">${t}</option>`));
            }
            else if (['Ê≥¢Ëâ≤', 'Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢'].includes(typeName) || ['BS'].includes(typeCode)) {
                options.push(...['Á∫¢Ê≥¢', 'ËìùÊ≥¢', 'ÁªøÊ≥¢'].map(t => `<option value="${t}">${t}</option>`));
            }
            else if (['ÂçäÊ≥¢', 'Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è'].includes(typeName) ||
                     ['BB'].includes(typeCode)) {
                options.push(...['Á∫¢Âçï', 'Á∫¢Âèå', 'Á∫¢Â§ß', 'Á∫¢Â∞è', 'ËìùÂçï', 'ËìùÂèå', 'ËìùÂ§ß', 'ËìùÂ∞è', 'ÁªøÂçï', 'ÁªøÂèå', 'ÁªøÂ§ß', 'ÁªøÂ∞è'].map(t => 
                    `<option value="${t}">${t}</option>`));
            }
            else if (['Âπ≥Áâπ‰∏ÄËÇñ', 'ÁâπËÇñ', 'ÁîüËÇñ', 'Ê≠£ËÇñ'].includes(typeName) || 
                     ['PT1', 'TX', 'SX', 'ZX'].includes(typeCode)) {
                options.push(...['Èº†', 'Áâõ', 'Ëôé', 'ÂÖî', 'Èæô', 'Ëõá', 'È©¨', 'Áæä', 'Áå¥', 'È∏°', 'Áãó', 'Áå™'].map(t => 
                    `<option value="${t}">${t}</option>`));
            }
            else if (['ÊÄªÂíå', 'ÊÄªÂíåÂ§ß', 'ÊÄªÂíåÂ∞è', 'ÊÄªÂíåÂçï', 'ÊÄªÂíåÂèå'].includes(typeName) || ['ZH'].includes(typeCode)) {
                options.push(...['ÊÄªÂíåÂ§ß', 'ÊÄªÂíåÂ∞è', 'ÊÄªÂíåÂçï', 'ÊÄªÂíåÂèå'].map(t => `<option value="${t}">${t}</option>`));
            }
            else if (['ÂÆ∂Á¶ΩÈáéÂÖΩ', 'ÂÆ∂Á¶Ω', 'ÈáéÂÖΩ'].includes(typeName) || ['JY'].includes(typeCode)) {
                options.push(...['ÂÆ∂Á¶Ω', 'ÈáéÂÖΩ'].map(t => `<option value="${t}">${t}</option>`));
            }
            else if (['Â§¥Êï∞', '0Â§¥', '1Â§¥', '2Â§¥', '3Â§¥', '4Â§¥'].includes(typeName) || ['TS'].includes(typeCode)) {
                options.push(...['0Â§¥', '1Â§¥', '2Â§¥', '3Â§¥', '4Â§¥'].map(t => `<option value="${t}">${t}</option>`));
            }
            else if (typeName.includes('Â∞æ') || ['WS', 'PTW'].includes(typeCode)) {
                options.push(...['0Â∞æ', '1Â∞æ', '2Â∞æ', '3Â∞æ', '4Â∞æ', '5Â∞æ', '6Â∞æ', '7Â∞æ', '8Â∞æ', '9Â∞æ'].map(t => 
                    `<option value="${t}">${t}</option>`));
            }
            else if (['‰∫îË°å', 'Èáë', 'Êú®', 'Ê∞¥', 'ÁÅ´', 'Âúü'].includes(typeName) || ['WX'].includes(typeCode)) {
                options.push(...['Èáë', 'Êú®', 'Ê∞¥', 'ÁÅ´', 'Âúü'].map(t => `<option value="${t}">${t}</option>`));
            }
            else {
                // ÈªòËÆ§‰ΩøÁî®ÈÄöÁî®ÈÄâÈ°π
                options.push(...PLAY_TYPES.map(t => `<option value="${t}">${t}</option>`));
            }
            
            dropdown.innerHTML = options.join('');
        }
        
        // üÜï v3.4 ËÆæÁΩÆÂ≠êÁ±ªÂûã‰øÆÊ≠£
        function setSubtypeCorrection(index, value) {
            const item = feedbackData.items[index];
            item.correction = value;
            item.subtypeCorrection = value;
        }
        
        // üÜï v3.4 ËÆæÁΩÆÂëΩ‰∏≠Âà§Êñ≠‰øÆÊ≠£
        function setWinCorrection(index, value) {
            const item = feedbackData.items[index];
            item.correction = value;
            item.winCorrection = value;
        }
        
        // ËÆæÁΩÆÊ≠£Á°ÆÁ±ªÂûã
        function setCorrectType(index, value) {
            feedbackData.items[index].correction = value;
        }
        
        // ËÆæÁΩÆ‰øÆÊ≠£ÂÜÖÂÆπ
        function setCorrection(index, value) {
            feedbackData.items[index].correction = value;
        }
        
        // ËÆæÁΩÆÂ§áÊ≥®
        function setItemNote(index, value) {
            feedbackData.items[index].note = value;
        }
        
        // Êõ¥Êñ∞ÈîôËØØËÆ°Êï∞
        function updateErrorCount() {
            const count = feedbackData.items.filter(item => item.hasError).length;
            feedbackData.errorCount = count;
            document.getElementById('fb-error-count').textContent = count;
            
            // Ê†πÊçÆÊòØÂê¶ÊúâÈîôËØØÊõ¥Êñ∞ÊåâÈíÆÁä∂ÊÄÅ
            const btn = document.getElementById('fb-submit-btn');
            if (count > 0) {
                btn.style.opacity = '1';
                btn.style.cursor = 'pointer';
                } else {
                btn.style.opacity = '0.5';
                btn.style.cursor = 'default';
            }
        }
        
        // ÂÖºÂÆπÊóßÂáΩÊï∞
        function hideFeedbackModal() {
            showPage('page-main');
        }
        
        function toggleItemFeedback(index, type) {
            // ÂÖºÂÆπÊóßË∞ÉÁî®
        }
        
        function updateItemCardStyle(index) {
            // ÂÖºÂÆπÊóß‰ª£Á†Å
            const item = feedbackData.items[index];
            const card = document.querySelector(`.fb-card[data-index="${index}"]`);
            if (!card) return;
            
            if (item?.hasError) {
                card.style.borderLeftColor = '#f44336';
                card.style.background = 'rgba(244,67,54,0.1)';
            } else {
                card.style.borderLeftColor = '#666';
                card.style.background = 'rgba(255,255,255,0.05)';
            }
        }
        
        // ÂÖºÂÆπÊóßÂáΩÊï∞Ôºà‰øùÁïôÔºâ
        function toggleCalcFeedback(type) {}
        function updateCalcButtonStyles() {}
        function renderCalcResult() {}
        function feedbackQuickAll(action) {}
        function updateFeedbackStats() {}
        function updateFeedbackDetail() {}
        
        // Êî∂ÈõÜÂÆåÊï¥Ë∞ÉËØï‰ø°ÊÅØÔºà‰∏≠ÊñáÂ≠óÊÆµÂêçÔºåÊñπ‰æøÊü•ÁúãÔºâ
        function collectDebugInfo() {
            // Ëé∑ÂèñÂºÄÂ•ñ‰ø°ÊÅØ
            const currentType = appState.currentLotteryType || 'xam';
            const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø', am: 'Êæ≥Èó®' };
            const lotteryNums = appState.lotteryNumbers || [];
            const tema = lotteryNums[6];
            
            // Ê†ºÂºèÂåñ‰∏ãÊ≥®ÂàóË°®Ôºà‰∏≠ÊñáÔºâ
            const betsFormatted = (parsedBets || []).map((b, i) => ({
                Â∫èÂè∑: i + 1,
                Á±ªÂûã: b.type,
                Âè∑Á†Å: b.number || b.value || '',
                ÈáëÈ¢ù: b.amount + 'ÂÖÉ'
            }));
            
            // Ê†ºÂºèÂåñËÆ°ÁÆóÁªìÊûúÔºà‰∏≠ÊñáÔºâ
            const resultsFormatted = (calcResults || []).map((r, i) => ({
                Â∫èÂè∑: i + 1,
                Á±ªÂûã: r.type,
                Âè∑Á†Å: r.number || r.value || '',
                ‰∏ãÊ≥®: r.amount + 'ÂÖÉ',
                ÊòØÂê¶‰∏≠Â•ñ: r.isWin ? '‚úì‰∏≠Â•ñ' : '‚úóÊú™‰∏≠',
                ‰∏≠Â•ñÈáëÈ¢ù: r.isWin ? r.winAmount + 'ÂÖÉ' : '0ÂÖÉ'
            }));
            
            // ËÆ°ÁÆóÊ±áÊÄªÊï∞ÊçÆ
            const totalBet = calcResults?.reduce((sum, r) => sum + r.amount, 0) || 0;
            const winCount = calcResults?.filter(r => r.isWin).length || 0;
            const winAmount = calcResults?.filter(r => r.isWin).reduce((sum, r) => sum + r.winAmount, 0) || 0;
            const profit = winAmount - totalBet;
            
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            // üìä ÁîüÊàêÊéßÂà∂Âè∞È£éÊ†ºÁöÑÊòìËØªÊÄªÁªìÔºàÊñπ‰æøÂú®SupabaseÂêéÂè∞Âø´ÈÄüÊü•ÁúãÔºâ
            // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
            const userInput = document.getElementById('bet-input')?.value || '';
            const pingmaStr = lotteryNums.slice(0,6).map(n => String(n).padStart(2,'0')).join(' ') || 'Êú™ËÆæÁΩÆ';
            const temaStr = tema ? String(tema).padStart(2,'0') : 'Êú™ËÆæÁΩÆ';
            
            // ÊåâÁ±ªÂûãÂàÜÁªÑÁªüËÆ°
            const betsByType = {};
            (parsedBets || []).forEach(b => {
                const key = b.type;
                if (!betsByType[key]) betsByType[key] = { nums: [], amount: b.amount, count: 0 };
                betsByType[key].nums.push(b.number || b.value || '');
                betsByType[key].count++;
            });
            
            // ÁîüÊàê‰∏ãÊ≥®ÊòéÁªÜÊñáÊú¨
            let betDetailText = '';
            for (const [type, data] of Object.entries(betsByType)) {
                const numsStr = data.nums.slice(0, 10).join(',') + (data.nums.length > 10 ? '...' : '');
                betDetailText += `   üìå ${type}: ${numsStr} ÂêÑ${data.amount}ÂÖÉ (${data.count}Ê≥®)\n`;
            }
            
            // ÁîüÊàê‰∏≠Â•ñÊòéÁªÜÊñáÊú¨
            const winBets = (calcResults || []).filter(r => r.isWin);
            let winDetailText = '';
            if (winBets.length > 0) {
                winBets.forEach(w => {
                    winDetailText += `   üéØ ${w.type} ${w.number || w.value} ‚Üí ${w.amount}ÂÖÉ√ó${w.odds}ÂÄç=${w.winAmount}ÂÖÉ\n`;
                });
            } else {
                winDetailText = '   (Êó†‰∏≠Â•ñ)\n';
            }
            
            // ÁªÑË£ÖÊéßÂà∂Âè∞È£éÊ†ºÊÄªÁªì
            const summaryText = `
‚ïî‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïó
‚ïë                    üìä ÂèçÈ¶àÊï∞ÊçÆÂø´ÈÄüÊÄªÁªì                        ‚ïë
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë üìù Áî®Êà∑ËæìÂÖ•:
‚ïë    "${userInput.substring(0, 60)}${userInput.length > 60 ? '...' : ''}"
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë üé∞ ÂºÄÂ•ñ‰ø°ÊÅØ:
‚ïë    ÂΩ©Áßç: ${typeNames[currentType] || currentType}  ÊúüÂè∑: ${appState.lotteryData[currentType]?.issue || 'Êú™Áü•'}
‚ïë    Âπ≥Á†Å: ${pingmaStr}
‚ïë    ÁâπÁ†Å: ${temaStr}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë ü§ñ AIÂ§ÑÁêÜ:
‚ïë    ÂèëÈÄÅÂÜÖÂÆπ: "${(debugInfo.aiInput || '').substring(0, 50)}${(debugInfo.aiInput || '').length > 50 ? '...' : ''}"
‚ïë    ÈîôËØØ‰ø°ÊÅØ: ${debugInfo.lastError || 'Êó†'}
‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë üìã ËØÜÂà´ÁªìÊûú: ÂÖ±${parsedBets?.length || 0}Ê≥®
${betDetailText}‚ï†‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ï£
‚ïë üí∞ ËÆ°ÁÆóÁªìÊûú:
‚ïë    ÊÄª‰∏ãÊ≥®: ${totalBet}ÂÖÉ
‚ïë    ‰∏≠Â•ñ: ${winCount}Ê≥® / ${winAmount}ÂÖÉ
${winDetailText}‚ïë    ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
‚ïë    ${profit >= 0 ? 'üìà ÁõàÂà©' : 'üìâ ‰∫èÊçü'}: ${profit >= 0 ? '+' : ''}${profit}ÂÖÉ
‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù`;

            const info = {
                '1_Áî®Êà∑ÂéüÂßãËæìÂÖ•': userInput,
                
                '2_AIÂ§ÑÁêÜ': {
                    'ÂèëÈÄÅÁªôAIÁöÑÂÜÖÂÆπ': debugInfo.aiInput || '',
                    'AIËøîÂõûÂéüÊñá': debugInfo.aiOutput || '',
                    'AIËß£ÊûêÁªìÊûú': debugInfo.aiParsed || null,
                    'ÈîôËØØ‰ø°ÊÅØ': debugInfo.lastError || 'Êó†'
                },
                
                '3_ÂâçÁ´ØËß£ÊûêÁªìÊûú': {
                    'ËØÜÂà´Ê≥®Êï∞': (parsedBets?.length || 0) + 'Ê≥®',
                    '‰∏ãÊ≥®ÊòéÁªÜ': betsFormatted
                },
                
                '4_ÂºÄÂ•ñ‰ø°ÊÅØ': {
                    'ÂΩ©Áßç': typeNames[currentType] || currentType,
                    'ÊúüÂè∑': appState.lotteryData[currentType]?.issue || 'Êú™Áü•',
                    'Âπ≥Á†Å': lotteryNums.slice(0,6).join(',') || 'Êú™ËÆæÁΩÆ',
                    'ÁâπÁ†Å': tema || 'Êú™ËÆæÁΩÆ'
                },
                
                '5_ËµîÁéáËÆæÁΩÆ': JSON.parse(localStorage.getItem('lhc_odds') || '{}'),
                
                '6_ËÆ°ÁÆóÁªìÊûú': {
                    'ÊÄª‰∏ãÊ≥®': totalBet + 'ÂÖÉ',
                    '‰∏≠Â•ñÊ≥®Êï∞': winCount + 'Ê≥®',
                    '‰∏≠Â•ñÈáëÈ¢ù': winAmount + 'ÂÖÉ',
                    'Áõà‰∫è': (profit >= 0 ? '+' : '') + profit + 'ÂÖÉ',
                    'ËÆ°ÁÆóÊòéÁªÜ': resultsFormatted
                },
                
                '7_Âø´ÈÄüÊÄªÁªì': summaryText
            };
            
            return info;
        }
        
        // Êèê‰∫§ÂèçÈ¶àÂà∞ Supabase
        // ÊóßÁâàÊèê‰∫§ÂáΩÊï∞Ôºà‰øùÁïôÂÖºÂÆπÊÄßÔºâ
        async function submitFeedback() {
            // Ë∞ÉÁî®Êñ∞ÁâàÊèê‰∫§ÂáΩÊï∞
            await submitFeedbackNew();
        }
        
        // Á≤æÂáÜÁ∫†ÈîôÁâà - Êèê‰∫§ÂèçÈ¶àÂáΩÊï∞
        async function submitFeedbackNew() {
            // Âè™Êèê‰∫§Ê†áËÆ∞‰∏∫ÈîôËØØÁöÑÊù°ÁõÆ
            const errorItems = feedbackData.items.filter(item => item.hasError);
            
            if (errorItems.length === 0) {
                showAutoCloseToast('‚ö†Ô∏è ËØ∑ÁÇπÂáª ‚ùå Ê†áËÆ∞Ëá≥Â∞ë‰∏Ä‰∏™ÈîôËØØÊù°ÁõÆ', 2000);
                return;
            }
            
            // Ëé∑ÂèñÂºÄÂ•ñ‰ø°ÊÅØ
            const currentType = appState.currentLotteryType || 'xam';
            const typeNames = { xam: 'Êñ∞Êæ≥', hk: 'È¶ôÊ∏Ø', am: 'Êæ≥Èó®' };
            const lotteryNums = appState.lotteryNumbers || [];
            const tema = lotteryNums[6];
            
            // ËÆ°ÁÆóÊ±áÊÄª
            const totalBet = calcResults?.reduce((sum, r) => sum + r.amount, 0) || 0;
            const winAmount = calcResults?.filter(r => r.isWin).reduce((sum, r) => sum + r.winAmount, 0) || 0;
            const profit = winAmount - totalBet;
            
            // ÊûÑÂª∫Á≤æÂáÜÁ∫†ÈîôÊï∞ÊçÆÂåÖ
            const submitData = {
                version: APP_VERSION,
                feedback_version: '2.0_precise',
                timestamp: new Date().toISOString(),
                
                // ÂºÄÂ•ñ‰ø°ÊÅØ
                lottery: {
                    type: typeNames[currentType] || currentType,
                    issue: appState.lotteryData[currentType]?.issue || 'Êú™Áü•',
                    numbers: lotteryNums,
                    tema: tema
                },
                
                // Áî®Êà∑ÂéüÂßãËæìÂÖ•
                user_input: document.getElementById('bet-input')?.value || '',
                
                // Ê±áÊÄªÊï∞ÊçÆ
                summary: {
                    total_items: feedbackData.items.length,
                    error_count: errorItems.length,
                    total_bet: totalBet,
                    profit: profit
                },
                
                // üÜï v3.4 ÈîôËØØÊù°ÁõÆÔºàÊ†∏ÂøÉÊï∞ÊçÆÔºâ- Ê†πÊçÆÁé©Ê≥ïÁ±ªÂûãÊî∂ÈõÜÂÆåÊï¥ËÉåÊôØ‰ø°ÊÅØ
                error_reports: errorItems.map(item => {
                    // Ëé∑ÂèñÁé©Ê≥ïÁ±ªÂûãÈÖçÁΩÆ
                    const typeCode = item.code || getTypeCode(item.type) || 'T01';
                    const typeConfig = PLAY_TYPE_CONFIG[typeCode] || {};
                    
                    return {
                        // 1Ô∏è‚É£ Ê†áËÆ∞ÁöÑËÆ∞ÂΩï‰ø°ÊÅØ
                        item_index: item.index,
                        item_raw: item.originalLine || item.original || '',
                        item_group_id: item.groupId,
                        item_line_id: item.lineId,
                        
                        // 2Ô∏è‚É£ Á≥ªÁªüËØÜÂà´/ËÆ°ÁÆóÁªìÊûúÔºàüÜï v3.4 Êõ¥ÂÆåÊï¥Ôºâ
                        system: {
                            type: item.type,
                            type_code: typeCode,
                            sub_type: item.subType || null,
                            zodiac: item.zodiac || null,
                            zodiac_name: item.zodiac ? (Z_CODE_NAMES[item.zodiac] || item.zodiac) : null,
                            numbers: item.numbers || item.number || null,
                            amount: item.amount,
                            count: 1,
                            is_win: item.isWin,
                            win_amount: item.winAmount,
                            odds: item.odds
                        },
                        
                        // üÜï v3.4 Áé©Ê≥ïÈÖçÁΩÆ‰ø°ÊÅØÔºà‰æø‰∫éAIÁêÜËß£ËßÑÂàôÔºâ
                        type_config: {
                            name: typeConfig.name || item.type,
                            has_subtypes: !!typeConfig.subTypes,
                            subtypes: typeConfig.subTypes || null,
                            win_rule: typeof typeConfig.winRule === 'string' 
                                ? typeConfig.winRule 
                                : (typeConfig.winRule?.[item.subType] || typeConfig.winRule?.[item.type] || null),
                            need_fields: typeConfig.needFields || [],
                            default_odds: typeConfig.defaultOdds || null
                        },
                        
                        // 3Ô∏è‚É£ ÈîôËØØÁ±ªÂûãÔºàüÜï v3.4 Â¢ûÂä†subtypeÔºâ
                        // type=Á±ªÂûãÈîô, amount=ÈáëÈ¢ùÈîô, num=Âè∑Á†ÅÈîô, subtype=Â≠êÁ±ªÂûãÈîô, count=Ê≥®Êï∞Èîô, win=ÂëΩ‰∏≠Èîô
                        error_type: item.errorType,
                        
                        // 4Ô∏è‚É£ ÈîôËØØÂΩíÂõ†ÔºàÂÆö‰Ωç‰øÆÊîπÂì™‰∏™Êñá‰ª∂Ôºâ
                        // regex_service=Ê≠£ÂàôÊúçÂä°, calc_service=ËÆ°ÁÆóÊúçÂä°
                        error_blame: item.errorBlame,
                        
                        // 5Ô∏è‚É£ Áî®Êà∑‰øÆÊ≠£ÂÄºÔºàüÜï v3.4 Âå∫ÂàÜ‰∏çÂêåÁ±ªÂûãÁöÑ‰øÆÊ≠£Ôºâ
                        user_correction: item.correction,
                        subtype_correction: item.subtypeCorrection || null,
                        win_correction: item.winCorrection || null,
                        
                        // 6Ô∏è‚É£ Â§áÊ≥®
                        note: item.note || ''
                    };
                }),
                
                // AIË∞ÉËØï‰ø°ÊÅØ
                ai_debug: {
                    input_sent: debugInfo.aiInput || '',
                    output_raw: debugInfo.aiOutput || '',
                    parsed_result: debugInfo.aiParsed || null,
                    last_error: debugInfo.lastError || ''
                }
            };
            
            console.log('üì§ Á≤æÂáÜÁ∫†ÈîôÊï∞ÊçÆÂåÖ:', submitData);
            
            try {
                showAutoCloseToast('üì§ Ê≠£Âú®Êèê‰∫§ÈîôËØØÊä•Âëä...', 3000);
                
                // Ëé∑ÂèñÊ†ºÂºèËÆæÁΩÆ‰∏≠ÁöÑAI‰ø°ÊÅØ
                const settings = getFormatSettings();
                
                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                // ÊûÑÂª∫„ÄêÂÆåÊï¥Ë∞ÉËØïÈìæÊù°„ÄëÊï∞ÊçÆ v3.1 - ‰æø‰∫éÁ≤æÂáÜÂÆö‰ΩçÈóÆÈ¢òÁéØËäÇ
                // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
                const dbData = {
                    version: APP_VERSION,
                    app_version: APP_VERSION,
                    backend_version: debugInfo.backendVersion || '',  // üÜï v3.2.1 ÂêéÁ´ØÁâàÊú¨
                    
                    // üìå Á¨¨1Ê≠•ÔºöÁî®Êà∑ÂéüÂßãËæìÂÖ•
                    raw_input: document.getElementById('bet-input')?.value || '',
                    
                    // üìå Á¨¨2Ê≠•ÔºöÂâçÁ´ØËÑ±ÊïèËΩ¨Êç¢ÔºàÊöóÂè∑Ôºâ
                    sanitized_input: debugInfo.sanitizedInput || debugInfo.aiInput || '',
                    
                    // üìå Á¨¨3Ê≠•ÔºöÂêéÁ´ØËØÜÂà´
                    backend_method: debugInfo.modelUsed === 'regex' ? 'regex' : 'ai',
                    
                    // üÜï v3.1 Ê≠£ÂàôËØÜÂà´ÁªìÊûúÔºàÂÖ≥ÈîÆÔºÅÂåÖÂê´ code, zodiac, nums, amtÔºâ
                    regex_items: JSON.stringify(debugInfo.extractItems || []),
                    
                    // AIËØÜÂà´ÁªìÊûúÔºàÂΩì backend_method ÊòØ ai Êó∂Ôºâ
                    ai_provider: settings.aiProvider || 'unknown',
                    ai_model: debugInfo.modelUsed || '',
                    ai_raw_response: (debugInfo.aiOutput || '').substring(0, 3000),
                    ai_parsed_result: JSON.stringify(debugInfo.aiParsed || null),
                    ai_latency_ms: debugInfo.latencyMs || 0,
                    
                    // üìå Á¨¨4Ê≠•ÔºöÂêéÁ´ØËÆ°ÁÆóÔºàüÜï v3.1 Êñ∞Â¢ûÂÖ≥ÈîÆÂ≠óÊÆµÔºâ
                    calc_input_count: debugInfo.calcInputCount || 0,     // ËØÜÂà´Êù°Êï∞
                    calc_output_count: debugInfo.calcOutputCount || 0,   // Â±ïÂºÄÂêéÊù°Êï∞ÔºàÂÖ≥ÈîÆÔºÅÔºâ
                    calc_items: JSON.stringify((debugInfo.calcItems || []).slice(0, 100)),  // ËÆ°ÁÆóÂêéÊØèÊù°ËØ¶ÊÉÖ
                    calc_s1: debugInfo.calcS1 || 0,   // ÊÄªÊäïÂÖ•
                    calc_s2: debugInfo.calcS2 || 0,   // ÂëΩ‰∏≠Êï∞
                    calc_s3: debugInfo.calcS3 || 0,   // ÂëΩ‰∏≠ÈáëÈ¢ù
                    calc_s4: debugInfo.calcS4 || 0,   // ÁªìÁÆó
                    calc_latency_ms: debugInfo.latencyMs || 0,
                    // üÜï v3.11.22 Â¢ûÂº∫Ë∞ÉËØï‰ø°ÊÅØÔºàÁ≤æÂáÜÂÆö‰ΩçÈóÆÈ¢òÔºâ
                    skip_regex_reason: debugInfo.skipRegexReason || null,         // Ë∑≥ËøáÊ≠£ÂàôÁöÑÂéüÂõ†
                    ai_items_count: debugInfo.aiItemsCount || 0,                  // AIËØÜÂà´ÁöÑÂéüÂßãËÆ∞ÂΩïÊï∞ÔºàÈ¢ÑÂ§ÑÁêÜÂâçÔºâ
                    preprocess_log: JSON.stringify(debugInfo.preprocessLog || []), // È¢ÑÂ§ÑÁêÜÊó•Âøó
                    
                    // üìå Á¨¨5Ê≠•ÔºöÂâçÁ´ØÊòæÁ§∫
                    display_items: JSON.stringify((calcResults || []).slice(0, 50).map(r => ({
                        type: r.type,
                        zodiac: r.zodiac,
                        numbers: r.numbers,
                        amount: r.amount,
                        isWin: r.isWin,
                        winAmount: r.winAmount
                    }))),
                    
                    // ÊóßÂ≠óÊÆµ‰øùÁïôÂÖºÂÆπ
                    restored_result: JSON.stringify((parsedBets || []).slice(0, 50)),
                    calc_bets: JSON.stringify((parsedBets || []).map(b => ({
                        type: b.type,
                        number: b.number || b.value,
                        amount: b.amount
                    })).slice(0, 50)),
                    calc_results: JSON.stringify((calcResults || []).map(r => ({
                        type: r.type,
                        number: r.number || r.value,
                        amount: r.amount,
                        isWin: r.isWin,
                        winAmount: r.winAmount,
                        odds: r.odds
                    })).slice(0, 50)),
                    
                    // üìå Á¨¨6Ê≠•ÔºöÂºÄÂ•ñ‰ø°ÊÅØ
                    lottery_type: submitData.lottery.type,
                    lottery_issue: submitData.lottery.issue,
                    lottery_numbers: JSON.stringify(submitData.lottery.numbers),
                    lottery_tema: submitData.lottery.tema,
                    
                    // üìå Á¨¨7Ê≠•ÔºöÊúÄÁªàÁªìÊûúÊ±áÊÄª
                    total_bets: submitData.summary.total_items,
                    total_amount: submitData.summary.total_bet,
                    win_count: (calcResults || []).filter(r => r.isWin).length,
                    win_amount: (calcResults || []).filter(r => r.isWin).reduce((s, r) => s + r.winAmount, 0),
                    profit: submitData.summary.profit,
                    
                    // üìå Á¨¨8Ê≠•ÔºöÁî®Êà∑ÂèçÈ¶àÁöÑÈîôËØØ v3.4
                    // error_stage: ÈîôËØØÂΩíÂõ†(regex_service/calc_service)
                    error_stage: errorItems[0]?.errorBlame || 'unknown',
                    // üÜï v3.4 error_detail: Êõ¥ËØ¶ÁªÜÁöÑÈîôËØØÊèèËø∞
                    error_detail: errorItems.map(e => {
                        let detail = `${e.errorType}`;
                        if (e.correction) detail += `:${e.correction}`;
                        if (e.subtypeCorrection) detail += ` [Â≠êÁ±ªÂûã‚Üí${e.subtypeCorrection}]`;
                        if (e.winCorrection) detail += ` [ÂëΩ‰∏≠‚Üí${e.winCorrection}]`;
                        if (e.note) detail += ` (${e.note})`;
                        return detail;
                    }).filter(n => n).join('; '),
                    // expected_result: Áî®Êà∑Â°´ÂÜôÁöÑ‰øÆÊ≠£ÂÄº
                    expected_result: errorItems[0]?.correction || errorItems[0]?.subtypeCorrection || '',
                    // error_items: ÂÆåÊï¥ÁöÑÈîôËØØÊä•ÂëäJSONÔºàüÜï v3.4 ÂåÖÂê´Áé©Ê≥ïÈÖçÁΩÆÔºâ
                    error_items: JSON.stringify(submitData.error_reports),
                    // üÜï v3.4 error_summary: Êõ¥Ê∏ÖÊô∞ÁöÑÂø´ÈÄüÊëòË¶Å
                    error_summary: errorItems.map(e => {
                        const typeCode = e.code || getTypeCode(e.type) || '';
                        const typeConfig = PLAY_TYPE_CONFIG[typeCode] || {};
                        return `[${e.type}/${typeCode}:${e.errorType}‚Üí${e.errorBlame}]${e.originalLine?.substring(0, 20) || ''}`;
                    }).join(' | '),
                    // üÜï v3.4 Áé©Ê≥ïÁ±ªÂûãÊ±áÊÄªÔºà‰æø‰∫éÂø´ÈÄü‰∫ÜËß£Ê∂âÂèäÁöÑÁé©Ê≥ïÔºâ
                    play_types_involved: [...new Set(errorItems.map(e => e.type))].join(','),
                    // üÜï v3.4 ÈîôËØØÁ±ªÂûãÊ±áÊÄª
                    error_types_involved: [...new Set(errorItems.map(e => e.errorType))].join(',')
                };
                
                console.log('üì§ ÂÆåÊï¥Ë∞ÉËØïÈìæÊù°Êï∞ÊçÆ:', dbData);
                
                const response = await fetch(`${SUPABASE_URL}/rest/v1/feedback`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8',
                        'apikey': SUPABASE_KEY,
                        'Authorization': `Bearer ${SUPABASE_KEY}`,
                        'Prefer': 'return=minimal'
                    },
                    body: JSON.stringify(dbData)
                });
                
                if (response.ok) {
                    showAutoCloseToast('‚úÖ ÂèçÈ¶àÊèê‰∫§ÊàêÂäüÔºÅÊÑüË∞¢ÊÇ®ÁöÑËØÑ‰ª∑', 3000);
                    setTimeout(() => {
                        showPage('page-main');
                    }, 1000);
                } else {
                    const errorText = await response.text();
                    console.error('ÂèçÈ¶àÊèê‰∫§Â§±Ë¥•:', errorText);
                    showAutoCloseToast('‚ùå Êèê‰∫§Â§±Ë¥•ÔºåËØ∑Á®çÂêéÈáçËØï', 3000);
                }
            } catch (e) {
                console.error('ÂèçÈ¶àÊèê‰∫§ÈîôËØØ:', e);
                showAutoCloseToast('‚ùå ÁΩëÁªúÈîôËØØÔºåËØ∑Á®çÂêéÈáçËØï', 3000);
            }
        }
        
        // ÂàùÂßãÂåñ
        init();
        </script>
    </body>
    </html>
